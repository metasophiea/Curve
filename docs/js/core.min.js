var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(h){var p=0;return function(){return p<h.length?{done:!1,value:h[p++]}:{done:!0}}};$jscomp.arrayIterator=function(h){return{next:$jscomp.arrayIteratorImpl(h)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(h,p,g){h!=Array.prototype&&h!=Object.prototype&&(h[p]=g.value)};$jscomp.getGlobal=function(h){return"undefined"!=typeof window&&window===h?h:"undefined"!=typeof global&&null!=global?global:h};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.Symbol=function(){var h=0;return function(p){return $jscomp.SYMBOL_PREFIX+(p||"")+h++}}();$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var h=$jscomp.global.Symbol.iterator;h||(h=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[h]&&$jscomp.defineProperty(Array.prototype,h,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var h=$jscomp.global.Symbol.asyncIterator;h||(h=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(h){$jscomp.initSymbolIterator();h={next:h};h[$jscomp.global.Symbol.iterator]=function(){return this};return h};
$jscomp.iteratorFromArray=function(h,p){$jscomp.initSymbolIterator();h instanceof String&&(h+="");var g=0,m={next:function(){if(g<h.length){var b=g++;return{value:p(b,h[b]),done:!1}}m.next=function(){return{done:!0,value:void 0}};return m.next()}};m[Symbol.iterator]=function(){return m};return m};
$jscomp.polyfill=function(h,p,g,m){if(p){g=$jscomp.global;h=h.split(".");for(m=0;m<h.length-1;m++){var b=h[m];b in g||(g[b]={});g=g[b]}h=h[h.length-1];m=g[h];p=p(m);p!=m&&null!=p&&$jscomp.defineProperty(g,h,{configurable:!0,writable:!0,value:p})}};$jscomp.polyfill("Array.prototype.keys",function(h){return h?h:function(){return $jscomp.iteratorFromArray(this,function(h){return h})}},"es6","es3");
$jscomp.polyfill("Array.from",function(h){return h?h:function(h,g,m){g=null!=g?g:function(b){return b};var b=[],c="undefined"!=typeof Symbol&&Symbol.iterator&&h[Symbol.iterator];if("function"==typeof c){h=c.call(h);for(var e=0;!(c=h.next()).done;)b.push(g.call(m,c.value,e++))}else for(c=h.length,e=0;e<c;e++)b.push(g.call(m,h[e],e));return b}},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var h={},p=Object.create(new $jscomp.global.Proxy(h,{get:function(g,m,b){return g==h&&"q"==m&&b==p}}));return!0===p.q}catch(g){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.makeIterator=function(h){var p="undefined"!=typeof Symbol&&Symbol.iterator&&h[Symbol.iterator];return p?p.call(h):$jscomp.arrayIterator(h)};
$jscomp.owns=function(h,p){return Object.prototype.hasOwnProperty.call(h,p)};
$jscomp.polyfill("WeakMap",function(h){function p(){if(!h||!Object.seal)return!1;try{var a=Object.seal({}),d=Object.seal({}),b=new h([[a,2],[d,3]]);if(2!=b.get(a)||3!=b.get(d))return!1;b.delete(a);b.set(d,4);return!b.has(a)&&4==b.get(d)}catch(q){return!1}}function g(){}function m(a){if(!$jscomp.owns(a,c)){var d=new g;$jscomp.defineProperty(a,c,{value:d})}}function b(a){var d=Object[a];d&&(Object[a]=function(a){if(a instanceof g)return a;m(a);return d(a)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(h&&
$jscomp.ES6_CONFORMANCE)return h}else if(p())return h;var c="$jscomp_hidden_"+Math.random();b("freeze");b("preventExtensions");b("seal");var e=0,f=function(a){this.id_=(e+=Math.random()+1).toString();if(a){a=$jscomp.makeIterator(a);for(var d;!(d=a.next()).done;)d=d.value,this.set(d[0],d[1])}};f.prototype.set=function(a,d){m(a);if(!$jscomp.owns(a,c))throw Error("WeakMap key fail: "+a);a[c][this.id_]=d;return this};f.prototype.get=function(a){return $jscomp.owns(a,c)?a[c][this.id_]:void 0};f.prototype.has=
function(a){return $jscomp.owns(a,c)&&$jscomp.owns(a[c],this.id_)};f.prototype.delete=function(a){return $jscomp.owns(a,c)&&$jscomp.owns(a[c],this.id_)?delete a[c][this.id_]:!1};return f},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(h){function p(){if($jscomp.ASSUME_NO_NATIVE_MAP||!h||"function"!=typeof h||!h.prototype.entries||"function"!=typeof Object.seal)return!1;try{var a=Object.seal({x:4}),d=new h($jscomp.makeIterator([[a,"s"]]));if("s"!=d.get(a)||1!=d.size||d.get({x:4})||d.set({x:4},"t")!=d||2!=d.size)return!1;var b=d.entries(),c=b.next();if(c.done||c.value[0]!=a||"s"!=c.value[1])return!1;c=b.next();return c.done||4!=c.value[0].x||"t"!=c.value[1]||!b.next().done?!1:!0}catch(l){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(h&&$jscomp.ES6_CONFORMANCE)return h}else if(p())return h;$jscomp.initSymbolIterator();var g=new WeakMap,m=function(a){this.data_={};this.head_=e();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var d;!(d=a.next()).done;)d=d.value,this.set(d[0],d[1])}};m.prototype.set=function(a,d){a=0===a?0:a;var k=b(this,a);k.list||(k.list=this.data_[k.id]=[]);k.entry?k.entry.value=d:(k.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,
value:d},k.list.push(k.entry),this.head_.previous.next=k.entry,this.head_.previous=k.entry,this.size++);return this};m.prototype.delete=function(a){a=b(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};m.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=e();this.size=0};m.prototype.has=function(a){return!!b(this,a).entry};
m.prototype.get=function(a){return(a=b(this,a).entry)&&a.value};m.prototype.entries=function(){return c(this,function(a){return[a.key,a.value]})};m.prototype.keys=function(){return c(this,function(a){return a.key})};m.prototype.values=function(){return c(this,function(a){return a.value})};m.prototype.forEach=function(a,d){for(var b=this.entries(),c;!(c=b.next()).done;)c=c.value,a.call(d,c[1],c[0],this)};m.prototype[Symbol.iterator]=m.prototype.entries;var b=function(a,d){var b=d&&typeof d;"object"==
b||"function"==b?g.has(d)?b=g.get(d):(b=""+ ++f,g.set(d,b)):b="p_"+d;var c=a.data_[b];if(c&&$jscomp.owns(a.data_,b))for(a=0;a<c.length;a++){var e=c[a];if(d!==d&&e.key!==e.key||d===e.key)return{id:b,list:c,index:a,entry:e}}return{id:b,list:c,index:-1,entry:void 0}},c=function(a,d){var b=a.head_;return $jscomp.iteratorPrototype(function(){if(b){for(;b.head!=a.head_;)b=b.previous;for(;b.next!=b.head;)return b=b.next,{done:!1,value:d(b)};b=null}return{done:!0,value:void 0}})},e=function(){var a={};return a.previous=
a.next=a.head=a},f=0;return m},"es6","es3");
$jscomp.polyfill("Set",function(h){function p(){if($jscomp.ASSUME_NO_NATIVE_SET||!h||"function"!=typeof h||!h.prototype.entries||"function"!=typeof Object.seal)return!1;try{var g=Object.seal({x:4}),b=new h($jscomp.makeIterator([g]));if(!b.has(g)||1!=b.size||b.add(g)!=b||1!=b.size||b.add({x:4})!=b||2!=b.size)return!1;var c=b.entries(),e=c.next();if(e.done||e.value[0]!=g||e.value[1]!=g)return!1;e=c.next();return e.done||e.value[0]==g||4!=e.value[0].x||e.value[1]!=e.value[0]?!1:c.next().done}catch(f){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(h&&$jscomp.ES6_CONFORMANCE)return h}else if(p())return h;$jscomp.initSymbolIterator();var g=function(g){this.map_=new Map;if(g){g=$jscomp.makeIterator(g);for(var b;!(b=g.next()).done;)this.add(b.value)}this.size=this.map_.size};g.prototype.add=function(g){g=0===g?0:g;this.map_.set(g,g);this.size=this.map_.size;return this};g.prototype.delete=function(g){g=this.map_.delete(g);this.size=this.map_.size;return g};g.prototype.clear=function(){this.map_.clear();
this.size=0};g.prototype.has=function(g){return this.map_.has(g)};g.prototype.entries=function(){return this.map_.entries()};g.prototype.values=function(){return this.map_.values()};g.prototype.keys=g.prototype.values;g.prototype[Symbol.iterator]=g.prototype.values;g.prototype.forEach=function(g,b){var c=this;this.map_.forEach(function(e){return g.call(b,e,e,c)})};return g},"es6","es3");
$jscomp.polyfill("Object.entries",function(h){return h?h:function(h){var g=[],m;for(m in h)$jscomp.owns(h,m)&&g.push([m,h[m]]);return g}},"es8","es3");$jscomp.polyfill("Array.prototype.fill",function(h){return h?h:function(h,g,m){var b=this.length||0;0>g&&(g=Math.max(0,b+g));if(null==m||m>b)m=b;m=Number(m);0>m&&(m=Math.max(0,b+m));for(g=Number(g||0);g<m;g++)this[g]=h;return this}},"es6","es3");
$jscomp.assign="function"==typeof Object.assign?Object.assign:function(h,p){for(var g=1;g<arguments.length;g++){var m=arguments[g];if(m)for(var b in m)$jscomp.owns(m,b)&&(h[b]=m[b])}return h};$jscomp.polyfill("Object.assign",function(h){return h||$jscomp.assign},"es6","es3");
(function(){for(var h=document.getElementsByTagName("canvas"),p=0;p<h.length;p++)if(h[p].hasAttribute("coreGraphics")){var g=h[p];g.library=new function(){var g=this;this.math=new function(){this.averageArray=function(b){return b.reduce(function(b,e){return b+e},0)/b.length};this.distanceBetweenTwoPoints=function(b,c){return Math.pow(Math.pow(b.x-c.x,2)+Math.pow(b.y-c.y,2),.5)};this.seconds2time=function(b){var c={h:0,m:0,s:0};c.h=Math.floor(b/3600);b-=3600*c.h;c.m=Math.floor(b/60);b-=60*c.m;c.s=
b;return c};this.largestValueFound=function(b){return b.reduce(function(b,e){return Math.abs(b)>Math.abs(e)?b:e})};this.smallestValueFound=function(b){return b.reduce(function(b,e){return Math.abs(b)<Math.abs(e)?b:e})};this.cartesian2polar=function(b,c){return{dis:Math.pow(Math.pow(b,2)+Math.pow(c,2),.5),ang:0===b?0===c?0:0<c?.5*Math.PI:1.5*Math.PI:0===c?0<=b?0:Math.PI:0<=b?Math.atan(c/b):Math.atan(c/b)+Math.PI}};this.polar2cartesian=function(b,c){return{x:c*Math.cos(b),y:c*Math.sin(b)}};this.cartesianAngleAdjust=
function(b,c,e){b=this.cartesian2polar(b,c);b.ang+=e;return this.polar2cartesian(b.ang,b.dis)};this.boundingBoxFromPoints=function(b){if(0==b.length)return{topLeft:{x:0,y:0},bottomRight:{x:0,y:0}};for(var c=b[0].x,e=b[0].x,f=b[0].y,a=b[0].y,d=1;d<b.length;d++)b[d].x<c?c=b[d].x:b[d].x>e&&(e=b[d].x),b[d].y<f?f=b[d].y:b[d].y>a&&(a=b[d].y);return{topLeft:{x:c,y:f},bottomRight:{x:e,y:a}}};this.pointsOfRect=function(b,c,e,f,a,d){a=void 0===a?0:a;d=void 0===d?{x:0,y:0}:d;var k=d.x*e,q=d.y*f,l=this.cartesian2polar(k,
q);l=this.polar2cartesian(l.ang-a,l.dis);d={x:b-l.x,y:c-l.y};l=this.cartesian2polar(k-e,q);l=this.polar2cartesian(l.ang-a,l.dis);var x={x:b-l.x,y:c-l.y};l=this.cartesian2polar(k-e,q-f);l=this.polar2cartesian(l.ang-a,l.dis);e={x:b-l.x,y:c-l.y};l=this.cartesian2polar(k,q-f);l=this.polar2cartesian(l.ang-a,l.dis);return[d,x,e,{x:b-l.x,y:c-l.y}]};this.pointsOfCircle=function(b,c,e,f){f=void 0===f?3:f;for(var a=[],d=0;d<f;d++)a.push({x:b+e*Math.sin(d/f*Math.PI*2),y:c+e*Math.cos(d/f*Math.PI*2)});return a};
this.pointsOfText=function(b,c,e,f,a,d,k,q){var l=document.createElement("canvas").getContext("2d");l.font=d;l.textAlign=k;l.textBaseline=q;b=l.measureText(b).width/a;d=-d.split("pt")[0].split(" ").pop();isNaN(d)&&(d=-7.5);d/=a;a=[{x:c,y:e},{x:c+b,y:e},{x:c+b,y:e-d},{x:c,y:e-d}];b={start:0,end:0,center:b/2,left:b,right:b};d={alphabetic:d,top:0,hanging:0,middle:d/2,ideographic:0,bottom:d};for(l=0;l<a.length;l++)a[l]={x:a[l].x-b[k],y:a[l].y+d[q]};for(l=0;l<a.length;l++)a[l]=this.cartesianAngleAdjust(a[l].x-
c,a[l].y-e,f),a[l].x+=c,a[l].y+=e;return a};this.relativeDistance=function(b,c,e,f,a){c=(f-c)/(e-c);if(void 0===a||!a){if(1<c)return b;if(0>c)return 0}return c*b};this.lineCorrecter=function(b,c,e){if(!(0>b.x1||0>b.x2||b.x1>e||b.x2>e||0>b.y1&&0>b.y2||b.y1>c&&b.y2>c))return e=(b.y2-b.y1)/(b.x2-b.x1),0>b.y1?(b.x1=(0-b.y1+e*b.x1)/e,b.y1=0):0>b.y2&&(b.x2=(0-b.y2+e*b.x2)/e,b.y2=0),b.y1>c?(b.x1=(c-b.y1+e*b.x1)/e,b.y1=c):b.y2>c&&(b.x2=(c-b.y2+e*b.x2)/e,b.y2=c),b};this.normalizeStretchArray=function(b){var c=
b.reduce(function(a,d,b,c){return d>c[a]?b:a},0),e=Math.abs(b[c]);b=b.map(function(a){return a/e});if(0==b[0]&&1==b[b.length-1])return b;var f=0!=b[0]?b[0]:b[b.length-1];return b=b.map(function(a){return(a-f)/(1-f)})};this.curvePoint=new function(){this.linear=function(b,c,e){c=void 0===c?0:c;return(void 0===b?.5:b)*((void 0===e?1:e)-c)+c};this.sin=function(b,c,e){c=void 0===c?0:c;return Math.sin(Math.PI/2*(void 0===b?.5:b))*((void 0===e?1:e)-c)+c};this.cos=function(b,c,e){c=void 0===c?0:c;return(1-
Math.cos(Math.PI/2*(void 0===b?.5:b)))*((void 0===e?1:e)-c)+c};this.s=function(b,c,e,f){c=void 0===c?0:c;e=void 0===e?1:e;f=void 0===f?8:f;return g.math.normalizeStretchArray([1/(1+Math.exp(-.5*-f)),1/(1+Math.exp(-f*((void 0===b?.5:b)-.5))),1/(1+Math.exp(.5*-f))])[1]*(e-c)+c};this.exponential=function(b,c,e,f){c=void 0===c?0:c;e=void 0===e?1:e;f=void 0===f?2:f;return g.math.normalizeStretchArray([(Math.exp(0*f)-1)/(Math.E-1),(Math.exp(f*(void 0===b?.5:b))-1)/(Math.E-1),(Math.exp(1*f)-1)/(Math.E-1)])[1]*
(e-c)+c}};this.curveGenerator=new function(){this.linear=function(b,c,e){c=void 0===c?0:c;e=void 0===e?1:e;b=Math.abs(void 0===b?2:b)-1;for(var f=[0],a=1;a<b;a++)f.push(a/b);f.push(1);b=e-c;for(a=0;a<f.length;a++)f[a]=f[a]*b+c;return f};this.sin=function(b,c,e){c=void 0===c?0:c;e=void 0===e?1:e;b=Math.abs(void 0===b?2:b)-1;for(var f=[0],a=1;a<b;a++)f.push(Math.sin(Math.PI/2*(a/b)));f.push(1);b=e-c;for(a=0;a<f.length;a++)f[a]=f[a]*b+c;return f};this.cos=function(b,c,e){c=void 0===c?0:c;e=void 0===
e?1:e;b=Math.abs(void 0===b?2:b)-1;for(var f=[0],a=1;a<b;a++)f.push(1-Math.cos(Math.PI/2*(a/b)));f.push(1);b=e-c;for(a=0;a<f.length;a++)f[a]=f[a]*b+c;return f};this.s=function(b,c,e,f){b=void 0===b?2:b;c=void 0===c?0:c;e=void 0===e?1:e;f=void 0===f?8:f;0==f&&(f=1E-6);for(var a=[],d=0;d<b;d++)a.push(1/(1+Math.exp(-f*(d/b-.5))));b=g.math.normalizeStretchArray(a);e-=c;for(d=0;d<b.length;d++)b[d]=b[d]*e+c;return b};this.exponential=function(b,c,e,f){c=void 0===c?0:c;e=void 0===e?1:e;f=void 0===f?2:f;
b=(void 0===b?2:b)-1;for(var a=[],d=0;d<=b;d++)a.push((Math.exp(d/b*f)-1)/(Math.E-1));a=system.utility.math.normalizeStretchArray(a);b=e-c;for(d=0;d<a.length;d++)a[d]=a[d]*b+c;return a}};this.detectOverlap=new function(){this.boundingBoxes=function(b,c){return!(b.bottomRight.y<c.topLeft.y||b.topLeft.y>c.bottomRight.y||b.bottomRight.x<c.topLeft.x||b.topLeft.x>c.bottomRight.x)};this.pointWithinBoundingBox=function(b,c){return!(b.x<c.topLeft.x||b.y<c.topLeft.y||b.x>c.bottomRight.x||b.y>c.bottomRight.y)};
this.pointWithinPoly=function(b,c){for(var e=!1,f=0,a=c.length-1;f<c.length;a=f++)c[f].y>b.y!=c[a].y>b.y&&b.x<(c[a].x-c[f].x)*(b.y-c[f].y)/(c[a].y-c[f].y)+c[f].x&&(e=!e);return e};this.lineSegments=function(b,c){var e=(c[1].y-c[0].y)*(b[1].x-b[0].x)-(c[1].x-c[0].x)*(b[1].y-b[0].y);if(0==e)return null;var f=((c[1].x-c[0].x)*(b[0].y-c[0].y)-(c[1].y-c[0].y)*(b[0].x-c[0].x))/e;c=((b[1].x-b[0].x)*(b[0].y-c[0].y)-(b[1].y-b[0].y)*(b[0].x-c[0].x))/e;return{x:b[0].x+f*(b[1].x-b[0].x),y:b[0].y+f*(b[1].y-b[0].y),
inSeg1:0<=f&&1>=f,inSeg2:0<=c&&1>=c}};this.overlappingPolygons=function(b,c){for(var e=0;e<b.length;e++)if(this.pointWithinPoly(b[e],c))return!0;for(e=0;e<c.length;e++)if(this.pointWithinPoly(c[e],b))return!0;var f=Array.apply(null,{length:b.length}).map(Number.call,Number).concat([0]),a=Array.apply(null,{length:c.length}).map(Number.call,Number).concat([0]);for(e=0;e<f.length-1;e++)for(var d=0;d<a.length-1;d++){var k=this.lineSegments([b[f[e]],b[f[e+1]]],[c[a[d]],c[a[d+1]]]);if(null!=k&&k.inSeg1&&
k.inSeg2)return!0}return!1}}};this.structure=new function(){this.functionListRunner=function(b,c){return function(e,f){for(var a=0;a<b.length;a++){for(var d=!0,k=0;k<b[a].requiredKeys.length;k++){d=!0;for(var q=0;q<b[a].requiredKeys[k].length&&(d=d&&c[b[a].requiredKeys[k][q]],d);q++);if(d)break}if(d&&b[a].function(e,f))break}}};this.signalRegistry=function(b,c,e){b=void 0===b?-1:b;c=void 0===c?-1:c;e=void 0===e?-1:e;var f=[],a=[],d=[],k=[],q={},l=[];this.__dump=function(){console.log("---- signalRegistry dump ----");
console.log("\tsignals");for(var a=0;a<f.length;a++)console.log("\t\t",a," "+JSON.stringify(f[a]));console.log("\tselectedSignals");for(a=0;a<tselectedSignals.length;a++)console.log("\t\t",a," "+JSON.stringify(tselectedSignals[a]));console.log("\tevents");for(a=0;a<d.length;a++)console.log("\t\t",a," "+JSON.stringify(d[a]));console.log("\tevents_byID");for(a=0;a<k.length;a++)console.log("\t\t",a," "+JSON.stringify(k[a]));console.log("\tevents_byPosition");var b=Object.keys(q);for(a=0;a<b.length;a++)console.log("\t\t",
b[a]," "+JSON.stringify(q[b[a]]));console.log("\tpositions");for(a=0;a<l.length;a++)console.log("\t\t",a," "+JSON.stringify(l[a]))};this.export=function(){return JSON.parse(JSON.stringify({signals:f,selectedSignals:a,events:d,events_byID:k,events_byPosition:q,positions:l}))};this.import=function(b){f=JSON.parse(JSON.stringify(b.signals));a=JSON.parse(JSON.stringify(b.selectedSignals));d=JSON.parse(JSON.stringify(b.events));k=JSON.parse(JSON.stringify(b.events_byID));q=JSON.parse(JSON.stringify(b.events_byPosition));
l=JSON.parse(JSON.stringify(b.positions))};this.getAllSignals=function(){return JSON.parse(JSON.stringify(f))};this.getAllEvents=function(){return JSON.parse(JSON.stringify(d))};this.getSignal=function(a){if(void 0!=f[a])return JSON.parse(JSON.stringify(f[a]))};this.eventsBetween=function(a,b){for(var k=void 0==b?Array.from(new Set(l.filter(function(d){return d==a}))):Array.from(new Set(l.filter(function(d){return d>=a&&d<b}))),c=[],e=0;e<k.length;e++){k[e]=q[String(k[e])];for(var f=0;f<k[e].length;f++)c.push(d[k[e][f]])}return c.sort(function(a,
d){return a.position<d.position?-1:a.position>d.position?1:0})};this.add=function(a,g){if(void 0!=a&&"line"in a&&"position"in a&&"length"in a){"strength"in a||(a.strength=1);0>a.line&&(a.line=0);0>a.length&&(a.length=0);0>a.position&&(a.position=0);0>a.strength&&(a.strength=0);-1<c&&a.line>c-1&&(a.line=c-1);-1<e&&a.length>e&&(a.length=e);-1<b&&a.position>b&&(a.position=b-a.length);-1<b&&a.position+a.length>b&&(a.length=b-a.position);-1<b&&a.position+a.length>b&&(a.position=b-a.length);1<a.strength&&
(a.strength=1);var x=0;if(void 0==g)for(;void 0!=f[x];)x++;else x=g;f[x]=JSON.parse(JSON.stringify(a));a=[{signalID:x,line:a.line,position:a.position,strength:a.strength},{signalID:x,line:a.line,position:a.position+a.length,strength:0}];for(g=0;void 0!=d[g];)g++;d[g]=a[0];k[x]=[g];void 0==q[a[0].position]?q[a[0].position]=[g]:q[a[0].position].push(g);for(l.push(a[0].position);void 0!=d[g];)g++;d[g]=a[1];k[x]=k[x].concat(g);void 0==q[a[1].position]?q[a[1].position]=[g]:q[a[1].position].push(g);l.push(a[1].position);
return x}};this.remove=function(a){if(void 0!=f[a]){delete f[a];for(var b=0;b<k[a].length;b++){var c=k[a][b];q[d[c].position].splice(q[d[c].position].indexOf(c),1);l.splice(l.indexOf(d[c].position),1);0==q[d[c].position].length&&delete q[d[c].position];delete d[c]}delete k[a]}};this.update=function(a,d){void 0!=d&&("line"in d||(d.line=f[a].line),-1<b&&("position"in d&&"length"in d?d.length+d.position>b&&(d.length=b-d.position):("position"in d?f[a].length+d.position>=b&&(d.position=b-f[a].length):
d.position=f[a].position,"length"in d?d.length+d.position>b&&(d.length=b-d.position):d.length=f[a].length)),"strength"in d||(d.strength=f[a].strength),this.remove(a),this.add(d,a))};this.reset=function(){f=[];a=[];d=[];k=[];q={};l=[]}}};this.audio=new function(){this.context=new (window.AudioContext||window.webkitAudioContext);this.changeAudioParam=function(a,d,b,c,e,f){f=void 0===f?!0:f;if(null==b)return d.value;f&&d.cancelScheduledValues(a.currentTime);try{switch(e){case "linear":d.linearRampToValueAtTime(b,
a.currentTime+c);break;case "exponential":console.warn("2018-4-18 - changeAudioParam:exponential doesn't work on chrome");0==b&&(b=1E-4);d.exponentialRampToValueAtTime(b,a.currentTime+c);break;case "s":for(var k=b-d.value,l=g.math.curveGenerator.s(10),q=0;q<l.length;q++)l[q]=d.value+l[q]*k;d.setValueCurveAtTime(new Float32Array(l),a.currentTime,c);break;default:d.setTargetAtTime(b,a.currentTime,.001)}}catch(z){console.log("could not change param (possibly due to an overlap, or bad target value)"),
console.log("audioParam:",d,"target:",b,"time:",c,"curve:",e,"cancelScheduledValues:",f),console.log(z)}};this.loadAudioFile=function(a,d,b){b=void 0===b?"":b;switch(void 0===d?"file":d){case "url":d=new XMLHttpRequest;d.open("GET",b,!0);d.responseType="arraybuffer";d.onload=function(){g.audio.context.decodeAudioData(this.response,function(d){a({buffer:d,name:b.split("/").pop(),duration:d.duration})},function(a){console.warn("Error with decoding audio data"+a.err)})};d.send();break;default:var c=
document.createElement("input");c.type="file";c.onchange=function(){var d=this.files[0],b=new FileReader;b.readAsArrayBuffer(d);b.onload=function(b){g.audio.context.decodeAudioData(b.target.result,function(b){a({buffer:b,name:d.name,duration:b.duration})});c.remove()}};document.body.appendChild(c);c.click()}};this.waveformSegment=function(a,d,b){d=void 0===d?{start:0,end:1}:d;b=void 0===b?1E4:b;var c=a.getChannelData(0);d.start=d.start?d.start:0;d.end=d.end?d.end:1;var k=a.length*d.start;a=a.length*
d.end;b=(a-k)/b;for(d=[];k<a;k+=Math.round(b))d.push(g.math.largestValueFound(c.slice(k,k+Math.round(b))));return d};this.loadBuffer=function(a,d,b,c){a=a.createBufferSource();a.buffer=d;a.connect(b);a.onended=c;return a};this.destination=this.context.createGain();this.destination.connect(this.context.destination);this.destination._gain=1;this.destination.masterGain=function(a){if(void 0==a)return this.destination._gain;this._gain=a;g.audio.changeAudioParam(g.audio.context,this.gain,this._gain,.01,
"instant",!0)};this.names_frequencies_split={0:{C:16.35,"C#":17.32,D:18.35,"D#":19.45,E:20.6,F:21.83,"F#":23.12,G:24.5,"G#":25.96,A:27.5,"A#":29.14,B:30.87},1:{C:32.7,"C#":34.65,D:36.71,"D#":38.89,E:41.2,F:43.65,"F#":46.25,G:49,"G#":51.91,A:55,"A#":58.27,B:61.74},2:{C:65.41,"C#":69.3,D:73.42,"D#":77.78,E:82.41,F:87.31,"F#":92.5,G:98,"G#":103.8,A:110,"A#":116.5,B:123.5},3:{C:130.8,"C#":138.6,D:146.8,"D#":155.6,E:164.8,F:174.6,"F#":185,G:196,"G#":207.7,A:220,"A#":233.1,B:246.9},4:{C:261.6,"C#":277.2,
D:293.7,"D#":311.1,E:329.6,F:349.2,"F#":370,G:392,"G#":415.3,A:440,"A#":466.2,B:493.9},5:{C:523.3,"C#":554.4,D:587.3,"D#":622.3,E:659.3,F:698.5,"F#":740,G:784,"G#":830.6,A:880,"A#":932.3,B:987.8},6:{C:1047,"C#":1109,D:1175,"D#":1245,E:1319,F:1397,"F#":1480,G:1568,"G#":1661,A:1760,"A#":1865,B:1976},7:{C:2093,"C#":2217,D:2349,"D#":2489,E:2637,F:2794,"F#":2960,G:3136,"G#":3322,A:3520,"A#":3729,B:3951},8:{C:4186,"C#":4435,D:4699,"D#":4978,E:5274,F:5588,"F#":5920,G:6272,"G#":6645,A:7040,"A#":7459,B:7902}};
this.names_frequencies={};for(var b=Object.entries(this.names_frequencies_split),c=0;c<b.length;c++)for(var e=Object.entries(this.names_frequencies_split[c]),f=0;f<e.length;f++)this.names_frequencies[b[c][0]+e[f][0]]=e[f][1];this.frequencies_names={};b=Object.entries(this.names_frequencies);for(c=0;c<b.length;c++)this.frequencies_names[b[c][1]]=b[c][0];b="0C 0C# 0D 0D# 0E 0F 0F# 0G 0G# 0A 0A# 0B 1C 1C# 1D 1D# 1E 1F 1F# 1G 1G# 1A 1A# 1B 2C 2C# 2D 2D# 2E 2F 2F# 2G 2G# 2A 2A# 2B 3C 3C# 3D 3D# 3E 3F 3F# 3G 3G# 3A 3A# 3B 4C 4C# 4D 4D# 4E 4F 4F# 4G 4G# 4A 4A# 4B 5C 5C# 5D 5D# 5E 5F 5F# 5G 5G# 5A 5A# 5B 6C 6C# 6D 6D# 6E 6F 6F# 6G 6G# 6A 6A# 6B 7C 7C# 7D 7D# 7E 7F 7F# 7G 7G# 7A 7A# 7B 8C 8C# 8D 8D# 8E 8F 8F# 8G 8G# 8A 8A# 8B".split(" ");
this.midinumbers_names={};for(c=0;c<b.length;c++)this.midinumbers_names[c+24]=b[c];this.names_midinumbers={};b=Object.entries(this.midinumbers_names);for(c=0;c<b.length;c++)this.names_midinumbers[b[c][1]]=parseInt(b[c][0]);this.num2name=function(a){return this.midinumbers_names[a]};this.num2freq=function(a){return this.names_frequencies[this.midinumbers_names[a]]};this.name2num=function(a){return this.names_midinumbers[a]};this.name2freq=function(a){return this.names_frequencies[a]};this.freq2num=
function(a){return this.names_midinumbers[this.frequencies_names[a]]};this.freq2name=function(a){return this.frequencies_names[a]}};this.misc=new function(){this.blendColours=function(b,c,e){function f(a){a=a.split(",");a[0]=a[0].replace("rgba(","");a[3]=a[3].replace(")","");return a.map(function(a){return parseFloat(a)})}b=f(b);c=f(c);for(var a=[],d=0;d<b.length;d++)a[d]=(1-e)*b[d]+e*c[d];return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"};this.multiBlendColours=function(b,c){if(0==c)return b[0];
if(1==c)return b[b.length-1];c*=b.length-1;return g.misc.blendColours(b[~~c],b[~~c+1],c%1)};this.padString=function(b,c,e){e=void 0===e?" ":e;if(1>e.length)return b;for(b=""+b;b.length<c;)b=e+b;return b};this.compressString=function(b){return g.thirdparty.lzString.compress(b)};this.decompressString=function(b){return g.thirdparty.lzString.decompress(b)};this.serialize=function(b,c){c=void 0===c?!0:c;b=JSON.stringify(b,function(b,c){switch({}.toString.call(c).match(/\s([a-zA-Z]+)/)[1].toLowerCase()){case "function":return{__uniqueType:"function",
__value:c.toString(),__name:c.name};case "arraybuffer":return{__uniqueType:"arraybuffer",__value:btoa(String.fromCharCode(new Uint8Array(c)))};case "audiobuffer":b=[];for(var a=0;a<c.numberOfChannels;a++)b.push(Array.from(c.getChannelData(a)));return{__uniqueType:"audiobuffer",__channelData:b,__sampleRate:c.sampleRate,__numberOfChannels:c.numberOfChannels,__length:c.length};default:return c}});c&&(b=g.misc.compressString(b));return b};this.unserialize=function(b,c){if(void 0!==b)return(void 0===c||
c)&&(b=g.misc.decompressString(b)),JSON.parse(b,function(b,c){if("object"==typeof c&&null!=c&&"__uniqueType"in c)switch(c.__uniqueType){case "function":b=c.__value.substring(0,c.__value.indexOf("{"));b=b.substring(b.indexOf("(")+1,b.lastIndexOf(")"));c=c.__value.substring(c.__value.indexOf("{")+1,c.__value.lastIndexOf("}"));c=Function(b,c);break;case "arraybuffer":c=atob(c.__value);for(b=0;b<c.length;b++)c[b]=c[b].charCodeAt(0);c=new ArrayBuffer(c);break;case "audiobuffer":var a=g.audio.context.createBuffer(c.__numberOfChannels,
c.__length,c.__sampleRate);for(b=0;b<a.numberOfChannels;b++){workingBuffer=a.getChannelData(b);for(var d=0;d<a.length;d++)workingBuffer[d]=c.__channelData[b][d]}c=a;break;default:c=c.__value}return c})};this.openFile=function(b,c){c=void 0===c?"readAsBinaryString":c;var e=document.createElement("input");e.type="file";e.onchange=function(){var e=new FileReader;switch(c){case "readAsArrayBuffer":e.readAsArrayBuffer(this.files[0]);break;default:e.readAsBinaryString(this.files[0])}e.onloadend=function(){b&&
b(e.result)}};e.click()};this.printFile=function(b,c){var e=document.createElement("a");e.href=URL.createObjectURL(new Blob([c]));e.download=b;e.click()}};this.thirdparty=new function(){this.lzString=function(){var b=String.fromCharCode,c={},e={compress:function(b){return null==b?"":e._compress(b,6,function(a){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$".charAt(a)})},decompress:function(b){if(null==b)return"";if(""==b)return null;b=b.replace(/ /g,"+");return e._decompress(b.length,
32,function(a){a=b.charAt(a);if(!c["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$"]){c["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$"]={};for(var d=0;65>d;d++)c["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$"]["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$".charAt(d)]=d}return c["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$"][a]})},_compress:function(b,a,d){if(null==b)return"";var c,e={},l={},g="",
f=2,h=3,r=2,m=[],n=0,t=0,p;for(p=0;p<b.length;p+=1){var v=b.charAt(p);Object.prototype.hasOwnProperty.call(e,v)||(e[v]=h++,l[v]=!0);var w=g+v;if(Object.prototype.hasOwnProperty.call(e,w))g=w;else{if(Object.prototype.hasOwnProperty.call(l,g)){if(256>g.charCodeAt(0)){for(c=0;c<r;c++)n<<=1,t==a-1?(t=0,m.push(d(n)),n=0):t++;var u=g.charCodeAt(0);for(c=0;8>c;c++)n=n<<1|u&1,t==a-1?(t=0,m.push(d(n)),n=0):t++,u>>=1}else{u=1;for(c=0;c<r;c++)n=n<<1|u,t==a-1?(t=0,m.push(d(n)),n=0):t++,u=0;u=g.charCodeAt(0);
for(c=0;16>c;c++)n=n<<1|u&1,t==a-1?(t=0,m.push(d(n)),n=0):t++,u>>=1}f--;0==f&&(f=Math.pow(2,r),r++);delete l[g]}else for(u=e[g],c=0;c<r;c++)n=n<<1|u&1,t==a-1?(t=0,m.push(d(n)),n=0):t++,u>>=1;f--;0==f&&(f=Math.pow(2,r),r++);e[w]=h++;g=String(v)}}if(""!==g){if(Object.prototype.hasOwnProperty.call(l,g)){if(256>g.charCodeAt(0)){for(c=0;c<r;c++)n<<=1,t==a-1?(t=0,m.push(d(n)),n=0):t++;u=g.charCodeAt(0);for(c=0;8>c;c++)n=n<<1|u&1,t==a-1?(t=0,m.push(d(n)),n=0):t++,u>>=1}else{u=1;for(c=0;c<r;c++)n=n<<1|u,
t==a-1?(t=0,m.push(d(n)),n=0):t++,u=0;u=g.charCodeAt(0);for(c=0;16>c;c++)n=n<<1|u&1,t==a-1?(t=0,m.push(d(n)),n=0):t++,u>>=1}f--;0==f&&(f=Math.pow(2,r),r++);delete l[g]}else for(u=e[g],c=0;c<r;c++)n=n<<1|u&1,t==a-1?(t=0,m.push(d(n)),n=0):t++,u>>=1;f--;0==f&&r++}u=2;for(c=0;c<r;c++)n=n<<1|u&1,t==a-1?(t=0,m.push(d(n)),n=0):t++,u>>=1;for(;;)if(n<<=1,t==a-1){m.push(d(n));break}else t++;return m.join("")},_decompress:function(c,a,d){var k=[],e=4,l=4,g=3,f=[],h,r,m=d(0),n=a,t=1;for(h=0;3>h;h+=1)k[h]=h;var p=
0;var v=Math.pow(2,2);for(r=1;r!=v;){var w=m&n;n>>=1;0==n&&(n=a,m=d(t++));p|=(0<w?1:0)*r;r<<=1}switch(p){case 0:p=0;v=Math.pow(2,8);for(r=1;r!=v;)w=m&n,n>>=1,0==n&&(n=a,m=d(t++)),p|=(0<w?1:0)*r,r<<=1;var u=b(p);break;case 1:p=0;v=Math.pow(2,16);for(r=1;r!=v;)w=m&n,n>>=1,0==n&&(n=a,m=d(t++)),p|=(0<w?1:0)*r,r<<=1;u=b(p);break;case 2:return""}h=k[3]=u;for(f.push(u);;){if(t>c)return"";p=0;v=Math.pow(2,g);for(r=1;r!=v;)w=m&n,n>>=1,0==n&&(n=a,m=d(t++)),p|=(0<w?1:0)*r,r<<=1;switch(u=p){case 0:p=0;v=Math.pow(2,
8);for(r=1;r!=v;)w=m&n,n>>=1,0==n&&(n=a,m=d(t++)),p|=(0<w?1:0)*r,r<<=1;k[l++]=b(p);u=l-1;e--;break;case 1:p=0;v=Math.pow(2,16);for(r=1;r!=v;)w=m&n,n>>=1,0==n&&(n=a,m=d(t++)),p|=(0<w?1:0)*r,r<<=1;k[l++]=b(p);u=l-1;e--;break;case 2:return f.join("")}0==e&&(e=Math.pow(2,g),g++);if(k[u])u=k[u];else if(u===l)u=h+h.charAt(0);else return null;f.push(u);k[l++]=h+u.charAt(0);e--;h=u;0==e&&(e=Math.pow(2,g),g++)}}};return e}()}};g.core=new function(){var h=new function(){function b(a){for(var d=[];void 0!=(a=
a.parent);)d.unshift({x:a.x,y:a.y,a:a.angle});a={x:void 0!=d[0]?d[0].x:0,y:void 0!=d[0]?d[0].y:0,a:void 0!=d[0]?d[0].a:0};for(var b=1;b<d.length;b++){var c=g.library.math.cartesianAngleAdjust(d[b].x,d[b].y,d[b-1].a);a.a+=d[b].a;a.x+=c.x;a.y+=c.y}return a}var c=this,e=new function(){this.length=function(a){return a*c.viewport.scale()};this.windowPoint2coreGraphicsPoint=function(a,d){var b=c.viewport.position(),e=c.viewport.scale()/window.devicePixelRatio,l=c.viewport.angle();a=a/e-b.x;d=d/e-b.y;return g.library.math.cartesianAngleAdjust(a,
d,-l)};this.coreGraphicsPoint2windowPoint=function(a,d){var b=c.viewport.position(),e=c.viewport.scale(),l=c.viewport.angle();a=g.library.math.cartesianAngleAdjust(a,d,l);return{x:(a.x+b.x)*e,y:(a.y+b.y)*e}}},f=new function(){this.canvas=function(){this.type="canvas";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.angle=this.y=this.x=0;this.anchor={x:0,y:0};this.height=this.width=10;var a=document.createElement("canvas"),
d=1;var k=a.getContext("2d",{alpha:!1});a.setAttribute("width",this.width*d);a.setAttribute("height",this.height*d);this.parameter={};this.parameter.x=function(a){return function(d){if(void 0==d)return a.x;a.x=d;a.computeExtremities()}}(this);this.parameter.y=function(a){return function(d){if(void 0==d)return a.y;a.y=d;a.computeExtremities()}}(this);this.parameter.angle=function(a){return function(d){if(void 0==d)return a.angle;a.angle=d;a.computeExtremities()}}(this);this.parameter.anchor=function(a){return function(d){if(void 0==
d)return a.anchor;a.anchor=d;a.computeExtremities()}}(this);this.parameter.width=function(b){return function(c){if(void 0==c)return b.width;b.width=c;b.computeExtremities();a.setAttribute("width",b.width*d)}}(this);this.parameter.height=function(b){return function(c){if(void 0==c)return b.height;b.height=c;b.computeExtremities();a.setAttribute("height",b.height*d)}}(this);this.resolution=function(b){if(void 0==b)return d;d=b;a.setAttribute("width",this.width*d);a.setAttribute("height",this.height*
d)};this._=k;this.$=function(a){return a*d};this.getAddress=function(){var a="",d=this;do a=d.name+"/"+a;while(void 0!=(d=d.parent));return"/"+a};this.computeExtremities=function(a){for(var d=this._static,c=this;void 0!=(c=c.parent)&&!d;)d=d||c._static;this._static=d;a=void 0==a?b(this):a;this.extremities={points:[],boundingBox:{}};this.extremities.points=g.library.math.pointsOfRect(this.x,this.y,this.width,this.height,-this.angle,this.anchor);this.extremities.points=this.extremities.points.map(function(d){d=
g.library.math.cartesianAngleAdjust(d.x,d.y,a.a);d.x+=a.x;d.y+=a.y;return d});this.extremities.boundingBox=g.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(a,d){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var b=!1}else b=g.library.math.detectOverlap.pointWithinBoundingBox({x:a,y:d},this.extremities.boundingBox);return b?(void 0==this.extremities.points?
(console.warn("the shape",this,"has no points"),a=!1):a=g.library.math.detectOverlap.pointWithinPoly({x:a,y:d},this.extremities.points),a):!1};this.render=function(d,b,k){b=void 0===b?{x:0,y:0,a:0}:b;k=void 0===k?!1:k;var l=this._static?!0:g.library.math.detectOverlap.boundingBoxes(c.viewport.getBoundingBox(),this.extremities.boundingBox);if(l){l=g.library.math.cartesianAngleAdjust(this.x,this.y,b.a);b.x+=l.x-this.x;b.y+=l.y-this.y;l={x:this.x+b.x,y:this.y+b.y};b=this.angle+b.a;var q=this.width,f=
this.height;k||(l=e.coreGraphicsPoint2windowPoint(l.x-this.anchor.x*q,l.y-this.anchor.y*f),q=e.length(q),f=e.length(f));l=g.library.math.cartesianAngleAdjust(l.x,l.y,-b);d.save();d.rotate(b);d.drawImage(a,l.x,l.y,q,f);d.restore();if(this.dotFrame){for(d=0;d<this.extremities.points.length;d++)k=e.coreGraphicsPoint2windowPoint(this.extremities.points[d].x,this.extremities.points[d].y),c.render.drawDot(k.x,k.y,4,"rgba(50,50,50,1)");k=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.topLeft.x,
this.extremities.boundingBox.topLeft.y);c.render.drawDot(k.x,k.y);k=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);c.render.drawDot(k.x,k.y)}}}};this.circle=function(){this.type="circle";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.y=this.x=0;this.r=2;this.style={fill:"rgba(255,100,255,1)",stroke:"rgba(0,0,0,0)",lineWidth:1,shadowColour:"rgba(0,0,0,0)",
shadowBlur:2,shadowOffset:{x:1,y:1}};this.parameter={};this.parameter.x=function(a){return function(d){if(void 0==d)return a.x;a.x=d;a.computeExtremities()}}(this);this.parameter.y=function(a){return function(d){if(void 0==d)return a.y;a.y=d;a.computeExtremities()}}(this);this.parameter.r=function(a){return function(d){if(void 0==d)return a.r;a.r=d;a.computeExtremities()}}(this);this.getAddress=function(){var a="",d=this;do a=d.name+"/"+a;while(void 0!=(d=d.parent));return"/"+a};this.computeExtremities=
function(a){for(var d=this._static,c=this;void 0!=(c=c.parent)&&!d;)d=d||c._static;this._static=d;a=void 0==a?b(this):a;this.extremities={points:[],boundingBox:{},origin:{}};point=g.library.math.cartesianAngleAdjust(this.x,this.y,a.a);this.extremities.origin={x:this.x+a.x,y:this.y+a.y};this.extremities.points=g.library.math.pointsOfCircle(this.x,this.y,this.r,10);this.extremities.points=this.extremities.points.map(function(d){d=g.library.math.cartesianAngleAdjust(d.x,d.y,a.a);d.x+=a.x;d.y+=a.y;return d});
this.extremities.boundingBox=g.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(a,d){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var b=!1}else b=g.library.math.detectOverlap.pointWithinBoundingBox({x:a,y:d},this.extremities.boundingBox);return b?g.library.math.distanceBetweenTwoPoints({x:a,y:d},{x:this.x+this.extremities.origin.x,y:this.y+this.extremities.origin.y})<=
this.r:!1};this.render=function(a,d,b,f){d=void 0===d?{x:0,y:0,a:0}:d;b=void 0===b?!1:b;f=void 0===f?!1:f;var k=this._static?!0:g.library.math.detectOverlap.boundingBoxes(c.viewport.getBoundingBox(),this.extremities.boundingBox);if(k){k=g.library.math.cartesianAngleAdjust(this.x,this.y,d.a);d.x+=k.x-this.x;d.y+=k.y-this.y;d={x:this.x+d.x,y:this.y+d.y};k=this.r;var q=this.style.lineWidth,h=this.style.shadowBlur,m=this.style.shadowOffset.x,r=this.style.shadowOffset.y;b||(d=e.coreGraphicsPoint2windowPoint(d.x,
d.y),k=e.length(k),q=e.length(q),h=e.length(h),m=e.length(m),r=e.length(r));if(f)b=new Path2D,b.arc(d.x,d.y,k,0,2*Math.PI,!1),a.clip(b);else if(a.fillStyle=this.style.fill,a.strokeStyle=this.style.stroke,a.lineWidth=q,a.shadowColor=this.style.shadowColour,a.shadowBlur=h,a.shadowOffsetX=m,a.shadowOffsetY=r,a.beginPath(),a.arc(d.x,d.y,k,0,2*Math.PI,!1),a.closePath(),a.fill(),a.stroke(),this.dotFrame){for(a=0;a<this.extremities.points.length;a++)b=e.coreGraphicsPoint2windowPoint(this.extremities.points[a].x,
this.extremities.points[a].y),c.render.drawDot(b.x,b.y,4,"rgba(50,50,50,1)");b=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);c.render.drawDot(b.x,b.y);b=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);c.render.drawDot(b.x,b.y);b=e.coreGraphicsPoint2windowPoint(this.extremities.origin.x,this.extremities.origin.y);c.render.drawDot(b.x,b.y)}}}};this.group=function(){function a(a,
b){if(void 0==b)return a.getAddress()+" >> no element provided";if(void 0==b.name||""==b.name)return a.getAddress()+" >> element has no name";for(var d=0;d<a.children.length;d++)if(a.children[d].name==b.name)return'element with the name "'+b.name+'" already exists in the '+(void 0==parent?"design root":'group "'+a.name+'"')}this.type="group";this.name="";this.clipActive=this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.angle=this.y=this.x=
0;this.children=[];this.clippingStencil;this.parameter={};this.parameter.x=function(a){return function(d){if(void 0==d)return a.x;a.x=d;a.computeExtremities(void 0,!0)}}(this);this.parameter.y=function(a){return function(d){if(void 0==d)return a.y;a.y=d;a.computeExtremities(void 0,!0)}}(this);this.parameter.angle=function(a){return function(d){if(void 0==d)return a.angle;a.angle=d;a.computeExtremities(void 0,!0)}}(this);this.getAddress=function(){var a="",b=this;do a=b.name+"/"+a;while(void 0!=(b=
b.parent));return"/"+a};this.clip=function(a){if(void 0==a)return this.clipActive;this.clipActive=void 0==this.clippingStencil?!1:a;this.computeExtremities()};this.stencil=function(a){if(void 0==a)return this.clippingStencil;this.clippingStencil=a;this.computeExtremities()};this.prepend=function(d){var b=a(this,d);void 0!=b?console.error("element invalid:",b):(this.children.unshift(d),d.parent=this,d.computeExtremities(void 0,!0))};this.append=function(d){var b=a(this,d);void 0!=b?console.error("element invalid:",
b):(this.children.push(d),d.parent=this,d.computeExtremities(void 0,!0))};this.remove=function(a){void 0!=a&&(a=this.children.indexOf(a),0>a||(this.children.splice(a,1),this.computeExtremities()))};this.clear=function(){this.children=[];this.computeExtremities()};this.contains=function(a){for(var d=0;d<this.children.length;d++)if(this.children[d]==a)return!0;return!1};this.getChildByName=function(a){for(var d=0;d<this.children.length;d++)if(this.children[d].name==a)return this.children[d]};this.getElementsWithName=
function(a){for(var d=[],b=0;b<this.children.length;b++)if(this.children[b].name==a&&d.push(this.children[b]),"group"==this.children[b].type)for(var c=this.children[b].getElementsWithName(a),e=0;e<c.length;e++)d.push(c[e]);return d};this.getOffset=function(){return b(this)};this.computeExtremities=function(a,c){c=void 0===c?!1:c;for(var d=void 0==a,e=this._static,k=this;void 0!=(k=k.parent)&&!e;)e=e||k._static;this._static=e;a=void 0==a?b(this):a;if(c)for(c={x:a.x,y:a.y,a:a.a+this.angle},e=g.library.math.cartesianAngleAdjust(this.x,
this.y,a.a),c.x+=e.x,c.y+=e.y,e=0;e<this.children.length;e++)this.children[e].computeExtremities(c,!0);this.extremities={points:[],boundingBox:{}};if(this.clipActive)c={x:a.x,y:a.y,a:a.a+this.angle},e=g.library.math.cartesianAngleAdjust(this.x,this.y,a.a),c.x+=e.x,c.y+=e.y,this.clippingStencil.computeExtremities(c),this.extremities.points=this.clippingStencil.extremities.points;else{a=[];for(e=0;e<this.children.length;e++)a.push(this.children[e].extremities.boundingBox.topLeft),a.push(this.children[e].extremities.boundingBox.bottomRight);
a=g.library.math.boundingBoxFromPoints(a);this.extremities.points=[{x:a.topLeft.x,y:a.topLeft.y},{x:a.bottomRight.x,y:a.topLeft.y},{x:a.bottomRight.x,y:a.bottomRight.y},{x:a.topLeft.x,y:a.bottomRight.y}]}this.extremities.boundingBox=g.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&d&&this.parent.computeExtremities()};this.isPointWithin=function(a,b){if(this.clipActive)return this.clippingStencil.isPointWithin(a,b);if(void 0==this.extremities.boundingBox){console.warn("the shape",
this,"has no bounding box");var d=!1}else d=g.library.math.detectOverlap.pointWithinBoundingBox({x:a,y:b},this.extremities.boundingBox);return d?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),a=!1):a=g.library.math.detectOverlap.pointWithinPoly({x:a,y:b},this.extremities.points),a):!1};this.getElementUnderPoint=function(a,b,c,g){c=void 0===c?!1:c;g=void 0===g?!1:g;for(var d=[],k=this.children.length-1;0<=k;k--){var l=this.children[k]._static||c?e.coreGraphicsPoint2windowPoint(a,
b):{x:a,y:b};if(!this.children[k].ignored&&this.children[k].isPointWithin(l.x,l.y))if("group"==this.children[k].type){if(l=this.children[k].getElementUnderPoint(a,b,this.children[k]._static||c,g),void 0!=l)if(g)d=d.concat(l);else return l}else if(g)d.push(this.children[k]);else return this.children[k]}if(g)return d};this.render=function(a,b,f,l){b=void 0===b?{x:0,y:0,a:0}:b;f=void 0===f?!1:f;l=void 0===l?!1:l;a:if(this._static)var d=!0;else{for(d=0;d<this.children.length;d++)if(this.children[d]._static){d=
!0;break a}d=g.library.math.detectOverlap.boundingBoxes(c.viewport.getBoundingBox(),this.extremities.boundingBox)}if(d){d=g.library.math.cartesianAngleAdjust(this.x,this.y,b.a);b={a:b.a+this.angle,x:b.x+d.x,y:b.y+d.y};if(this.clipActive||l)a.save(),this.clippingStencil.render(a,Object.assign({},b),f||this.clippingStencil._static,l||this.clipActive);for(l=0;l<this.children.length;l++)d=this.children[l],d.render(a,Object.assign({},b),f||d._static);this.clipActive&&a.restore();if(this.dotFrame){for(l=
0;l<this.extremities.points.length;l++)a=e.coreGraphicsPoint2windowPoint(this.extremities.points[l].x,this.extremities.points[l].y),c.render.drawDot(a.x,a.y,4,"rgba(50,50,50,1)");a=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);c.render.drawDot(a.x,a.y);a=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);c.render.drawDot(a.x,a.y)}}}};this.image=function(){this.type=
"image";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.angle=this.y=this.x=0;this.anchor={x:0,y:0};this.height=this.width=10;this.url="";var a={};this.style={shadowColour:"rgba(0,0,0,0)",shadowBlur:2,shadowOffset:{x:1,y:1}};this.parameter={};this.parameter.x=function(a){return function(b){if(void 0==b)return a.x;a.x=b;a.computeExtremities()}}(this);this.parameter.y=function(a){return function(b){if(void 0==b)return a.y;
a.y=b;a.computeExtremities()}}(this);this.parameter.angle=function(a){return function(b){if(void 0==b)return a.angle;a.angle=b;a.computeExtremities()}}(this);this.parameter.anchor=function(a){return function(b){if(void 0==b)return a.anchor;a.anchor=b;a.computeExtremities()}}(this);this.parameter.width=function(a){return function(b){if(void 0==b)return a.width;a.width=b;a.computeExtremities()}}(this);this.parameter.height=function(a){return function(b){if(void 0==b)return a.height;a.height=b;a.computeExtremities()}}(this);
this.getAddress=function(){var a="",b=this;do a=b.name+"/"+a;while(void 0!=(b=b.parent));return"/"+a};this.computeExtremities=function(a){for(var d=this._static,c=this;void 0!=(c=c.parent)&&!d;)d=d||c._static;this._static=d;a=void 0==a?b(this):a;this.extremities={points:[],boundingBox:{}};this.extremities.points=g.library.math.pointsOfRect(this.x,this.y,this.width,this.height,-this.angle,this.anchor);this.extremities.points=this.extremities.points.map(function(b){b=g.library.math.cartesianAngleAdjust(b.x,
b.y,a.a);b.x+=a.x;b.y+=a.y;return b});this.extremities.boundingBox=g.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(a,b){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var d=!1}else d=g.library.math.detectOverlap.pointWithinBoundingBox({x:a,y:b},this.extremities.boundingBox);return d?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),
a=!1):a=g.library.math.detectOverlap.pointWithinPoly({x:a,y:b},this.extremities.points),a):!1};this.render=function(b,k,f){k=void 0===k?{x:0,y:0,a:0}:k;f=void 0===f?!1:f;var d=this._static?!0:g.library.math.detectOverlap.boundingBoxes(c.viewport.getBoundingBox(),this.extremities.boundingBox);if(d){d=g.library.math.cartesianAngleAdjust(this.x,this.y,k.a);k.x+=d.x-this.x;k.y+=d.y-this.y;d=this.angle+k.a;var h=this.width,q=this.height;k={x:this.x+k.x-this.anchor.x*(this.width*Math.cos(d)+this.height*
Math.sin(-d)),y:this.y+k.y-this.anchor.y*(this.width*Math.sin(d)+this.height*Math.cos(-d))};f||(k=e.coreGraphicsPoint2windowPoint(k.x,k.y),h=e.length(h),q=e.length(q));k=g.library.math.cartesianAngleAdjust(k.x,k.y,-d);a.hasOwnProperty(this.url)||(a[this.url]=new Image,a[this.url].src=this.url);b.save();b.rotate(d);b.drawImage(a[this.url],k.x,k.y,h,q);b.restore();if(this.dotFrame){for(b=0;b<this.extremities.points.length;b++)f=e.coreGraphicsPoint2windowPoint(this.extremities.points[b].x,this.extremities.points[b].y),
c.render.drawDot(f.x,f.y,4,"rgba(50,50,50,1)");f=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);c.render.drawDot(f.x,f.y);f=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);c.render.drawDot(f.x,f.y)}}}};this.path=function(){this.type="path";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.points=
[];this.style={stroke:"rgba(0,0,0,0)",lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:2,shadowColour:"rgba(0,0,0,0)",shadowBlur:20,shadowOffset:{x:20,y:20}};this.parameter={};this.parameter.points=function(a){return function(b){if(void 0==b)return a.points;a.points=b;a.computeExtremities()}}(this);this.getAddress=function(){var a="",b=this;do a=b.name+"/"+a;while(void 0!=(b=b.parent));return"/"+a};this.computeExtremities=function(a){for(var d=this._static,c=this;void 0!=(c=c.parent)&&!d;)d=
d||c._static;this._static=d;a=void 0==a?b(this):a;this.extremities={points:[],boundingBox:{}};this.extremities.points=this.points.map(function(b){b=g.library.math.cartesianAngleAdjust(b.x,b.y,a.a);b.x+=a.x;b.y+=a.y;return b});this.extremities.boundingBox=g.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(a,b){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var d=
!1}else d=g.library.math.detectOverlap.pointWithinBoundingBox({x:a,y:b},this.extremities.boundingBox);return d?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),a=!1):a=g.library.math.detectOverlap.pointWithinPoly({x:a,y:b},this.extremities.points),a):!1};this.render=function(a,b,k){b=void 0===b?{x:0,y:0,a:0}:b;k=void 0===k?!1:k;var d=this._static?!0:g.library.math.detectOverlap.boundingBoxes(c.viewport.getBoundingBox(),this.extremities.boundingBox);if(d){d=this.points.map(function(a){a=
g.library.math.cartesianAngleAdjust(a.x,a.y,b.a);return{x:a.x+b.x,y:a.y+b.y}});var f=this.style.lineWidth,h=this.style.shadowBlur,m=this.style.shadowOffset.x,y=this.style.shadowOffset.y;k||(d=d.map(function(a){return e.coreGraphicsPoint2windowPoint(a.x,a.y)}),f=e.length(f),h=e.length(h),m=e.length(m),y=e.length(y));a.fillStyle=this.style.fill;a.strokeStyle=this.style.stroke;a.lineWidth=f;a.lineCap=this.style.lineCap;a.lineJoin=this.style.lineJoin;a.miterLimit=this.style.miterLimit;a.shadowColor=this.style.shadowColour;
a.shadowBlur=h;a.shadowOffsetX=m;a.shadowOffsetY=y;a.beginPath();a.moveTo(d[0].x,d[0].y);for(k=1;k<d.length;k++)a.lineTo(d[k].x,d[k].y);a.stroke();if(this.dotFrame){for(k=0;k<this.extremities.points.length;k++)a=e.coreGraphicsPoint2windowPoint(this.extremities.points[k].x,this.extremities.points[k].y),c.render.drawDot(a.x,a.y,4,"rgba(50,50,50,1)");a=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);c.render.drawDot(a.x,a.y);a=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.bottomRight.x,
this.extremities.boundingBox.bottomRight.y);c.render.drawDot(a.x,a.y)}}}};this.polygon=function(){this.type="polygon";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.points=[];this.style={fill:"rgba(100,255,255,1)",stroke:"rgba(0,0,0,0)",lineWidth:1,lineJoin:"round",miterLimit:2,shadowColour:"rgba(0,0,0,0)",shadowBlur:20,shadowOffset:{x:20,y:20}};this.parameter={};this.parameter.points=function(a){return function(b){if(void 0==
b)return a.points;a.points=b;a.computeExtremities()}}(this);this.getAddress=function(){var a="",b=this;do a=b.name+"/"+a;while(void 0!=(b=b.parent));return"/"+a};this.computeExtremities=function(a){for(var d=this._static,c=this;void 0!=(c=c.parent)&&!d;)d=d||c._static;this._static=d;a=void 0==a?b(this):a;this.extremities={points:[],boundingBox:{}};this.extremities.points=this.points.map(function(b){b=g.library.math.cartesianAngleAdjust(b.x,b.y,a.a);b.x+=a.x;b.y+=a.y;return b});this.extremities.boundingBox=
g.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(a,b){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var d=!1}else d=g.library.math.detectOverlap.pointWithinBoundingBox({x:a,y:b},this.extremities.boundingBox);return d?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),a=!1):a=g.library.math.detectOverlap.pointWithinPoly({x:a,y:b},
this.extremities.points),a):!1};this.render=function(a,b,k,f){b=void 0===b?{x:0,y:0,a:0}:b;k=void 0===k?!1:k;f=void 0===f?!1:f;var d=this._static?!0:g.library.math.detectOverlap.boundingBoxes(c.viewport.getBoundingBox(),this.extremities.boundingBox);if(d){d=this.points.map(function(a){a=g.library.math.cartesianAngleAdjust(a.x,a.y,b.a);return{x:a.x+b.x,y:a.y+b.y}});var h=this.style.lineWidth,q=this.style.shadowBlur,m=this.style.shadowOffset.x,r=this.style.shadowOffset.y;k||(d=d.map(function(a){return e.coreGraphicsPoint2windowPoint(a.x,
a.y)}),h=e.length(h),q=e.length(q),m=e.length(m),r=e.length(r));if(f){f=new Path2D;f.moveTo(d[0].x,d[0].y);for(k=1;k<d.length;k++)f.lineTo(d[k].x,d[k].y);a.clip(f)}else{a.fillStyle=this.style.fill;a.strokeStyle=this.style.stroke;a.lineWidth=h;a.lineJoin=this.style.lineJoin;a.miterLimit=this.style.miterLimit;a.shadowColor=this.style.shadowColour;a.shadowBlur=q;a.shadowOffsetX=m;a.shadowOffsetY=r;a.beginPath();a.moveTo(d[0].x,d[0].y);for(k=1;k<d.length;k++)a.lineTo(d[k].x,d[k].y);a.closePath();a.fill();
a.stroke();if(this.dotFrame){for(k=0;k<this.extremities.points.length;k++)a=e.coreGraphicsPoint2windowPoint(this.extremities.points[k].x,this.extremities.points[k].y),c.render.drawDot(a.x,a.y,4,"rgba(50,50,50,1)");a=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);c.render.drawDot(a.x,a.y);a=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);c.render.drawDot(a.x,a.y)}}}}};
this.rectangle=function(){this.type="rectangle";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.angle=this.y=this.x=0;this.anchor={x:0,y:0};this.height=this.width=10;this.style={fill:"rgba(255,100,255,1)",stroke:"rgba(0,0,0,0)",lineWidth:1,shadowColour:"rgba(0,0,0,0)",shadowBlur:2,shadowOffset:{x:1,y:1}};this.parameter={};this.parameter.x=function(a){return function(b){if(void 0==b)return a.x;a.x=b;a.computeExtremities()}}(this);
this.parameter.y=function(a){return function(b){if(void 0==b)return a.y;a.y=b;a.computeExtremities()}}(this);this.parameter.angle=function(a){return function(b){if(void 0==b)return a.angle;a.angle=b;a.computeExtremities()}}(this);this.parameter.anchor=function(a){return function(b){if(void 0==b)return a.anchor;a.anchor=b;a.computeExtremities()}}(this);this.parameter.width=function(a){return function(b){if(void 0==b)return a.width;a.width=b;a.computeExtremities()}}(this);this.parameter.height=function(a){return function(b){if(void 0==
b)return a.height;a.height=b;a.computeExtremities()}}(this);this.getAddress=function(){var a="",b=this;do a=b.name+"/"+a;while(void 0!=(b=b.parent));return"/"+a};this.getOffset=function(){return b(this)};this.computeExtremities=function(a,d){d=this._static;for(var c=this;void 0!=(c=c.parent)&&!d;)d=d||c._static;this._static=d;a=void 0==a?b(this):a;this.extremities={points:[],boundingBox:{}};this.extremities.points=g.library.math.pointsOfRect(this.x,this.y,this.width,this.height,-this.angle,this.anchor);
this.extremities.points=this.extremities.points.map(function(b){b=g.library.math.cartesianAngleAdjust(b.x,b.y,a.a);b.x+=a.x;b.y+=a.y;return b});this.extremities.boundingBox=g.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(a,b){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var d=!1}else d=g.library.math.detectOverlap.pointWithinBoundingBox({x:a,y:b},this.extremities.boundingBox);
return d?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),a=!1):a=g.library.math.detectOverlap.pointWithinPoly({x:a,y:b},this.extremities.points),a):!1};this.render=function(a,b,f,h){b=void 0===b?{x:0,y:0,a:0}:b;f=void 0===f?!1:f;h=void 0===h?!1:h;var d=this._static?!0:g.library.math.detectOverlap.boundingBoxes(c.viewport.getBoundingBox(),this.extremities.boundingBox);if(d){d=g.library.math.cartesianAngleAdjust(this.x,this.y,b.a);b.x+=d.x-this.x;b.y+=d.y-this.y;d=this.angle+
b.a;var k=this.width,q=this.height,m=this.style.lineWidth,r=this.style.shadowBlur,p=this.style.shadowOffset.x,n=this.style.shadowOffset.y;b={x:this.x+b.x-this.anchor.x*(this.width*Math.cos(d)+this.height*Math.sin(-d)),y:this.y+b.y-this.anchor.y*(this.width*Math.sin(d)+this.height*Math.cos(-d))};f||(b=e.coreGraphicsPoint2windowPoint(b.x,b.y),k=e.length(k),q=e.length(q),m=e.length(m),r=e.length(r),p=e.length(p),n=e.length(n));b=g.library.math.cartesianAngleAdjust(b.x,b.y,-d);if(h)a.rotate(d),f=new Path2D,
f.rect(b.x,b.y,k,q),a.clip(f),a.rotate(-d);else if(a.fillStyle=this.style.fill,a.strokeStyle=this.style.stroke,a.lineWidth=m,a.shadowColor=this.style.shadowColour,a.shadowBlur=r,a.shadowOffsetX=p,a.shadowOffsetY=n,a.save(),a.rotate(d),a.fillRect(b.x,b.y,k,q),a.strokeRect(b.x,b.y,k,q),a.restore(),this.dotFrame){for(a=0;a<this.extremities.points.length;a++)f=e.coreGraphicsPoint2windowPoint(this.extremities.points[a].x,this.extremities.points[a].y),c.render.drawDot(f.x,f.y,4,"rgba(50,50,50,1)");f=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.topLeft.x,
this.extremities.boundingBox.topLeft.y);c.render.drawDot(f.x,f.y);f=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);c.render.drawDot(f.x,f.y)}}}};this.text=function(){this.type="text";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.y=this.x=0;this.text="curve";this.angle=0;this.size=1;this.style={font:"30pt Arial",align:"start",baseline:"alphabetic",
fill:"rgba(255,100,100,1)",stroke:"rgba(0,0,0,0)",lineWidth:1,shadowColour:"rgba(0,0,0,0)",shadowBlur:2,shadowOffset:{x:20,y:20}};this.parameter={};this.parameter.x=function(a){return function(b){if(void 0==b)return a.x;a.x=b;a.computeExtremities()}}(this);this.parameter.y=function(a){return function(b){if(void 0==b)return a.y;a.y=b;a.computeExtremities()}}(this);this.parameter.angle=function(a){return function(b){if(void 0==b)return a.angle;a.angle=b;a.computeExtremities()}}(this);this.parameter.size=
function(a){return function(b){if(void 0==b)return a.size;a.size=b;a.computeExtremities()}}(this);this.getAddress=function(){var a="",b=this;do a=b.name+"/"+a;while(void 0!=(b=b.parent));return"/"+a};this.computeExtremities=function(a){for(var d=this._static,c=this;void 0!=(c=c.parent)&&!d;)d=d||c._static;this._static=d;a=void 0==a?b(this):a;this.extremities={points:[],boundingBox:{}};this.extremities.points=g.library.math.pointsOfText(this.text,this.x,this.y,this.angle,1/this.size,this.style.font,
this.style.align,this.style.baseline);this.extremities.points=this.extremities.points.map(function(b){b=g.library.math.cartesianAngleAdjust(b.x,b.y,a.a);b.x+=a.x;b.y+=a.y;return b});this.extremities.boundingBox=g.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(a,b){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var d=!1}else d=g.library.math.detectOverlap.pointWithinBoundingBox({x:a,
y:b},this.extremities.boundingBox);return d?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),a=!1):a=g.library.math.detectOverlap.pointWithinPoly({x:a,y:b},this.extremities.points),a):!1};this.render=function(a,b,f,h){b=void 0===b?{x:0,y:0,a:0}:b;f=void 0===f?!1:f;h=void 0===h?!1:h;var d=g.library.math.cartesianAngleAdjust(this.x,this.y,b.a);b.x+=d.x-this.x;b.y+=d.y-this.y;d={x:this.x+b.x,y:this.y+b.y};var k=this.size;b=this.angle+b.a;var m=this.style.lineWidth,q=this.style.shadowBlur,
r=this.style.shadowOffset.x,p=this.style.shadowOffset.y;f||(d=e.coreGraphicsPoint2windowPoint(d.x,d.y),k=e.length(k),q=e.length(q),r=e.length(r),p=e.length(p));d=g.library.math.cartesianAngleAdjust(d.x,d.y,-b);if(h)console.warn("no clipping available for text shape");else if(a.font=this.style.font,a.textAlign=this.style.align,a.textBaseline=this.style.baseline,a.fillStyle=this.style.fill,a.strokeStyle=this.style.stroke,a.lineWidth=m,a.shadowColor=this.style.shadowColour,a.shadowBlur=q,a.shadowOffsetX=
r,a.shadowOffsetY=p,a.save(),a.rotate(b),a.scale(k,k),a.fillText(this.text,d.x/k,d.y/k),a.shadowColor="rgba(0,0,0,0)",a.strokeText(this.text,d.x/k,d.y/k),a.restore(),this.dotFrame){for(a=0;a<this.extremities.points.length;a++)f=e.coreGraphicsPoint2windowPoint(this.extremities.points[a].x,this.extremities.points[a].y),c.render.drawDot(f.x,f.y,4,"rgba(50,50,50,1)");f=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);c.render.drawDot(f.x,f.y);
f=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);c.render.drawDot(f.x,f.y)}}}};this.arrangement=new function(){var a=new f.group;a.name="root";this.createElement=function(a){return new f[a]};this.clear=function(){a.clear()};this.get=function(){return a};this.set=function(b){a=b};this.prepend=function(b){a.prepend(b)};this.append=function(b){a.append(b)};this.remove=function(b){a.remove(b)};this.getElementUnderPoint=function(b,
c,e,f){return a.getElementUnderPoint(b,c,void 0===e?!1:e,void 0===f?!1:f)};this.getElementsWithName=function(b){return a.getElementsWithName(b)}};this.viewport=new function(){function a(){function a(a){var b=a.charAt(0).toUpperCase()+a.slice(1),e=g.getAttribute("coreGraphics"+b);if(c[a]!=e||c["window"+b]!=window["inner"+b])c[a]=e,c["window"+b]=window["inner"+b],void 0==e?(g[a]=c.defaultSize[a]*window.devicePixelRatio,g.style[a]=c.defaultSize[a]+"px"):e.indexOf("%")==e.length-1?(b=g.parentElement["offset"+
b],e=parseFloat(e.slice(0,e.length-1))/100,g[a]=b*e*window.devicePixelRatio,g.style[a]=b*e+"px"):(g[a]=e*window.devicePixelRatio,g.style[a]=e+"px"),d=!0}var d=!1;a("height");a("width");d&&b()}function b(){f.points.tl=e.windowPoint2coreGraphicsPoint(0,0);f.points.tr=e.windowPoint2coreGraphicsPoint(g.width,0);f.points.bl=e.windowPoint2coreGraphicsPoint(0,g.height);f.points.br=e.windowPoint2coreGraphicsPoint(g.width,g.height);f.boundingBox=g.library.math.boundingBoxFromPoints([f.points.tl,f.points.tr,
f.points.br,f.points.bl])}var c={defaultSize:{width:640,height:480},width:0,height:0,windowWidth:0,windowHeight:0},f={position:{x:0,y:0},scale:window.devicePixelRatio,angle:0,points:{tl:{x:0,y:0},tr:{x:0,y:0},bl:{x:0,y:0},br:{x:0,y:0}},boundingBox:{topLeft:{x:0,y:0},bottomRight:{x:0,y:0}}},h=void 0,m=void 0,p=!1,y=!0;this.position=function(a,c){if(void 0==a||void 0==c)return{x:f.position.x,y:f.position.y};f.position.x=a;f.position.y=c;b()};this.scale=function(a){if(void 0==a)return f.scale;f.scale=
0==a?window.devicePixelRatio:a;b()};this.angle=function(a){if(void 0==a)return f.angle;f.angle=a;b()};this.windowPoint2coreGraphicsPoint=function(a,b){return e.windowPoint2coreGraphicsPoint(a,b)};this.refresh=function(){a();b();this.allowKeyboardInput(y)};this.getBoundingBox=function(){return f.boundingBox};this.mousePosition=function(a,b){if(void 0==a||void 0==b)return{x:h,y:m};h=a;m=b};this.stopMouseScroll=function(a){if(void 0==a)return p;p=a;a||(document.body.style.overflow="")};this.allowKeyboardInput=
function(a){if(void 0==a)return y;(y=a)?g.setAttribute("tabIndex",1):g.removeAttribute("tabIndex")};this.cursor=function(a){if(void 0==a)return document.body.style.cursor;document.body.style.cursor=a}};this.render=new function(){function a(a){void 0!==a&&a||(e.fillStyle="rgb(255,255,255)",e.fillRect(0,0,g.width,g.height));c.arrangement.get().render(e)}function b(d){f=requestAnimationFrame(b);try{a()}catch(x){c.render.active(!1),console.error("major animation error"),console.error(x)}c.stats.collect(d)}
var e=g.getContext("2d",{alpha:!1}),f=void 0;this.drawDot=function(a,b,c,d){c=void 0===c?2:c;e.fillStyle=void 0===d?"rgba(150,150,255,1)":d;e.beginPath();e.arc(a,b,c,0,2*Math.PI,!1);e.closePath();e.fill()};this.frame=function(b){a(void 0===b?!1:b)};this.active=function(a){if(void 0==a)return void 0!=f;a?void 0==f&&b():void 0!=f&&(cancelAnimationFrame(f),f=void 0)}};this.stats=new function(){var a=!1,b=0,c={compute:function(a){this.frameTimeArray.push(1E3/(a-b));30<=this.frameTimeArray.length&&this.frameTimeArray.shift();
this.rate=g.library.math.averageArray(this.frameTimeArray);b=a},counter:0,frameTimeArray:[],rate:0},e={recursiveCount:function(a){void 0==a&&(this.counts={total:0,canvas:0,circle:0,group:0,image:0,path:0,polygon:0,rectangle:0,text:0},a=g.core.arrangement.get());this.counts.total++;switch(a.type){case "canvas":this.counts.canvas++;break;case "circle":this.counts.circle++;break;case "group":this.counts.group++;break;case "image":this.counts.image++;break;case "path":this.counts.path++;break;case "polygon":this.counts.polygon++;
break;case "rectangle":this.counts.rectangle++;break;case "text":this.counts.text++}if(void 0!=a.children)for(var b=0;b<a.children.length;b++)this.recursiveCount(a.children[b])},recursivePrint:function(a,b){b=void 0===b?"":b;void 0==a&&(a=g.core.arrangement.get());console.log(b+a.name);if(void 0!=a.children)for(var c=0;c<a.children.length;c++)this.recursivePrint(a.children[c],b+"- ")},counts:{total:0,canvas:0,circle:0,group:0,image:0,path:0,polygon:0,rectangle:0,text:0}};this.collect=function(b){a&&
c.compute(b)};this.active=function(b){if(void 0==b)return a;a=b};this.getReport=function(){e.recursiveCount();return{framesPerSecond:c.rate,shapeCount:e.counts}}};this.callback=new function(){for(var a="onmousedown onmouseup onmousemove onmouseenter onmouseleave onwheel onclick ondblclick onkeydown onkeyup touchstart touchmove touchend touchenter touchleave touchcancel".split(" "),b={},f=0;f<a.length;b={$jscomp$loop$prop$getRelevantShape$7:b.$jscomp$loop$prop$getRelevantShape$7},f++){b.$jscomp$loop$prop$getRelevantShape$7=
function(a,b,d){var e=c.arrangement.getElementUnderPoint(a,b);if(void 0!=e&&void 0==e[d])for(a=c.arrangement.getElementUnderPoint(a,b,void 0,!0),b=0;b<a.length;b++)if(void 0!=a[b][d]){e=a[b];break}return e};this[a[f]]=function(a,b,c){};var h=0,l=0;g[a[f]]=function(a){return function(b){return function(d){if(c.callback[b]){var f=e.windowPoint2coreGraphicsPoint(d.x,d.y),g=a.$jscomp$loop$prop$getRelevantShape$7(f.x,f.y,b);c.callback[b](f.x,f.y,d,g)}}}}(b)(a[f]);g.onmouseover=function(a){return function(b){c.viewport.stopMouseScroll()&&
(document.body.style.overflow="hidden");if(c.callback.onmouseover){var d=e.windowPoint2coreGraphicsPoint(b.x,b.y),f=a.$jscomp$loop$prop$getRelevantShape$7(d.x,d.y,"onmouseover");c.callback.onmouseover(d.x,d.y,b,f)}}}(b);g.onmouseout=function(a){return function(b){c.viewport.stopMouseScroll()&&(document.body.style.overflow="");if(c.callback.onmouseout){var d=e.windowPoint2coreGraphicsPoint(b.x,b.y),f=a.$jscomp$loop$prop$getRelevantShape$7(d.x,d.y,"onmouseout");c.callback.onmouseout(d.x,d.y,b,f)}}}(b);
g.onmousemove=function(a){return function(b){var d=e.windowPoint2coreGraphicsPoint(b.x,b.y);c.viewport.mousePosition(d.x,d.y);if(c.callback.onmousemove){var f=a.$jscomp$loop$prop$getRelevantShape$7(h,l,"onmouseleave"),g=a.$jscomp$loop$prop$getRelevantShape$7(d.x,d.y,"onmouseenter"),k=a.$jscomp$loop$prop$getRelevantShape$7(d.x,d.y,"onmousemove");f!=g&&(c.callback.onmouseleave(d.x,d.y,b,f),c.callback.onmouseenter(d.x,d.y,b,g));c.callback.onmousemove(d.x,d.y,b,k);h=d.x;l=d.y}}}(b);g.onkeydown=function(a){return function(b){if(c.callback.onkeydown){var d=
c.viewport.mousePosition(),e=a.$jscomp$loop$prop$getRelevantShape$7(d.x,d.y,"onkeydown");c.callback.onkeydown(d.x,d.y,b,e)}}}(b);g.onkeyup=function(a){return function(b){if(c.callback.onkeyup){var d=c.viewport.mousePosition(),e=a.$jscomp$loop$prop$getRelevantShape$7(d.x,d.y,"onkeyup");c.callback.onkeyup(d.x,d.y,b,e)}}}(b)}};c.viewport.refresh();c.arrangement.clear()};this.arrangement=new function(){this.get=function(){return h.arrangement.get()};this.set=function(b){return h.arrangement.set(b)};this.createElement=
function(b){return h.arrangement.createElement(b)};this.append=function(b){return h.arrangement.append(b)};this.prepend=function(b){return h.arrangement.prepend(b)};this.remove=function(b){return h.arrangement.remove(b)};this.getElementUnderPoint=function(b,c){return h.arrangement.getElementUnderPoint(b,c)};this.getElementsWithName=function(b){return h.arrangement.getElementsWithName(b)};this.forceRefresh=function(b){return h.arrangement.forceRefresh(b)}};this.viewport=new function(){this.position=
function(b,c){return h.viewport.position(b,c)};this.scale=function(b){return h.viewport.scale(b)};this.angle=function(b){return h.viewport.angle(b)};this.windowPoint2coreGraphicsPoint=function(b,c){return h.viewport.windowPoint2coreGraphicsPoint(b,c)};this.refresh=function(){h.viewport.refresh()};this.mousePosition=function(){return h.viewport.mousePosition()};this.stopMouseScroll=function(b){return h.viewport.stopMouseScroll(b)};this.allowKeyboardInput=function(b){return h.viewport.allowKeyboardInput(b)};
this.cursor=function(b){return h.viewport.cursor(b)}};this.render=new function(){this.frame=function(b){return h.render.frame(void 0===b?!1:b)};this.active=function(b){return h.render.active(b)}};this.stats=new function(){this.active=function(b){return h.stats.active(b)};this.getReport=function(){return h.stats.getReport()}};this.callback=new function(){this.onmousedown=function(b,c,e,f){};h.callback.onmousedown=function(b){return function(c,e,f,a){b.onmousedown(c,e,f,a)}}(this);this.onmouseup=function(b,
c,e,f){};h.callback.onmouseup=function(b){return function(c,e,f,a){b.onmouseup(c,e,f,a)}}(this);this.onmousemove=function(b,c,e,f){};h.callback.onmousemove=function(b){return function(c,e,f,a){b.onmousemove(c,e,f,a)}}(this);this.onmouseenter=function(b,c,e,f){};h.callback.onmouseenter=function(b){return function(c,e,f,a){b.onmouseenter(c,e,f,a)}}(this);this.onmouseleave=function(b,c,e,f){};h.callback.onmouseleave=function(b){return function(c,e,f,a){b.onmouseleave(c,e,f,a)}}(this);this.onwheel=function(b,
c,e,f){};h.callback.onwheel=function(b){return function(c,e,f,a){b.onwheel(c,e,f,a)}}(this);this.onclick=function(b,c,e,f){};h.callback.onclick=function(b){return function(c,e,f,a){b.onclick(c,e,f,a)}}(this);this.ondblclick=function(b,c,e,f){};h.callback.ondblclick=function(b){return function(c,e,f,a){b.ondblclick(c,e,f,a)}}(this);this.onkeydown=function(b,c,e,f){};h.callback.onkeydown=function(b){return function(c,e,f,a){b.onkeydown(c,e,f,a)}}(this);this.onkeyup=function(b,c,e,f){};h.callback.onkeyup=
function(b){return function(c,e,f,a){b.onkeyup(c,e,f,a)}}(this);this.touchstart=function(b,c,e){};h.callback.touchstart=function(b){return function(c,e,f,a){b.touchstart(c,e,f)}}(this);this.touchmove=function(b,c,e){};h.callback.touchmove=function(b){return function(c,e,f,a){b.touchmove(c,e,f)}}(this);this.touchend=function(b,c,e){};h.callback.touchend=function(b){return function(c,e,f,a){b.touchend(c,e,f)}}(this);this.touchenter=function(b,c,e){};h.callback.touchenter=function(b){return function(c,
e,f,a){b.touchenter(c,e,f)}}(this);this.touchleave=function(b,c,e){};h.callback.touchleave=function(b){return function(c,e,f,a){b.touchleave(c,e,f)}}(this);this.touchcancel=function(b,c,e){};h.callback.touchcancel=function(b){return function(c,e,f,a){b.touchcancel(c,e,f)}}(this)}}}})();
