var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(h){var p=0;return function(){return p<h.length?{done:!1,value:h[p++]}:{done:!0}}};$jscomp.arrayIterator=function(h){return{next:$jscomp.arrayIteratorImpl(h)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(h,p,g){h!=Array.prototype&&h!=Object.prototype&&(h[p]=g.value)};$jscomp.getGlobal=function(h){return"undefined"!=typeof window&&window===h?h:"undefined"!=typeof global&&null!=global?global:h};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.Symbol=function(){var h=0;return function(p){return $jscomp.SYMBOL_PREFIX+(p||"")+h++}}();$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var h=$jscomp.global.Symbol.iterator;h||(h=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[h]&&$jscomp.defineProperty(Array.prototype,h,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var h=$jscomp.global.Symbol.asyncIterator;h||(h=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(h){$jscomp.initSymbolIterator();h={next:h};h[$jscomp.global.Symbol.iterator]=function(){return this};return h};
$jscomp.iteratorFromArray=function(h,p){$jscomp.initSymbolIterator();h instanceof String&&(h+="");var g=0,l={next:function(){if(g<h.length){var b=g++;return{value:p(b,h[b]),done:!1}}l.next=function(){return{done:!0,value:void 0}};return l.next()}};l[Symbol.iterator]=function(){return l};return l};
$jscomp.polyfill=function(h,p,g,l){if(p){g=$jscomp.global;h=h.split(".");for(l=0;l<h.length-1;l++){var b=h[l];b in g||(g[b]={});g=g[b]}h=h[h.length-1];l=g[h];p=p(l);p!=l&&null!=p&&$jscomp.defineProperty(g,h,{configurable:!0,writable:!0,value:p})}};$jscomp.polyfill("Array.prototype.keys",function(h){return h?h:function(){return $jscomp.iteratorFromArray(this,function(h){return h})}},"es6","es3");
$jscomp.polyfill("Array.from",function(h){return h?h:function(h,g,l){g=null!=g?g:function(b){return b};var b=[],d="undefined"!=typeof Symbol&&Symbol.iterator&&h[Symbol.iterator];if("function"==typeof d){h=d.call(h);for(var e=0;!(d=h.next()).done;)b.push(g.call(l,d.value,e++))}else for(d=h.length,e=0;e<d;e++)b.push(g.call(l,h[e],e));return b}},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var h={},p=Object.create(new $jscomp.global.Proxy(h,{get:function(g,l,b){return g==h&&"q"==l&&b==p}}));return!0===p.q}catch(g){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.makeIterator=function(h){var p="undefined"!=typeof Symbol&&Symbol.iterator&&h[Symbol.iterator];return p?p.call(h):$jscomp.arrayIterator(h)};
$jscomp.owns=function(h,p){return Object.prototype.hasOwnProperty.call(h,p)};
$jscomp.polyfill("WeakMap",function(h){function p(){if(!h||!Object.seal)return!1;try{var a=Object.seal({}),c=Object.seal({}),b=new h([[a,2],[c,3]]);if(2!=b.get(a)||3!=b.get(c))return!1;b.delete(a);b.set(c,4);return!b.has(a)&&4==b.get(c)}catch(q){return!1}}function g(){}function l(a){if(!$jscomp.owns(a,d)){var c=new g;$jscomp.defineProperty(a,d,{value:c})}}function b(a){var c=Object[a];c&&(Object[a]=function(a){if(a instanceof g)return a;l(a);return c(a)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(h&&
$jscomp.ES6_CONFORMANCE)return h}else if(p())return h;var d="$jscomp_hidden_"+Math.random();b("freeze");b("preventExtensions");b("seal");var e=0,f=function(a){this.id_=(e+=Math.random()+1).toString();if(a){a=$jscomp.makeIterator(a);for(var c;!(c=a.next()).done;)c=c.value,this.set(c[0],c[1])}};f.prototype.set=function(a,c){l(a);if(!$jscomp.owns(a,d))throw Error("WeakMap key fail: "+a);a[d][this.id_]=c;return this};f.prototype.get=function(a){return $jscomp.owns(a,d)?a[d][this.id_]:void 0};f.prototype.has=
function(a){return $jscomp.owns(a,d)&&$jscomp.owns(a[d],this.id_)};f.prototype.delete=function(a){return $jscomp.owns(a,d)&&$jscomp.owns(a[d],this.id_)?delete a[d][this.id_]:!1};return f},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(h){function p(){if($jscomp.ASSUME_NO_NATIVE_MAP||!h||"function"!=typeof h||!h.prototype.entries||"function"!=typeof Object.seal)return!1;try{var a=Object.seal({x:4}),c=new h($jscomp.makeIterator([[a,"s"]]));if("s"!=c.get(a)||1!=c.size||c.get({x:4})||c.set({x:4},"t")!=c||2!=c.size)return!1;var b=c.entries(),d=b.next();if(d.done||d.value[0]!=a||"s"!=d.value[1])return!1;d=b.next();return d.done||4!=d.value[0].x||"t"!=d.value[1]||!b.next().done?!1:!0}catch(m){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(h&&$jscomp.ES6_CONFORMANCE)return h}else if(p())return h;$jscomp.initSymbolIterator();var g=new WeakMap,l=function(a){this.data_={};this.head_=e();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var c;!(c=a.next()).done;)c=c.value,this.set(c[0],c[1])}};l.prototype.set=function(a,c){a=0===a?0:a;var k=b(this,a);k.list||(k.list=this.data_[k.id]=[]);k.entry?k.entry.value=c:(k.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,
value:c},k.list.push(k.entry),this.head_.previous.next=k.entry,this.head_.previous=k.entry,this.size++);return this};l.prototype.delete=function(a){a=b(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};l.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=e();this.size=0};l.prototype.has=function(a){return!!b(this,a).entry};
l.prototype.get=function(a){return(a=b(this,a).entry)&&a.value};l.prototype.entries=function(){return d(this,function(a){return[a.key,a.value]})};l.prototype.keys=function(){return d(this,function(a){return a.key})};l.prototype.values=function(){return d(this,function(a){return a.value})};l.prototype.forEach=function(a,c){for(var b=this.entries(),d;!(d=b.next()).done;)d=d.value,a.call(c,d[1],d[0],this)};l.prototype[Symbol.iterator]=l.prototype.entries;var b=function(a,c){var b=c&&typeof c;"object"==
b||"function"==b?g.has(c)?b=g.get(c):(b=""+ ++f,g.set(c,b)):b="p_"+c;var d=a.data_[b];if(d&&$jscomp.owns(a.data_,b))for(a=0;a<d.length;a++){var e=d[a];if(c!==c&&e.key!==e.key||c===e.key)return{id:b,list:d,index:a,entry:e}}return{id:b,list:d,index:-1,entry:void 0}},d=function(a,c){var b=a.head_;return $jscomp.iteratorPrototype(function(){if(b){for(;b.head!=a.head_;)b=b.previous;for(;b.next!=b.head;)return b=b.next,{done:!1,value:c(b)};b=null}return{done:!0,value:void 0}})},e=function(){var a={};return a.previous=
a.next=a.head=a},f=0;return l},"es6","es3");
$jscomp.polyfill("Set",function(h){function p(){if($jscomp.ASSUME_NO_NATIVE_SET||!h||"function"!=typeof h||!h.prototype.entries||"function"!=typeof Object.seal)return!1;try{var g=Object.seal({x:4}),b=new h($jscomp.makeIterator([g]));if(!b.has(g)||1!=b.size||b.add(g)!=b||1!=b.size||b.add({x:4})!=b||2!=b.size)return!1;var d=b.entries(),e=d.next();if(e.done||e.value[0]!=g||e.value[1]!=g)return!1;e=d.next();return e.done||e.value[0]==g||4!=e.value[0].x||e.value[1]!=e.value[0]?!1:d.next().done}catch(f){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(h&&$jscomp.ES6_CONFORMANCE)return h}else if(p())return h;$jscomp.initSymbolIterator();var g=function(g){this.map_=new Map;if(g){g=$jscomp.makeIterator(g);for(var b;!(b=g.next()).done;)this.add(b.value)}this.size=this.map_.size};g.prototype.add=function(g){g=0===g?0:g;this.map_.set(g,g);this.size=this.map_.size;return this};g.prototype.delete=function(g){g=this.map_.delete(g);this.size=this.map_.size;return g};g.prototype.clear=function(){this.map_.clear();
this.size=0};g.prototype.has=function(g){return this.map_.has(g)};g.prototype.entries=function(){return this.map_.entries()};g.prototype.values=function(){return this.map_.values()};g.prototype.keys=g.prototype.values;g.prototype[Symbol.iterator]=g.prototype.values;g.prototype.forEach=function(g,b){var d=this;this.map_.forEach(function(e){return g.call(b,e,e,d)})};return g},"es6","es3");
$jscomp.polyfill("Object.entries",function(h){return h?h:function(h){var g=[],l;for(l in h)$jscomp.owns(h,l)&&g.push([l,h[l]]);return g}},"es8","es3");$jscomp.polyfill("Array.prototype.fill",function(h){return h?h:function(h,g,l){var b=this.length||0;0>g&&(g=Math.max(0,b+g));if(null==l||l>b)l=b;l=Number(l);0>l&&(l=Math.max(0,b+l));for(g=Number(g||0);g<l;g++)this[g]=h;return this}},"es6","es3");
$jscomp.assign="function"==typeof Object.assign?Object.assign:function(h,p){for(var g=1;g<arguments.length;g++){var l=arguments[g];if(l)for(var b in l)$jscomp.owns(l,b)&&(h[b]=l[b])}return h};$jscomp.polyfill("Object.assign",function(h){return h||$jscomp.assign},"es6","es3");
(function(){for(var h=document.getElementsByTagName("canvas"),p=0;p<h.length;p++)if(h[p].hasAttribute("coreGraphics")){var g=h[p];g.library=new function(){var g=this;this.math=new function(){this.averageArray=function(b){return b.reduce(function(b,e){return b+e},0)/b.length};this.distanceBetweenTwoPoints=function(b,d){return Math.pow(Math.pow(b.x-d.x,2)+Math.pow(b.y-d.y,2),.5)};this.seconds2time=function(b){var d={h:0,m:0,s:0};d.h=Math.floor(b/3600);b-=3600*d.h;d.m=Math.floor(b/60);b-=60*d.m;d.s=
b;return d};this.largestValueFound=function(b){return b.reduce(function(b,e){return Math.abs(b)>Math.abs(e)?b:e})};this.smallestValueFound=function(b){return b.reduce(function(b,e){return Math.abs(b)<Math.abs(e)?b:e})};this.cartesian2polar=function(b,d){return{dis:Math.pow(Math.pow(b,2)+Math.pow(d,2),.5),ang:0===b?0===d?0:0<d?.5*Math.PI:1.5*Math.PI:0===d?0<=b?0:Math.PI:0<=b?Math.atan(d/b):Math.atan(d/b)+Math.PI}};this.polar2cartesian=function(b,d){return{x:d*Math.cos(b),y:d*Math.sin(b)}};this.cartesianAngleAdjust=
function(b,d,e){b=this.cartesian2polar(b,d);b.ang+=e;return this.polar2cartesian(b.ang,b.dis)};this.boundingBoxFromPoints=function(b){if(0==b.length)return{topLeft:{x:0,y:0},bottomRight:{x:0,y:0}};for(var d=b[0].x,e=b[0].x,f=b[0].y,a=b[0].y,c=1;c<b.length;c++)b[c].x<d?d=b[c].x:b[c].x>e&&(e=b[c].x),b[c].y<f?f=b[c].y:b[c].y>a&&(a=b[c].y);return{topLeft:{x:d,y:f},bottomRight:{x:e,y:a}}};this.pointsOfRect=function(b,d,e,f,a,c){a=void 0===a?0:a;c=void 0===c?{x:0,y:0}:c;var k=c.x*e,q=c.y*f,m=this.cartesian2polar(k,
q);m=this.polar2cartesian(m.ang-a,m.dis);c={x:b-m.x,y:d-m.y};m=this.cartesian2polar(k-e,q);m=this.polar2cartesian(m.ang-a,m.dis);var x={x:b-m.x,y:d-m.y};m=this.cartesian2polar(k-e,q-f);m=this.polar2cartesian(m.ang-a,m.dis);e={x:b-m.x,y:d-m.y};m=this.cartesian2polar(k,q-f);m=this.polar2cartesian(m.ang-a,m.dis);return[c,x,e,{x:b-m.x,y:d-m.y}]};this.pointsOfCircle=function(b,d,e,f){f=void 0===f?3:f;for(var a=[],c=0;c<f;c++)a.push({x:b+e*Math.sin(c/f*Math.PI*2),y:d+e*Math.cos(c/f*Math.PI*2)});return a};
this.pointsOfText=function(b,d,e,f,a,c,k,q){var m=document.createElement("canvas").getContext("2d");m.font=c;m.textAlign=k;m.textBaseline=q;b=m.measureText(b).width/a;c=-c.split("pt")[0].split(" ").pop();isNaN(c)&&(c=-7.5);c/=a;a=[{x:d,y:e},{x:d+b,y:e},{x:d+b,y:e-c},{x:d,y:e-c}];b={start:0,end:0,center:b/2,left:b,right:b};c={alphabetic:c,top:0,hanging:0,middle:c/2,ideographic:0,bottom:c};for(m=0;m<a.length;m++)a[m]={x:a[m].x-b[k],y:a[m].y+c[q]};for(m=0;m<a.length;m++)a[m]=this.cartesianAngleAdjust(a[m].x-
d,a[m].y-e,f),a[m].x+=d,a[m].y+=e;return a};this.relativeDistance=function(b,d,e,f,a){d=(f-d)/(e-d);if(void 0===a||!a){if(1<d)return b;if(0>d)return 0}return d*b};this.lineCorrecter=function(b,d,e){if(!(0>b.x1||0>b.x2||b.x1>e||b.x2>e||0>b.y1&&0>b.y2||b.y1>d&&b.y2>d))return e=(b.y2-b.y1)/(b.x2-b.x1),0>b.y1?(b.x1=(0-b.y1+e*b.x1)/e,b.y1=0):0>b.y2&&(b.x2=(0-b.y2+e*b.x2)/e,b.y2=0),b.y1>d?(b.x1=(d-b.y1+e*b.x1)/e,b.y1=d):b.y2>d&&(b.x2=(d-b.y2+e*b.x2)/e,b.y2=d),b};this.normalizeStretchArray=function(b){var d=
b.reduce(function(a,c,b,d){return c>d[a]?b:a},0),e=Math.abs(b[d]);b=b.map(function(a){return a/e});if(0==b[0]&&1==b[b.length-1])return b;var f=0!=b[0]?b[0]:b[b.length-1];return b=b.map(function(a){return(a-f)/(1-f)})};this.curvePoint=new function(){this.linear=function(b,d,e){d=void 0===d?0:d;return(void 0===b?.5:b)*((void 0===e?1:e)-d)+d};this.sin=function(b,d,e){d=void 0===d?0:d;return Math.sin(Math.PI/2*(void 0===b?.5:b))*((void 0===e?1:e)-d)+d};this.cos=function(b,d,e){d=void 0===d?0:d;return(1-
Math.cos(Math.PI/2*(void 0===b?.5:b)))*((void 0===e?1:e)-d)+d};this.s=function(b,d,e,f){d=void 0===d?0:d;e=void 0===e?1:e;f=void 0===f?8:f;return g.math.normalizeStretchArray([1/(1+Math.exp(-.5*-f)),1/(1+Math.exp(-f*((void 0===b?.5:b)-.5))),1/(1+Math.exp(.5*-f))])[1]*(e-d)+d};this.exponential=function(b,d,e,f){d=void 0===d?0:d;e=void 0===e?1:e;f=void 0===f?2:f;return g.math.normalizeStretchArray([(Math.exp(0*f)-1)/(Math.E-1),(Math.exp(f*(void 0===b?.5:b))-1)/(Math.E-1),(Math.exp(1*f)-1)/(Math.E-1)])[1]*
(e-d)+d}};this.curveGenerator=new function(){this.linear=function(b,d,e){d=void 0===d?0:d;e=void 0===e?1:e;b=Math.abs(void 0===b?2:b)-1;for(var f=[0],a=1;a<b;a++)f.push(a/b);f.push(1);b=e-d;for(a=0;a<f.length;a++)f[a]=f[a]*b+d;return f};this.sin=function(b,d,e){d=void 0===d?0:d;e=void 0===e?1:e;b=Math.abs(void 0===b?2:b)-1;for(var f=[0],a=1;a<b;a++)f.push(Math.sin(Math.PI/2*(a/b)));f.push(1);b=e-d;for(a=0;a<f.length;a++)f[a]=f[a]*b+d;return f};this.cos=function(b,d,e){d=void 0===d?0:d;e=void 0===
e?1:e;b=Math.abs(void 0===b?2:b)-1;for(var f=[0],a=1;a<b;a++)f.push(1-Math.cos(Math.PI/2*(a/b)));f.push(1);b=e-d;for(a=0;a<f.length;a++)f[a]=f[a]*b+d;return f};this.s=function(b,d,e,f){b=void 0===b?2:b;d=void 0===d?0:d;e=void 0===e?1:e;f=void 0===f?8:f;0==f&&(f=1E-6);for(var a=[],c=0;c<b;c++)a.push(1/(1+Math.exp(-f*(c/b-.5))));b=g.math.normalizeStretchArray(a);e-=d;for(c=0;c<b.length;c++)b[c]=b[c]*e+d;return b};this.exponential=function(b,d,e,f){d=void 0===d?0:d;e=void 0===e?1:e;f=void 0===f?2:f;
b=(void 0===b?2:b)-1;for(var a=[],c=0;c<=b;c++)a.push((Math.exp(c/b*f)-1)/(Math.E-1));a=system.utility.math.normalizeStretchArray(a);b=e-d;for(c=0;c<a.length;c++)a[c]=a[c]*b+d;return a}};this.detectOverlap=new function(){this.boundingBoxes=function(b,d){return!(b.bottomRight.y<d.topLeft.y||b.topLeft.y>d.bottomRight.y||b.bottomRight.x<d.topLeft.x||b.topLeft.x>d.bottomRight.x)};this.pointWithinBoundingBox=function(b,d){return!(b.x<d.topLeft.x||b.y<d.topLeft.y||b.x>d.bottomRight.x||b.y>d.bottomRight.y)};
this.pointWithinPoly=function(b,d){for(var e=!1,f=0,a=d.length-1;f<d.length;a=f++)d[f].y>b.y!=d[a].y>b.y&&b.x<(d[a].x-d[f].x)*(b.y-d[f].y)/(d[a].y-d[f].y)+d[f].x&&(e=!e);return e};this.lineSegments=function(b,d){var e=(d[1].y-d[0].y)*(b[1].x-b[0].x)-(d[1].x-d[0].x)*(b[1].y-b[0].y);if(0==e)return null;var f=((d[1].x-d[0].x)*(b[0].y-d[0].y)-(d[1].y-d[0].y)*(b[0].x-d[0].x))/e;d=((b[1].x-b[0].x)*(b[0].y-d[0].y)-(b[1].y-b[0].y)*(b[0].x-d[0].x))/e;return{x:b[0].x+f*(b[1].x-b[0].x),y:b[0].y+f*(b[1].y-b[0].y),
inSeg1:0<=f&&1>=f,inSeg2:0<=d&&1>=d}};this.overlappingPolygons=function(b,d){for(var e=0;e<b.length;e++)if(this.pointWithinPoly(b[e],d))return!0;for(e=0;e<d.length;e++)if(this.pointWithinPoly(d[e],b))return!0;var f=Array.apply(null,{length:b.length}).map(Number.call,Number).concat([0]),a=Array.apply(null,{length:d.length}).map(Number.call,Number).concat([0]);for(e=0;e<f.length-1;e++)for(var c=0;c<a.length-1;c++){var k=this.lineSegments([b[f[e]],b[f[e+1]]],[d[a[c]],d[a[c+1]]]);if(null!=k&&k.inSeg1&&
k.inSeg2)return!0}return!1}}};this.structure=new function(){this.functionListRunner=function(b,d){return function(e,f){for(var a=0;a<b.length;a++){for(var c=!0,k=0;k<b[a].requiredKeys.length;k++){c=!0;for(var q=0;q<b[a].requiredKeys[k].length&&(c=c&&d[b[a].requiredKeys[k][q]],c);q++);if(c)break}if(c&&b[a].function(e,f))break}}};this.signalRegistry=function(b,d,e){b=void 0===b?-1:b;d=void 0===d?-1:d;e=void 0===e?-1:e;var f=[],a=[],c=[],k=[],q={},m=[];this.__dump=function(){console.log("---- signalRegistry dump ----");
console.log("\tsignals");for(var a=0;a<f.length;a++)console.log("\t\t",a," "+JSON.stringify(f[a]));console.log("\tselectedSignals");for(a=0;a<tselectedSignals.length;a++)console.log("\t\t",a," "+JSON.stringify(tselectedSignals[a]));console.log("\tevents");for(a=0;a<c.length;a++)console.log("\t\t",a," "+JSON.stringify(c[a]));console.log("\tevents_byID");for(a=0;a<k.length;a++)console.log("\t\t",a," "+JSON.stringify(k[a]));console.log("\tevents_byPosition");var b=Object.keys(q);for(a=0;a<b.length;a++)console.log("\t\t",
b[a]," "+JSON.stringify(q[b[a]]));console.log("\tpositions");for(a=0;a<m.length;a++)console.log("\t\t",a," "+JSON.stringify(m[a]))};this.export=function(){return JSON.parse(JSON.stringify({signals:f,selectedSignals:a,events:c,events_byID:k,events_byPosition:q,positions:m}))};this.import=function(b){f=JSON.parse(JSON.stringify(b.signals));a=JSON.parse(JSON.stringify(b.selectedSignals));c=JSON.parse(JSON.stringify(b.events));k=JSON.parse(JSON.stringify(b.events_byID));q=JSON.parse(JSON.stringify(b.events_byPosition));
m=JSON.parse(JSON.stringify(b.positions))};this.getAllSignals=function(){return JSON.parse(JSON.stringify(f))};this.getAllEvents=function(){return JSON.parse(JSON.stringify(c))};this.getSignal=function(a){if(void 0!=f[a])return JSON.parse(JSON.stringify(f[a]))};this.eventsBetween=function(a,b){for(var k=void 0==b?Array.from(new Set(m.filter(function(c){return c==a}))):Array.from(new Set(m.filter(function(c){return c>=a&&c<b}))),d=[],e=0;e<k.length;e++){k[e]=q[String(k[e])];for(var f=0;f<k[e].length;f++)d.push(c[k[e][f]])}return d.sort(function(a,
c){return a.position<c.position?-1:a.position>c.position?1:0})};this.add=function(a,g){if(void 0!=a&&"line"in a&&"position"in a&&"length"in a){"strength"in a||(a.strength=1);0>a.line&&(a.line=0);0>a.length&&(a.length=0);0>a.position&&(a.position=0);0>a.strength&&(a.strength=0);-1<d&&a.line>d-1&&(a.line=d-1);-1<e&&a.length>e&&(a.length=e);-1<b&&a.position>b&&(a.position=b-a.length);-1<b&&a.position+a.length>b&&(a.length=b-a.position);-1<b&&a.position+a.length>b&&(a.position=b-a.length);1<a.strength&&
(a.strength=1);var x=0;if(void 0==g)for(;void 0!=f[x];)x++;else x=g;f[x]=JSON.parse(JSON.stringify(a));a=[{signalID:x,line:a.line,position:a.position,strength:a.strength},{signalID:x,line:a.line,position:a.position+a.length,strength:0}];for(g=0;void 0!=c[g];)g++;c[g]=a[0];k[x]=[g];void 0==q[a[0].position]?q[a[0].position]=[g]:q[a[0].position].push(g);for(m.push(a[0].position);void 0!=c[g];)g++;c[g]=a[1];k[x]=k[x].concat(g);void 0==q[a[1].position]?q[a[1].position]=[g]:q[a[1].position].push(g);m.push(a[1].position);
return x}};this.remove=function(a){if(void 0!=f[a]){delete f[a];for(var b=0;b<k[a].length;b++){var d=k[a][b];q[c[d].position].splice(q[c[d].position].indexOf(d),1);m.splice(m.indexOf(c[d].position),1);0==q[c[d].position].length&&delete q[c[d].position];delete c[d]}delete k[a]}};this.update=function(a,c){void 0!=c&&("line"in c||(c.line=f[a].line),-1<b&&("position"in c&&"length"in c?c.length+c.position>b&&(c.length=b-c.position):("position"in c?f[a].length+c.position>=b&&(c.position=b-f[a].length):
c.position=f[a].position,"length"in c?c.length+c.position>b&&(c.length=b-c.position):c.length=f[a].length)),"strength"in c||(c.strength=f[a].strength),this.remove(a),this.add(c,a))};this.reset=function(){f=[];a=[];c=[];k=[];q={};m=[]}}};this.audio=new function(){this.context=new (window.AudioContext||window.webkitAudioContext);this.changeAudioParam=function(a,c,b,d,e,f){f=void 0===f?!0:f;if(null==b)return c.value;f&&c.cancelScheduledValues(a.currentTime);try{switch(e){case "linear":c.linearRampToValueAtTime(b,
a.currentTime+d);break;case "exponential":console.warn("2018-4-18 - changeAudioParam:exponential doesn't work on chrome");0==b&&(b=1E-4);c.exponentialRampToValueAtTime(b,a.currentTime+d);break;case "s":for(var k=b-c.value,m=g.math.curveGenerator.s(10),q=0;q<m.length;q++)m[q]=c.value+m[q]*k;c.setValueCurveAtTime(new Float32Array(m),a.currentTime,d);break;default:c.setTargetAtTime(b,a.currentTime,.001)}}catch(z){console.log("could not change param (possibly due to an overlap, or bad target value)"),
console.log("audioParam:",c,"target:",b,"time:",d,"curve:",e,"cancelScheduledValues:",f),console.log(z)}};this.loadAudioFile=function(a,c,b){b=void 0===b?"":b;switch(void 0===c?"file":c){case "url":c=new XMLHttpRequest;c.open("GET",b,!0);c.responseType="arraybuffer";c.onload=function(){g.audio.context.decodeAudioData(this.response,function(c){a({buffer:c,name:b.split("/").pop(),duration:c.duration})},function(a){console.warn("Error with decoding audio data"+a.err)})};c.send();break;default:var d=
document.createElement("input");d.type="file";d.onchange=function(){var c=this.files[0],b=new FileReader;b.readAsArrayBuffer(c);b.onload=function(b){g.audio.context.decodeAudioData(b.target.result,function(b){a({buffer:b,name:c.name,duration:b.duration})});d.remove()}};document.body.appendChild(d);d.click()}};this.waveformSegment=function(a,c,b){c=void 0===c?{start:0,end:1}:c;b=void 0===b?1E4:b;var d=a.getChannelData(0);c.start=c.start?c.start:0;c.end=c.end?c.end:1;var k=a.length*c.start;a=a.length*
c.end;b=(a-k)/b;for(c=[];k<a;k+=Math.round(b))c.push(g.math.largestValueFound(d.slice(k,k+Math.round(b))));return c};this.loadBuffer=function(a,c,b,d){a=a.createBufferSource();a.buffer=c;a.connect(b);a.onended=d;return a};this.destination=this.context.createGain();this.destination.connect(this.context.destination);this.destination._gain=1;this.destination.masterGain=function(a){if(void 0==a)return this.destination._gain;this._gain=a;g.audio.changeAudioParam(g.audio.context,this.gain,this._gain,.01,
"instant",!0)};this.names_frequencies_split={0:{C:16.35,"C#":17.32,D:18.35,"D#":19.45,E:20.6,F:21.83,"F#":23.12,G:24.5,"G#":25.96,A:27.5,"A#":29.14,B:30.87},1:{C:32.7,"C#":34.65,D:36.71,"D#":38.89,E:41.2,F:43.65,"F#":46.25,G:49,"G#":51.91,A:55,"A#":58.27,B:61.74},2:{C:65.41,"C#":69.3,D:73.42,"D#":77.78,E:82.41,F:87.31,"F#":92.5,G:98,"G#":103.8,A:110,"A#":116.5,B:123.5},3:{C:130.8,"C#":138.6,D:146.8,"D#":155.6,E:164.8,F:174.6,"F#":185,G:196,"G#":207.7,A:220,"A#":233.1,B:246.9},4:{C:261.6,"C#":277.2,
D:293.7,"D#":311.1,E:329.6,F:349.2,"F#":370,G:392,"G#":415.3,A:440,"A#":466.2,B:493.9},5:{C:523.3,"C#":554.4,D:587.3,"D#":622.3,E:659.3,F:698.5,"F#":740,G:784,"G#":830.6,A:880,"A#":932.3,B:987.8},6:{C:1047,"C#":1109,D:1175,"D#":1245,E:1319,F:1397,"F#":1480,G:1568,"G#":1661,A:1760,"A#":1865,B:1976},7:{C:2093,"C#":2217,D:2349,"D#":2489,E:2637,F:2794,"F#":2960,G:3136,"G#":3322,A:3520,"A#":3729,B:3951},8:{C:4186,"C#":4435,D:4699,"D#":4978,E:5274,F:5588,"F#":5920,G:6272,"G#":6645,A:7040,"A#":7459,B:7902}};
this.names_frequencies={};for(var b=Object.entries(this.names_frequencies_split),d=0;d<b.length;d++)for(var e=Object.entries(this.names_frequencies_split[d]),f=0;f<e.length;f++)this.names_frequencies[b[d][0]+e[f][0]]=e[f][1];this.frequencies_names={};b=Object.entries(this.names_frequencies);for(d=0;d<b.length;d++)this.frequencies_names[b[d][1]]=b[d][0];b="0C 0C# 0D 0D# 0E 0F 0F# 0G 0G# 0A 0A# 0B 1C 1C# 1D 1D# 1E 1F 1F# 1G 1G# 1A 1A# 1B 2C 2C# 2D 2D# 2E 2F 2F# 2G 2G# 2A 2A# 2B 3C 3C# 3D 3D# 3E 3F 3F# 3G 3G# 3A 3A# 3B 4C 4C# 4D 4D# 4E 4F 4F# 4G 4G# 4A 4A# 4B 5C 5C# 5D 5D# 5E 5F 5F# 5G 5G# 5A 5A# 5B 6C 6C# 6D 6D# 6E 6F 6F# 6G 6G# 6A 6A# 6B 7C 7C# 7D 7D# 7E 7F 7F# 7G 7G# 7A 7A# 7B 8C 8C# 8D 8D# 8E 8F 8F# 8G 8G# 8A 8A# 8B".split(" ");
this.midinumbers_names={};for(d=0;d<b.length;d++)this.midinumbers_names[d+24]=b[d];this.names_midinumbers={};b=Object.entries(this.midinumbers_names);for(d=0;d<b.length;d++)this.names_midinumbers[b[d][1]]=parseInt(b[d][0]);this.num2name=function(a){return this.midinumbers_names[a]};this.num2freq=function(a){return this.names_frequencies[this.midinumbers_names[a]]};this.name2num=function(a){return this.names_midinumbers[a]};this.name2freq=function(a){return this.names_frequencies[a]};this.freq2num=
function(a){return this.names_midinumbers[this.frequencies_names[a]]};this.freq2name=function(a){return this.frequencies_names[a]}};this.misc=new function(){this.blendColours=function(b,d,e){function f(a){a=a.split(",");a[0]=a[0].replace("rgba(","");a[3]=a[3].replace(")","");return a.map(function(a){return parseFloat(a)})}b=f(b);d=f(d);for(var a=[],c=0;c<b.length;c++)a[c]=(1-e)*b[c]+e*d[c];return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"};this.multiBlendColours=function(b,d){if(0==d)return b[0];
if(1==d)return b[b.length-1];d*=b.length-1;return g.misc.blendColours(b[~~d],b[~~d+1],d%1)};this.padString=function(b,d,e){e=void 0===e?" ":e;if(1>e.length)return b;for(b=""+b;b.length<d;)b=e+b;return b};this.compressString=function(b){return g.thirdparty.lzString.compress(b)};this.decompressString=function(b){return g.thirdparty.lzString.decompress(b)};this.serialize=function(b,d){d=void 0===d?!0:d;b=JSON.stringify(b,function(b,d){switch({}.toString.call(d).match(/\s([a-zA-Z]+)/)[1].toLowerCase()){case "function":return{__uniqueType:"function",
__value:d.toString(),__name:d.name};case "arraybuffer":return{__uniqueType:"arraybuffer",__value:btoa(String.fromCharCode(new Uint8Array(d)))};case "audiobuffer":b=[];for(var a=0;a<d.numberOfChannels;a++)b.push(Array.from(d.getChannelData(a)));return{__uniqueType:"audiobuffer",__channelData:b,__sampleRate:d.sampleRate,__numberOfChannels:d.numberOfChannels,__length:d.length};default:return d}});d&&(b=g.misc.compressString(b));return b};this.unserialize=function(b,d){if(void 0!==b)return(void 0===d||
d)&&(b=g.misc.decompressString(b)),JSON.parse(b,function(b,d){if("object"==typeof d&&null!=d&&"__uniqueType"in d)switch(d.__uniqueType){case "function":b=d.__value.substring(0,d.__value.indexOf("{"));b=b.substring(b.indexOf("(")+1,b.lastIndexOf(")"));d=d.__value.substring(d.__value.indexOf("{")+1,d.__value.lastIndexOf("}"));d=Function(b,d);break;case "arraybuffer":d=atob(d.__value);for(b=0;b<d.length;b++)d[b]=d[b].charCodeAt(0);d=new ArrayBuffer(d);break;case "audiobuffer":var a=g.audio.context.createBuffer(d.__numberOfChannels,
d.__length,d.__sampleRate);for(b=0;b<a.numberOfChannels;b++){workingBuffer=a.getChannelData(b);for(var c=0;c<a.length;c++)workingBuffer[c]=d.__channelData[b][c]}d=a;break;default:d=d.__value}return d})};this.openFile=function(b,d){d=void 0===d?"readAsBinaryString":d;var e=document.createElement("input");e.type="file";e.onchange=function(){var e=new FileReader;switch(d){case "readAsArrayBuffer":e.readAsArrayBuffer(this.files[0]);break;default:e.readAsBinaryString(this.files[0])}e.onloadend=function(){b&&
b(e.result)}};e.click()};this.printFile=function(b,d){var e=document.createElement("a");e.href=URL.createObjectURL(new Blob([d]));e.download=b;e.click()}};this.thirdparty=new function(){this.lzString=function(){var b=String.fromCharCode,d={},e={compress:function(b){return null==b?"":e._compress(b,6,function(a){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$".charAt(a)})},decompress:function(b){if(null==b)return"";if(""==b)return null;b=b.replace(/ /g,"+");return e._decompress(b.length,
32,function(a){a=b.charAt(a);if(!d["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$"]){d["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$"]={};for(var c=0;65>c;c++)d["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$"]["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$".charAt(c)]=c}return d["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$"][a]})},_compress:function(b,a,c){if(null==b)return"";var d,e={},m={},g="",
f=2,h=3,r=2,l=[],n=0,t=0,p;for(p=0;p<b.length;p+=1){var v=b.charAt(p);Object.prototype.hasOwnProperty.call(e,v)||(e[v]=h++,m[v]=!0);var w=g+v;if(Object.prototype.hasOwnProperty.call(e,w))g=w;else{if(Object.prototype.hasOwnProperty.call(m,g)){if(256>g.charCodeAt(0)){for(d=0;d<r;d++)n<<=1,t==a-1?(t=0,l.push(c(n)),n=0):t++;var u=g.charCodeAt(0);for(d=0;8>d;d++)n=n<<1|u&1,t==a-1?(t=0,l.push(c(n)),n=0):t++,u>>=1}else{u=1;for(d=0;d<r;d++)n=n<<1|u,t==a-1?(t=0,l.push(c(n)),n=0):t++,u=0;u=g.charCodeAt(0);
for(d=0;16>d;d++)n=n<<1|u&1,t==a-1?(t=0,l.push(c(n)),n=0):t++,u>>=1}f--;0==f&&(f=Math.pow(2,r),r++);delete m[g]}else for(u=e[g],d=0;d<r;d++)n=n<<1|u&1,t==a-1?(t=0,l.push(c(n)),n=0):t++,u>>=1;f--;0==f&&(f=Math.pow(2,r),r++);e[w]=h++;g=String(v)}}if(""!==g){if(Object.prototype.hasOwnProperty.call(m,g)){if(256>g.charCodeAt(0)){for(d=0;d<r;d++)n<<=1,t==a-1?(t=0,l.push(c(n)),n=0):t++;u=g.charCodeAt(0);for(d=0;8>d;d++)n=n<<1|u&1,t==a-1?(t=0,l.push(c(n)),n=0):t++,u>>=1}else{u=1;for(d=0;d<r;d++)n=n<<1|u,
t==a-1?(t=0,l.push(c(n)),n=0):t++,u=0;u=g.charCodeAt(0);for(d=0;16>d;d++)n=n<<1|u&1,t==a-1?(t=0,l.push(c(n)),n=0):t++,u>>=1}f--;0==f&&(f=Math.pow(2,r),r++);delete m[g]}else for(u=e[g],d=0;d<r;d++)n=n<<1|u&1,t==a-1?(t=0,l.push(c(n)),n=0):t++,u>>=1;f--;0==f&&r++}u=2;for(d=0;d<r;d++)n=n<<1|u&1,t==a-1?(t=0,l.push(c(n)),n=0):t++,u>>=1;for(;;)if(n<<=1,t==a-1){l.push(c(n));break}else t++;return l.join("")},_decompress:function(d,a,c){var k=[],e=4,m=4,g=3,f=[],h,r,l=c(0),n=a,t=1;for(h=0;3>h;h+=1)k[h]=h;var p=
0;var v=Math.pow(2,2);for(r=1;r!=v;){var w=l&n;n>>=1;0==n&&(n=a,l=c(t++));p|=(0<w?1:0)*r;r<<=1}switch(p){case 0:p=0;v=Math.pow(2,8);for(r=1;r!=v;)w=l&n,n>>=1,0==n&&(n=a,l=c(t++)),p|=(0<w?1:0)*r,r<<=1;var u=b(p);break;case 1:p=0;v=Math.pow(2,16);for(r=1;r!=v;)w=l&n,n>>=1,0==n&&(n=a,l=c(t++)),p|=(0<w?1:0)*r,r<<=1;u=b(p);break;case 2:return""}h=k[3]=u;for(f.push(u);;){if(t>d)return"";p=0;v=Math.pow(2,g);for(r=1;r!=v;)w=l&n,n>>=1,0==n&&(n=a,l=c(t++)),p|=(0<w?1:0)*r,r<<=1;switch(u=p){case 0:p=0;v=Math.pow(2,
8);for(r=1;r!=v;)w=l&n,n>>=1,0==n&&(n=a,l=c(t++)),p|=(0<w?1:0)*r,r<<=1;k[m++]=b(p);u=m-1;e--;break;case 1:p=0;v=Math.pow(2,16);for(r=1;r!=v;)w=l&n,n>>=1,0==n&&(n=a,l=c(t++)),p|=(0<w?1:0)*r,r<<=1;k[m++]=b(p);u=m-1;e--;break;case 2:return f.join("")}0==e&&(e=Math.pow(2,g),g++);if(k[u])u=k[u];else if(u===m)u=h+h.charAt(0);else return null;f.push(u);k[m++]=h+u.charAt(0);e--;h=u;0==e&&(e=Math.pow(2,g),g++)}}};return e}()}};g.core=new function(){var h=new function(){function b(a){for(var c=[];void 0!=(a=
a.parent);)c.unshift({x:a.x,y:a.y,a:a.angle});a={x:void 0!=c[0]?c[0].x:0,y:void 0!=c[0]?c[0].y:0,a:void 0!=c[0]?c[0].a:0};for(var b=1;b<c.length;b++){var d=g.library.math.cartesianAngleAdjust(c[b].x,c[b].y,c[b-1].a);a.a+=c[b].a;a.x+=d.x;a.y+=d.y}return a}var d=this,e=new function(){this.length=function(a){return a*d.viewport.scale()};this.windowPoint2coreGraphicsPoint=function(a,c){var b=d.viewport.position(),e=d.viewport.scale()/window.devicePixelRatio,m=d.viewport.angle();a=a/e-b.x;c=c/e-b.y;return g.library.math.cartesianAngleAdjust(a,
c,-m)};this.coreGraphicsPoint2windowPoint=function(a,c){var b=d.viewport.position(),e=d.viewport.scale(),m=d.viewport.angle();a=g.library.math.cartesianAngleAdjust(a,c,m);return{x:(a.x+b.x)*e,y:(a.y+b.y)*e}}},f=new function(){this.polygon=function(){this.type="polygon";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.points=[];this.style={fill:"rgba(100,255,255,1)",stroke:"rgba(0,0,0,0)",lineWidth:1,lineJoin:"round",miterLimit:2,
shadowColour:"rgba(0,0,0,0)",shadowBlur:20,shadowOffset:{x:20,y:20}};this.parameter={};this.parameter.points=function(a){return function(c){if(void 0==c)return a.points;a.points=c;a.computeExtremities()}}(this);this.getAddress=function(){var a="",c=this;do a=c.name+"/"+a;while(void 0!=(c=c.parent));return"/"+a};this.computeExtremities=function(a){for(var c=this._static,d=this;void 0!=(d=d.parent)&&!c;)c=c||d._static;this._static=c;a=void 0==a?b(this):a;this.extremities={points:[],boundingBox:{}};
this.extremities.points=this.points.map(function(c){c=g.library.math.cartesianAngleAdjust(c.x,c.y,a.a);c.x+=a.x;c.y+=a.y;return c});this.extremities.boundingBox=g.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(a,c){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var b=!1}else b=g.library.math.detectOverlap.pointWithinBoundingBox({x:a,y:c},this.extremities.boundingBox);
return b?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),a=!1):a=g.library.math.detectOverlap.pointWithinPoly({x:a,y:c},this.extremities.points),a):!1};this.render=function(a,c,b,q){c=void 0===c?{x:0,y:0,a:0}:c;b=void 0===b?!1:b;q=void 0===q?!1:q;var k=this._static?!0:g.library.math.detectOverlap.boundingBoxes(d.viewport.getBoundingBox(),this.extremities.boundingBox);if(k){k=this.points.map(function(a){a=g.library.math.cartesianAngleAdjust(a.x,a.y,c.a);return{x:a.x+
c.x,y:a.y+c.y}});var f=this.style.lineWidth,h=this.style.shadowBlur,l=this.style.shadowOffset.x,r=this.style.shadowOffset.y;b||(k=k.map(function(a){return e.coreGraphicsPoint2windowPoint(a.x,a.y)}),f=e.length(f),h=e.length(h),l=e.length(l),r=e.length(r));if(q){q=new Path2D;q.moveTo(k[0].x,k[0].y);for(b=1;b<k.length;b++)q.lineTo(k[b].x,k[b].y);a.clip(q)}else{a.fillStyle=this.style.fill;a.strokeStyle=this.style.stroke;a.lineWidth=f;a.lineJoin=this.style.lineJoin;a.miterLimit=this.style.miterLimit;a.shadowColor=
this.style.shadowColour;a.shadowBlur=h;a.shadowOffsetX=l;a.shadowOffsetY=r;a.beginPath();a.moveTo(k[0].x,k[0].y);for(b=1;b<k.length;b++)a.lineTo(k[b].x,k[b].y);a.closePath();a.fill();a.stroke();if(this.dotFrame){for(b=0;b<this.extremities.points.length;b++)a=e.coreGraphicsPoint2windowPoint(this.extremities.points[b].x,this.extremities.points[b].y),d.render.drawDot(a.x,a.y,4,"rgba(50,50,50,1)");a=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);
d.render.drawDot(a.x,a.y);a=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);d.render.drawDot(a.x,a.y)}}}}};this.circle=function(){this.type="circle";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.y=this.x=0;this.r=2;this.style={fill:"rgba(255,100,255,1)",stroke:"rgba(0,0,0,0)",lineWidth:1,shadowColour:"rgba(0,0,0,0)",shadowBlur:2,shadowOffset:{x:1,
y:1}};this.parameter={};this.parameter.x=function(a){return function(c){if(void 0==c)return a.x;a.x=c;a.computeExtremities()}}(this);this.parameter.y=function(a){return function(c){if(void 0==c)return a.y;a.y=c;a.computeExtremities()}}(this);this.parameter.r=function(a){return function(c){if(void 0==c)return a.r;a.r=c;a.computeExtremities()}}(this);this.getAddress=function(){var a="",c=this;do a=c.name+"/"+a;while(void 0!=(c=c.parent));return"/"+a};this.computeExtremities=function(a){for(var c=this._static,
d=this;void 0!=(d=d.parent)&&!c;)c=c||d._static;this._static=c;a=void 0==a?b(this):a;this.extremities={points:[],boundingBox:{},origin:{}};point=g.library.math.cartesianAngleAdjust(this.x,this.y,a.a);this.extremities.origin={x:this.x+a.x,y:this.y+a.y};this.extremities.points=g.library.math.pointsOfCircle(this.x,this.y,this.r,10);this.extremities.points=this.extremities.points.map(function(c){c=g.library.math.cartesianAngleAdjust(c.x,c.y,a.a);c.x+=a.x;c.y+=a.y;return c});this.extremities.boundingBox=
g.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(a,c){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var b=!1}else b=g.library.math.detectOverlap.pointWithinBoundingBox({x:a,y:c},this.extremities.boundingBox);return b?g.library.math.distanceBetweenTwoPoints({x:a,y:c},{x:this.x+this.extremities.origin.x,y:this.y+this.extremities.origin.y})<=this.r:!1};this.render=
function(a,c,b,q){c=void 0===c?{x:0,y:0,a:0}:c;b=void 0===b?!1:b;q=void 0===q?!1:q;var k=this._static?!0:g.library.math.detectOverlap.boundingBoxes(d.viewport.getBoundingBox(),this.extremities.boundingBox);if(k){k=g.library.math.cartesianAngleAdjust(this.x,this.y,c.a);c.x+=k.x-this.x;c.y+=k.y-this.y;c={x:this.x+c.x,y:this.y+c.y};k=this.r;var f=this.style.lineWidth,h=this.style.shadowBlur,l=this.style.shadowOffset.x,r=this.style.shadowOffset.y;b||(c=e.coreGraphicsPoint2windowPoint(c.x,c.y),k=e.length(k),
f=e.length(f),h=e.length(h),l=e.length(l),r=e.length(r));if(q)b=new Path2D,b.arc(c.x,c.y,k,0,2*Math.PI,!1),a.clip(b);else if(a.fillStyle=this.style.fill,a.strokeStyle=this.style.stroke,a.lineWidth=f,a.shadowColor=this.style.shadowColour,a.shadowBlur=h,a.shadowOffsetX=l,a.shadowOffsetY=r,a.beginPath(),a.arc(c.x,c.y,k,0,2*Math.PI,!1),a.closePath(),a.fill(),a.stroke(),this.dotFrame){for(a=0;a<this.extremities.points.length;a++)b=e.coreGraphicsPoint2windowPoint(this.extremities.points[a].x,this.extremities.points[a].y),
d.render.drawDot(b.x,b.y,4,"rgba(50,50,50,1)");b=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);d.render.drawDot(b.x,b.y);b=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);d.render.drawDot(b.x,b.y);b=e.coreGraphicsPoint2windowPoint(this.extremities.origin.x,this.extremities.origin.y);d.render.drawDot(b.x,b.y)}}}};this.canvas=function(){this.type="canvas";this.name=
"";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.angle=this.y=this.x=0;this.anchor={x:0,y:0};this.height=this.width=10;var a=document.createElement("canvas"),c=1;var k=a.getContext("2d",{alpha:!1});a.setAttribute("width",this.width*c);a.setAttribute("height",this.height*c);this.parameter={};this.parameter.x=function(a){return function(c){if(void 0==c)return a.x;a.x=c;a.computeExtremities()}}(this);this.parameter.y=function(a){return function(c){if(void 0==
c)return a.y;a.y=c;a.computeExtremities()}}(this);this.parameter.angle=function(a){return function(c){if(void 0==c)return a.angle;a.angle=c;a.computeExtremities()}}(this);this.parameter.anchor=function(a){return function(c){if(void 0==c)return a.anchor;a.anchor=c;a.computeExtremities()}}(this);this.parameter.width=function(b){return function(d){if(void 0==d)return b.width;b.width=d;b.computeExtremities();a.setAttribute("width",b.width*c)}}(this);this.parameter.height=function(b){return function(d){if(void 0==
d)return b.height;b.height=d;b.computeExtremities();a.setAttribute("height",b.height*c)}}(this);this.resolution=function(b){if(void 0==b)return c;c=b;a.setAttribute("width",this.width*c);a.setAttribute("height",this.height*c)};this._=k;this.$=function(a){return a*c};this.getAddress=function(){var a="",c=this;do a=c.name+"/"+a;while(void 0!=(c=c.parent));return"/"+a};this.computeExtremities=function(a){for(var c=this._static,d=this;void 0!=(d=d.parent)&&!c;)c=c||d._static;this._static=c;a=void 0==
a?b(this):a;this.extremities={points:[],boundingBox:{}};this.extremities.points=g.library.math.pointsOfRect(this.x,this.y,this.width,this.height,-this.angle,this.anchor);this.extremities.points=this.extremities.points.map(function(c){c=g.library.math.cartesianAngleAdjust(c.x,c.y,a.a);c.x+=a.x;c.y+=a.y;return c});this.extremities.boundingBox=g.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(a,c){if(void 0==
this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var b=!1}else b=g.library.math.detectOverlap.pointWithinBoundingBox({x:a,y:c},this.extremities.boundingBox);return b?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),a=!1):a=g.library.math.detectOverlap.pointWithinPoly({x:a,y:c},this.extremities.points),a):!1};this.render=function(c,b,k){b=void 0===b?{x:0,y:0,a:0}:b;k=void 0===k?!1:k;var m=this._static?!0:g.library.math.detectOverlap.boundingBoxes(d.viewport.getBoundingBox(),
this.extremities.boundingBox);if(m){m=g.library.math.cartesianAngleAdjust(this.x,this.y,b.a);b.x+=m.x-this.x;b.y+=m.y-this.y;m={x:this.x+b.x,y:this.y+b.y};b=this.angle+b.a;var f=this.width,q=this.height;k||(m=e.coreGraphicsPoint2windowPoint(m.x-this.anchor.x*f,m.y-this.anchor.y*q),f=e.length(f),q=e.length(q));m=g.library.math.cartesianAngleAdjust(m.x,m.y,-b);c.save();c.rotate(b);c.drawImage(a,m.x,m.y,f,q);c.restore();if(this.dotFrame){for(c=0;c<this.extremities.points.length;c++)k=e.coreGraphicsPoint2windowPoint(this.extremities.points[c].x,
this.extremities.points[c].y),d.render.drawDot(k.x,k.y,4,"rgba(50,50,50,1)");k=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);d.render.drawDot(k.x,k.y);k=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);d.render.drawDot(k.x,k.y)}}}};this.image=function(){this.type="image";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities=
{points:[],boundingBox:{}};this.angle=this.y=this.x=0;this.anchor={x:0,y:0};this.height=this.width=10;this.url="";var a={};this.style={shadowColour:"rgba(0,0,0,0)",shadowBlur:2,shadowOffset:{x:1,y:1}};this.parameter={};this.parameter.x=function(a){return function(c){if(void 0==c)return a.x;a.x=c;a.computeExtremities()}}(this);this.parameter.y=function(a){return function(c){if(void 0==c)return a.y;a.y=c;a.computeExtremities()}}(this);this.parameter.angle=function(a){return function(c){if(void 0==c)return a.angle;
a.angle=c;a.computeExtremities()}}(this);this.parameter.anchor=function(a){return function(c){if(void 0==c)return a.anchor;a.anchor=c;a.computeExtremities()}}(this);this.parameter.width=function(a){return function(c){if(void 0==c)return a.width;a.width=c;a.computeExtremities()}}(this);this.parameter.height=function(a){return function(c){if(void 0==c)return a.height;a.height=c;a.computeExtremities()}}(this);this.getAddress=function(){var a="",b=this;do a=b.name+"/"+a;while(void 0!=(b=b.parent));return"/"+
a};this.computeExtremities=function(a){for(var c=this._static,d=this;void 0!=(d=d.parent)&&!c;)c=c||d._static;this._static=c;a=void 0==a?b(this):a;this.extremities={points:[],boundingBox:{}};this.extremities.points=g.library.math.pointsOfRect(this.x,this.y,this.width,this.height,-this.angle,this.anchor);this.extremities.points=this.extremities.points.map(function(c){c=g.library.math.cartesianAngleAdjust(c.x,c.y,a.a);c.x+=a.x;c.y+=a.y;return c});this.extremities.boundingBox=g.library.math.boundingBoxFromPoints(this.extremities.points);
void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(a,b){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var c=!1}else c=g.library.math.detectOverlap.pointWithinBoundingBox({x:a,y:b},this.extremities.boundingBox);return c?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),a=!1):a=g.library.math.detectOverlap.pointWithinPoly({x:a,y:b},this.extremities.points),a):!1};this.render=function(c,b,f){b=
void 0===b?{x:0,y:0,a:0}:b;f=void 0===f?!1:f;var k=this._static?!0:g.library.math.detectOverlap.boundingBoxes(d.viewport.getBoundingBox(),this.extremities.boundingBox);if(k){k=g.library.math.cartesianAngleAdjust(this.x,this.y,b.a);b.x+=k.x-this.x;b.y+=k.y-this.y;k=this.angle+b.a;var h=this.width,q=this.height;b={x:this.x+b.x-this.anchor.x*(this.width*Math.cos(k)+this.height*Math.sin(-k)),y:this.y+b.y-this.anchor.y*(this.width*Math.sin(k)+this.height*Math.cos(-k))};f||(b=e.coreGraphicsPoint2windowPoint(b.x,
b.y),h=e.length(h),q=e.length(q));b=g.library.math.cartesianAngleAdjust(b.x,b.y,-k);a.hasOwnProperty(this.url)||(a[this.url]=new Image,a[this.url].src=this.url);c.save();c.rotate(k);c.drawImage(a[this.url],b.x,b.y,h,q);c.restore();if(this.dotFrame){for(c=0;c<this.extremities.points.length;c++)f=e.coreGraphicsPoint2windowPoint(this.extremities.points[c].x,this.extremities.points[c].y),d.render.drawDot(f.x,f.y,4,"rgba(50,50,50,1)");f=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.topLeft.x,
this.extremities.boundingBox.topLeft.y);d.render.drawDot(f.x,f.y);f=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);d.render.drawDot(f.x,f.y)}}}};this.path=function(){this.type="path";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.points=[];this.style={stroke:"rgba(0,0,0,0)",lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:2,shadowColour:"rgba(0,0,0,0)",
shadowBlur:20,shadowOffset:{x:20,y:20}};this.parameter={};this.parameter.points=function(a){return function(c){if(void 0==c)return a.points;a.points=c;a.computeExtremities()}}(this);this.getAddress=function(){var a="",c=this;do a=c.name+"/"+a;while(void 0!=(c=c.parent));return"/"+a};this.computeExtremities=function(a){for(var c=this._static,d=this;void 0!=(d=d.parent)&&!c;)c=c||d._static;this._static=c;a=void 0==a?b(this):a;this.extremities={points:[],boundingBox:{}};this.extremities.points=this.points.map(function(c){c=
g.library.math.cartesianAngleAdjust(c.x,c.y,a.a);c.x+=a.x;c.y+=a.y;return c});this.extremities.boundingBox=g.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(a,c){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var b=!1}else b=g.library.math.detectOverlap.pointWithinBoundingBox({x:a,y:c},this.extremities.boundingBox);return b?(void 0==this.extremities.points?
(console.warn("the shape",this,"has no points"),a=!1):a=g.library.math.detectOverlap.pointWithinPoly({x:a,y:c},this.extremities.points),a):!1};this.render=function(a,c,b){c=void 0===c?{x:0,y:0,a:0}:c;b=void 0===b?!1:b;var k=this._static?!0:g.library.math.detectOverlap.boundingBoxes(d.viewport.getBoundingBox(),this.extremities.boundingBox);if(k){k=this.points.map(function(a){a=g.library.math.cartesianAngleAdjust(a.x,a.y,c.a);return{x:a.x+c.x,y:a.y+c.y}});var f=this.style.lineWidth,h=this.style.shadowBlur,
l=this.style.shadowOffset.x,y=this.style.shadowOffset.y;b||(k=k.map(function(a){return e.coreGraphicsPoint2windowPoint(a.x,a.y)}),f=e.length(f),h=e.length(h),l=e.length(l),y=e.length(y));a.fillStyle=this.style.fill;a.strokeStyle=this.style.stroke;a.lineWidth=f;a.lineCap=this.style.lineCap;a.lineJoin=this.style.lineJoin;a.miterLimit=this.style.miterLimit;a.shadowColor=this.style.shadowColour;a.shadowBlur=h;a.shadowOffsetX=l;a.shadowOffsetY=y;a.beginPath();a.moveTo(k[0].x,k[0].y);for(b=1;b<k.length;b++)a.lineTo(k[b].x,
k[b].y);a.stroke();if(this.dotFrame){for(b=0;b<this.extremities.points.length;b++)a=e.coreGraphicsPoint2windowPoint(this.extremities.points[b].x,this.extremities.points[b].y),d.render.drawDot(a.x,a.y,4,"rgba(50,50,50,1)");a=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);d.render.drawDot(a.x,a.y);a=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);d.render.drawDot(a.x,
a.y)}}}};this.rectangle=function(){this.type="rectangle";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.angle=this.y=this.x=0;this.anchor={x:0,y:0};this.height=this.width=10;this.style={fill:"rgba(255,100,255,1)",stroke:"rgba(0,0,0,0)",lineWidth:1,shadowColour:"rgba(0,0,0,0)",shadowBlur:2,shadowOffset:{x:1,y:1}};this.parameter={};this.parameter.x=function(a){return function(b){if(void 0==b)return a.x;a.x=b;a.computeExtremities()}}(this);
this.parameter.y=function(a){return function(b){if(void 0==b)return a.y;a.y=b;a.computeExtremities()}}(this);this.parameter.angle=function(a){return function(b){if(void 0==b)return a.angle;a.angle=b;a.computeExtremities()}}(this);this.parameter.anchor=function(a){return function(b){if(void 0==b)return a.anchor;a.anchor=b;a.computeExtremities()}}(this);this.parameter.width=function(a){return function(b){if(void 0==b)return a.width;a.width=b;a.computeExtremities()}}(this);this.parameter.height=function(a){return function(b){if(void 0==
b)return a.height;a.height=b;a.computeExtremities()}}(this);this.getAddress=function(){var a="",b=this;do a=b.name+"/"+a;while(void 0!=(b=b.parent));return"/"+a};this.getOffset=function(){return b(this)};this.computeExtremities=function(a,c){c=this._static;for(var d=this;void 0!=(d=d.parent)&&!c;)c=c||d._static;this._static=c;a=void 0==a?b(this):a;this.extremities={points:[],boundingBox:{}};this.extremities.points=g.library.math.pointsOfRect(this.x,this.y,this.width,this.height,-this.angle,this.anchor);
this.extremities.points=this.extremities.points.map(function(b){b=g.library.math.cartesianAngleAdjust(b.x,b.y,a.a);b.x+=a.x;b.y+=a.y;return b});this.extremities.boundingBox=g.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(a,b){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var c=!1}else c=g.library.math.detectOverlap.pointWithinBoundingBox({x:a,y:b},this.extremities.boundingBox);
return c?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),a=!1):a=g.library.math.detectOverlap.pointWithinPoly({x:a,y:b},this.extremities.points),a):!1};this.render=function(a,b,k,f){b=void 0===b?{x:0,y:0,a:0}:b;k=void 0===k?!1:k;f=void 0===f?!1:f;var c=this._static?!0:g.library.math.detectOverlap.boundingBoxes(d.viewport.getBoundingBox(),this.extremities.boundingBox);if(c){c=g.library.math.cartesianAngleAdjust(this.x,this.y,b.a);b.x+=c.x-this.x;b.y+=c.y-this.y;c=this.angle+
b.a;var h=this.width,q=this.height,l=this.style.lineWidth,r=this.style.shadowBlur,p=this.style.shadowOffset.x,n=this.style.shadowOffset.y;b={x:this.x+b.x-this.anchor.x*(this.width*Math.cos(c)+this.height*Math.sin(-c)),y:this.y+b.y-this.anchor.y*(this.width*Math.sin(c)+this.height*Math.cos(-c))};k||(b=e.coreGraphicsPoint2windowPoint(b.x,b.y),h=e.length(h),q=e.length(q),l=e.length(l),r=e.length(r),p=e.length(p),n=e.length(n));b=g.library.math.cartesianAngleAdjust(b.x,b.y,-c);if(f)a.rotate(c),k=new Path2D,
k.rect(b.x,b.y,h,q),a.clip(k),a.rotate(-c);else if(a.fillStyle=this.style.fill,a.strokeStyle=this.style.stroke,a.lineWidth=l,a.shadowColor=this.style.shadowColour,a.shadowBlur=r,a.shadowOffsetX=p,a.shadowOffsetY=n,a.save(),a.rotate(c),a.fillRect(b.x,b.y,h,q),a.strokeRect(b.x,b.y,h,q),a.restore(),this.dotFrame){for(a=0;a<this.extremities.points.length;a++)k=e.coreGraphicsPoint2windowPoint(this.extremities.points[a].x,this.extremities.points[a].y),d.render.drawDot(k.x,k.y,4,"rgba(50,50,50,1)");k=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.topLeft.x,
this.extremities.boundingBox.topLeft.y);d.render.drawDot(k.x,k.y);k=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);d.render.drawDot(k.x,k.y)}}}};this.group=function(){function a(a,b){if(void 0==b)return a.getAddress()+" >> no element provided";if(void 0==b.name||""==b.name)return a.getAddress()+" >> element has no name";for(var c=0;c<a.children.length;c++)if(a.children[c].name==b.name)return'element with the name "'+b.name+'" already exists in the '+
(void 0==parent?"design root":'group "'+a.name+'"')}this.type="group";this.name="";this.clipActive=this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.angle=this.y=this.x=0;this.children=[];this.clippingStencil;this.parameter={};this.parameter.x=function(a){return function(b){if(void 0==b)return a.x;a.x=b;a.computeExtremities(void 0,!0)}}(this);this.parameter.y=function(a){return function(b){if(void 0==b)return a.y;a.y=b;a.computeExtremities(void 0,
!0)}}(this);this.parameter.angle=function(a){return function(b){if(void 0==b)return a.angle;a.angle=b;a.computeExtremities(void 0,!0)}}(this);this.getAddress=function(){var a="",b=this;do a=b.name+"/"+a;while(void 0!=(b=b.parent));return"/"+a};this.clip=function(a){if(void 0==a)return this.clipActive;this.clipActive=void 0==this.clippingStencil?!1:a;this.computeExtremities()};this.stencil=function(a){if(void 0==a)return this.clippingStencil;this.clippingStencil=a;this.computeExtremities()};this.prepend=
function(b){var c=a(this,b);void 0!=c?console.error("element invalid:",c):(this.children.unshift(b),b.parent=this,b.computeExtremities(void 0,!0))};this.append=function(b){var c=a(this,b);void 0!=c?console.error("element invalid:",c):(this.children.push(b),b.parent=this,b.computeExtremities(void 0,!0))};this.remove=function(a){void 0!=a&&(a=this.children.indexOf(a),0>a||(this.children.splice(a,1),this.computeExtremities()))};this.clear=function(){this.children=[];this.computeExtremities()};this.contains=
function(a){for(var b=0;b<this.children.length;b++)if(this.children[b]==a)return!0;return!1};this.getChildByName=function(a){for(var b=0;b<this.children.length;b++)if(this.children[b].name==a)return this.children[b]};this.getElementsWithName=function(a){for(var b=[],c=0;c<this.children.length;c++)if(this.children[c].name==a&&b.push(this.children[c]),"group"==this.children[c].type)for(var d=this.children[c].getElementsWithName(a),e=0;e<d.length;e++)b.push(d[e]);return b};this.getOffset=function(){return b(this)};
this.computeExtremities=function(a,d){d=void 0===d?!1:d;for(var c=void 0==a,e=this._static,f=this;void 0!=(f=f.parent)&&!e;)e=e||f._static;this._static=e;a=void 0==a?b(this):a;if(d)for(d={x:a.x,y:a.y,a:a.a+this.angle},e=g.library.math.cartesianAngleAdjust(this.x,this.y,a.a),d.x+=e.x,d.y+=e.y,e=0;e<this.children.length;e++)this.children[e].computeExtremities(d,!0);this.extremities={points:[],boundingBox:{}};if(this.clipActive)d={x:a.x,y:a.y,a:a.a+this.angle},e=g.library.math.cartesianAngleAdjust(this.x,
this.y,a.a),d.x+=e.x,d.y+=e.y,this.clippingStencil.computeExtremities(d),this.extremities.points=this.clippingStencil.extremities.points;else{a=[];for(e=0;e<this.children.length;e++)a.push(this.children[e].extremities.boundingBox.topLeft),a.push(this.children[e].extremities.boundingBox.bottomRight);a=g.library.math.boundingBoxFromPoints(a);this.extremities.points=[{x:a.topLeft.x,y:a.topLeft.y},{x:a.bottomRight.x,y:a.topLeft.y},{x:a.bottomRight.x,y:a.bottomRight.y},{x:a.topLeft.x,y:a.bottomRight.y}]}this.extremities.boundingBox=
g.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&c&&this.parent.computeExtremities()};this.isPointWithin=function(a,b){if(this.clipActive)return this.clippingStencil.isPointWithin(a,b);if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var c=!1}else c=g.library.math.detectOverlap.pointWithinBoundingBox({x:a,y:b},this.extremities.boundingBox);return c?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),
a=!1):a=g.library.math.detectOverlap.pointWithinPoly({x:a,y:b},this.extremities.points),a):!1};this.getElementUnderPoint=function(a,b,d,f){d=void 0===d?!1:d;f=void 0===f?!1:f;for(var c=[],g=this.children.length-1;0<=g;g--){var k=this.children[g]._static||d?e.coreGraphicsPoint2windowPoint(a,b):{x:a,y:b};if(!this.children[g].ignored&&this.children[g].isPointWithin(k.x,k.y))if("group"==this.children[g].type){if(k=this.children[g].getElementUnderPoint(a,b,this.children[g]._static||d,f),void 0!=k)if(f)c=
c.concat(k);else return k}else if(f)c.push(this.children[g]);else return this.children[g]}if(f)return c};this.render=function(a,b,f,h){b=void 0===b?{x:0,y:0,a:0}:b;f=void 0===f?!1:f;h=void 0===h?!1:h;a:if(this._static)var c=!0;else{for(c=0;c<this.children.length;c++)if(this.children[c]._static){c=!0;break a}c=g.library.math.detectOverlap.boundingBoxes(d.viewport.getBoundingBox(),this.extremities.boundingBox)}if(c){c=g.library.math.cartesianAngleAdjust(this.x,this.y,b.a);b={a:b.a+this.angle,x:b.x+
c.x,y:b.y+c.y};if(this.clipActive||h)a.save(),this.clippingStencil.render(a,Object.assign({},b),f||this.clippingStencil._static,h||this.clipActive);for(h=0;h<this.children.length;h++)c=this.children[h],c.render(a,Object.assign({},b),f||c._static);this.clipActive&&a.restore();if(this.dotFrame){for(h=0;h<this.extremities.points.length;h++)a=e.coreGraphicsPoint2windowPoint(this.extremities.points[h].x,this.extremities.points[h].y),d.render.drawDot(a.x,a.y,4,"rgba(50,50,50,1)");a=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.topLeft.x,
this.extremities.boundingBox.topLeft.y);d.render.drawDot(a.x,a.y);a=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);d.render.drawDot(a.x,a.y)}}}};this.text=function(){this.type="text";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.y=this.x=0;this.text="curve";this.angle=0;this.size=1;this.style={font:"30pt Arial",align:"start",baseline:"alphabetic",
fill:"rgba(255,100,100,1)",stroke:"rgba(0,0,0,0)",lineWidth:1,shadowColour:"rgba(0,0,0,0)",shadowBlur:2,shadowOffset:{x:20,y:20}};this.parameter={};this.parameter.x=function(a){return function(b){if(void 0==b)return a.x;a.x=b;a.computeExtremities()}}(this);this.parameter.y=function(a){return function(b){if(void 0==b)return a.y;a.y=b;a.computeExtremities()}}(this);this.parameter.angle=function(a){return function(b){if(void 0==b)return a.angle;a.angle=b;a.computeExtremities()}}(this);this.parameter.size=
function(a){return function(b){if(void 0==b)return a.size;a.size=b;a.computeExtremities()}}(this);this.getAddress=function(){var a="",b=this;do a=b.name+"/"+a;while(void 0!=(b=b.parent));return"/"+a};this.computeExtremities=function(a){for(var c=this._static,d=this;void 0!=(d=d.parent)&&!c;)c=c||d._static;this._static=c;a=void 0==a?b(this):a;this.extremities={points:[],boundingBox:{}};this.extremities.points=g.library.math.pointsOfText(this.text,this.x,this.y,this.angle,1/this.size,this.style.font,
this.style.align,this.style.baseline);this.extremities.points=this.extremities.points.map(function(b){b=g.library.math.cartesianAngleAdjust(b.x,b.y,a.a);b.x+=a.x;b.y+=a.y;return b});this.extremities.boundingBox=g.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(a,b){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var c=!1}else c=g.library.math.detectOverlap.pointWithinBoundingBox({x:a,
y:b},this.extremities.boundingBox);return c?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),a=!1):a=g.library.math.detectOverlap.pointWithinPoly({x:a,y:b},this.extremities.points),a):!1};this.render=function(a,b,f,h){b=void 0===b?{x:0,y:0,a:0}:b;f=void 0===f?!1:f;h=void 0===h?!1:h;var c=g.library.math.cartesianAngleAdjust(this.x,this.y,b.a);b.x+=c.x-this.x;b.y+=c.y-this.y;c={x:this.x+b.x,y:this.y+b.y};var k=this.size;b=this.angle+b.a;var q=this.style.lineWidth,l=this.style.shadowBlur,
r=this.style.shadowOffset.x,p=this.style.shadowOffset.y;f||(c=e.coreGraphicsPoint2windowPoint(c.x,c.y),k=e.length(k),l=e.length(l),r=e.length(r),p=e.length(p));c=g.library.math.cartesianAngleAdjust(c.x,c.y,-b);if(h)console.warn("no clipping available for text shape");else if(a.font=this.style.font,a.textAlign=this.style.align,a.textBaseline=this.style.baseline,a.fillStyle=this.style.fill,a.strokeStyle=this.style.stroke,a.lineWidth=q,a.shadowColor=this.style.shadowColour,a.shadowBlur=l,a.shadowOffsetX=
r,a.shadowOffsetY=p,a.save(),a.rotate(b),a.scale(k,k),a.fillText(this.text,c.x/k,c.y/k),a.shadowColor="rgba(0,0,0,0)",a.strokeText(this.text,c.x/k,c.y/k),a.restore(),this.dotFrame){for(a=0;a<this.extremities.points.length;a++)f=e.coreGraphicsPoint2windowPoint(this.extremities.points[a].x,this.extremities.points[a].y),d.render.drawDot(f.x,f.y,4,"rgba(50,50,50,1)");f=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);d.render.drawDot(f.x,f.y);
f=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);d.render.drawDot(f.x,f.y)}}}};this.arrangement=new function(){var a=new f.group;a.name="root";this.createElement=function(a){return new f[a]};this.clear=function(){a.clear()};this.get=function(){return a};this.set=function(b){a=b};this.prepend=function(b){a.prepend(b)};this.append=function(b){a.append(b)};this.remove=function(b){a.remove(b)};this.getElementUnderPoint=function(b,
d,e,f){return a.getElementUnderPoint(b,d,void 0===e?!1:e,void 0===f?!1:f)};this.getElementsWithName=function(b){return a.getElementsWithName(b)}};this.viewport=new function(){function a(){function a(a){var b=a.charAt(0).toUpperCase()+a.slice(1),e=g.getAttribute("coreGraphics"+b);if(d[a]!=e||d["window"+b]!=window["inner"+b])d[a]=e,d["window"+b]=window["inner"+b],void 0==e?(g[a]=d.defaultSize[a]*window.devicePixelRatio,g.style[a]=d.defaultSize[a]+"px"):e.indexOf("%")==e.length-1?(b=g.parentElement["offset"+
b],e=parseFloat(e.slice(0,e.length-1))/100,g[a]=b*e*window.devicePixelRatio,g.style[a]=b*e+"px"):(g[a]=e*window.devicePixelRatio,g.style[a]=e+"px"),c=!0}var c=!1;a("height");a("width");c&&b()}function b(){f.points.tl=e.windowPoint2coreGraphicsPoint(0,0);f.points.tr=e.windowPoint2coreGraphicsPoint(g.width,0);f.points.bl=e.windowPoint2coreGraphicsPoint(0,g.height);f.points.br=e.windowPoint2coreGraphicsPoint(g.width,g.height);f.boundingBox=g.library.math.boundingBoxFromPoints([f.points.tl,f.points.tr,
f.points.br,f.points.bl])}var d={defaultSize:{width:640,height:480},width:0,height:0,windowWidth:0,windowHeight:0},f={position:{x:0,y:0},scale:window.devicePixelRatio,angle:0,points:{tl:{x:0,y:0},tr:{x:0,y:0},bl:{x:0,y:0},br:{x:0,y:0}},boundingBox:{topLeft:{x:0,y:0},bottomRight:{x:0,y:0}}},h=void 0,l=void 0,p=!1,y=!0;this.position=function(a,c){if(void 0==a||void 0==c)return{x:f.position.x,y:f.position.y};f.position.x=a;f.position.y=c;b()};this.scale=function(a){if(void 0==a)return f.scale;f.scale=
0==a?window.devicePixelRatio:a;b()};this.angle=function(a){if(void 0==a)return f.angle;f.angle=a;b()};this.windowPoint2coreGraphicsPoint=function(a,b){return e.windowPoint2coreGraphicsPoint(a,b)};this.refresh=function(){a();b();this.allowKeyboardInput(y)};this.getBoundingBox=function(){return f.boundingBox};this.mousePosition=function(a,b){if(void 0==a||void 0==b)return{x:h,y:l};h=a;l=b};this.stopMouseScroll=function(a){if(void 0==a)return p;p=a;a||(document.body.style.overflow="")};this.allowKeyboardInput=
function(a){if(void 0==a)return y;(y=a)?g.setAttribute("tabIndex",1):g.removeAttribute("tabIndex")};this.cursor=function(a){if(void 0==a)return document.body.style.cursor;document.body.style.cursor=a}};this.render=new function(){function a(a){void 0!==a&&a||(e.fillStyle="rgb(255,255,255)",e.fillRect(0,0,g.width,g.height));d.arrangement.get().render(e)}function b(c){f=requestAnimationFrame(b);try{a()}catch(x){d.render.active(!1),console.error("major animation error"),console.error(x)}d.stats.collect(c)}
var e=g.getContext("2d",{alpha:!1}),f=void 0;this.drawDot=function(a,b,c,d){c=void 0===c?2:c;e.fillStyle=void 0===d?"rgba(150,150,255,1)":d;e.beginPath();e.arc(a,b,c,0,2*Math.PI,!1);e.closePath();e.fill()};this.frame=function(b){a(void 0===b?!1:b)};this.active=function(a){if(void 0==a)return void 0!=f;a?void 0==f&&b():void 0!=f&&(cancelAnimationFrame(f),f=void 0)}};this.stats=new function(){var a=!1,b=0,d={compute:function(a){this.frameTimeArray.push(1E3/(a-b));30<=this.frameTimeArray.length&&this.frameTimeArray.shift();
this.rate=g.library.math.averageArray(this.frameTimeArray);b=a},counter:0,frameTimeArray:[],rate:0},e={recursiveCount:function(a){void 0==a&&(this.counts={total:0,canvas:0,circle:0,group:0,image:0,path:0,polygon:0,rectangle:0,text:0},a=g.core.arrangement.get());this.counts.total++;switch(a.type){case "canvas":this.counts.canvas++;break;case "circle":this.counts.circle++;break;case "group":this.counts.group++;break;case "image":this.counts.image++;break;case "path":this.counts.path++;break;case "polygon":this.counts.polygon++;
break;case "rectangle":this.counts.rectangle++;break;case "text":this.counts.text++}if(void 0!=a.children)for(var b=0;b<a.children.length;b++)this.recursiveCount(a.children[b])},recursivePrint:function(a,b){b=void 0===b?"":b;void 0==a&&(a=g.core.arrangement.get());console.log(b+a.name);if(void 0!=a.children)for(var c=0;c<a.children.length;c++)this.recursivePrint(a.children[c],b+"- ")},counts:{total:0,canvas:0,circle:0,group:0,image:0,path:0,polygon:0,rectangle:0,text:0}};this.collect=function(b){a&&
d.compute(b)};this.active=function(b){if(void 0==b)return a;a=b};this.getReport=function(){e.recursiveCount();return{framesPerSecond:d.rate,shapeCount:e.counts}}};this.callback=new function(){for(var a="onmousedown onmouseup onmousemove onmouseenter onmouseleave onwheel onclick ondblclick onkeydown onkeyup touchstart touchmove touchend touchenter touchleave touchcancel".split(" "),b={},f=0;f<a.length;b={$jscomp$loop$prop$getRelevantShape$7:b.$jscomp$loop$prop$getRelevantShape$7},f++){b.$jscomp$loop$prop$getRelevantShape$7=
function(a,b,c){var e=d.arrangement.getElementUnderPoint(a,b);if(void 0!=e&&void 0==e[c])for(a=d.arrangement.getElementUnderPoint(a,b,void 0,!0),b=0;b<a.length;b++)if(void 0!=a[b][c]){e=a[b];break}return e};this[a[f]]=function(a,b,c){};var h=0,l=0;g[a[f]]=function(a){return function(b){return function(c){if(d.callback[b]){var f=e.windowPoint2coreGraphicsPoint(c.x,c.y),g=a.$jscomp$loop$prop$getRelevantShape$7(f.x,f.y,b);d.callback[b](f.x,f.y,c,g)}}}}(b)(a[f]);g.onmouseover=function(a){return function(b){d.viewport.stopMouseScroll()&&
(document.body.style.overflow="hidden");if(d.callback.onmouseover){var c=e.windowPoint2coreGraphicsPoint(b.x,b.y),f=a.$jscomp$loop$prop$getRelevantShape$7(c.x,c.y,"onmouseover");d.callback.onmouseover(c.x,c.y,b,f)}}}(b);g.onmouseout=function(a){return function(b){d.viewport.stopMouseScroll()&&(document.body.style.overflow="");if(d.callback.onmouseout){var c=e.windowPoint2coreGraphicsPoint(b.x,b.y),f=a.$jscomp$loop$prop$getRelevantShape$7(c.x,c.y,"onmouseout");d.callback.onmouseout(c.x,c.y,b,f)}}}(b);
g.onmousemove=function(a){return function(b){var c=e.windowPoint2coreGraphicsPoint(b.x,b.y);d.viewport.mousePosition(c.x,c.y);if(d.callback.onmousemove){var f=a.$jscomp$loop$prop$getRelevantShape$7(h,l,"onmouseleave"),g=a.$jscomp$loop$prop$getRelevantShape$7(c.x,c.y,"onmouseenter"),k=a.$jscomp$loop$prop$getRelevantShape$7(c.x,c.y,"onmousemove");f!=g&&(d.callback.onmouseleave(c.x,c.y,b,f),d.callback.onmouseenter(c.x,c.y,b,g));d.callback.onmousemove(c.x,c.y,b,k);h=c.x;l=c.y}}}(b);g.onkeydown=function(a){return function(b){if(d.callback.onkeydown){var c=
d.viewport.mousePosition(),e=a.$jscomp$loop$prop$getRelevantShape$7(c.x,c.y,"onkeydown");d.callback.onkeydown(c.x,c.y,b,e)}}}(b);g.onkeyup=function(a){return function(b){if(d.callback.onkeyup){var c=d.viewport.mousePosition(),e=a.$jscomp$loop$prop$getRelevantShape$7(c.x,c.y,"onkeyup");d.callback.onkeyup(c.x,c.y,b,e)}}}(b)}};d.viewport.refresh();d.arrangement.clear()};this.arrangement=new function(){this.get=function(){return h.arrangement.get()};this.set=function(b){return h.arrangement.set(b)};this.createElement=
function(b){return h.arrangement.createElement(b)};this.append=function(b){return h.arrangement.append(b)};this.prepend=function(b){return h.arrangement.prepend(b)};this.remove=function(b){return h.arrangement.remove(b)};this.getElementUnderPoint=function(b,d){return h.arrangement.getElementUnderPoint(b,d)};this.getElementsWithName=function(b){return h.arrangement.getElementsWithName(b)};this.forceRefresh=function(b){return h.arrangement.forceRefresh(b)}};this.viewport=new function(){this.position=
function(b,d){return h.viewport.position(b,d)};this.scale=function(b){return h.viewport.scale(b)};this.angle=function(b){return h.viewport.angle(b)};this.windowPoint2coreGraphicsPoint=function(b,d){return h.viewport.windowPoint2coreGraphicsPoint(b,d)};this.refresh=function(){h.viewport.refresh()};this.mousePosition=function(){return h.viewport.mousePosition()};this.stopMouseScroll=function(b){return h.viewport.stopMouseScroll(b)};this.allowKeyboardInput=function(b){return h.viewport.allowKeyboardInput(b)};
this.cursor=function(b){return h.viewport.cursor(b)}};this.render=new function(){this.frame=function(b){return h.render.frame(void 0===b?!1:b)};this.active=function(b){return h.render.active(b)}};this.stats=new function(){this.active=function(b){return h.stats.active(b)};this.getReport=function(){return h.stats.getReport()}};this.callback=new function(){this.onmousedown=function(b,d,e,f){};h.callback.onmousedown=function(b){return function(d,e,f,a){b.onmousedown(d,e,f,a)}}(this);this.onmouseup=function(b,
d,e,f){};h.callback.onmouseup=function(b){return function(d,e,f,a){b.onmouseup(d,e,f,a)}}(this);this.onmousemove=function(b,d,e,f){};h.callback.onmousemove=function(b){return function(d,e,f,a){b.onmousemove(d,e,f,a)}}(this);this.onmouseenter=function(b,d,e,f){};h.callback.onmouseenter=function(b){return function(d,e,f,a){b.onmouseenter(d,e,f,a)}}(this);this.onmouseleave=function(b,d,e,f){};h.callback.onmouseleave=function(b){return function(d,e,f,a){b.onmouseleave(d,e,f,a)}}(this);this.onwheel=function(b,
d,e,f){};h.callback.onwheel=function(b){return function(d,e,f,a){b.onwheel(d,e,f,a)}}(this);this.onclick=function(b,d,e,f){};h.callback.onclick=function(b){return function(d,e,f,a){b.onclick(d,e,f,a)}}(this);this.ondblclick=function(b,d,e,f){};h.callback.ondblclick=function(b){return function(d,e,f,a){b.ondblclick(d,e,f,a)}}(this);this.onkeydown=function(b,d,e,f){};h.callback.onkeydown=function(b){return function(d,e,f,a){b.onkeydown(d,e,f,a)}}(this);this.onkeyup=function(b,d,e,f){};h.callback.onkeyup=
function(b){return function(d,e,f,a){b.onkeyup(d,e,f,a)}}(this);this.touchstart=function(b,d,e){};h.callback.touchstart=function(b){return function(d,e,f,a){b.touchstart(d,e,f)}}(this);this.touchmove=function(b,d,e){};h.callback.touchmove=function(b){return function(d,e,f,a){b.touchmove(d,e,f)}}(this);this.touchend=function(b,d,e){};h.callback.touchend=function(b){return function(d,e,f,a){b.touchend(d,e,f)}}(this);this.touchenter=function(b,d,e){};h.callback.touchenter=function(b){return function(d,
e,f,a){b.touchenter(d,e,f)}}(this);this.touchleave=function(b,d,e){};h.callback.touchleave=function(b){return function(d,e,f,a){b.touchleave(d,e,f)}}(this);this.touchcancel=function(b,d,e){};h.callback.touchcancel=function(b){return function(d,e,f,a){b.touchcancel(d,e,f)}}(this)}}}})();
