var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(g){var q=0;return function(){return q<g.length?{done:!1,value:g[q++]}:{done:!0}}};$jscomp.arrayIterator=function(g){return{next:$jscomp.arrayIteratorImpl(g)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(g,q,h){g!=Array.prototype&&g!=Object.prototype&&(g[q]=h.value)};$jscomp.getGlobal=function(g){return"undefined"!=typeof window&&window===g?g:"undefined"!=typeof global&&null!=global?global:g};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.Symbol=function(){var g=0;return function(q){return $jscomp.SYMBOL_PREFIX+(q||"")+g++}}();$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var g=$jscomp.global.Symbol.iterator;g||(g=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[g]&&$jscomp.defineProperty(Array.prototype,g,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var g=$jscomp.global.Symbol.asyncIterator;g||(g=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(g){$jscomp.initSymbolIterator();g={next:g};g[$jscomp.global.Symbol.iterator]=function(){return this};return g};
$jscomp.iteratorFromArray=function(g,q){$jscomp.initSymbolIterator();g instanceof String&&(g+="");var h=0,m={next:function(){if(h<g.length){var a=h++;return{value:q(a,g[a]),done:!1}}m.next=function(){return{done:!0,value:void 0}};return m.next()}};m[Symbol.iterator]=function(){return m};return m};
$jscomp.polyfill=function(g,q,h,m){if(q){h=$jscomp.global;g=g.split(".");for(m=0;m<g.length-1;m++){var a=g[m];a in h||(h[a]={});h=h[a]}g=g[g.length-1];m=h[g];q=q(m);q!=m&&null!=q&&$jscomp.defineProperty(h,g,{configurable:!0,writable:!0,value:q})}};$jscomp.polyfill("Array.prototype.keys",function(g){return g?g:function(){return $jscomp.iteratorFromArray(this,function(g){return g})}},"es6","es3");
$jscomp.polyfill("Array.from",function(g){return g?g:function(g,h,m){h=null!=h?h:function(a){return a};var a=[],d="undefined"!=typeof Symbol&&Symbol.iterator&&g[Symbol.iterator];if("function"==typeof d){g=d.call(g);for(var e=0;!(d=g.next()).done;)a.push(h.call(m,d.value,e++))}else for(d=g.length,e=0;e<d;e++)a.push(h.call(m,g[e],e));return a}},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var g={},q=Object.create(new $jscomp.global.Proxy(g,{get:function(h,m,a){return h==g&&"q"==m&&a==q}}));return!0===q.q}catch(h){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.makeIterator=function(g){var q="undefined"!=typeof Symbol&&Symbol.iterator&&g[Symbol.iterator];return q?q.call(g):$jscomp.arrayIterator(g)};
$jscomp.owns=function(g,q){return Object.prototype.hasOwnProperty.call(g,q)};
$jscomp.polyfill("WeakMap",function(g){function q(){if(!g||!Object.seal)return!1;try{var b=Object.seal({}),c=Object.seal({}),a=new g([[b,2],[c,3]]);if(2!=a.get(b)||3!=a.get(c))return!1;a.delete(b);a.set(c,4);return!a.has(b)&&4==a.get(c)}catch(n){return!1}}function h(){}function m(b){if(!$jscomp.owns(b,d)){var c=new h;$jscomp.defineProperty(b,d,{value:c})}}function a(b){var c=Object[b];c&&(Object[b]=function(b){if(b instanceof h)return b;m(b);return c(b)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(g&&
$jscomp.ES6_CONFORMANCE)return g}else if(q())return g;var d="$jscomp_hidden_"+Math.random();a("freeze");a("preventExtensions");a("seal");var e=0,f=function(b){this.id_=(e+=Math.random()+1).toString();if(b){b=$jscomp.makeIterator(b);for(var c;!(c=b.next()).done;)c=c.value,this.set(c[0],c[1])}};f.prototype.set=function(b,c){m(b);if(!$jscomp.owns(b,d))throw Error("WeakMap key fail: "+b);b[d][this.id_]=c;return this};f.prototype.get=function(b){return $jscomp.owns(b,d)?b[d][this.id_]:void 0};f.prototype.has=
function(b){return $jscomp.owns(b,d)&&$jscomp.owns(b[d],this.id_)};f.prototype.delete=function(b){return $jscomp.owns(b,d)&&$jscomp.owns(b[d],this.id_)?delete b[d][this.id_]:!1};return f},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(g){function q(){if($jscomp.ASSUME_NO_NATIVE_MAP||!g||"function"!=typeof g||!g.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),c=new g($jscomp.makeIterator([[b,"s"]]));if("s"!=c.get(b)||1!=c.size||c.get({x:4})||c.set({x:4},"t")!=c||2!=c.size)return!1;var a=c.entries(),d=a.next();if(d.done||d.value[0]!=b||"s"!=d.value[1])return!1;d=a.next();return d.done||4!=d.value[0].x||"t"!=d.value[1]||!a.next().done?!1:!0}catch(l){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(g&&$jscomp.ES6_CONFORMANCE)return g}else if(q())return g;$jscomp.initSymbolIterator();var h=new WeakMap,m=function(b){this.data_={};this.head_=e();this.size=0;if(b){b=$jscomp.makeIterator(b);for(var c;!(c=b.next()).done;)c=c.value,this.set(c[0],c[1])}};m.prototype.set=function(b,c){b=0===b?0:b;var k=a(this,b);k.list||(k.list=this.data_[k.id]=[]);k.entry?k.entry.value=c:(k.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:b,
value:c},k.list.push(k.entry),this.head_.previous.next=k.entry,this.head_.previous=k.entry,this.size++);return this};m.prototype.delete=function(b){b=a(this,b);return b.entry&&b.list?(b.list.splice(b.index,1),b.list.length||delete this.data_[b.id],b.entry.previous.next=b.entry.next,b.entry.next.previous=b.entry.previous,b.entry.head=null,this.size--,!0):!1};m.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=e();this.size=0};m.prototype.has=function(b){return!!a(this,b).entry};
m.prototype.get=function(b){return(b=a(this,b).entry)&&b.value};m.prototype.entries=function(){return d(this,function(b){return[b.key,b.value]})};m.prototype.keys=function(){return d(this,function(b){return b.key})};m.prototype.values=function(){return d(this,function(b){return b.value})};m.prototype.forEach=function(b,c){for(var a=this.entries(),d;!(d=a.next()).done;)d=d.value,b.call(c,d[1],d[0],this)};m.prototype[Symbol.iterator]=m.prototype.entries;var a=function(b,c){var a=c&&typeof c;"object"==
a||"function"==a?h.has(c)?a=h.get(c):(a=""+ ++f,h.set(c,a)):a="p_"+c;var d=b.data_[a];if(d&&$jscomp.owns(b.data_,a))for(b=0;b<d.length;b++){var l=d[b];if(c!==c&&l.key!==l.key||c===l.key)return{id:a,list:d,index:b,entry:l}}return{id:a,list:d,index:-1,entry:void 0}},d=function(b,c){var a=b.head_;return $jscomp.iteratorPrototype(function(){if(a){for(;a.head!=b.head_;)a=a.previous;for(;a.next!=a.head;)return a=a.next,{done:!1,value:c(a)};a=null}return{done:!0,value:void 0}})},e=function(){var b={};return b.previous=
b.next=b.head=b},f=0;return m},"es6","es3");
$jscomp.polyfill("Set",function(g){function q(){if($jscomp.ASSUME_NO_NATIVE_SET||!g||"function"!=typeof g||!g.prototype.entries||"function"!=typeof Object.seal)return!1;try{var h=Object.seal({x:4}),a=new g($jscomp.makeIterator([h]));if(!a.has(h)||1!=a.size||a.add(h)!=a||1!=a.size||a.add({x:4})!=a||2!=a.size)return!1;var d=a.entries(),e=d.next();if(e.done||e.value[0]!=h||e.value[1]!=h)return!1;e=d.next();return e.done||e.value[0]==h||4!=e.value[0].x||e.value[1]!=e.value[0]?!1:d.next().done}catch(f){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(g&&$jscomp.ES6_CONFORMANCE)return g}else if(q())return g;$jscomp.initSymbolIterator();var h=function(h){this.map_=new Map;if(h){h=$jscomp.makeIterator(h);for(var a;!(a=h.next()).done;)this.add(a.value)}this.size=this.map_.size};h.prototype.add=function(h){h=0===h?0:h;this.map_.set(h,h);this.size=this.map_.size;return this};h.prototype.delete=function(h){h=this.map_.delete(h);this.size=this.map_.size;return h};h.prototype.clear=function(){this.map_.clear();
this.size=0};h.prototype.has=function(h){return this.map_.has(h)};h.prototype.entries=function(){return this.map_.entries()};h.prototype.values=function(){return this.map_.values()};h.prototype.keys=h.prototype.values;h.prototype[Symbol.iterator]=h.prototype.values;h.prototype.forEach=function(h,a){var d=this;this.map_.forEach(function(e){return h.call(a,e,e,d)})};return h},"es6","es3");
$jscomp.polyfill("Object.entries",function(g){return g?g:function(g){var h=[],m;for(m in g)$jscomp.owns(g,m)&&h.push([m,g[m]]);return h}},"es8","es3");$jscomp.polyfill("Array.prototype.fill",function(g){return g?g:function(g,h,m){var a=this.length||0;0>h&&(h=Math.max(0,a+h));if(null==m||m>a)m=a;m=Number(m);0>m&&(m=Math.max(0,a+m));for(h=Number(h||0);h<m;h++)this[h]=g;return this}},"es6","es3");
$jscomp.assign="function"==typeof Object.assign?Object.assign:function(g,q){for(var h=1;h<arguments.length;h++){var m=arguments[h];if(m)for(var a in m)$jscomp.owns(m,a)&&(g[a]=m[a])}return g};$jscomp.polyfill("Object.assign",function(g){return g||$jscomp.assign},"es6","es3");
(function(){for(var g=document.getElementsByTagName("canvas"),q=0;q<g.length;q++)if(g[q].hasAttribute("coreGraphics")){var h=g[q];h.library=new function(){var m=this;this.math=new function(){this.averageArray=function(a){return a.reduce(function(a,e){return a+e},0)/a.length};this.averagePoint=function(a){var d=a.reduce(function(a,d){return{x:a.x+d.x,y:a.y+d.y}});return{x:d.x/a.length,y:d.y/a.length}};this.distanceBetweenTwoPoints=function(a,d){return Math.pow(Math.pow(a.x-d.x,2)+Math.pow(a.y-d.y,
2),.5)};this.seconds2time=function(a){var d={h:0,m:0,s:0};d.h=Math.floor(a/3600);a-=3600*d.h;d.m=Math.floor(a/60);a-=60*d.m;d.s=a;return d};this.largestValueFound=function(a){return a.reduce(function(a,e){return Math.abs(a)>Math.abs(e)?a:e})};this.smallestValueFound=function(a){return a.reduce(function(a,e){return Math.abs(a)<Math.abs(e)?a:e})};this.cartesian2polar=function(a,d){return{dis:Math.pow(Math.pow(a,2)+Math.pow(d,2),.5),ang:0===a?0===d?0:0<d?.5*Math.PI:1.5*Math.PI:0===d?0<=a?0:Math.PI:0<=
a?Math.atan(d/a):Math.atan(d/a)+Math.PI}};this.polar2cartesian=function(a,d){return{x:d*Math.cos(a),y:d*Math.sin(a)}};this.cartesianAngleAdjust=function(a,d,e){if(0==e||0==e%Math.PI*2)return{x:a,y:d};a=this.cartesian2polar(a,d);a.ang+=e;return this.polar2cartesian(a.ang,a.dis)};this.applyOffsetToPoints=function(a,d){return d.map(function(d){return{x:d.x+a.x,y:d.y+a.y}})};this.applyOffsetToPolygon=function(a,d){a={points:this.applyOffsetToPoints(a,d.points),boundingBox:{}};a.boundingBox=this.boundingBoxFromPoints(a.points);
return a};this.boundingBoxFromPoints=function(a){if(0==a.length)return{topLeft:{x:0,y:0},bottomRight:{x:0,y:0}};for(var d=a[0].x,e=a[0].x,f=a[0].y,b=a[0].y,c=1;c<a.length;c++)a[c].x<d?d=a[c].x:a[c].x>e&&(e=a[c].x),a[c].y<f?f=a[c].y:a[c].y>b&&(b=a[c].y);return{topLeft:{x:d,y:f},bottomRight:{x:e,y:b}}};this.pointsOfRect=function(a,d,e,f,b,c){b=void 0===b?0:b;c=void 0===c?{x:0,y:0}:c;var k=c.x*e,n=c.y*f,l=this.cartesian2polar(k,n);l=this.polar2cartesian(l.ang-b,l.dis);c={x:a-l.x,y:d-l.y};l=this.cartesian2polar(k-
e,n);l=this.polar2cartesian(l.ang-b,l.dis);var v={x:a-l.x,y:d-l.y};l=this.cartesian2polar(k-e,n-f);l=this.polar2cartesian(l.ang-b,l.dis);e={x:a-l.x,y:d-l.y};l=this.cartesian2polar(k,n-f);l=this.polar2cartesian(l.ang-b,l.dis);return[c,v,e,{x:a-l.x,y:d-l.y}]};this.pointsOfCircle=function(a,d,e,f){f=void 0===f?3:f;for(var b=[],c=0;c<f;c++)b.push({x:a+e*Math.sin(c/f*Math.PI*2),y:d+e*Math.cos(c/f*Math.PI*2)});return b};this.pointsOfText=function(a,d,e,f,b,c,k,n){var l=document.createElement("canvas").getContext("2d");
l.font=c;l.textAlign=k;l.textBaseline=n;a=l.measureText(a).width/b;c=-c.split("pt")[0].split(" ").pop();isNaN(c)&&(c=-7.5);c/=b;b=[{x:d,y:e},{x:d+a,y:e},{x:d+a,y:e-c},{x:d,y:e-c}];a={start:0,end:0,center:a/2,left:a,right:a};c={alphabetic:c,top:0,hanging:0,middle:c/2,ideographic:0,bottom:c};for(l=0;l<b.length;l++)b[l]={x:b[l].x-a[k],y:b[l].y+c[n]};for(l=0;l<b.length;l++)b[l]=this.cartesianAngleAdjust(b[l].x-d,b[l].y-e,f),b[l].x+=d,b[l].y+=e;return b};this.relativeDistance=function(a,d,e,f,b){d=(f-
d)/(e-d);if(void 0===b||!b){if(1<d)return a;if(0>d)return 0}return d*a};this.lineCorrecter=function(a,d,e){if(!(0>a.x1||0>a.x2||a.x1>e||a.x2>e||0>a.y1&&0>a.y2||a.y1>d&&a.y2>d))return e=(a.y2-a.y1)/(a.x2-a.x1),0>a.y1?(a.x1=(0-a.y1+e*a.x1)/e,a.y1=0):0>a.y2&&(a.x2=(0-a.y2+e*a.x2)/e,a.y2=0),a.y1>d?(a.x1=(d-a.y1+e*a.x1)/e,a.y1=d):a.y2>d&&(a.x2=(d-a.y2+e*a.x2)/e,a.y2=d),a};this.normalizeStretchArray=function(a){var d=a.reduce(function(b,c,a,d){return c>d[b]?a:b},0),e=Math.abs(a[d]);a=a.map(function(b){return b/
e});if(0==a[0]&&1==a[a.length-1])return a;var f=0!=a[0]?a[0]:a[a.length-1];return a=a.map(function(b){return(b-f)/(1-f)})};this.curvePoint=new function(){this.linear=function(a,d,e){d=void 0===d?0:d;return(void 0===a?.5:a)*((void 0===e?1:e)-d)+d};this.sin=function(a,d,e){d=void 0===d?0:d;return Math.sin(Math.PI/2*(void 0===a?.5:a))*((void 0===e?1:e)-d)+d};this.cos=function(a,d,e){d=void 0===d?0:d;return(1-Math.cos(Math.PI/2*(void 0===a?.5:a)))*((void 0===e?1:e)-d)+d};this.s=function(a,d,e,f){d=void 0===
d?0:d;e=void 0===e?1:e;f=void 0===f?8:f;return m.math.normalizeStretchArray([1/(1+Math.exp(-.5*-f)),1/(1+Math.exp(-f*((void 0===a?.5:a)-.5))),1/(1+Math.exp(.5*-f))])[1]*(e-d)+d};this.exponential=function(a,d,e,f){d=void 0===d?0:d;e=void 0===e?1:e;f=void 0===f?2:f;return m.math.normalizeStretchArray([(Math.exp(0*f)-1)/(Math.E-1),(Math.exp(f*(void 0===a?.5:a))-1)/(Math.E-1),(Math.exp(1*f)-1)/(Math.E-1)])[1]*(e-d)+d}};this.curveGenerator=new function(){this.linear=function(a,d,e){d=void 0===d?0:d;e=
void 0===e?1:e;a=Math.abs(void 0===a?2:a)-1;for(var f=[0],b=1;b<a;b++)f.push(b/a);f.push(1);a=e-d;for(b=0;b<f.length;b++)f[b]=f[b]*a+d;return f};this.sin=function(a,d,e){d=void 0===d?0:d;e=void 0===e?1:e;a=Math.abs(void 0===a?2:a)-1;for(var f=[0],b=1;b<a;b++)f.push(Math.sin(Math.PI/2*(b/a)));f.push(1);a=e-d;for(b=0;b<f.length;b++)f[b]=f[b]*a+d;return f};this.cos=function(a,d,e){d=void 0===d?0:d;e=void 0===e?1:e;a=Math.abs(void 0===a?2:a)-1;for(var f=[0],b=1;b<a;b++)f.push(1-Math.cos(Math.PI/2*(b/
a)));f.push(1);a=e-d;for(b=0;b<f.length;b++)f[b]=f[b]*a+d;return f};this.s=function(a,d,e,f){a=void 0===a?2:a;d=void 0===d?0:d;e=void 0===e?1:e;f=void 0===f?8:f;0==f&&(f=1E-6);for(var b=[],c=0;c<a;c++)b.push(1/(1+Math.exp(-f*(c/a-.5))));a=m.math.normalizeStretchArray(b);e-=d;for(c=0;c<a.length;c++)a[c]=a[c]*e+d;return a};this.exponential=function(a,d,e,f){d=void 0===d?0:d;e=void 0===e?1:e;f=void 0===f?2:f;a=(void 0===a?2:a)-1;for(var b=[],c=0;c<=a;c++)b.push((Math.exp(c/a*f)-1)/(Math.E-1));b=system.utility.math.normalizeStretchArray(b);
a=e-d;for(c=0;c<b.length;c++)b[c]=b[c]*a+d;return b}};this.detectOverlap=new function(){this.boundingBoxes=function(a,d){return!(a.bottomRight.y<d.topLeft.y||a.topLeft.y>d.bottomRight.y||a.bottomRight.x<d.topLeft.x||a.topLeft.x>d.bottomRight.x)};this.pointWithinBoundingBox=function(a,d){return!(a.x<d.topLeft.x||a.y<d.topLeft.y||a.x>d.bottomRight.x||a.y>d.bottomRight.y)};this.pointWithinPoly=function(a,d){for(var e=!1,f=0,b=d.length-1;f<d.length;b=f++)d[f].y>a.y!=d[b].y>a.y&&a.x<(d[b].x-d[f].x)*(a.y-
d[f].y)/(d[b].y-d[f].y)+d[f].x&&(e=!e);return e};this.lineSegments=function(a,d){var e=(d[1].y-d[0].y)*(a[1].x-a[0].x)-(d[1].x-d[0].x)*(a[1].y-a[0].y);if(0==e)return null;var f=((d[1].x-d[0].x)*(a[0].y-d[0].y)-(d[1].y-d[0].y)*(a[0].x-d[0].x))/e;d=((a[1].x-a[0].x)*(a[0].y-d[0].y)-(a[1].y-a[0].y)*(a[0].x-d[0].x))/e;return{x:a[0].x+f*(a[1].x-a[0].x),y:a[0].y+f*(a[1].y-a[0].y),inSeg1:0<=f&&1>=f,inSeg2:0<=d&&1>=d}};this.overlappingPolygons=function(a,d){for(var e=0;e<a.length;e++)if(this.pointWithinPoly(a[e],
d))return!0;for(e=0;e<d.length;e++)if(this.pointWithinPoly(d[e],a))return!0;var f=Array.apply(null,{length:a.length}).map(Number.call,Number).concat([0]),b=Array.apply(null,{length:d.length}).map(Number.call,Number).concat([0]);for(e=0;e<f.length-1;e++)for(var c=0;c<b.length-1;c++){var k=this.lineSegments([a[f[e]],a[f[e+1]]],[d[b[c]],d[b[c+1]]]);if(null!=k&&k.inSeg1&&k.inSeg2)return!0}return!1};this.overlappingPolygonWithPolygons=function(a,d){for(var e=0;e<d.length;e++)if(this.boundingBoxes(a.boundingBox,
d[e].boundingBox)&&this.overlappingPolygons(a.points,d[e].points))return!0;return!1}};this.fitPolyIn=function(a,d,e){e=void 0===e?!1:e;var f,b=[[],[],[]],c=h.library.math.averagePoint(a.points),k=100,n=[];for(f=1;f<k+1;f++){n=[];for(var l=2*f+1,v=2*Math.PI/l,A=Math.pow(f,2),w=0;w<l;w++){var z=m.math.polar2cartesian(v*w,A);e&&b[0].push({x:z.x+c.x,y:z.y+c.y});this.detectOverlap.overlappingPolygonWithPolygons(this.applyOffsetToPolygon(z,a),d)||n.push({ang:v*w,dis:A})}if(0!=n.length)break}k=10;if(1==
n.length)var g=n[0];else{l=Math.pow(f,2);v=Math.pow(f-1,2);A=[];for(f=0;f<k;f++){var p=[],r=(l-v)/2+v;for(w=0;w<n.length;w++)z=m.math.polar2cartesian(n[w].ang,r),e&&b[1].push({x:z.x+c.x,y:z.y+c.y}),this.detectOverlap.overlappingPolygonWithPolygons(this.applyOffsetToPolygon(z,a),d)||(p.push({ang:n[w].ang,dis:r}),A.push({ang:n[w].ang,dis:r}));if(1==p.length){g=p[0];break}0==p.length?v=r:l=r}void 0==g&&(g=A.pop())}k=10;f=m.math.polar2cartesian(g.ang,g.dis);e&&b[2].push({x:f.x+c.x,y:f.y+c.y});n=f.x;w=
f.y;for(f=g=z=0;f<k;f++)l=(n-z)/2+z,v=(w-g)/2+g,e&&b[2].push({x:l+c.x,y:w+c.y}),this.detectOverlap.overlappingPolygonWithPolygons(this.applyOffsetToPolygon({x:l,y:w},a),d)?z=l:n=l,e&&b[2].push({x:n+c.x,y:v+c.y}),this.detectOverlap.overlappingPolygonWithPolygons(this.applyOffsetToPolygon({x:n,y:v},a),d)?g=v:w=v;f={x:n,y:w};return e?{offset:f,paths:b}:f}};this.structure=new function(){this.functionListRunner=function(a,d){return function(e,f){for(var b=0;b<a.length;b++){for(var c=!0,k=0;k<a[b].requiredKeys.length;k++){c=
!0;for(var n=0;n<a[b].requiredKeys[k].length&&(c=c&&d[a[b].requiredKeys[k][n]],c);n++);if(c)break}if(c&&a[b].function(e,f))break}}};this.signalRegistry=function(a,d,e){a=void 0===a?-1:a;d=void 0===d?-1:d;e=void 0===e?-1:e;var f=[],b=[],c=[],k=[],n={},l=[];this.__dump=function(){console.log("---- signalRegistry dump ----");console.log("\tsignals");for(var b=0;b<f.length;b++)console.log("\t\t",b," "+JSON.stringify(f[b]));console.log("\tselectedSignals");for(b=0;b<tselectedSignals.length;b++)console.log("\t\t",
b," "+JSON.stringify(tselectedSignals[b]));console.log("\tevents");for(b=0;b<c.length;b++)console.log("\t\t",b," "+JSON.stringify(c[b]));console.log("\tevents_byID");for(b=0;b<k.length;b++)console.log("\t\t",b," "+JSON.stringify(k[b]));console.log("\tevents_byPosition");var a=Object.keys(n);for(b=0;b<a.length;b++)console.log("\t\t",a[b]," "+JSON.stringify(n[a[b]]));console.log("\tpositions");for(b=0;b<l.length;b++)console.log("\t\t",b," "+JSON.stringify(l[b]))};this.export=function(){return JSON.parse(JSON.stringify({signals:f,
selectedSignals:b,events:c,events_byID:k,events_byPosition:n,positions:l}))};this.import=function(a){f=JSON.parse(JSON.stringify(a.signals));b=JSON.parse(JSON.stringify(a.selectedSignals));c=JSON.parse(JSON.stringify(a.events));k=JSON.parse(JSON.stringify(a.events_byID));n=JSON.parse(JSON.stringify(a.events_byPosition));l=JSON.parse(JSON.stringify(a.positions))};this.getAllSignals=function(){return JSON.parse(JSON.stringify(f))};this.getAllEvents=function(){return JSON.parse(JSON.stringify(c))};this.getSignal=
function(b){if(void 0!=f[b])return JSON.parse(JSON.stringify(f[b]))};this.eventsBetween=function(b,a){for(var d=void 0==a?Array.from(new Set(l.filter(function(c){return c==b}))):Array.from(new Set(l.filter(function(c){return c>=b&&c<a}))),k=[],e=0;e<d.length;e++){d[e]=n[String(d[e])];for(var f=0;f<d[e].length;f++)k.push(c[d[e][f]])}return k.sort(function(b,c){return b.position<c.position?-1:b.position>c.position?1:0})};this.add=function(b,h){if(void 0!=b&&"line"in b&&"position"in b&&"length"in b){"strength"in
b||(b.strength=1);0>b.line&&(b.line=0);0>b.length&&(b.length=0);0>b.position&&(b.position=0);0>b.strength&&(b.strength=0);-1<d&&b.line>d-1&&(b.line=d-1);-1<e&&b.length>e&&(b.length=e);-1<a&&b.position>a&&(b.position=a-b.length);-1<a&&b.position+b.length>a&&(b.length=a-b.position);-1<a&&b.position+b.length>a&&(b.position=a-b.length);1<b.strength&&(b.strength=1);var v=0;if(void 0==h)for(;void 0!=f[v];)v++;else v=h;f[v]=JSON.parse(JSON.stringify(b));b=[{signalID:v,line:b.line,position:b.position,strength:b.strength},
{signalID:v,line:b.line,position:b.position+b.length,strength:0}];for(h=0;void 0!=c[h];)h++;c[h]=b[0];k[v]=[h];void 0==n[b[0].position]?n[b[0].position]=[h]:n[b[0].position].push(h);for(l.push(b[0].position);void 0!=c[h];)h++;c[h]=b[1];k[v]=k[v].concat(h);void 0==n[b[1].position]?n[b[1].position]=[h]:n[b[1].position].push(h);l.push(b[1].position);return v}};this.remove=function(b){if(void 0!=f[b]){delete f[b];for(var a=0;a<k[b].length;a++){var d=k[b][a];n[c[d].position].splice(n[c[d].position].indexOf(d),
1);l.splice(l.indexOf(c[d].position),1);0==n[c[d].position].length&&delete n[c[d].position];delete c[d]}delete k[b]}};this.update=function(b,c){void 0!=c&&("line"in c||(c.line=f[b].line),-1<a&&("position"in c&&"length"in c?c.length+c.position>a&&(c.length=a-c.position):("position"in c?f[b].length+c.position>=a&&(c.position=a-f[b].length):c.position=f[b].position,"length"in c?c.length+c.position>a&&(c.length=a-c.position):c.length=f[b].length)),"strength"in c||(c.strength=f[b].strength),this.remove(b),
this.add(c,b))};this.reset=function(){f=[];b=[];c=[];k=[];n={};l=[]}}};this.audio=new function(){this.context=new (window.AudioContext||window.webkitAudioContext);this.changeAudioParam=function(b,c,a,d,l,e){e=void 0===e?!0:e;if(null==a)return c.value;e&&c.cancelScheduledValues(b.currentTime);try{switch(l){case "linear":c.linearRampToValueAtTime(a,b.currentTime+d);break;case "exponential":console.warn("2018-4-18 - changeAudioParam:exponential doesn't work on chrome");0==a&&(a=1E-4);c.exponentialRampToValueAtTime(a,
b.currentTime+d);break;case "s":for(var k=a-c.value,n=m.math.curveGenerator.s(10),f=0;f<n.length;f++)n[f]=c.value+n[f]*k;c.setValueCurveAtTime(new Float32Array(n),b.currentTime,d);break;default:c.setTargetAtTime(a,b.currentTime,.001)}}catch(u){console.log("could not change param (possibly due to an overlap, or bad target value)"),console.log("audioParam:",c,"target:",a,"time:",d,"curve:",l,"cancelScheduledValues:",e),console.log(u)}};this.loadAudioFile=function(b,c,a){a=void 0===a?"":a;switch(void 0===
c?"file":c){case "url":c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType="arraybuffer";c.onload=function(){m.audio.context.decodeAudioData(this.response,function(c){b({buffer:c,name:a.split("/").pop(),duration:c.duration})},function(b){console.warn("Error with decoding audio data"+b.err)})};c.send();break;default:var d=document.createElement("input");d.type="file";d.onchange=function(){var c=this.files[0],a=new FileReader;a.readAsArrayBuffer(c);a.onload=function(a){m.audio.context.decodeAudioData(a.target.result,
function(a){b({buffer:a,name:c.name,duration:a.duration})});d.remove()}};document.body.appendChild(d);d.click()}};this.waveformSegment=function(b,c,a){c=void 0===c?{start:0,end:1}:c;a=void 0===a?1E4:a;var d=b.getChannelData(0);c.start=c.start?c.start:0;c.end=c.end?c.end:1;var k=b.length*c.start;b=b.length*c.end;a=(b-k)/a;for(c=[];k<b;k+=Math.round(a))c.push(m.math.largestValueFound(d.slice(k,k+Math.round(a))));return c};this.loadBuffer=function(b,c,a,d){b=b.createBufferSource();b.buffer=c;b.connect(a);
b.onended=d;return b};this.destination=this.context.createGain();this.destination.connect(this.context.destination);this.destination._gain=1;this.destination.masterGain=function(b){if(void 0==b)return this.destination._gain;this._gain=b;m.audio.changeAudioParam(m.audio.context,this.gain,this._gain,.01,"instant",!0)};this.names_frequencies_split={0:{C:16.35,"C#":17.32,D:18.35,"D#":19.45,E:20.6,F:21.83,"F#":23.12,G:24.5,"G#":25.96,A:27.5,"A#":29.14,B:30.87},1:{C:32.7,"C#":34.65,D:36.71,"D#":38.89,E:41.2,
F:43.65,"F#":46.25,G:49,"G#":51.91,A:55,"A#":58.27,B:61.74},2:{C:65.41,"C#":69.3,D:73.42,"D#":77.78,E:82.41,F:87.31,"F#":92.5,G:98,"G#":103.8,A:110,"A#":116.5,B:123.5},3:{C:130.8,"C#":138.6,D:146.8,"D#":155.6,E:164.8,F:174.6,"F#":185,G:196,"G#":207.7,A:220,"A#":233.1,B:246.9},4:{C:261.6,"C#":277.2,D:293.7,"D#":311.1,E:329.6,F:349.2,"F#":370,G:392,"G#":415.3,A:440,"A#":466.2,B:493.9},5:{C:523.3,"C#":554.4,D:587.3,"D#":622.3,E:659.3,F:698.5,"F#":740,G:784,"G#":830.6,A:880,"A#":932.3,B:987.8},6:{C:1047,
"C#":1109,D:1175,"D#":1245,E:1319,F:1397,"F#":1480,G:1568,"G#":1661,A:1760,"A#":1865,B:1976},7:{C:2093,"C#":2217,D:2349,"D#":2489,E:2637,F:2794,"F#":2960,G:3136,"G#":3322,A:3520,"A#":3729,B:3951},8:{C:4186,"C#":4435,D:4699,"D#":4978,E:5274,F:5588,"F#":5920,G:6272,"G#":6645,A:7040,"A#":7459,B:7902}};this.names_frequencies={};for(var a=Object.entries(this.names_frequencies_split),d=0;d<a.length;d++)for(var e=Object.entries(this.names_frequencies_split[d]),f=0;f<e.length;f++)this.names_frequencies[a[d][0]+
e[f][0]]=e[f][1];this.frequencies_names={};a=Object.entries(this.names_frequencies);for(d=0;d<a.length;d++)this.frequencies_names[a[d][1]]=a[d][0];a="0C 0C# 0D 0D# 0E 0F 0F# 0G 0G# 0A 0A# 0B 1C 1C# 1D 1D# 1E 1F 1F# 1G 1G# 1A 1A# 1B 2C 2C# 2D 2D# 2E 2F 2F# 2G 2G# 2A 2A# 2B 3C 3C# 3D 3D# 3E 3F 3F# 3G 3G# 3A 3A# 3B 4C 4C# 4D 4D# 4E 4F 4F# 4G 4G# 4A 4A# 4B 5C 5C# 5D 5D# 5E 5F 5F# 5G 5G# 5A 5A# 5B 6C 6C# 6D 6D# 6E 6F 6F# 6G 6G# 6A 6A# 6B 7C 7C# 7D 7D# 7E 7F 7F# 7G 7G# 7A 7A# 7B 8C 8C# 8D 8D# 8E 8F 8F# 8G 8G# 8A 8A# 8B".split(" ");
this.midinumbers_names={};for(d=0;d<a.length;d++)this.midinumbers_names[d+24]=a[d];this.names_midinumbers={};a=Object.entries(this.midinumbers_names);for(d=0;d<a.length;d++)this.names_midinumbers[a[d][1]]=parseInt(a[d][0]);this.num2name=function(b){return this.midinumbers_names[b]};this.num2freq=function(b){return this.names_frequencies[this.midinumbers_names[b]]};this.name2num=function(b){return this.names_midinumbers[b]};this.name2freq=function(b){return this.names_frequencies[b]};this.freq2num=
function(b){return this.names_midinumbers[this.frequencies_names[b]]};this.freq2name=function(b){return this.frequencies_names[b]}};this.misc=new function(){this.blendColours=function(a,d,e){function f(b){b=b.split(",");b[0]=b[0].replace("rgba(","");b[3]=b[3].replace(")","");return b.map(function(b){return parseFloat(b)})}a=f(a);d=f(d);for(var b=[],c=0;c<a.length;c++)b[c]=(1-e)*a[c]+e*d[c];return"rgba("+b[0]+","+b[1]+","+b[2]+","+b[3]+")"};this.multiBlendColours=function(a,d){if(0==d)return a[0];
if(1==d)return a[a.length-1];d*=a.length-1;return m.misc.blendColours(a[~~d],a[~~d+1],d%1)};this.padString=function(a,d,e){e=void 0===e?" ":e;if(1>e.length)return a;for(a=""+a;a.length<d;)a=e+a;return a};this.compressString=function(a){return m.thirdparty.lzString.compress(a)};this.decompressString=function(a){return m.thirdparty.lzString.decompress(a)};this.serialize=function(a,d){d=void 0===d?!0:d;a=JSON.stringify(a,function(a,d){switch({}.toString.call(d).match(/\s([a-zA-Z]+)/)[1].toLowerCase()){case "function":return{__uniqueType:"function",
__value:d.toString(),__name:d.name};case "arraybuffer":return{__uniqueType:"arraybuffer",__value:btoa(String.fromCharCode(new Uint8Array(d)))};case "audiobuffer":a=[];for(var b=0;b<d.numberOfChannels;b++)a.push(Array.from(d.getChannelData(b)));return{__uniqueType:"audiobuffer",__channelData:a,__sampleRate:d.sampleRate,__numberOfChannels:d.numberOfChannels,__length:d.length};default:return d}});d&&(a=m.misc.compressString(a));return a};this.unserialize=function(a,d){if(void 0!==a)return(void 0===d||
d)&&(a=m.misc.decompressString(a)),JSON.parse(a,function(a,d){if("object"==typeof d&&null!=d&&"__uniqueType"in d)switch(d.__uniqueType){case "function":a=d.__value.substring(0,d.__value.indexOf("{"));a=a.substring(a.indexOf("(")+1,a.lastIndexOf(")"));d=d.__value.substring(d.__value.indexOf("{")+1,d.__value.lastIndexOf("}"));d=Function(a,d);break;case "arraybuffer":d=atob(d.__value);for(a=0;a<d.length;a++)d[a]=d[a].charCodeAt(0);d=new ArrayBuffer(d);break;case "audiobuffer":var b=m.audio.context.createBuffer(d.__numberOfChannels,
d.__length,d.__sampleRate);for(a=0;a<b.numberOfChannels;a++){workingBuffer=b.getChannelData(a);for(var c=0;c<b.length;c++)workingBuffer[c]=d.__channelData[a][c]}d=b;break;default:d=d.__value}return d})};this.openFile=function(a,d){d=void 0===d?"readAsBinaryString":d;var e=document.createElement("input");e.type="file";e.onchange=function(){var e=new FileReader;switch(d){case "readAsArrayBuffer":e.readAsArrayBuffer(this.files[0]);break;default:e.readAsBinaryString(this.files[0])}e.onloadend=function(){a&&
a(e.result)}};e.click()};this.printFile=function(a,d){var e=document.createElement("a");e.href=URL.createObjectURL(new Blob([d]));e.download=a;e.click()}};this.thirdparty=new function(){this.lzString=function(){var a=String.fromCharCode,d={},e={compress:function(a){return null==a?"":e._compress(a,6,function(b){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$".charAt(b)})},decompress:function(a){if(null==a)return"";if(""==a)return null;a=a.replace(/ /g,"+");return e._decompress(a.length,
32,function(b){b=a.charAt(b);if(!d["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$"]){d["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$"]={};for(var c=0;65>c;c++)d["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$"]["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$".charAt(c)]=c}return d["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$"][b]})},_compress:function(a,b,c){if(null==a)return"";var d,e={},l={},f="",
h=2,g=3,m=2,u=[],p=0,r=0,q;for(q=0;q<a.length;q+=1){var x=a.charAt(q);Object.prototype.hasOwnProperty.call(e,x)||(e[x]=g++,l[x]=!0);var y=f+x;if(Object.prototype.hasOwnProperty.call(e,y))f=y;else{if(Object.prototype.hasOwnProperty.call(l,f)){if(256>f.charCodeAt(0)){for(d=0;d<m;d++)p<<=1,r==b-1?(r=0,u.push(c(p)),p=0):r++;var t=f.charCodeAt(0);for(d=0;8>d;d++)p=p<<1|t&1,r==b-1?(r=0,u.push(c(p)),p=0):r++,t>>=1}else{t=1;for(d=0;d<m;d++)p=p<<1|t,r==b-1?(r=0,u.push(c(p)),p=0):r++,t=0;t=f.charCodeAt(0);
for(d=0;16>d;d++)p=p<<1|t&1,r==b-1?(r=0,u.push(c(p)),p=0):r++,t>>=1}h--;0==h&&(h=Math.pow(2,m),m++);delete l[f]}else for(t=e[f],d=0;d<m;d++)p=p<<1|t&1,r==b-1?(r=0,u.push(c(p)),p=0):r++,t>>=1;h--;0==h&&(h=Math.pow(2,m),m++);e[y]=g++;f=String(x)}}if(""!==f){if(Object.prototype.hasOwnProperty.call(l,f)){if(256>f.charCodeAt(0)){for(d=0;d<m;d++)p<<=1,r==b-1?(r=0,u.push(c(p)),p=0):r++;t=f.charCodeAt(0);for(d=0;8>d;d++)p=p<<1|t&1,r==b-1?(r=0,u.push(c(p)),p=0):r++,t>>=1}else{t=1;for(d=0;d<m;d++)p=p<<1|t,
r==b-1?(r=0,u.push(c(p)),p=0):r++,t=0;t=f.charCodeAt(0);for(d=0;16>d;d++)p=p<<1|t&1,r==b-1?(r=0,u.push(c(p)),p=0):r++,t>>=1}h--;0==h&&(h=Math.pow(2,m),m++);delete l[f]}else for(t=e[f],d=0;d<m;d++)p=p<<1|t&1,r==b-1?(r=0,u.push(c(p)),p=0):r++,t>>=1;h--;0==h&&m++}t=2;for(d=0;d<m;d++)p=p<<1|t&1,r==b-1?(r=0,u.push(c(p)),p=0):r++,t>>=1;for(;;)if(p<<=1,r==b-1){u.push(c(p));break}else r++;return u.join("")},_decompress:function(d,b,c){var k=[],e=4,l=4,f=3,h=[],m,g,u=c(0),p=b,r=1;for(m=0;3>m;m+=1)k[m]=m;var q=
0;var x=Math.pow(2,2);for(g=1;g!=x;){var y=u&p;p>>=1;0==p&&(p=b,u=c(r++));q|=(0<y?1:0)*g;g<<=1}switch(q){case 0:q=0;x=Math.pow(2,8);for(g=1;g!=x;)y=u&p,p>>=1,0==p&&(p=b,u=c(r++)),q|=(0<y?1:0)*g,g<<=1;var t=a(q);break;case 1:q=0;x=Math.pow(2,16);for(g=1;g!=x;)y=u&p,p>>=1,0==p&&(p=b,u=c(r++)),q|=(0<y?1:0)*g,g<<=1;t=a(q);break;case 2:return""}m=k[3]=t;for(h.push(t);;){if(r>d)return"";q=0;x=Math.pow(2,f);for(g=1;g!=x;)y=u&p,p>>=1,0==p&&(p=b,u=c(r++)),q|=(0<y?1:0)*g,g<<=1;switch(t=q){case 0:q=0;x=Math.pow(2,
8);for(g=1;g!=x;)y=u&p,p>>=1,0==p&&(p=b,u=c(r++)),q|=(0<y?1:0)*g,g<<=1;k[l++]=a(q);t=l-1;e--;break;case 1:q=0;x=Math.pow(2,16);for(g=1;g!=x;)y=u&p,p>>=1,0==p&&(p=b,u=c(r++)),q|=(0<y?1:0)*g,g<<=1;k[l++]=a(q);t=l-1;e--;break;case 2:return h.join("")}0==e&&(e=Math.pow(2,f),f++);if(k[t])t=k[t];else if(t===l)t=m+m.charAt(0);else return null;h.push(t);k[l++]=m+t.charAt(0);e--;m=t;0==e&&(e=Math.pow(2,f),f++)}}};return e}()}};h.core=new function(){var g=new function(){function a(b){for(var c=[];void 0!=(b=
b.parent);)c.unshift({x:b.x,y:b.y,a:b.angle});b={x:void 0!=c[0]?c[0].x:0,y:void 0!=c[0]?c[0].y:0,a:void 0!=c[0]?c[0].a:0};for(var a=1;a<c.length;a++){var d=h.library.math.cartesianAngleAdjust(c[a].x,c[a].y,c[a-1].a);b.a+=c[a].a;b.x+=d.x;b.y+=d.y}return b}var d=this,e=new function(){this.length=function(b){return b*d.viewport.scale()};this.windowPoint2coreGraphicsPoint=function(b,c){var a=d.viewport.position(),e=d.viewport.scale()/window.devicePixelRatio,l=d.viewport.angle();b=b/e-a.x;c=c/e-a.y;return h.library.math.cartesianAngleAdjust(b,
c,-l)};this.coreGraphicsPoint2windowPoint=function(b,c){var a=d.viewport.position(),e=d.viewport.scale(),l=d.viewport.angle();b=h.library.math.cartesianAngleAdjust(b,c,l);return{x:(b.x+a.x)*e,y:(b.y+a.y)*e}}},f=new function(){this.polygon=function(){this.type="polygon";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.points=[];this.style={fill:"rgba(100,255,255,1)",stroke:"rgba(0,0,0,0)",lineWidth:1,lineJoin:"round",miterLimit:2};
this.parameter={};this.parameter.points=function(b){return function(c){if(void 0==c)return b.points;b.points=c;b.computeExtremities()}}(this);this.getAddress=function(){var b="",c=this;do b=c.name+"/"+b;while(void 0!=(c=c.parent));return"/"+b};this.computeExtremities=function(b){for(var c=this._static,d=this;void 0!=(d=d.parent)&&!c;)c=c||d._static;this._static=c;b=void 0==b?a(this):b;this.extremities={points:[],boundingBox:{}};this.extremities.points=this.points.map(function(c){c=h.library.math.cartesianAngleAdjust(c.x,
c.y,b.a);c.x+=b.x;c.y+=b.y;return c});this.extremities.boundingBox=h.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(b,c){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var a=!1}else a=h.library.math.detectOverlap.pointWithinBoundingBox({x:b,y:c},this.extremities.boundingBox);return a?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),
b=!1):b=h.library.math.detectOverlap.pointWithinPoly({x:b,y:c},this.extremities.points),b):!1};this.render=function(b,c,a,n){c=void 0===c?{x:0,y:0,a:0}:c;a=void 0===a?!1:a;n=void 0===n?!1:n;var k=this._static?!0:h.library.math.detectOverlap.boundingBoxes(d.viewport.getBoundingBox(),this.extremities.boundingBox);if(k){k=this.points.map(function(b){b=h.library.math.cartesianAngleAdjust(b.x,b.y,c.a);return{x:b.x+c.x,y:b.y+c.y}});var f=this.style.lineWidth;a||(k=k.map(function(b){return e.coreGraphicsPoint2windowPoint(b.x,
b.y)}),f=e.length(f));if(n){n=new Path2D;n.moveTo(k[0].x,k[0].y);for(a=1;a<k.length;a++)n.lineTo(k[a].x,k[a].y);b.clip(n)}else{b.fillStyle=this.style.fill;b.strokeStyle=this.style.stroke;b.lineWidth=f;b.lineJoin=this.style.lineJoin;b.miterLimit=this.style.miterLimit;b.beginPath();b.moveTo(k[0].x,k[0].y);for(a=1;a<k.length;a++)b.lineTo(k[a].x,k[a].y);b.closePath();b.fill();b.stroke();if(this.dotFrame){for(a=0;a<this.extremities.points.length;a++)b=e.coreGraphicsPoint2windowPoint(this.extremities.points[a].x,
this.extremities.points[a].y),d.render.drawDot(b.x,b.y,4,"rgba(50,50,50,1)");b=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);d.render.drawDot(b.x,b.y);b=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);d.render.drawDot(b.x,b.y)}}}}};this.circle=function(){this.type="circle";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities=
{points:[],boundingBox:{}};this.y=this.x=0;this.r=2;this.style={fill:"rgba(255,100,255,1)",stroke:"rgba(0,0,0,0)",lineWidth:1};this.parameter={};this.parameter.x=function(b){return function(c){if(void 0==c)return b.x;b.x=c;b.computeExtremities()}}(this);this.parameter.y=function(b){return function(c){if(void 0==c)return b.y;b.y=c;b.computeExtremities()}}(this);this.parameter.r=function(b){return function(c){if(void 0==c)return b.r;b.r=c;b.computeExtremities()}}(this);this.getAddress=function(){var b=
"",c=this;do b=c.name+"/"+b;while(void 0!=(c=c.parent));return"/"+b};this.computeExtremities=function(b){for(var c=this._static,d=this;void 0!=(d=d.parent)&&!c;)c=c||d._static;this._static=c;b=void 0==b?a(this):b;this.extremities={points:[],boundingBox:{},origin:{}};point=h.library.math.cartesianAngleAdjust(this.x,this.y,b.a);this.extremities.origin={x:this.x+b.x,y:this.y+b.y};this.extremities.points=h.library.math.pointsOfCircle(this.x,this.y,this.r,10);this.extremities.points=this.extremities.points.map(function(c){c=
h.library.math.cartesianAngleAdjust(c.x,c.y,b.a);c.x+=b.x;c.y+=b.y;return c});this.extremities.boundingBox=h.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(b,c){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var a=!1}else a=h.library.math.detectOverlap.pointWithinBoundingBox({x:b,y:c},this.extremities.boundingBox);return a?h.library.math.distanceBetweenTwoPoints({x:b,
y:c},{x:this.x+this.extremities.origin.x,y:this.y+this.extremities.origin.y})<=this.r:!1};this.render=function(b,c,a,n){c=void 0===c?{x:0,y:0,a:0}:c;a=void 0===a?!1:a;n=void 0===n?!1:n;var k=this._static?!0:h.library.math.detectOverlap.boundingBoxes(d.viewport.getBoundingBox(),this.extremities.boundingBox);if(k){k=h.library.math.cartesianAngleAdjust(this.x,this.y,c.a);c.x+=k.x-this.x;c.y+=k.y-this.y;c={x:this.x+c.x,y:this.y+c.y};k=this.r;var f=this.style.lineWidth;a||(c=e.coreGraphicsPoint2windowPoint(c.x,
c.y),k=e.length(k),f=e.length(f));if(n)a=new Path2D,a.arc(c.x,c.y,k,0,2*Math.PI,!1),b.clip(a);else if(b.fillStyle=this.style.fill,b.strokeStyle=this.style.stroke,b.lineWidth=f,b.beginPath(),b.arc(c.x,c.y,k,0,2*Math.PI,!1),b.closePath(),b.fill(),b.stroke(),this.dotFrame){for(b=0;b<this.extremities.points.length;b++)a=e.coreGraphicsPoint2windowPoint(this.extremities.points[b].x,this.extremities.points[b].y),d.render.drawDot(a.x,a.y,4,"rgba(50,50,50,1)");a=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.topLeft.x,
this.extremities.boundingBox.topLeft.y);d.render.drawDot(a.x,a.y);a=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);d.render.drawDot(a.x,a.y);a=e.coreGraphicsPoint2windowPoint(this.extremities.origin.x,this.extremities.origin.y);d.render.drawDot(a.x,a.y)}}}};this.canvas=function(){this.type="canvas";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.angle=
this.y=this.x=0;this.anchor={x:0,y:0};this.height=this.width=10;var b=document.createElement("canvas"),c=1;var k=b.getContext("2d",{alpha:!1});b.setAttribute("width",this.width*c);b.setAttribute("height",this.height*c);this.parameter={};this.parameter.x=function(b){return function(c){if(void 0==c)return b.x;b.x=c;b.computeExtremities()}}(this);this.parameter.y=function(b){return function(c){if(void 0==c)return b.y;b.y=c;b.computeExtremities()}}(this);this.parameter.angle=function(b){return function(c){if(void 0==
c)return b.angle;b.angle=c;b.computeExtremities()}}(this);this.parameter.anchor=function(b){return function(c){if(void 0==c)return b.anchor;b.anchor=c;b.computeExtremities()}}(this);this.parameter.width=function(a){return function(d){if(void 0==d)return a.width;a.width=d;a.computeExtremities();b.setAttribute("width",a.width*c)}}(this);this.parameter.height=function(a){return function(d){if(void 0==d)return a.height;a.height=d;a.computeExtremities();b.setAttribute("height",a.height*c)}}(this);this.resolution=
function(a){if(void 0==a)return c;c=a;b.setAttribute("width",this.width*c);b.setAttribute("height",this.height*c)};this._=k;this.$=function(b){return b*c};this.getAddress=function(){var b="",c=this;do b=c.name+"/"+b;while(void 0!=(c=c.parent));return"/"+b};this.computeExtremities=function(b){for(var c=this._static,d=this;void 0!=(d=d.parent)&&!c;)c=c||d._static;this._static=c;b=void 0==b?a(this):b;this.extremities={points:[],boundingBox:{}};this.extremities.points=h.library.math.pointsOfRect(this.x,
this.y,this.width,this.height,-this.angle,this.anchor);this.extremities.points=this.extremities.points.map(function(c){c=h.library.math.cartesianAngleAdjust(c.x,c.y,b.a);c.x+=b.x;c.y+=b.y;return c});this.extremities.boundingBox=h.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(b,c){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var a=!1}else a=h.library.math.detectOverlap.pointWithinBoundingBox({x:b,
y:c},this.extremities.boundingBox);return a?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),b=!1):b=h.library.math.detectOverlap.pointWithinPoly({x:b,y:c},this.extremities.points),b):!1};this.render=function(c,a,k){a=void 0===a?{x:0,y:0,a:0}:a;k=void 0===k?!1:k;var l=this._static?!0:h.library.math.detectOverlap.boundingBoxes(d.viewport.getBoundingBox(),this.extremities.boundingBox);if(l){l=h.library.math.cartesianAngleAdjust(this.x,this.y,a.a);a.x+=l.x-this.x;a.y+=
l.y-this.y;l={x:this.x+a.x,y:this.y+a.y};a=this.angle+a.a;var f=this.width,n=this.height;k||(l=e.coreGraphicsPoint2windowPoint(l.x-this.anchor.x*f,l.y-this.anchor.y*n),f=e.length(f),n=e.length(n));l=h.library.math.cartesianAngleAdjust(l.x,l.y,-a);c.save();c.rotate(a);c.drawImage(b,l.x,l.y,f,n);c.restore();if(this.dotFrame){for(c=0;c<this.extremities.points.length;c++)k=e.coreGraphicsPoint2windowPoint(this.extremities.points[c].x,this.extremities.points[c].y),d.render.drawDot(k.x,k.y,4,"rgba(50,50,50,1)");
k=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);d.render.drawDot(k.x,k.y);k=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);d.render.drawDot(k.x,k.y)}}}};this.image=function(){this.type="image";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.angle=this.y=this.x=0;this.anchor={x:0,y:0};
this.height=this.width=10;this.url="";var b={};this.parameter={};this.parameter.x=function(b){return function(c){if(void 0==c)return b.x;b.x=c;b.computeExtremities()}}(this);this.parameter.y=function(b){return function(c){if(void 0==c)return b.y;b.y=c;b.computeExtremities()}}(this);this.parameter.angle=function(b){return function(c){if(void 0==c)return b.angle;b.angle=c;b.computeExtremities()}}(this);this.parameter.anchor=function(b){return function(c){if(void 0==c)return b.anchor;b.anchor=c;b.computeExtremities()}}(this);
this.parameter.width=function(b){return function(c){if(void 0==c)return b.width;b.width=c;b.computeExtremities()}}(this);this.parameter.height=function(b){return function(c){if(void 0==c)return b.height;b.height=c;b.computeExtremities()}}(this);this.getAddress=function(){var b="",a=this;do b=a.name+"/"+b;while(void 0!=(a=a.parent));return"/"+b};this.computeExtremities=function(b){for(var c=this._static,d=this;void 0!=(d=d.parent)&&!c;)c=c||d._static;this._static=c;b=void 0==b?a(this):b;this.extremities=
{points:[],boundingBox:{}};this.extremities.points=h.library.math.pointsOfRect(this.x,this.y,this.width,this.height,-this.angle,this.anchor);this.extremities.points=this.extremities.points.map(function(c){c=h.library.math.cartesianAngleAdjust(c.x,c.y,b.a);c.x+=b.x;c.y+=b.y;return c});this.extremities.boundingBox=h.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(b,a){if(void 0==this.extremities.boundingBox){console.warn("the shape",
this,"has no bounding box");var c=!1}else c=h.library.math.detectOverlap.pointWithinBoundingBox({x:b,y:a},this.extremities.boundingBox);return c?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),b=!1):b=h.library.math.detectOverlap.pointWithinPoly({x:b,y:a},this.extremities.points),b):!1};this.render=function(c,a,f){a=void 0===a?{x:0,y:0,a:0}:a;f=void 0===f?!1:f;var k=this._static?!0:h.library.math.detectOverlap.boundingBoxes(d.viewport.getBoundingBox(),this.extremities.boundingBox);
if(k){k=h.library.math.cartesianAngleAdjust(this.x,this.y,a.a);a.x+=k.x-this.x;a.y+=k.y-this.y;k=this.angle+a.a;var g=this.width,n=this.height;a={x:this.x+a.x-this.anchor.x*(this.width*Math.cos(k)+this.height*Math.sin(-k)),y:this.y+a.y-this.anchor.y*(this.width*Math.sin(k)+this.height*Math.cos(-k))};f||(a=e.coreGraphicsPoint2windowPoint(a.x,a.y),g=e.length(g),n=e.length(n));a=h.library.math.cartesianAngleAdjust(a.x,a.y,-k);b.hasOwnProperty(this.url)||(b[this.url]=new Image,b[this.url].src=this.url);
c.save();c.rotate(k);c.drawImage(b[this.url],a.x,a.y,g,n);c.restore();if(this.dotFrame){for(c=0;c<this.extremities.points.length;c++)f=e.coreGraphicsPoint2windowPoint(this.extremities.points[c].x,this.extremities.points[c].y),d.render.drawDot(f.x,f.y,4,"rgba(50,50,50,1)");f=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);d.render.drawDot(f.x,f.y);f=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);
d.render.drawDot(f.x,f.y)}}}};this.path=function(){this.type="path";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.points=[];this.style={stroke:"rgba(0,0,0,0)",lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:2};this.parameter={};this.parameter.points=function(b){return function(a){if(void 0==a)return b.points;b.points=a;b.computeExtremities()}}(this);this.getAddress=function(){var b="",a=this;do b=a.name+"/"+b;
while(void 0!=(a=a.parent));return"/"+b};this.computeExtremities=function(b){for(var c=this._static,d=this;void 0!=(d=d.parent)&&!c;)c=c||d._static;this._static=c;b=void 0==b?a(this):b;this.extremities={points:[],boundingBox:{}};this.extremities.points=this.points.map(function(a){a=h.library.math.cartesianAngleAdjust(a.x,a.y,b.a);a.x+=b.x;a.y+=b.y;return a});this.extremities.boundingBox=h.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};
this.isPointWithin=function(b,a){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var c=!1}else c=h.library.math.detectOverlap.pointWithinBoundingBox({x:b,y:a},this.extremities.boundingBox);return c?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),b=!1):b=h.library.math.detectOverlap.pointWithinPoly({x:b,y:a},this.extremities.points),b):!1};this.render=function(b,a,k){a=void 0===a?{x:0,y:0,a:0}:a;k=void 0===k?!1:k;var c=
this._static?!0:h.library.math.detectOverlap.boundingBoxes(d.viewport.getBoundingBox(),this.extremities.boundingBox);if(c){c=this.points.map(function(b){b=h.library.math.cartesianAngleAdjust(b.x,b.y,a.a);return{x:b.x+a.x,y:b.y+a.y}});var f=this.style.lineWidth;k||(c=c.map(function(b){return e.coreGraphicsPoint2windowPoint(b.x,b.y)}),f=e.length(f));b.fillStyle=this.style.fill;b.strokeStyle=this.style.stroke;b.lineWidth=f;b.lineCap=this.style.lineCap;b.lineJoin=this.style.lineJoin;b.miterLimit=this.style.miterLimit;
b.beginPath();b.moveTo(c[0].x,c[0].y);for(k=1;k<c.length;k++)b.lineTo(c[k].x,c[k].y);b.stroke();if(this.dotFrame){for(k=0;k<this.extremities.points.length;k++)b=e.coreGraphicsPoint2windowPoint(this.extremities.points[k].x,this.extremities.points[k].y),d.render.drawDot(b.x,b.y,4,"rgba(50,50,50,1)");b=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);d.render.drawDot(b.x,b.y);b=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.bottomRight.x,
this.extremities.boundingBox.bottomRight.y);d.render.drawDot(b.x,b.y)}}}};this.rectangle=function(){this.type="rectangle";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.angle=this.y=this.x=0;this.anchor={x:0,y:0};this.height=this.width=10;this.style={fill:"rgba(255,100,255,1)",stroke:"rgba(0,0,0,0)",lineWidth:1};this.parameter={};this.parameter.x=function(b){return function(a){if(void 0==a)return b.x;b.x=a;b.computeExtremities()}}(this);
this.parameter.y=function(b){return function(a){if(void 0==a)return b.y;b.y=a;b.computeExtremities()}}(this);this.parameter.angle=function(b){return function(a){if(void 0==a)return b.angle;b.angle=a;b.computeExtremities()}}(this);this.parameter.anchor=function(b){return function(a){if(void 0==a)return b.anchor;b.anchor=a;b.computeExtremities()}}(this);this.parameter.width=function(b){return function(a){if(void 0==a)return b.width;b.width=a;b.computeExtremities()}}(this);this.parameter.height=function(b){return function(a){if(void 0==
a)return b.height;b.height=a;b.computeExtremities()}}(this);this.getAddress=function(){var b="",a=this;do b=a.name+"/"+b;while(void 0!=(a=a.parent));return"/"+b};this.getOffset=function(){return a(this)};this.computeExtremities=function(b,c){c=this._static;for(var d=this;void 0!=(d=d.parent)&&!c;)c=c||d._static;this._static=c;b=void 0==b?a(this):b;this.extremities={points:[],boundingBox:{}};this.extremities.points=h.library.math.pointsOfRect(this.x,this.y,this.width,this.height,-this.angle,this.anchor);
this.extremities.points=this.extremities.points.map(function(a){a=h.library.math.cartesianAngleAdjust(a.x,a.y,b.a);a.x+=b.x;a.y+=b.y;return a});this.extremities.boundingBox=h.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(b,a){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var c=!1}else c=h.library.math.detectOverlap.pointWithinBoundingBox({x:b,y:a},this.extremities.boundingBox);
return c?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),b=!1):b=h.library.math.detectOverlap.pointWithinPoly({x:b,y:a},this.extremities.points),b):!1};this.render=function(b,a,k,f){a=void 0===a?{x:0,y:0,a:0}:a;k=void 0===k?!1:k;f=void 0===f?!1:f;var c=this._static?!0:h.library.math.detectOverlap.boundingBoxes(d.viewport.getBoundingBox(),this.extremities.boundingBox);if(c){c=h.library.math.cartesianAngleAdjust(this.x,this.y,a.a);a.x+=c.x-this.x;a.y+=c.y-this.y;c=this.angle+
a.a;var g=this.width,n=this.height,m=this.style.lineWidth;a={x:this.x+a.x-this.anchor.x*(this.width*Math.cos(c)+this.height*Math.sin(-c)),y:this.y+a.y-this.anchor.y*(this.width*Math.sin(c)+this.height*Math.cos(-c))};k||(a=e.coreGraphicsPoint2windowPoint(a.x,a.y),g=e.length(g),n=e.length(n),m=e.length(m));a=h.library.math.cartesianAngleAdjust(a.x,a.y,-c);if(f)b.rotate(c),k=new Path2D,k.rect(a.x,a.y,g,n),b.clip(k),b.rotate(-c);else if(b.fillStyle=this.style.fill,b.strokeStyle=this.style.stroke,b.lineWidth=
m,b.save(),b.rotate(c),b.fillRect(a.x,a.y,g,n),b.strokeRect(a.x,a.y,g,n),b.restore(),this.dotFrame){for(b=0;b<this.extremities.points.length;b++)k=e.coreGraphicsPoint2windowPoint(this.extremities.points[b].x,this.extremities.points[b].y),d.render.drawDot(k.x,k.y,4,"rgba(50,50,50,1)");k=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);d.render.drawDot(k.x,k.y);k=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.bottomRight.x,
this.extremities.boundingBox.bottomRight.y);d.render.drawDot(k.x,k.y)}}}};this.group=function(){function b(b,a){if(void 0==a)return b.getAddress()+" >> no element provided";if(void 0==a.name||""==a.name)return b.getAddress()+" >> element has no name";for(var c=0;c<b.children.length;c++)if(b.children[c].name==a.name)return'element with the name "'+a.name+'" already exists in the '+(void 0==parent?"design root":'group "'+b.name+'"')}this.type="group";this.name="";this.clipActive=this._static=this.ignored=
!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.angle=this.y=this.x=0;this.children=[];this.clippingStencil;this.parameter={};this.parameter.x=function(b){return function(a){if(void 0==a)return b.x;b.x=a;b.computeExtremities(void 0,!0)}}(this);this.parameter.y=function(b){return function(a){if(void 0==a)return b.y;b.y=a;b.computeExtremities(void 0,!0)}}(this);this.parameter.angle=function(b){return function(a){if(void 0==a)return b.angle;b.angle=a;b.computeExtremities(void 0,
!0)}}(this);this.getAddress=function(){var b="",a=this;do b=a.name+"/"+b;while(void 0!=(a=a.parent));return"/"+b};this.clip=function(b){if(void 0==b)return this.clipActive;this.clipActive=void 0==this.clippingStencil?!1:b;this.computeExtremities()};this.stencil=function(b){if(void 0==b)return this.clippingStencil;this.clippingStencil=b;this.computeExtremities()};this.prepend=function(a){var c=b(this,a);void 0!=c?console.error("element invalid:",c):(this.children.unshift(a),a.parent=this,a.computeExtremities(void 0,
!0))};this.append=function(a){var c=b(this,a);void 0!=c?console.error("element invalid:",c):(this.children.push(a),a.parent=this,a.computeExtremities(void 0,!0))};this.remove=function(b){void 0!=b&&(b=this.children.indexOf(b),0>b||(this.children.splice(b,1),this.computeExtremities()))};this.clear=function(){this.children=[];this.computeExtremities()};this.contains=function(b){for(var a=0;a<this.children.length;a++)if(this.children[a]==b)return!0;return!1};this.getChildByName=function(b){for(var a=
0;a<this.children.length;a++)if(this.children[a].name==b)return this.children[a]};this.getElementsWithName=function(b){for(var a=[],c=0;c<this.children.length;c++)if(this.children[c].name==b&&a.push(this.children[c]),"group"==this.children[c].type)for(var d=this.children[c].getElementsWithName(b),e=0;e<d.length;e++)a.push(d[e]);return a};this.getOffset=function(){return a(this)};this.computeExtremities=function(b,d){d=void 0===d?!1:d;for(var c=void 0==b,e=this._static,f=this;void 0!=(f=f.parent)&&
!e;)e=e||f._static;this._static=e;b=void 0==b?a(this):b;if(d)for(d={x:b.x,y:b.y,a:b.a+this.angle},e=h.library.math.cartesianAngleAdjust(this.x,this.y,b.a),d.x+=e.x,d.y+=e.y,e=0;e<this.children.length;e++)this.children[e].computeExtremities(d,!0);this.extremities={points:[],boundingBox:{}};if(this.clipActive)d={x:b.x,y:b.y,a:b.a+this.angle},e=h.library.math.cartesianAngleAdjust(this.x,this.y,b.a),d.x+=e.x,d.y+=e.y,this.clippingStencil.computeExtremities(d),this.extremities.points=this.clippingStencil.extremities.points;
else{b=[];for(e=0;e<this.children.length;e++)b.push(this.children[e].extremities.boundingBox.topLeft),b.push(this.children[e].extremities.boundingBox.bottomRight);b=h.library.math.boundingBoxFromPoints(b);this.extremities.points=[{x:b.topLeft.x,y:b.topLeft.y},{x:b.bottomRight.x,y:b.topLeft.y},{x:b.bottomRight.x,y:b.bottomRight.y},{x:b.topLeft.x,y:b.bottomRight.y}]}this.extremities.boundingBox=h.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&c&&this.parent.computeExtremities()};
this.isPointWithin=function(b,a){if(this.clipActive)return this.clippingStencil.isPointWithin(b,a);if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var c=!1}else c=h.library.math.detectOverlap.pointWithinBoundingBox({x:b,y:a},this.extremities.boundingBox);return c?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),b=!1):b=h.library.math.detectOverlap.pointWithinPoly({x:b,y:a},this.extremities.points),b):!1};this.getElementUnderPoint=
function(b,a,d,f){d=void 0===d?!1:d;f=void 0===f?!1:f;for(var c=[],h=this.children.length-1;0<=h;h--){var k=this.children[h]._static||d?e.coreGraphicsPoint2windowPoint(b,a):{x:b,y:a};if(!this.children[h].ignored&&this.children[h].isPointWithin(k.x,k.y))if("group"==this.children[h].type){if(k=this.children[h].getElementUnderPoint(b,a,this.children[h]._static||d,f),void 0!=k)if(f)c=c.concat(k);else return k}else if(f)c.push(this.children[h]);else return this.children[h]}if(f)return c};this.render=function(b,
a,f,g){a=void 0===a?{x:0,y:0,a:0}:a;f=void 0===f?!1:f;g=void 0===g?!1:g;a:if(this._static)var c=!0;else{for(c=0;c<this.children.length;c++)if(this.children[c]._static){c=!0;break a}c=h.library.math.detectOverlap.boundingBoxes(d.viewport.getBoundingBox(),this.extremities.boundingBox)}if(c){c=h.library.math.cartesianAngleAdjust(this.x,this.y,a.a);a={a:a.a+this.angle,x:a.x+c.x,y:a.y+c.y};if(this.clipActive||g)b.save(),this.clippingStencil.render(b,Object.assign({},a),f||this.clippingStencil._static,
g||this.clipActive);for(g=0;g<this.children.length;g++)c=this.children[g],c.render(b,Object.assign({},a),f||c._static);this.clipActive&&b.restore();if(this.dotFrame){for(g=0;g<this.extremities.points.length;g++)b=e.coreGraphicsPoint2windowPoint(this.extremities.points[g].x,this.extremities.points[g].y),d.render.drawDot(b.x,b.y,4,"rgba(50,50,50,1)");b=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);d.render.drawDot(b.x,b.y);b=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.bottomRight.x,
this.extremities.boundingBox.bottomRight.y);d.render.drawDot(b.x,b.y)}}}};this.text=function(){this.type="text";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.y=this.x=0;this.text="curve";this.angle=0;this.size=1;this.style={font:"30pt Arial",align:"start",baseline:"alphabetic",fill:"rgba(255,100,100,1)",stroke:"rgba(0,0,0,0)",lineWidth:1};this.parameter={};this.parameter.x=function(b){return function(a){if(void 0==a)return b.x;
b.x=a;b.computeExtremities()}}(this);this.parameter.y=function(b){return function(a){if(void 0==a)return b.y;b.y=a;b.computeExtremities()}}(this);this.parameter.angle=function(b){return function(a){if(void 0==a)return b.angle;b.angle=a;b.computeExtremities()}}(this);this.parameter.size=function(b){return function(a){if(void 0==a)return b.size;b.size=a;b.computeExtremities()}}(this);this.getAddress=function(){var b="",a=this;do b=a.name+"/"+b;while(void 0!=(a=a.parent));return"/"+b};this.computeExtremities=
function(b){for(var c=this._static,d=this;void 0!=(d=d.parent)&&!c;)c=c||d._static;this._static=c;b=void 0==b?a(this):b;this.extremities={points:[],boundingBox:{}};this.extremities.points=h.library.math.pointsOfText(this.text,this.x,this.y,this.angle,1/this.size,this.style.font,this.style.align,this.style.baseline);this.extremities.points=this.extremities.points.map(function(a){a=h.library.math.cartesianAngleAdjust(a.x,a.y,b.a);a.x+=b.x;a.y+=b.y;return a});this.extremities.boundingBox=h.library.math.boundingBoxFromPoints(this.extremities.points);
void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(b,a){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var c=!1}else c=h.library.math.detectOverlap.pointWithinBoundingBox({x:b,y:a},this.extremities.boundingBox);return c?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),b=!1):b=h.library.math.detectOverlap.pointWithinPoly({x:b,y:a},this.extremities.points),b):!1};this.render=function(b,a,f,
g){a=void 0===a?{x:0,y:0,a:0}:a;f=void 0===f?!1:f;g=void 0===g?!1:g;var c=h.library.math.cartesianAngleAdjust(this.x,this.y,a.a);a.x+=c.x-this.x;a.y+=c.y-this.y;c={x:this.x+a.x,y:this.y+a.y};var k=this.size;a=this.angle+a.a;var n=this.style.lineWidth;f||(c=e.coreGraphicsPoint2windowPoint(c.x,c.y),k=e.length(k));c=h.library.math.cartesianAngleAdjust(c.x,c.y,-a);if(g)console.warn("no clipping available for text shape");else if(b.font=this.style.font,b.textAlign=this.style.align,b.textBaseline=this.style.baseline,
b.fillStyle=this.style.fill,b.strokeStyle=this.style.stroke,b.lineWidth=n,b.save(),b.rotate(a),b.scale(k,k),b.fillText(this.text,c.x/k,c.y/k),b.strokeText(this.text,c.x/k,c.y/k),b.restore(),this.dotFrame){for(b=0;b<this.extremities.points.length;b++)f=e.coreGraphicsPoint2windowPoint(this.extremities.points[b].x,this.extremities.points[b].y),d.render.drawDot(f.x,f.y,4,"rgba(50,50,50,1)");f=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);
d.render.drawDot(f.x,f.y);f=e.coreGraphicsPoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);d.render.drawDot(f.x,f.y)}}}};this.arrangement=new function(){var b=new f.group;b.name="root";this.createElement=function(b){return new f[b]};this.clear=function(){b.clear()};this.get=function(){return b};this.set=function(a){b=a};this.prepend=function(a){b.prepend(a)};this.append=function(a){b.append(a)};this.remove=function(a){b.remove(a)};this.getElementUnderPoint=
function(a,d,e,f){return b.getElementUnderPoint(a,d,void 0===e?!1:e,void 0===f?!1:f)};this.getElementsWithName=function(a){return b.getElementsWithName(a)}};this.viewport=new function(){function a(){function a(a){var d=a.charAt(0).toUpperCase()+a.slice(1),c=h.getAttribute("coreGraphics"+d);if(f[a]!=c||f["window"+d]!=window["inner"+d])f[a]=c,f["window"+d]=window["inner"+d],void 0==c?(h[a]=f.defaultSize[a]*window.devicePixelRatio,h.style[a]=f.defaultSize[a]+"px"):c.indexOf("%")==c.length-1?(d=h.parentElement["offset"+
d],c=parseFloat(c.slice(0,c.length-1))/100,h[a]=d*c*window.devicePixelRatio,h.style[a]=d*c+"px"):(h[a]=c*window.devicePixelRatio,h.style[a]=c+"px"),b=!0}var b=!1;a("height");a("width");b&&d()}function d(){g.points.tl=e.windowPoint2coreGraphicsPoint(0,0);g.points.tr=e.windowPoint2coreGraphicsPoint(h.width,0);g.points.bl=e.windowPoint2coreGraphicsPoint(0,h.height);g.points.br=e.windowPoint2coreGraphicsPoint(h.width,h.height);g.boundingBox=h.library.math.boundingBoxFromPoints([g.points.tl,g.points.tr,
g.points.br,g.points.bl])}var f={defaultSize:{width:640,height:480},width:0,height:0,windowWidth:0,windowHeight:0},g={position:{x:0,y:0},scale:window.devicePixelRatio,angle:0,points:{tl:{x:0,y:0},tr:{x:0,y:0},bl:{x:0,y:0},br:{x:0,y:0}},boundingBox:{topLeft:{x:0,y:0},bottomRight:{x:0,y:0}}},l=void 0,m=void 0,q=!1,w=!0;this.position=function(a,b){if(void 0==a||void 0==b)return{x:g.position.x,y:g.position.y};g.position.x=a;g.position.y=b;d()};this.scale=function(a){if(void 0==a)return g.scale;g.scale=
0==a?window.devicePixelRatio:a;d()};this.angle=function(a){if(void 0==a)return g.angle;g.angle=a;d()};this.windowPoint2coreGraphicsPoint=function(a,b){return e.windowPoint2coreGraphicsPoint(a,b)};this.refresh=function(){a();d();this.allowKeyboardInput(w)};this.getBoundingBox=function(){return g.boundingBox};this.mousePosition=function(a,b){if(void 0==a||void 0==b)return{x:l,y:m};l=a;m=b};this.stopMouseScroll=function(a){if(void 0==a)return q;q=a;a||(document.body.style.overflow="")};this.allowKeyboardInput=
function(a){if(void 0==a)return w;(w=a)?h.setAttribute("tabIndex",1):h.removeAttribute("tabIndex")};this.cursor=function(a){if(void 0==a)return document.body.style.cursor;document.body.style.cursor=a}};this.render=new function(){function a(a){void 0!==a&&a||(e.fillStyle="rgb(255,255,255)",e.fillRect(0,0,h.width,h.height));d.arrangement.get().render(e)}function c(b){f=requestAnimationFrame(c);try{a()}catch(v){d.render.active(!1),console.error("major animation error"),console.error(v)}d.stats.collect(b)}
var e=h.getContext("2d",{alpha:!1}),f=void 0;this.drawDot=function(a,b,d,c){d=void 0===d?2:d;e.fillStyle=void 0===c?"rgba(150,150,255,1)":c;e.beginPath();e.arc(a,b,d,0,2*Math.PI,!1);e.closePath();e.fill()};this.frame=function(b){a(void 0===b?!1:b)};this.active=function(a){if(void 0==a)return void 0!=f;a?void 0==f&&c():void 0!=f&&(cancelAnimationFrame(f),f=void 0)}};this.stats=new function(){var a=!1,d=0,e={compute:function(a){this.frameTimeArray.push(1E3/(a-d));30<=this.frameTimeArray.length&&this.frameTimeArray.shift();
this.rate=h.library.math.averageArray(this.frameTimeArray);d=a},counter:0,frameTimeArray:[],rate:0},f={recursiveCount:function(a){void 0==a&&(this.counts={total:0,canvas:0,circle:0,group:0,image:0,path:0,polygon:0,rectangle:0,text:0},a=h.core.arrangement.get());this.counts.total++;switch(a.type){case "canvas":this.counts.canvas++;break;case "circle":this.counts.circle++;break;case "group":this.counts.group++;break;case "image":this.counts.image++;break;case "path":this.counts.path++;break;case "polygon":this.counts.polygon++;
break;case "rectangle":this.counts.rectangle++;break;case "text":this.counts.text++}if(void 0!=a.children)for(var b=0;b<a.children.length;b++)this.recursiveCount(a.children[b])},recursivePrint:function(a,b){b=void 0===b?"":b;void 0==a&&(a=h.core.arrangement.get());console.log(b+a.name);if(void 0!=a.children)for(var d=0;d<a.children.length;d++)this.recursivePrint(a.children[d],b+"- ")},counts:{total:0,canvas:0,circle:0,group:0,image:0,path:0,polygon:0,rectangle:0,text:0}};this.collect=function(b){a&&
e.compute(b)};this.active=function(b){if(void 0==b)return a;a=b};this.getReport=function(){f.recursiveCount();return{framesPerSecond:e.rate,shapeCount:f.counts}}};this.callback=new function(){for(var a="onmousedown onmouseup onmousemove onmouseenter onmouseleave onwheel onclick ondblclick onkeydown onkeyup touchstart touchmove touchend touchenter touchleave touchcancel".split(" "),c={},f=0;f<a.length;c={$jscomp$loop$prop$getRelevantShape$7:c.$jscomp$loop$prop$getRelevantShape$7},f++){c.$jscomp$loop$prop$getRelevantShape$7=
function(a,b,c){var e=d.arrangement.getElementUnderPoint(a,b);if(void 0!=e&&void 0==e[c])for(a=d.arrangement.getElementUnderPoint(a,b,void 0,!0),b=0;b<a.length;b++)if(void 0!=a[b][c]){e=a[b];break}return e};this[a[f]]=function(a,b,d){};var g=0,l=0;h[a[f]]=function(a){return function(b){return function(c){if(d.callback[b]){var f=e.windowPoint2coreGraphicsPoint(c.x,c.y),g=a.$jscomp$loop$prop$getRelevantShape$7(f.x,f.y,b);d.callback[b](f.x,f.y,c,g)}}}}(c)(a[f]);h.onmouseover=function(a){return function(b){d.viewport.stopMouseScroll()&&
(document.body.style.overflow="hidden");if(d.callback.onmouseover){var c=e.windowPoint2coreGraphicsPoint(b.x,b.y),f=a.$jscomp$loop$prop$getRelevantShape$7(c.x,c.y,"onmouseover");d.callback.onmouseover(c.x,c.y,b,f)}}}(c);h.onmouseout=function(a){return function(b){d.viewport.stopMouseScroll()&&(document.body.style.overflow="");if(d.callback.onmouseout){var c=e.windowPoint2coreGraphicsPoint(b.x,b.y),f=a.$jscomp$loop$prop$getRelevantShape$7(c.x,c.y,"onmouseout");d.callback.onmouseout(c.x,c.y,b,f)}}}(c);
h.onmousemove=function(a){return function(b){var c=e.windowPoint2coreGraphicsPoint(b.x,b.y);d.viewport.mousePosition(c.x,c.y);if(d.callback.onmousemove){var f=a.$jscomp$loop$prop$getRelevantShape$7(g,l,"onmouseleave"),h=a.$jscomp$loop$prop$getRelevantShape$7(c.x,c.y,"onmouseenter"),k=a.$jscomp$loop$prop$getRelevantShape$7(c.x,c.y,"onmousemove");f!=h&&(d.callback.onmouseleave(c.x,c.y,b,f),d.callback.onmouseenter(c.x,c.y,b,h));d.callback.onmousemove(c.x,c.y,b,k);g=c.x;l=c.y}}}(c);h.onkeydown=function(a){return function(b){if(d.callback.onkeydown){var c=
d.viewport.mousePosition(),e=a.$jscomp$loop$prop$getRelevantShape$7(c.x,c.y,"onkeydown");d.callback.onkeydown(c.x,c.y,b,e)}}}(c);h.onkeyup=function(a){return function(b){if(d.callback.onkeyup){var c=d.viewport.mousePosition(),e=a.$jscomp$loop$prop$getRelevantShape$7(c.x,c.y,"onkeyup");d.callback.onkeyup(c.x,c.y,b,e)}}}(c)}};d.viewport.refresh();d.arrangement.clear()};this.arrangement=new function(){this.get=function(){return g.arrangement.get()};this.set=function(a){return g.arrangement.set(a)};this.createElement=
function(a){return g.arrangement.createElement(a)};this.append=function(a){return g.arrangement.append(a)};this.prepend=function(a){return g.arrangement.prepend(a)};this.remove=function(a){return g.arrangement.remove(a)};this.getElementUnderPoint=function(a,d){return g.arrangement.getElementUnderPoint(a,d)};this.getElementsWithName=function(a){return g.arrangement.getElementsWithName(a)};this.forceRefresh=function(a){return g.arrangement.forceRefresh(a)}};this.viewport=new function(){this.position=
function(a,d){return g.viewport.position(a,d)};this.scale=function(a){return g.viewport.scale(a)};this.angle=function(a){return g.viewport.angle(a)};this.windowPoint2coreGraphicsPoint=function(a,d){return g.viewport.windowPoint2coreGraphicsPoint(a,d)};this.refresh=function(){g.viewport.refresh()};this.mousePosition=function(){return g.viewport.mousePosition()};this.stopMouseScroll=function(a){return g.viewport.stopMouseScroll(a)};this.allowKeyboardInput=function(a){return g.viewport.allowKeyboardInput(a)};
this.cursor=function(a){return g.viewport.cursor(a)}};this.render=new function(){this.frame=function(a){return g.render.frame(void 0===a?!1:a)};this.active=function(a){return g.render.active(a)}};this.stats=new function(){this.active=function(a){return g.stats.active(a)};this.getReport=function(){return g.stats.getReport()}};this.callback=new function(){this.onmousedown=function(a,d,e,f){};g.callback.onmousedown=function(a){return function(d,e,f,b){a.onmousedown(d,e,f,b)}}(this);this.onmouseup=function(a,
d,e,f){};g.callback.onmouseup=function(a){return function(d,e,f,b){a.onmouseup(d,e,f,b)}}(this);this.onmousemove=function(a,d,e,f){};g.callback.onmousemove=function(a){return function(d,e,f,b){a.onmousemove(d,e,f,b)}}(this);this.onmouseenter=function(a,d,e,f){};g.callback.onmouseenter=function(a){return function(d,e,f,b){a.onmouseenter(d,e,f,b)}}(this);this.onmouseleave=function(a,d,e,f){};g.callback.onmouseleave=function(a){return function(d,e,f,b){a.onmouseleave(d,e,f,b)}}(this);this.onwheel=function(a,
d,e,f){};g.callback.onwheel=function(a){return function(d,e,f,b){a.onwheel(d,e,f,b)}}(this);this.onclick=function(a,d,e,f){};g.callback.onclick=function(a){return function(d,e,f,b){a.onclick(d,e,f,b)}}(this);this.ondblclick=function(a,d,e,f){};g.callback.ondblclick=function(a){return function(d,e,f,b){a.ondblclick(d,e,f,b)}}(this);this.onkeydown=function(a,d,e,f){};g.callback.onkeydown=function(a){return function(d,e,f,b){a.onkeydown(d,e,f,b)}}(this);this.onkeyup=function(a,d,e,f){};g.callback.onkeyup=
function(a){return function(d,e,f,b){a.onkeyup(d,e,f,b)}}(this);this.touchstart=function(a,d,e){};g.callback.touchstart=function(a){return function(d,e,f,b){a.touchstart(d,e,f)}}(this);this.touchmove=function(a,d,e){};g.callback.touchmove=function(a){return function(d,e,f,b){a.touchmove(d,e,f)}}(this);this.touchend=function(a,d,e){};g.callback.touchend=function(a){return function(d,e,f,b){a.touchend(d,e,f)}}(this);this.touchenter=function(a,d,e){};g.callback.touchenter=function(a){return function(d,
e,f,b){a.touchenter(d,e,f)}}(this);this.touchleave=function(a,d,e){};g.callback.touchleave=function(a){return function(d,e,f,b){a.touchleave(d,e,f)}}(this);this.touchcancel=function(a,d,e){};g.callback.touchcancel=function(a){return function(d,e,f,b){a.touchcancel(d,e,f)}}(this)}}}})();
