var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(z){var H=0;return function(){return H<z.length?{done:!1,value:z[H++]}:{done:!0}}};$jscomp.arrayIterator=function(z){return{next:$jscomp.arrayIteratorImpl(z)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(z,H,f){z!=Array.prototype&&z!=Object.prototype&&(z[H]=f.value)};$jscomp.getGlobal=function(z){return"undefined"!=typeof window&&window===z?z:"undefined"!=typeof global&&null!=global?global:z};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.Symbol=function(){var z=0;return function(H){return $jscomp.SYMBOL_PREFIX+(H||"")+z++}}();$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var z=$jscomp.global.Symbol.iterator;z||(z=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[z]&&$jscomp.defineProperty(Array.prototype,z,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var z=$jscomp.global.Symbol.asyncIterator;z||(z=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(z){$jscomp.initSymbolIterator();z={next:z};z[$jscomp.global.Symbol.iterator]=function(){return this};return z};
$jscomp.iteratorFromArray=function(z,H){$jscomp.initSymbolIterator();z instanceof String&&(z+="");var f=0,r={next:function(){if(f<z.length){var d=f++;return{value:H(d,z[d]),done:!1}}r.next=function(){return{done:!0,value:void 0}};return r.next()}};r[Symbol.iterator]=function(){return r};return r};
$jscomp.polyfill=function(z,H,f,r){if(H){f=$jscomp.global;z=z.split(".");for(r=0;r<z.length-1;r++){var d=z[r];d in f||(f[d]={});f=f[d]}z=z[z.length-1];r=f[z];H=H(r);H!=r&&null!=H&&$jscomp.defineProperty(f,z,{configurable:!0,writable:!0,value:H})}};$jscomp.polyfill("Array.prototype.keys",function(z){return z?z:function(){return $jscomp.iteratorFromArray(this,function(z){return z})}},"es6","es3");
$jscomp.polyfill("Array.from",function(z){return z?z:function(z,f,r){f=null!=f?f:function(a){return a};var d=[],c="undefined"!=typeof Symbol&&Symbol.iterator&&z[Symbol.iterator];if("function"==typeof c){z=c.call(z);for(var g=0;!(c=z.next()).done;)d.push(f.call(r,c.value,g++))}else for(c=z.length,g=0;g<c;g++)d.push(f.call(r,z[g],g));return d}},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var z={},H=Object.create(new $jscomp.global.Proxy(z,{get:function(f,r,d){return f==z&&"q"==r&&d==H}}));return!0===H.q}catch(f){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.makeIterator=function(z){var H="undefined"!=typeof Symbol&&Symbol.iterator&&z[Symbol.iterator];return H?H.call(z):$jscomp.arrayIterator(z)};
$jscomp.owns=function(z,H){return Object.prototype.hasOwnProperty.call(z,H)};
$jscomp.polyfill("WeakMap",function(z){function H(){if(!z||!Object.seal)return!1;try{var a=Object.seal({}),e=Object.seal({}),c=new z([[a,2],[e,3]]);if(2!=c.get(a)||3!=c.get(e))return!1;c.delete(a);c.set(e,4);return!c.has(a)&&4==c.get(e)}catch(k){return!1}}function f(){}function r(a){if(!$jscomp.owns(a,c)){var b=new f;$jscomp.defineProperty(a,c,{value:b})}}function d(a){var b=Object[a];b&&(Object[a]=function(a){if(a instanceof f)return a;r(a);return b(a)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(z&&
$jscomp.ES6_CONFORMANCE)return z}else if(H())return z;var c="$jscomp_hidden_"+Math.random();d("freeze");d("preventExtensions");d("seal");var g=0,a=function(a){this.id_=(g+=Math.random()+1).toString();if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};a.prototype.set=function(a,e){r(a);if(!$jscomp.owns(a,c))throw Error("WeakMap key fail: "+a);a[c][this.id_]=e;return this};a.prototype.get=function(a){return $jscomp.owns(a,c)?a[c][this.id_]:void 0};a.prototype.has=
function(a){return $jscomp.owns(a,c)&&$jscomp.owns(a[c],this.id_)};a.prototype.delete=function(a){return $jscomp.owns(a,c)&&$jscomp.owns(a[c],this.id_)?delete a[c][this.id_]:!1};return a},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(z){function H(){if($jscomp.ASSUME_NO_NATIVE_MAP||!z||"function"!=typeof z||!z.prototype.entries||"function"!=typeof Object.seal)return!1;try{var a=Object.seal({x:4}),e=new z($jscomp.makeIterator([[a,"s"]]));if("s"!=e.get(a)||1!=e.size||e.get({x:4})||e.set({x:4},"t")!=e||2!=e.size)return!1;var c=e.entries(),d=c.next();if(d.done||d.value[0]!=a||"s"!=d.value[1])return!1;d=c.next();return d.done||4!=d.value[0].x||"t"!=d.value[1]||!c.next().done?!1:!0}catch(p){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(z&&$jscomp.ES6_CONFORMANCE)return z}else if(H())return z;$jscomp.initSymbolIterator();var f=new WeakMap,r=function(a){this.data_={};this.head_=g();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};r.prototype.set=function(a,e){a=0===a?0:a;var b=d(this,a);b.list||(b.list=this.data_[b.id]=[]);b.entry?b.entry.value=e:(b.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,
value:e},b.list.push(b.entry),this.head_.previous.next=b.entry,this.head_.previous=b.entry,this.size++);return this};r.prototype.delete=function(a){a=d(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};r.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=g();this.size=0};r.prototype.has=function(a){return!!d(this,a).entry};
r.prototype.get=function(a){return(a=d(this,a).entry)&&a.value};r.prototype.entries=function(){return c(this,function(a){return[a.key,a.value]})};r.prototype.keys=function(){return c(this,function(a){return a.key})};r.prototype.values=function(){return c(this,function(a){return a.value})};r.prototype.forEach=function(a,e){for(var b=this.entries(),c;!(c=b.next()).done;)c=c.value,a.call(e,c[1],c[0],this)};r.prototype[Symbol.iterator]=r.prototype.entries;var d=function(b,e){var c=e&&typeof e;"object"==
c||"function"==c?f.has(e)?c=f.get(e):(c=""+ ++a,f.set(e,c)):c="p_"+e;var d=b.data_[c];if(d&&$jscomp.owns(b.data_,c))for(b=0;b<d.length;b++){var g=d[b];if(e!==e&&g.key!==g.key||e===g.key)return{id:c,list:d,index:b,entry:g}}return{id:c,list:d,index:-1,entry:void 0}},c=function(a,e){var b=a.head_;return $jscomp.iteratorPrototype(function(){if(b){for(;b.head!=a.head_;)b=b.previous;for(;b.next!=b.head;)return b=b.next,{done:!1,value:e(b)};b=null}return{done:!0,value:void 0}})},g=function(){var a={};return a.previous=
a.next=a.head=a},a=0;return r},"es6","es3");
$jscomp.polyfill("Set",function(z){function H(){if($jscomp.ASSUME_NO_NATIVE_SET||!z||"function"!=typeof z||!z.prototype.entries||"function"!=typeof Object.seal)return!1;try{var f=Object.seal({x:4}),d=new z($jscomp.makeIterator([f]));if(!d.has(f)||1!=d.size||d.add(f)!=d||1!=d.size||d.add({x:4})!=d||2!=d.size)return!1;var c=d.entries(),g=c.next();if(g.done||g.value[0]!=f||g.value[1]!=f)return!1;g=c.next();return g.done||g.value[0]==f||4!=g.value[0].x||g.value[1]!=g.value[0]?!1:c.next().done}catch(a){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(z&&$jscomp.ES6_CONFORMANCE)return z}else if(H())return z;$jscomp.initSymbolIterator();var f=function(f){this.map_=new Map;if(f){f=$jscomp.makeIterator(f);for(var d;!(d=f.next()).done;)this.add(d.value)}this.size=this.map_.size};f.prototype.add=function(f){f=0===f?0:f;this.map_.set(f,f);this.size=this.map_.size;return this};f.prototype.delete=function(f){f=this.map_.delete(f);this.size=this.map_.size;return f};f.prototype.clear=function(){this.map_.clear();
this.size=0};f.prototype.has=function(f){return this.map_.has(f)};f.prototype.entries=function(){return this.map_.entries()};f.prototype.values=function(){return this.map_.values()};f.prototype.keys=f.prototype.values;f.prototype[Symbol.iterator]=f.prototype.values;f.prototype.forEach=function(f,d){var c=this;this.map_.forEach(function(g){return f.call(d,g,g,c)})};return f},"es6","es3");
$jscomp.polyfill("Object.entries",function(z){return z?z:function(z){var f=[],r;for(r in z)$jscomp.owns(z,r)&&f.push([r,z[r]]);return f}},"es8","es3");$jscomp.polyfill("Array.prototype.fill",function(z){return z?z:function(z,f,r){var d=this.length||0;0>f&&(f=Math.max(0,d+f));if(null==r||r>d)r=d;r=Number(r);0>r&&(r=Math.max(0,d+r));for(f=Number(f||0);f<r;f++)this[f]=z;return this}},"es6","es3");
$jscomp.assign="function"==typeof Object.assign?Object.assign:function(z,H){for(var f=1;f<arguments.length;f++){var r=arguments[f];if(r)for(var d in r)$jscomp.owns(r,d)&&(z[d]=r[d])}return z};$jscomp.polyfill("Object.assign",function(z){return z||$jscomp.assign},"es6","es3");$jscomp.polyfill("Math.sign",function(z){return z?z:function(z){z=Number(z);return 0===z||isNaN(z)?z:0<z?1:-1}},"es6","es3");
$jscomp.polyfill("Object.is",function(z){return z?z:function(z,f){return z===f?0!==z||1/z===1/f:z!==z&&f!==f}},"es6","es3");$jscomp.polyfill("Array.prototype.includes",function(z){return z?z:function(z,f){var r=this;r instanceof String&&(r=String(r));var d=r.length;f=f||0;for(0>f&&(f=Math.max(f+d,0));f<d;f++){var c=r[f];if(c===z||Object.is(c,z))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(z,H,f){if(null==z)throw new TypeError("The 'this' value for String.prototype."+f+" must not be null or undefined");if(H instanceof RegExp)throw new TypeError("First argument to String.prototype."+f+" must not be a regular expression");return z+""};$jscomp.polyfill("String.prototype.includes",function(z){return z?z:function(z,f){return-1!==$jscomp.checkStringArgs(this,z,"includes").indexOf(z,f||0)}},"es6","es3");
$jscomp.polyfill("Array.prototype.values",function(z){return z?z:function(){return $jscomp.iteratorFromArray(this,function(z,f){return f})}},"es8","es3");
(function(){for(var z=document.getElementsByTagName("canvas"),H=0;H<z.length;H++)if(z[H].hasAttribute("workspace")){var f=z[H];f.library=new function(){var f=this;this.math=new function(){this.averageArray=function(d){return d.reduce(function(c,d){return c+d},0)/d.length};this.distanceBetweenTwoPoints=function(d,c){return Math.pow(Math.pow(d.x-c.x,2)+Math.pow(d.y-c.y,2),.5)};this.seconds2time=function(d){var c={h:0,m:0,s:0};c.h=Math.floor(d/3600);d-=3600*c.h;c.m=Math.floor(d/60);d-=60*c.m;c.s=d;return c};
this.largestValueFound=function(d){return d.reduce(function(c,d){return Math.abs(c)>Math.abs(d)?c:d})};this.smallestValueFound=function(d){return d.reduce(function(c,d){return Math.abs(c)<Math.abs(d)?c:d})};this.cartesian2polar=function(d,c){return{dis:Math.pow(Math.pow(d,2)+Math.pow(c,2),.5),ang:0===d?0===c?0:0<c?.5*Math.PI:1.5*Math.PI:0===c?0<=d?0:Math.PI:0<=d?Math.atan(c/d):Math.atan(c/d)+Math.PI}};this.polar2cartesian=function(d,c){return{x:c*Math.cos(d),y:c*Math.sin(d)}};this.cartesianAngleAdjust=
function(d,c,g){d=this.cartesian2polar(d,c);d.ang+=g;return this.polar2cartesian(d.ang,d.dis)};this.boundingBoxFromPoints=function(d){if(0==d.length)return{topLeft:{x:0,y:0},bottomRight:{x:0,y:0}};for(var c=d[0].x,g=d[0].x,a=d[0].y,b=d[0].y,e=1;e<d.length;e++)d[e].x<c?c=d[e].x:d[e].x>g&&(g=d[e].x),d[e].y<a?a=d[e].y:d[e].y>b&&(b=d[e].y);return{topLeft:{x:c,y:a},bottomRight:{x:g,y:b}}};this.pointsOfRect=function(d,c,g,a,b,e){b=void 0===b?0:b;e=void 0===e?{x:0,y:0}:e;var h=e.x*g,k=e.y*a,f=this.cartesian2polar(h,
k);f=this.polar2cartesian(f.ang-b,f.dis);e={x:d-f.x,y:c-f.y};f=this.cartesian2polar(h-g,k);f=this.polar2cartesian(f.ang-b,f.dis);var t={x:d-f.x,y:c-f.y};f=this.cartesian2polar(h-g,k-a);f=this.polar2cartesian(f.ang-b,f.dis);g={x:d-f.x,y:c-f.y};f=this.cartesian2polar(h,k-a);f=this.polar2cartesian(f.ang-b,f.dis);return[e,t,g,{x:d-f.x,y:c-f.y}]};this.pointsOfCircle=function(d,c,g,a){a=void 0===a?3:a;for(var b=[],e=0;e<a;e++)b.push({x:d+g*Math.sin(e/a*Math.PI*2),y:c+g*Math.cos(e/a*Math.PI*2)});return b};
this.pointsOfText=function(d,c,g,a,b,e,h,k){var f=document.createElement("canvas").getContext("2d");f.font=e;f.textAlign=h;f.textBaseline=k;d=f.measureText(d).width/b;e=-e.split("pt")[0].split(" ").pop();isNaN(e)&&(e=-7.5);e/=b;b=[{x:c,y:g},{x:c+d,y:g},{x:c+d,y:g-e},{x:c,y:g-e}];d={start:0,end:0,center:d/2,left:d,right:d};e={alphabetic:e,top:0,hanging:0,middle:e/2,ideographic:0,bottom:e};for(f=0;f<b.length;f++)b[f]={x:b[f].x-d[h],y:b[f].y+e[k]};for(f=0;f<b.length;f++)b[f]=this.cartesianAngleAdjust(b[f].x-
c,b[f].y-g,a),b[f].x+=c,b[f].y+=g;return b};this.relativeDistance=function(d,c,g,a,b){c=(a-c)/(g-c);if(void 0===b||!b){if(1<c)return d;if(0>c)return 0}return c*d};this.lineCorrecter=function(d,c,g){if(!(0>d.x1||0>d.x2||d.x1>g||d.x2>g||0>d.y1&&0>d.y2||d.y1>c&&d.y2>c))return g=(d.y2-d.y1)/(d.x2-d.x1),0>d.y1?(d.x1=(0-d.y1+g*d.x1)/g,d.y1=0):0>d.y2&&(d.x2=(0-d.y2+g*d.x2)/g,d.y2=0),d.y1>c?(d.x1=(c-d.y1+g*d.x1)/g,d.y1=c):d.y2>c&&(d.x2=(c-d.y2+g*d.x2)/g,d.y2=c),d};this.normalizeStretchArray=function(d){var c=
d.reduce(function(a,e,c,d){return e>d[a]?c:a},0),g=Math.abs(d[c]);d=d.map(function(a){return a/g});if(0==d[0]&&1==d[d.length-1])return d;var a=0!=d[0]?d[0]:d[d.length-1];return d=d.map(function(b){return(b-a)/(1-a)})};this.curvePoint=new function(){this.linear=function(d,c,g){c=void 0===c?0:c;return(void 0===d?.5:d)*((void 0===g?1:g)-c)+c};this.sin=function(d,c,g){c=void 0===c?0:c;return Math.sin(Math.PI/2*(void 0===d?.5:d))*((void 0===g?1:g)-c)+c};this.cos=function(d,c,g){c=void 0===c?0:c;return(1-
Math.cos(Math.PI/2*(void 0===d?.5:d)))*((void 0===g?1:g)-c)+c};this.s=function(d,c,g,a){c=void 0===c?0:c;g=void 0===g?1:g;a=void 0===a?8:a;return f.math.normalizeStretchArray([1/(1+Math.exp(-.5*-a)),1/(1+Math.exp(-a*((void 0===d?.5:d)-.5))),1/(1+Math.exp(.5*-a))])[1]*(g-c)+c};this.exponential=function(d,c,g,a){c=void 0===c?0:c;g=void 0===g?1:g;a=void 0===a?2:a;return f.math.normalizeStretchArray([(Math.exp(0*a)-1)/(Math.E-1),(Math.exp(a*(void 0===d?.5:d))-1)/(Math.E-1),(Math.exp(1*a)-1)/(Math.E-1)])[1]*
(g-c)+c}};this.curveGenerator=new function(){this.linear=function(d,c,g){c=void 0===c?0:c;g=void 0===g?1:g;d=Math.abs(void 0===d?2:d)-1;for(var a=[0],b=1;b<d;b++)a.push(b/d);a.push(1);d=g-c;for(b=0;b<a.length;b++)a[b]=a[b]*d+c;return a};this.sin=function(d,c,g){c=void 0===c?0:c;g=void 0===g?1:g;d=Math.abs(void 0===d?2:d)-1;for(var a=[0],b=1;b<d;b++)a.push(Math.sin(Math.PI/2*(b/d)));a.push(1);d=g-c;for(b=0;b<a.length;b++)a[b]=a[b]*d+c;return a};this.cos=function(d,c,g){c=void 0===c?0:c;g=void 0===
g?1:g;d=Math.abs(void 0===d?2:d)-1;for(var a=[0],b=1;b<d;b++)a.push(1-Math.cos(Math.PI/2*(b/d)));a.push(1);d=g-c;for(b=0;b<a.length;b++)a[b]=a[b]*d+c;return a};this.s=function(d,c,g,a){d=void 0===d?2:d;c=void 0===c?0:c;g=void 0===g?1:g;a=void 0===a?8:a;0==a&&(a=1E-6);for(var b=[],e=0;e<d;e++)b.push(1/(1+Math.exp(-a*(e/d-.5))));d=f.math.normalizeStretchArray(b);g-=c;for(e=0;e<d.length;e++)d[e]=d[e]*g+c;return d};this.exponential=function(d,c,g,a){c=void 0===c?0:c;g=void 0===g?1:g;a=void 0===a?2:a;
d=(void 0===d?2:d)-1;for(var b=[],e=0;e<=d;e++)b.push((Math.exp(e/d*a)-1)/(Math.E-1));b=system.utility.math.normalizeStretchArray(b);d=g-c;for(e=0;e<b.length;e++)b[e]=b[e]*d+c;return b}};this.detectOverlap=new function(){this.boundingBoxes=function(d,c){return!(d.bottomRight.y<c.topLeft.y||d.topLeft.y>c.bottomRight.y||d.bottomRight.x<c.topLeft.x||d.topLeft.x>c.bottomRight.x)};this.pointWithinBoundingBox=function(d,c){return!(d.x<c.topLeft.x||d.y<c.topLeft.y||d.x>c.bottomRight.x||d.y>c.bottomRight.y)};
this.pointWithinPoly=function(d,c){for(var g=!1,a=0,b=c.length-1;a<c.length;b=a++)c[a].y>d.y!=c[b].y>d.y&&d.x<(c[b].x-c[a].x)*(d.y-c[a].y)/(c[b].y-c[a].y)+c[a].x&&(g=!g);return g};this.lineSegments=function(d,c){var g=(c[1].y-c[0].y)*(d[1].x-d[0].x)-(c[1].x-c[0].x)*(d[1].y-d[0].y);if(0==g)return null;var a=((c[1].x-c[0].x)*(d[0].y-c[0].y)-(c[1].y-c[0].y)*(d[0].x-c[0].x))/g;c=((d[1].x-d[0].x)*(d[0].y-c[0].y)-(d[1].y-d[0].y)*(d[0].x-c[0].x))/g;return{x:d[0].x+a*(d[1].x-d[0].x),y:d[0].y+a*(d[1].y-d[0].y),
inSeg1:0<=a&&1>=a,inSeg2:0<=c&&1>=c}};this.overlappingPolygons=function(d,c){for(var g=0;g<d.length;g++)if(this.pointWithinPoly(d[g],c))return!0;for(g=0;g<c.length;g++)if(this.pointWithinPoly(c[g],d))return!0;var a=Array.apply(null,{length:d.length}).map(Number.call,Number).concat([0]),b=Array.apply(null,{length:c.length}).map(Number.call,Number).concat([0]);for(g=0;g<a.length-1;g++)for(var e=0;e<b.length-1;e++){var h=this.lineSegments([d[a[g]],d[a[g+1]]],[c[b[e]],c[b[e+1]]]);if(null!=h&&h.inSeg1&&
h.inSeg2)return!0}return!1}}};this.structure=new function(){this.functionListRunner=function(d,c){return function(g,a){for(var b=0;b<d.length;b++){for(var e=!0,h=0;h<d[b].requiredKeys.length;h++){e=!0;for(var k=0;k<d[b].requiredKeys[h].length&&(e=e&&c[d[b].requiredKeys[h][k]],e);k++);if(e)break}if(e&&d[b].function(g,a))break}}};this.signalRegistry=function(d,c,g){d=void 0===d?-1:d;c=void 0===c?-1:c;g=void 0===g?-1:g;var a=[],b=[],e=[],h=[],k={},f=[];this.__dump=function(){console.log("---- signalRegistry dump ----");
console.log("\tsignals");for(var b=0;b<a.length;b++)console.log("\t\t",b," "+JSON.stringify(a[b]));console.log("\tselectedSignals");for(b=0;b<tselectedSignals.length;b++)console.log("\t\t",b," "+JSON.stringify(tselectedSignals[b]));console.log("\tevents");for(b=0;b<e.length;b++)console.log("\t\t",b," "+JSON.stringify(e[b]));console.log("\tevents_byID");for(b=0;b<h.length;b++)console.log("\t\t",b," "+JSON.stringify(h[b]));console.log("\tevents_byPosition");var c=Object.keys(k);for(b=0;b<c.length;b++)console.log("\t\t",
c[b]," "+JSON.stringify(k[c[b]]));console.log("\tpositions");for(b=0;b<f.length;b++)console.log("\t\t",b," "+JSON.stringify(f[b]))};this.export=function(){return JSON.parse(JSON.stringify({signals:a,selectedSignals:b,events:e,events_byID:h,events_byPosition:k,positions:f}))};this.import=function(c){a=JSON.parse(JSON.stringify(c.signals));b=JSON.parse(JSON.stringify(c.selectedSignals));e=JSON.parse(JSON.stringify(c.events));h=JSON.parse(JSON.stringify(c.events_byID));k=JSON.parse(JSON.stringify(c.events_byPosition));
f=JSON.parse(JSON.stringify(c.positions))};this.getAllSignals=function(){return JSON.parse(JSON.stringify(a))};this.getAllEvents=function(){return JSON.parse(JSON.stringify(e))};this.getSignal=function(b){if(void 0!=a[b])return JSON.parse(JSON.stringify(a[b]))};this.eventsBetween=function(a,b){for(var c=void 0==b?Array.from(new Set(f.filter(function(b){return b==a}))):Array.from(new Set(f.filter(function(e){return e>=a&&e<b}))),d=[],g=0;g<c.length;g++){c[g]=k[String(c[g])];for(var h=0;h<c[g].length;h++)d.push(e[c[g][h]])}return d.sort(function(a,
b){return a.position<b.position?-1:a.position>b.position?1:0})};this.add=function(b,m){if(void 0!=b&&"line"in b&&"position"in b&&"length"in b){"strength"in b||(b.strength=1);0>b.line&&(b.line=0);0>b.length&&(b.length=0);0>b.position&&(b.position=0);0>b.strength&&(b.strength=0);-1<c&&b.line>c-1&&(b.line=c-1);-1<g&&b.length>g&&(b.length=g);-1<d&&b.position>d&&(b.position=d-b.length);-1<d&&b.position+b.length>d&&(b.length=d-b.position);-1<d&&b.position+b.length>d&&(b.position=d-b.length);1<b.strength&&
(b.strength=1);var p=0;if(void 0==m)for(;void 0!=a[p];)p++;else p=m;a[p]=JSON.parse(JSON.stringify(b));b=[{signalID:p,line:b.line,position:b.position,strength:b.strength},{signalID:p,line:b.line,position:b.position+b.length,strength:0}];for(m=0;void 0!=e[m];)m++;e[m]=b[0];h[p]=[m];void 0==k[b[0].position]?k[b[0].position]=[m]:k[b[0].position].push(m);for(f.push(b[0].position);void 0!=e[m];)m++;e[m]=b[1];h[p]=h[p].concat(m);void 0==k[b[1].position]?k[b[1].position]=[m]:k[b[1].position].push(m);f.push(b[1].position);
return p}};this.remove=function(b){if(void 0!=a[b]){delete a[b];for(var c=0;c<h[b].length;c++){var d=h[b][c];k[e[d].position].splice(k[e[d].position].indexOf(d),1);f.splice(f.indexOf(e[d].position),1);0==k[e[d].position].length&&delete k[e[d].position];delete e[d]}delete h[b]}};this.update=function(b,e){void 0!=e&&("line"in e||(e.line=a[b].line),-1<d&&("position"in e&&"length"in e?e.length+e.position>d&&(e.length=d-e.position):("position"in e?a[b].length+e.position>=d&&(e.position=d-a[b].length):
e.position=a[b].position,"length"in e?e.length+e.position>d&&(e.length=d-e.position):e.length=a[b].length)),"strength"in e||(e.strength=a[b].strength),this.remove(b),this.add(e,b))};this.reset=function(){a=[];b=[];e=[];h=[];k={};f=[]}}};this.audio=new function(){this.context=new (window.AudioContext||window.webkitAudioContext);this.changeAudioParam=function(a,e,c,d,g,t){t=void 0===t?!0:t;if(null==c)return e.value;t&&e.cancelScheduledValues(a.currentTime);try{switch(g){case "linear":e.linearRampToValueAtTime(c,
a.currentTime+d);break;case "exponential":console.warn("2018-4-18 - changeAudioParam:exponential doesn't work on chrome");0==c&&(c=1E-4);e.exponentialRampToValueAtTime(c,a.currentTime+d);break;case "s":for(var b=c-e.value,h=f.math.curveGenerator.s(10),k=0;k<h.length;k++)h[k]=e.value+h[k]*b;e.setValueCurveAtTime(new Float32Array(h),a.currentTime,d);break;default:e.setTargetAtTime(c,a.currentTime,.001)}}catch(n){console.log("could not change param (possibly due to an overlap, or bad target value)"),
console.log("audioParam:",e,"target:",c,"time:",d,"curve:",g,"cancelScheduledValues:",t),console.log(n)}};this.loadAudioFile=function(a,e,c){c=void 0===c?"":c;switch(void 0===e?"file":e){case "url":e=new XMLHttpRequest;e.open("GET",c,!0);e.responseType="arraybuffer";e.onload=function(){f.audio.context.decodeAudioData(this.response,function(b){a({buffer:b,name:c.split("/").pop(),duration:b.duration})},function(a){console.warn("Error with decoding audio data"+a.err)})};e.send();break;default:var b=
document.createElement("input");b.type="file";b.onchange=function(){var e=this.files[0],c=new FileReader;c.readAsArrayBuffer(e);c.onload=function(c){f.audio.context.decodeAudioData(c.target.result,function(b){a({buffer:b,name:e.name,duration:b.duration})});b.remove()}};document.body.appendChild(b);b.click()}};this.waveformSegment=function(a,e,c){e=void 0===e?{start:0,end:1}:e;c=void 0===c?1E4:c;var b=a.getChannelData(0);e.start=e.start?e.start:0;e.end=e.end?e.end:1;var d=a.length*e.start;a=a.length*
e.end;c=(a-d)/c;for(e=[];d<a;d+=Math.round(c))e.push(f.math.largestValueFound(b.slice(d,d+Math.round(c))));return e};this.loadBuffer=function(a,e,c,d){a=a.createBufferSource();a.buffer=e;a.connect(c);a.onended=d;return a};this.destination=this.context.createGain();this.destination.connect(this.context.destination);this.destination._gain=1;this.destination.masterGain=function(a){if(void 0==a)return this.destination._gain;this._gain=a;f.audio.changeAudioParam(f.audio.context,this.gain,this._gain,.01,
"instant",!0)};this.names_frequencies_split={0:{C:16.35,"C#":17.32,D:18.35,"D#":19.45,E:20.6,F:21.83,"F#":23.12,G:24.5,"G#":25.96,A:27.5,"A#":29.14,B:30.87},1:{C:32.7,"C#":34.65,D:36.71,"D#":38.89,E:41.2,F:43.65,"F#":46.25,G:49,"G#":51.91,A:55,"A#":58.27,B:61.74},2:{C:65.41,"C#":69.3,D:73.42,"D#":77.78,E:82.41,F:87.31,"F#":92.5,G:98,"G#":103.8,A:110,"A#":116.5,B:123.5},3:{C:130.8,"C#":138.6,D:146.8,"D#":155.6,E:164.8,F:174.6,"F#":185,G:196,"G#":207.7,A:220,"A#":233.1,B:246.9},4:{C:261.6,"C#":277.2,
D:293.7,"D#":311.1,E:329.6,F:349.2,"F#":370,G:392,"G#":415.3,A:440,"A#":466.2,B:493.9},5:{C:523.3,"C#":554.4,D:587.3,"D#":622.3,E:659.3,F:698.5,"F#":740,G:784,"G#":830.6,A:880,"A#":932.3,B:987.8},6:{C:1047,"C#":1109,D:1175,"D#":1245,E:1319,F:1397,"F#":1480,G:1568,"G#":1661,A:1760,"A#":1865,B:1976},7:{C:2093,"C#":2217,D:2349,"D#":2489,E:2637,F:2794,"F#":2960,G:3136,"G#":3322,A:3520,"A#":3729,B:3951},8:{C:4186,"C#":4435,D:4699,"D#":4978,E:5274,F:5588,"F#":5920,G:6272,"G#":6645,A:7040,"A#":7459,B:7902}};
this.names_frequencies={};for(var d=Object.entries(this.names_frequencies_split),c=0;c<d.length;c++)for(var g=Object.entries(this.names_frequencies_split[c]),a=0;a<g.length;a++)this.names_frequencies[d[c][0]+g[a][0]]=g[a][1];this.frequencies_names={};d=Object.entries(this.names_frequencies);for(c=0;c<d.length;c++)this.frequencies_names[d[c][1]]=d[c][0];d="0C 0C# 0D 0D# 0E 0F 0F# 0G 0G# 0A 0A# 0B 1C 1C# 1D 1D# 1E 1F 1F# 1G 1G# 1A 1A# 1B 2C 2C# 2D 2D# 2E 2F 2F# 2G 2G# 2A 2A# 2B 3C 3C# 3D 3D# 3E 3F 3F# 3G 3G# 3A 3A# 3B 4C 4C# 4D 4D# 4E 4F 4F# 4G 4G# 4A 4A# 4B 5C 5C# 5D 5D# 5E 5F 5F# 5G 5G# 5A 5A# 5B 6C 6C# 6D 6D# 6E 6F 6F# 6G 6G# 6A 6A# 6B 7C 7C# 7D 7D# 7E 7F 7F# 7G 7G# 7A 7A# 7B 8C 8C# 8D 8D# 8E 8F 8F# 8G 8G# 8A 8A# 8B".split(" ");
this.midinumbers_names={};for(c=0;c<d.length;c++)this.midinumbers_names[c+24]=d[c];this.names_midinumbers={};d=Object.entries(this.midinumbers_names);for(c=0;c<d.length;c++)this.names_midinumbers[d[c][1]]=parseInt(d[c][0]);this.num2name=function(a){return this.midinumbers_names[a]};this.num2freq=function(a){return this.names_frequencies[this.midinumbers_names[a]]};this.name2num=function(a){return this.names_midinumbers[a]};this.name2freq=function(a){return this.names_frequencies[a]};this.freq2num=
function(a){return this.names_midinumbers[this.frequencies_names[a]]};this.freq2name=function(a){return this.frequencies_names[a]}};this.misc=new function(){this.blendColours=function(d,c,g){function a(a){a=a.split(",");a[0]=a[0].replace("rgba(","");a[3]=a[3].replace(")","");return a.map(function(a){return parseFloat(a)})}d=a(d);c=a(c);for(var b=[],e=0;e<d.length;e++)b[e]=(1-g)*d[e]+g*c[e];return"rgba("+b[0]+","+b[1]+","+b[2]+","+b[3]+")"};this.multiBlendColours=function(d,c){if(0==c)return d[0];
if(1==c)return d[d.length-1];c*=d.length-1;return f.misc.blendColours(d[~~c],d[~~c+1],c%1)};this.padString=function(d,c,g){g=void 0===g?" ":g;if(1>g.length)return d;for(d=""+d;d.length<c;)d=g+d;return d};this.compressString=function(d){return f.thirdparty.lzString.compress(d)};this.decompressString=function(d){return f.thirdparty.lzString.decompress(d)};this.serialize=function(d,c){c=void 0===c?!0:c;d=JSON.stringify(d,function(c,a){switch({}.toString.call(a).match(/\s([a-zA-Z]+)/)[1].toLowerCase()){case "function":return{__uniqueType:"function",
__value:a.toString(),__name:a.name};case "arraybuffer":return{__uniqueType:"arraybuffer",__value:btoa(String.fromCharCode(new Uint8Array(a)))};case "audiobuffer":c=[];for(var b=0;b<a.numberOfChannels;b++)c.push(Array.from(a.getChannelData(b)));return{__uniqueType:"audiobuffer",__channelData:c,__sampleRate:a.sampleRate,__numberOfChannels:a.numberOfChannels,__length:a.length};default:return a}});c&&(d=f.misc.compressString(d));return d};this.unserialize=function(d,c){if(void 0!==d)return(void 0===c||
c)&&(d=f.misc.decompressString(d)),JSON.parse(d,function(c,a){if("object"==typeof a&&null!=a&&"__uniqueType"in a)switch(a.__uniqueType){case "function":c=a.__value.substring(0,a.__value.indexOf("{"));c=c.substring(c.indexOf("(")+1,c.lastIndexOf(")"));a=a.__value.substring(a.__value.indexOf("{")+1,a.__value.lastIndexOf("}"));a=Function(c,a);break;case "arraybuffer":a=atob(a.__value);for(c=0;c<a.length;c++)a[c]=a[c].charCodeAt(0);a=new ArrayBuffer(a);break;case "audiobuffer":var b=f.audio.context.createBuffer(a.__numberOfChannels,
a.__length,a.__sampleRate);for(c=0;c<b.numberOfChannels;c++){workingBuffer=b.getChannelData(c);for(var e=0;e<b.length;e++)workingBuffer[e]=a.__channelData[c][e]}a=b;break;default:a=a.__value}return a})};this.openFile=function(d,c){c=void 0===c?"readAsBinaryString":c;var g=document.createElement("input");g.type="file";g.onchange=function(){var a=new FileReader;switch(c){case "readAsArrayBuffer":a.readAsArrayBuffer(this.files[0]);break;default:a.readAsBinaryString(this.files[0])}a.onloadend=function(){d&&
d(a.result)}};g.click()};this.printFile=function(d,c){var g=document.createElement("a");g.href=URL.createObjectURL(new Blob([c]));g.download=d;g.click()}};this.thirdparty=new function(){this.lzString=function(){var d=String.fromCharCode,c={},g={compress:function(a){return null==a?"":g._compress(a,6,function(a){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$".charAt(a)})},decompress:function(a){if(null==a)return"";if(""==a)return null;a=a.replace(/ /g,"+");return g._decompress(a.length,
32,function(b){b=a.charAt(b);if(!c["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$"]){c["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$"]={};for(var e=0;65>e;e++)c["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$"]["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$".charAt(e)]=e}return c["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$"][b]})},_compress:function(a,b,e){if(null==a)return"";var c,d={},g={},f="",
m=2,q=3,u=2,n=[],l=0,y=0,v;for(v=0;v<a.length;v+=1){var B=a.charAt(v);Object.prototype.hasOwnProperty.call(d,B)||(d[B]=q++,g[B]=!0);var x=f+B;if(Object.prototype.hasOwnProperty.call(d,x))f=x;else{if(Object.prototype.hasOwnProperty.call(g,f)){if(256>f.charCodeAt(0)){for(c=0;c<u;c++)l<<=1,y==b-1?(y=0,n.push(e(l)),l=0):y++;var w=f.charCodeAt(0);for(c=0;8>c;c++)l=l<<1|w&1,y==b-1?(y=0,n.push(e(l)),l=0):y++,w>>=1}else{w=1;for(c=0;c<u;c++)l=l<<1|w,y==b-1?(y=0,n.push(e(l)),l=0):y++,w=0;w=f.charCodeAt(0);
for(c=0;16>c;c++)l=l<<1|w&1,y==b-1?(y=0,n.push(e(l)),l=0):y++,w>>=1}m--;0==m&&(m=Math.pow(2,u),u++);delete g[f]}else for(w=d[f],c=0;c<u;c++)l=l<<1|w&1,y==b-1?(y=0,n.push(e(l)),l=0):y++,w>>=1;m--;0==m&&(m=Math.pow(2,u),u++);d[x]=q++;f=String(B)}}if(""!==f){if(Object.prototype.hasOwnProperty.call(g,f)){if(256>f.charCodeAt(0)){for(c=0;c<u;c++)l<<=1,y==b-1?(y=0,n.push(e(l)),l=0):y++;w=f.charCodeAt(0);for(c=0;8>c;c++)l=l<<1|w&1,y==b-1?(y=0,n.push(e(l)),l=0):y++,w>>=1}else{w=1;for(c=0;c<u;c++)l=l<<1|w,
y==b-1?(y=0,n.push(e(l)),l=0):y++,w=0;w=f.charCodeAt(0);for(c=0;16>c;c++)l=l<<1|w&1,y==b-1?(y=0,n.push(e(l)),l=0):y++,w>>=1}m--;0==m&&(m=Math.pow(2,u),u++);delete g[f]}else for(w=d[f],c=0;c<u;c++)l=l<<1|w&1,y==b-1?(y=0,n.push(e(l)),l=0):y++,w>>=1;m--;0==m&&u++}w=2;for(c=0;c<u;c++)l=l<<1|w&1,y==b-1?(y=0,n.push(e(l)),l=0):y++,w>>=1;for(;;)if(l<<=1,y==b-1){n.push(e(l));break}else y++;return n.join("")},_decompress:function(a,b,e){var c=[],g=4,f=4,t=3,m=[],q,u,n=e(0),l=b,y=1;for(q=0;3>q;q+=1)c[q]=q;var v=
0;var B=Math.pow(2,2);for(u=1;u!=B;){var x=n&l;l>>=1;0==l&&(l=b,n=e(y++));v|=(0<x?1:0)*u;u<<=1}switch(v){case 0:v=0;B=Math.pow(2,8);for(u=1;u!=B;)x=n&l,l>>=1,0==l&&(l=b,n=e(y++)),v|=(0<x?1:0)*u,u<<=1;var w=d(v);break;case 1:v=0;B=Math.pow(2,16);for(u=1;u!=B;)x=n&l,l>>=1,0==l&&(l=b,n=e(y++)),v|=(0<x?1:0)*u,u<<=1;w=d(v);break;case 2:return""}q=c[3]=w;for(m.push(w);;){if(y>a)return"";v=0;B=Math.pow(2,t);for(u=1;u!=B;)x=n&l,l>>=1,0==l&&(l=b,n=e(y++)),v|=(0<x?1:0)*u,u<<=1;switch(w=v){case 0:v=0;B=Math.pow(2,
8);for(u=1;u!=B;)x=n&l,l>>=1,0==l&&(l=b,n=e(y++)),v|=(0<x?1:0)*u,u<<=1;c[f++]=d(v);w=f-1;g--;break;case 1:v=0;B=Math.pow(2,16);for(u=1;u!=B;)x=n&l,l>>=1,0==l&&(l=b,n=e(y++)),v|=(0<x?1:0)*u,u<<=1;c[f++]=d(v);w=f-1;g--;break;case 2:return m.join("")}0==g&&(g=Math.pow(2,t),t++);if(c[w])w=c[w];else if(w===f)w=q+q.charAt(0);else return null;m.push(w);c[f++]=q+w.charAt(0);g--;q=w;0==g&&(g=Math.pow(2,t),t++)}}};return g}()}};f.core=new function(){var r=new function(){function d(a){for(var b=[];void 0!=(a=
a.parent);)b.unshift({x:a.x,y:a.y,a:a.angle});a={x:void 0!=b[0]?b[0].x:0,y:void 0!=b[0]?b[0].y:0,a:void 0!=b[0]?b[0].a:0};for(var c=1;c<b.length;c++){var d=f.library.math.cartesianAngleAdjust(b[c].x,b[c].y,b[c-1].a);a.a+=b[c].a;a.x+=d.x;a.y+=d.y}return a}var c=this,g=new function(){this.length=function(a){return a*c.viewport.scale()};this.windowPoint2workspacePoint=function(a,e){var b=c.viewport.position(),d=c.viewport.scale()/window.devicePixelRatio,g=c.viewport.angle();a=a/d-b.x;e=e/d-b.y;return f.library.math.cartesianAngleAdjust(a,
e,-g)};this.workspacePoint2windowPoint=function(a,e){var b=c.viewport.position(),d=c.viewport.scale(),g=c.viewport.angle();a=f.library.math.cartesianAngleAdjust(a,e,g);return{x:(a.x+b.x)*d,y:(a.y+b.y)*d}}},a=new function(){this.canvas=function(){this.type="canvas";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.angle=this.y=this.x=0;this.anchor={x:0,y:0};this.height=this.width=10;var a=document.createElement("canvas"),
e=1;var h=a.getContext("2d",{alpha:!1});a.setAttribute("width",this.width*e);a.setAttribute("height",this.height*e);this.parameter={};this.parameter.x=function(a){return function(b){if(void 0==b)return a.x;a.x=b;a.computeExtremities()}}(this);this.parameter.y=function(a){return function(b){if(void 0==b)return a.y;a.y=b;a.computeExtremities()}}(this);this.parameter.angle=function(a){return function(b){if(void 0==b)return a.angle;a.angle=b;a.computeExtremities()}}(this);this.parameter.anchor=function(a){return function(b){if(void 0==
b)return a.anchor;a.anchor=b;a.computeExtremities()}}(this);this.parameter.width=function(b){return function(c){if(void 0==c)return b.width;b.width=c;b.computeExtremities();a.setAttribute("width",b.width*e)}}(this);this.parameter.height=function(b){return function(c){if(void 0==c)return b.height;b.height=c;b.computeExtremities();a.setAttribute("height",b.height*e)}}(this);this.resolution=function(b){if(void 0==b)return e;e=b;a.setAttribute("width",this.width*e);a.setAttribute("height",this.height*
e)};this._=h;this.$=function(a){return a*e};this.getAddress=function(){var a="",b=this;do a=b.name+"/"+a;while(void 0!=(b=b.parent));return"/"+a};this.computeExtremities=function(a){for(var b=this._static,e=this;void 0!=(e=e.parent)&&!b;)b=b||e._static;this._static=b;a=void 0==a?d(this):a;this.extremities={points:[],boundingBox:{}};this.extremities.points=f.library.math.pointsOfRect(this.x,this.y,this.width,this.height,-this.angle,this.anchor);this.extremities.points=this.extremities.points.map(function(b){b=
f.library.math.cartesianAngleAdjust(b.x,b.y,a.a);b.x+=a.x;b.y+=a.y;return b});this.extremities.boundingBox=f.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(a,b){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var e=!1}else e=f.library.math.detectOverlap.pointWithinBoundingBox({x:a,y:b},this.extremities.boundingBox);return e?(void 0==this.extremities.points?
(console.warn("the shape",this,"has no points"),a=!1):a=f.library.math.detectOverlap.pointWithinPoly({x:a,y:b},this.extremities.points),a):!1};this.render=function(b,e,d){e=void 0===e?{x:0,y:0,a:0}:e;d=void 0===d?!1:d;var h=this._static?!0:f.library.math.detectOverlap.boundingBoxes(c.viewport.getBoundingBox(),this.extremities.boundingBox);if(h){h=f.library.math.cartesianAngleAdjust(this.x,this.y,e.a);e.x+=h.x-this.x;e.y+=h.y-this.y;h={x:this.x+e.x,y:this.y+e.y};e=this.angle+e.a;var k=this.width,p=
this.height;d||(h=g.workspacePoint2windowPoint(h.x-this.anchor.x*k,h.y-this.anchor.y*p),k=g.length(k),p=g.length(p));h=f.library.math.cartesianAngleAdjust(h.x,h.y,-e);b.save();b.rotate(e);b.drawImage(a,h.x,h.y,k,p);b.restore();if(this.dotFrame){for(b=0;b<this.extremities.points.length;b++)d=g.workspacePoint2windowPoint(this.extremities.points[b].x,this.extremities.points[b].y),c.render.drawDot(d.x,d.y,4,"rgba(50,50,50,1)");d=g.workspacePoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);
c.render.drawDot(d.x,d.y);d=g.workspacePoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);c.render.drawDot(d.x,d.y)}}}};this.circle=function(){this.type="circle";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.y=this.x=0;this.r=2;this.style={fill:"rgba(255,100,255,1)",stroke:"rgba(0,0,0,0)",lineWidth:1,shadowColour:"rgba(0,0,0,0)",shadowBlur:2,shadowOffset:{x:1,y:1}};
this.parameter={};this.parameter.x=function(a){return function(b){if(void 0==b)return a.x;a.x=b;a.computeExtremities()}}(this);this.parameter.y=function(a){return function(b){if(void 0==b)return a.y;a.y=b;a.computeExtremities()}}(this);this.parameter.r=function(a){return function(b){if(void 0==b)return a.r;a.r=b;a.computeExtremities()}}(this);this.getAddress=function(){var a="",e=this;do a=e.name+"/"+a;while(void 0!=(e=e.parent));return"/"+a};this.computeExtremities=function(a){for(var b=this._static,
c=this;void 0!=(c=c.parent)&&!b;)b=b||c._static;this._static=b;a=void 0==a?d(this):a;this.extremities={points:[],boundingBox:{},origin:{}};point=f.library.math.cartesianAngleAdjust(this.x,this.y,a.a);this.extremities.origin={x:this.x+a.x,y:this.y+a.y};this.extremities.points=f.library.math.pointsOfCircle(this.x,this.y,this.r,10);this.extremities.points=this.extremities.points.map(function(b){b=f.library.math.cartesianAngleAdjust(b.x,b.y,a.a);b.x+=a.x;b.y+=a.y;return b});this.extremities.boundingBox=
f.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(a,e){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var b=!1}else b=f.library.math.detectOverlap.pointWithinBoundingBox({x:a,y:e},this.extremities.boundingBox);return b?f.library.math.distanceBetweenTwoPoints({x:a,y:e},{x:this.x+this.extremities.origin.x,y:this.y+this.extremities.origin.y})<=this.r:!1};this.render=
function(a,e,d,k){e=void 0===e?{x:0,y:0,a:0}:e;d=void 0===d?!1:d;k=void 0===k?!1:k;var b=this._static?!0:f.library.math.detectOverlap.boundingBoxes(c.viewport.getBoundingBox(),this.extremities.boundingBox);if(b){b=f.library.math.cartesianAngleAdjust(this.x,this.y,e.a);e.x+=b.x-this.x;e.y+=b.y-this.y;e={x:this.x+e.x,y:this.y+e.y};b=this.r;var h=this.style.lineWidth,m=this.style.shadowBlur,q=this.style.shadowOffset.x,u=this.style.shadowOffset.y;d||(e=g.workspacePoint2windowPoint(e.x,e.y),b=g.length(b),
h=g.length(h),m=g.length(m),q=g.length(q),u=g.length(u));if(k)d=new Path2D,d.arc(e.x,e.y,b,0,2*Math.PI,!1),a.clip(d);else if(a.fillStyle=this.style.fill,a.strokeStyle=this.style.stroke,a.lineWidth=h,a.shadowColor=this.style.shadowColour,a.shadowBlur=m,a.shadowOffsetX=q,a.shadowOffsetY=u,a.beginPath(),a.arc(e.x,e.y,b,0,2*Math.PI,!1),a.closePath(),a.fill(),a.stroke(),this.dotFrame){for(a=0;a<this.extremities.points.length;a++)d=g.workspacePoint2windowPoint(this.extremities.points[a].x,this.extremities.points[a].y),
c.render.drawDot(d.x,d.y,4,"rgba(50,50,50,1)");d=g.workspacePoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);c.render.drawDot(d.x,d.y);d=g.workspacePoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);c.render.drawDot(d.x,d.y);d=g.workspacePoint2windowPoint(this.extremities.origin.x,this.extremities.origin.y);c.render.drawDot(d.x,d.y)}}}};this.group=function(){function a(a,b){if(void 0==b)return a.getAddress()+
" >> no element provided";if(void 0==b.name||""==b.name)return a.getAddress()+" >> element has no name";for(var e=0;e<a.children.length;e++)if(a.children[e].name==b.name)return'element with the name "'+b.name+'" already exists in the '+(void 0==parent?"design root":'group "'+a.name+'"')}this.type="group";this.name="";this.clipActive=this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.angle=this.y=this.x=0;this.children=[];this.clippingStencil;
this.parameter={};this.parameter.x=function(a){return function(b){if(void 0==b)return a.x;a.x=b;a.computeExtremities(void 0,!0)}}(this);this.parameter.y=function(a){return function(b){if(void 0==b)return a.y;a.y=b;a.computeExtremities(void 0,!0)}}(this);this.parameter.angle=function(a){return function(b){if(void 0==b)return a.angle;a.angle=b;a.computeExtremities(void 0,!0)}}(this);this.getAddress=function(){var a="",b=this;do a=b.name+"/"+a;while(void 0!=(b=b.parent));return"/"+a};this.clip=function(a){if(void 0==
a)return this.clipActive;this.clipActive=void 0==this.clippingStencil?!1:a;this.computeExtremities()};this.stencil=function(a){if(void 0==a)return this.clippingStencil;this.clippingStencil=a;this.computeExtremities()};this.prepend=function(b){var e=a(this,b);void 0!=e?console.error("element invalid:",e):(this.children.unshift(b),b.parent=this,b.computeExtremities(void 0,!0))};this.append=function(b){var e=a(this,b);void 0!=e?console.error("element invalid:",e):(this.children.push(b),b.parent=this,
b.computeExtremities(void 0,!0))};this.remove=function(a){void 0!=a&&(a=this.children.indexOf(a),0>a||(this.children.splice(a,1),this.computeExtremities()))};this.clear=function(){this.children=[];this.computeExtremities()};this.contains=function(a){for(var b=0;b<this.children.length;b++)if(this.children[b]==a)return!0;return!1};this.getChildByName=function(a){for(var b=0;b<this.children.length;b++)if(this.children[b].name==a)return this.children[b]};this.getElementsWithName=function(a){for(var b=
[],e=0;e<this.children.length;e++)if(this.children[e].name==a&&b.push(this.children[e]),"group"==this.children[e].type)for(var c=this.children[e].getElementsWithName(a),d=0;d<c.length;d++)b.push(c[d]);return b};this.getOffset=function(){return d(this)};this.computeExtremities=function(a,b){b=void 0===b?!1:b;for(var e=void 0==a,c=this._static,g=this;void 0!=(g=g.parent)&&!c;)c=c||g._static;this._static=c;a=void 0==a?d(this):a;if(b)for(b={x:a.x,y:a.y,a:a.a+this.angle},c=f.library.math.cartesianAngleAdjust(this.x,
this.y,a.a),b.x+=c.x,b.y+=c.y,c=0;c<this.children.length;c++)this.children[c].computeExtremities(b,!0);this.extremities={points:[],boundingBox:{}};if(this.clipActive)b={x:a.x,y:a.y,a:a.a+this.angle},c=f.library.math.cartesianAngleAdjust(this.x,this.y,a.a),b.x+=c.x,b.y+=c.y,this.clippingStencil.computeExtremities(b),this.extremities.points=this.clippingStencil.extremities.points;else{a=[];for(c=0;c<this.children.length;c++)a.push(this.children[c].extremities.boundingBox.topLeft),a.push(this.children[c].extremities.boundingBox.bottomRight);
a=f.library.math.boundingBoxFromPoints(a);this.extremities.points=[{x:a.topLeft.x,y:a.topLeft.y},{x:a.bottomRight.x,y:a.topLeft.y},{x:a.bottomRight.x,y:a.bottomRight.y},{x:a.topLeft.x,y:a.bottomRight.y}]}this.extremities.boundingBox=f.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&e&&this.parent.computeExtremities()};this.isPointWithin=function(a,b){if(this.clipActive)return this.clippingStencil.isPointWithin(a,b);if(void 0==this.extremities.boundingBox){console.warn("the shape",
this,"has no bounding box");var e=!1}else e=f.library.math.detectOverlap.pointWithinBoundingBox({x:a,y:b},this.extremities.boundingBox);return e?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),a=!1):a=f.library.math.detectOverlap.pointWithinPoly({x:a,y:b},this.extremities.points),a):!1};this.getElementUnderPoint=function(a,b,c,d){c=void 0===c?!1:c;d=void 0===d?!1:d;for(var e=[],f=this.children.length-1;0<=f;f--){var k=this.children[f]._static||c?g.workspacePoint2windowPoint(a,
b):{x:a,y:b};if(!this.children[f].ignored&&this.children[f].isPointWithin(k.x,k.y))if("group"==this.children[f].type){if(k=this.children[f].getElementUnderPoint(a,b,this.children[f]._static||c,d),void 0!=k)if(d)e=e.concat(k);else return k}else if(d)e.push(this.children[f]);else return this.children[f]}if(d)return e};this.render=function(a,b,d,p){b=void 0===b?{x:0,y:0,a:0}:b;d=void 0===d?!1:d;p=void 0===p?!1:p;a:if(this._static)var e=!0;else{for(e=0;e<this.children.length;e++)if(this.children[e]._static){e=
!0;break a}e=f.library.math.detectOverlap.boundingBoxes(c.viewport.getBoundingBox(),this.extremities.boundingBox)}if(e){e=f.library.math.cartesianAngleAdjust(this.x,this.y,b.a);b={a:b.a+this.angle,x:b.x+e.x,y:b.y+e.y};if(this.clipActive||p)a.save(),this.clippingStencil.render(a,Object.assign({},b),d||this.clippingStencil._static,p||this.clipActive);for(p=0;p<this.children.length;p++)e=this.children[p],e.render(a,Object.assign({},b),d||e._static);this.clipActive&&a.restore();if(this.dotFrame){for(p=
0;p<this.extremities.points.length;p++)a=g.workspacePoint2windowPoint(this.extremities.points[p].x,this.extremities.points[p].y),c.render.drawDot(a.x,a.y,4,"rgba(50,50,50,1)");a=g.workspacePoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);c.render.drawDot(a.x,a.y);a=g.workspacePoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);c.render.drawDot(a.x,a.y)}}}};this.image=function(){this.type="image";this.name=
"";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.angle=this.y=this.x=0;this.anchor={x:0,y:0};this.height=this.width=10;this.url="";var a={};this.style={shadowColour:"rgba(0,0,0,0)",shadowBlur:2,shadowOffset:{x:1,y:1}};this.parameter={};this.parameter.x=function(a){return function(b){if(void 0==b)return a.x;a.x=b;a.computeExtremities()}}(this);this.parameter.y=function(a){return function(b){if(void 0==b)return a.y;a.y=b;a.computeExtremities()}}(this);
this.parameter.angle=function(a){return function(b){if(void 0==b)return a.angle;a.angle=b;a.computeExtremities()}}(this);this.parameter.anchor=function(a){return function(b){if(void 0==b)return a.anchor;a.anchor=b;a.computeExtremities()}}(this);this.parameter.width=function(a){return function(b){if(void 0==b)return a.width;a.width=b;a.computeExtremities()}}(this);this.parameter.height=function(a){return function(b){if(void 0==b)return a.height;a.height=b;a.computeExtremities()}}(this);this.getAddress=
function(){var a="",b=this;do a=b.name+"/"+a;while(void 0!=(b=b.parent));return"/"+a};this.computeExtremities=function(a){for(var b=this._static,e=this;void 0!=(e=e.parent)&&!b;)b=b||e._static;this._static=b;a=void 0==a?d(this):a;this.extremities={points:[],boundingBox:{}};this.extremities.points=f.library.math.pointsOfRect(this.x,this.y,this.width,this.height,-this.angle,this.anchor);this.extremities.points=this.extremities.points.map(function(b){b=f.library.math.cartesianAngleAdjust(b.x,b.y,a.a);
b.x+=a.x;b.y+=a.y;return b});this.extremities.boundingBox=f.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(a,b){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var e=!1}else e=f.library.math.detectOverlap.pointWithinBoundingBox({x:a,y:b},this.extremities.boundingBox);return e?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),a=
!1):a=f.library.math.detectOverlap.pointWithinPoly({x:a,y:b},this.extremities.points),a):!1};this.render=function(b,d,k){d=void 0===d?{x:0,y:0,a:0}:d;k=void 0===k?!1:k;var e=this._static?!0:f.library.math.detectOverlap.boundingBoxes(c.viewport.getBoundingBox(),this.extremities.boundingBox);if(e){e=f.library.math.cartesianAngleAdjust(this.x,this.y,d.a);d.x+=e.x-this.x;d.y+=e.y-this.y;e=this.angle+d.a;var h=this.width,m=this.height;d={x:this.x+d.x-this.anchor.x*(this.width*Math.cos(e)+this.height*Math.sin(-e)),
y:this.y+d.y-this.anchor.y*(this.width*Math.sin(e)+this.height*Math.cos(-e))};k||(d=g.workspacePoint2windowPoint(d.x,d.y),h=g.length(h),m=g.length(m));d=f.library.math.cartesianAngleAdjust(d.x,d.y,-e);a.hasOwnProperty(this.url)||(a[this.url]=new Image,a[this.url].src=this.url);b.save();b.rotate(e);b.drawImage(a[this.url],d.x,d.y,h,m);b.restore();if(this.dotFrame){for(b=0;b<this.extremities.points.length;b++)k=g.workspacePoint2windowPoint(this.extremities.points[b].x,this.extremities.points[b].y),
c.render.drawDot(k.x,k.y,4,"rgba(50,50,50,1)");k=g.workspacePoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);c.render.drawDot(k.x,k.y);k=g.workspacePoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);c.render.drawDot(k.x,k.y)}}}};this.path=function(){this.type="path";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.points=
[];this.style={stroke:"rgba(0,0,0,0)",lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:2,shadowColour:"rgba(0,0,0,0)",shadowBlur:20,shadowOffset:{x:20,y:20}};this.parameter={};this.parameter.points=function(a){return function(b){if(void 0==b)return a.points;a.points=b;a.computeExtremities()}}(this);this.getAddress=function(){var a="",e=this;do a=e.name+"/"+a;while(void 0!=(e=e.parent));return"/"+a};this.computeExtremities=function(a){for(var b=this._static,c=this;void 0!=(c=c.parent)&&!b;)b=
b||c._static;this._static=b;a=void 0==a?d(this):a;this.extremities={points:[],boundingBox:{}};this.extremities.points=this.points.map(function(b){b=f.library.math.cartesianAngleAdjust(b.x,b.y,a.a);b.x+=a.x;b.y+=a.y;return b});this.extremities.boundingBox=f.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(a,e){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var b=
!1}else b=f.library.math.detectOverlap.pointWithinBoundingBox({x:a,y:e},this.extremities.boundingBox);return b?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),a=!1):a=f.library.math.detectOverlap.pointWithinPoly({x:a,y:e},this.extremities.points),a):!1};this.render=function(a,e,d){e=void 0===e?{x:0,y:0,a:0}:e;d=void 0===d?!1:d;var b=this._static?!0:f.library.math.detectOverlap.boundingBoxes(c.viewport.getBoundingBox(),this.extremities.boundingBox);if(b){b=this.points.map(function(a){a=
f.library.math.cartesianAngleAdjust(a.x,a.y,e.a);return{x:a.x+e.x,y:a.y+e.y}});var h=this.style.lineWidth,t=this.style.shadowBlur,m=this.style.shadowOffset.x,q=this.style.shadowOffset.y;d||(b=b.map(function(a){return g.workspacePoint2windowPoint(a.x,a.y)}),h=g.length(h),t=g.length(t),m=g.length(m),q=g.length(q));a.fillStyle=this.style.fill;a.strokeStyle=this.style.stroke;a.lineWidth=h;a.lineCap=this.style.lineCap;a.lineJoin=this.style.lineJoin;a.miterLimit=this.style.miterLimit;a.shadowColor=this.style.shadowColour;
a.shadowBlur=t;a.shadowOffsetX=m;a.shadowOffsetY=q;a.beginPath();a.moveTo(b[0].x,b[0].y);for(d=1;d<b.length;d++)a.lineTo(b[d].x,b[d].y);a.stroke();if(this.dotFrame){for(d=0;d<this.extremities.points.length;d++)a=g.workspacePoint2windowPoint(this.extremities.points[d].x,this.extremities.points[d].y),c.render.drawDot(a.x,a.y,4,"rgba(50,50,50,1)");a=g.workspacePoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);c.render.drawDot(a.x,a.y);a=g.workspacePoint2windowPoint(this.extremities.boundingBox.bottomRight.x,
this.extremities.boundingBox.bottomRight.y);c.render.drawDot(a.x,a.y)}}}};this.polygon=function(){this.type="polygon";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.points=[];this.style={fill:"rgba(100,255,255,1)",stroke:"rgba(0,0,0,0)",lineWidth:1,lineJoin:"round",miterLimit:2,shadowColour:"rgba(0,0,0,0)",shadowBlur:20,shadowOffset:{x:20,y:20}};this.parameter={};this.parameter.points=function(a){return function(b){if(void 0==
b)return a.points;a.points=b;a.computeExtremities()}}(this);this.getAddress=function(){var a="",e=this;do a=e.name+"/"+a;while(void 0!=(e=e.parent));return"/"+a};this.computeExtremities=function(a){for(var b=this._static,c=this;void 0!=(c=c.parent)&&!b;)b=b||c._static;this._static=b;a=void 0==a?d(this):a;this.extremities={points:[],boundingBox:{}};this.extremities.points=this.points.map(function(b){b=f.library.math.cartesianAngleAdjust(b.x,b.y,a.a);b.x+=a.x;b.y+=a.y;return b});this.extremities.boundingBox=
f.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(a,e){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var b=!1}else b=f.library.math.detectOverlap.pointWithinBoundingBox({x:a,y:e},this.extremities.boundingBox);return b?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),a=!1):a=f.library.math.detectOverlap.pointWithinPoly({x:a,y:e},
this.extremities.points),a):!1};this.render=function(a,e,d,k){e=void 0===e?{x:0,y:0,a:0}:e;d=void 0===d?!1:d;k=void 0===k?!1:k;var b=this._static?!0:f.library.math.detectOverlap.boundingBoxes(c.viewport.getBoundingBox(),this.extremities.boundingBox);if(b){b=this.points.map(function(a){a=f.library.math.cartesianAngleAdjust(a.x,a.y,e.a);return{x:a.x+e.x,y:a.y+e.y}});var h=this.style.lineWidth,m=this.style.shadowBlur,q=this.style.shadowOffset.x,u=this.style.shadowOffset.y;d||(b=b.map(function(a){return g.workspacePoint2windowPoint(a.x,
a.y)}),h=g.length(h),m=g.length(m),q=g.length(q),u=g.length(u));if(k){k=new Path2D;k.moveTo(b[0].x,b[0].y);for(d=1;d<b.length;d++)k.lineTo(b[d].x,b[d].y);a.clip(k)}else{a.fillStyle=this.style.fill;a.strokeStyle=this.style.stroke;a.lineWidth=h;a.lineJoin=this.style.lineJoin;a.miterLimit=this.style.miterLimit;a.shadowColor=this.style.shadowColour;a.shadowBlur=m;a.shadowOffsetX=q;a.shadowOffsetY=u;a.beginPath();a.moveTo(b[0].x,b[0].y);for(d=1;d<b.length;d++)a.lineTo(b[d].x,b[d].y);a.closePath();a.fill();
a.stroke();if(this.dotFrame){for(d=0;d<this.extremities.points.length;d++)a=g.workspacePoint2windowPoint(this.extremities.points[d].x,this.extremities.points[d].y),c.render.drawDot(a.x,a.y,4,"rgba(50,50,50,1)");a=g.workspacePoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);c.render.drawDot(a.x,a.y);a=g.workspacePoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);c.render.drawDot(a.x,a.y)}}}}};this.rectangle=
function(){this.type="rectangle";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.angle=this.y=this.x=0;this.anchor={x:0,y:0};this.height=this.width=10;this.style={fill:"rgba(255,100,255,1)",stroke:"rgba(0,0,0,0)",lineWidth:1,shadowColour:"rgba(0,0,0,0)",shadowBlur:2,shadowOffset:{x:1,y:1}};this.parameter={};this.parameter.x=function(a){return function(b){if(void 0==b)return a.x;a.x=b;a.computeExtremities()}}(this);this.parameter.y=
function(a){return function(b){if(void 0==b)return a.y;a.y=b;a.computeExtremities()}}(this);this.parameter.angle=function(a){return function(b){if(void 0==b)return a.angle;a.angle=b;a.computeExtremities()}}(this);this.parameter.anchor=function(a){return function(b){if(void 0==b)return a.anchor;a.anchor=b;a.computeExtremities()}}(this);this.parameter.width=function(a){return function(b){if(void 0==b)return a.width;a.width=b;a.computeExtremities()}}(this);this.parameter.height=function(a){return function(b){if(void 0==
b)return a.height;a.height=b;a.computeExtremities()}}(this);this.getAddress=function(){var a="",c=this;do a=c.name+"/"+a;while(void 0!=(c=c.parent));return"/"+a};this.getOffset=function(){return d(this)};this.computeExtremities=function(a,c){c=this._static;for(var b=this;void 0!=(b=b.parent)&&!c;)c=c||b._static;this._static=c;a=void 0==a?d(this):a;this.extremities={points:[],boundingBox:{}};this.extremities.points=f.library.math.pointsOfRect(this.x,this.y,this.width,this.height,-this.angle,this.anchor);
this.extremities.points=this.extremities.points.map(function(b){b=f.library.math.cartesianAngleAdjust(b.x,b.y,a.a);b.x+=a.x;b.y+=a.y;return b});this.extremities.boundingBox=f.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(a,c){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var b=!1}else b=f.library.math.detectOverlap.pointWithinBoundingBox({x:a,y:c},this.extremities.boundingBox);
return b?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),a=!1):a=f.library.math.detectOverlap.pointWithinPoly({x:a,y:c},this.extremities.points),a):!1};this.render=function(a,e,d,k){e=void 0===e?{x:0,y:0,a:0}:e;d=void 0===d?!1:d;k=void 0===k?!1:k;var b=this._static?!0:f.library.math.detectOverlap.boundingBoxes(c.viewport.getBoundingBox(),this.extremities.boundingBox);if(b){b=f.library.math.cartesianAngleAdjust(this.x,this.y,e.a);e.x+=b.x-this.x;e.y+=b.y-this.y;b=this.angle+
e.a;var h=this.width,m=this.height,q=this.style.lineWidth,u=this.style.shadowBlur,n=this.style.shadowOffset.x,l=this.style.shadowOffset.y;e={x:this.x+e.x-this.anchor.x*(this.width*Math.cos(b)+this.height*Math.sin(-b)),y:this.y+e.y-this.anchor.y*(this.width*Math.sin(b)+this.height*Math.cos(-b))};d||(e=g.workspacePoint2windowPoint(e.x,e.y),h=g.length(h),m=g.length(m),q=g.length(q),u=g.length(u),n=g.length(n),l=g.length(l));e=f.library.math.cartesianAngleAdjust(e.x,e.y,-b);if(k)a.rotate(b),d=new Path2D,
d.rect(e.x,e.y,h,m),a.clip(d),a.rotate(-b);else if(a.fillStyle=this.style.fill,a.strokeStyle=this.style.stroke,a.lineWidth=q,a.shadowColor=this.style.shadowColour,a.shadowBlur=u,a.shadowOffsetX=n,a.shadowOffsetY=l,a.save(),a.rotate(b),a.fillRect(e.x,e.y,h,m),a.strokeRect(e.x,e.y,h,m),a.restore(),this.dotFrame){for(a=0;a<this.extremities.points.length;a++)d=g.workspacePoint2windowPoint(this.extremities.points[a].x,this.extremities.points[a].y),c.render.drawDot(d.x,d.y,4,"rgba(50,50,50,1)");d=g.workspacePoint2windowPoint(this.extremities.boundingBox.topLeft.x,
this.extremities.boundingBox.topLeft.y);c.render.drawDot(d.x,d.y);d=g.workspacePoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);c.render.drawDot(d.x,d.y)}}}};this.text=function(){this.type="text";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.y=this.x=0;this.text="curve";this.angle=0;this.size=1;this.style={font:"30pt Arial",align:"start",baseline:"alphabetic",fill:"rgba(255,100,100,1)",
stroke:"rgba(0,0,0,0)",lineWidth:1,shadowColour:"rgba(0,0,0,0)",shadowBlur:2,shadowOffset:{x:20,y:20}};this.parameter={};this.parameter.x=function(a){return function(b){if(void 0==b)return a.x;a.x=b;a.computeExtremities()}}(this);this.parameter.y=function(a){return function(b){if(void 0==b)return a.y;a.y=b;a.computeExtremities()}}(this);this.parameter.angle=function(a){return function(b){if(void 0==b)return a.angle;a.angle=b;a.computeExtremities()}}(this);this.parameter.size=function(a){return function(b){if(void 0==
b)return a.size;a.size=b;a.computeExtremities()}}(this);this.getAddress=function(){var a="",c=this;do a=c.name+"/"+a;while(void 0!=(c=c.parent));return"/"+a};this.computeExtremities=function(a){for(var b=this._static,c=this;void 0!=(c=c.parent)&&!b;)b=b||c._static;this._static=b;a=void 0==a?d(this):a;this.extremities={points:[],boundingBox:{}};this.extremities.points=f.library.math.pointsOfText(this.text,this.x,this.y,this.angle,1/this.size,this.style.font,this.style.align,this.style.baseline);this.extremities.points=
this.extremities.points.map(function(b){b=f.library.math.cartesianAngleAdjust(b.x,b.y,a.a);b.x+=a.x;b.y+=a.y;return b});this.extremities.boundingBox=f.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(a,c){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var b=!1}else b=f.library.math.detectOverlap.pointWithinBoundingBox({x:a,y:c},this.extremities.boundingBox);
return b?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),a=!1):a=f.library.math.detectOverlap.pointWithinPoly({x:a,y:c},this.extremities.points),a):!1};this.render=function(a,d,h,k){d=void 0===d?{x:0,y:0,a:0}:d;h=void 0===h?!1:h;k=void 0===k?!1:k;var b=f.library.math.cartesianAngleAdjust(this.x,this.y,d.a);d.x+=b.x-this.x;d.y+=b.y-this.y;b={x:this.x+d.x,y:this.y+d.y};var e=this.size;d=this.angle+d.a;var m=this.style.lineWidth,q=this.style.shadowBlur,u=this.style.shadowOffset.x,
n=this.style.shadowOffset.y;h||(b=g.workspacePoint2windowPoint(b.x,b.y),e=g.length(e),q=g.length(q),u=g.length(u),n=g.length(n));b=f.library.math.cartesianAngleAdjust(b.x,b.y,-d);if(k)console.warn("no clipping available for text shape");else if(a.font=this.style.font,a.textAlign=this.style.align,a.textBaseline=this.style.baseline,a.fillStyle=this.style.fill,a.strokeStyle=this.style.stroke,a.lineWidth=m,a.shadowColor=this.style.shadowColour,a.shadowBlur=q,a.shadowOffsetX=u,a.shadowOffsetY=n,a.save(),
a.rotate(d),a.scale(e,e),a.fillText(this.text,b.x/e,b.y/e),a.shadowColor="rgba(0,0,0,0)",a.strokeText(this.text,b.x/e,b.y/e),a.restore(),this.dotFrame){for(a=0;a<this.extremities.points.length;a++)h=g.workspacePoint2windowPoint(this.extremities.points[a].x,this.extremities.points[a].y),c.render.drawDot(h.x,h.y,4,"rgba(50,50,50,1)");h=g.workspacePoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);c.render.drawDot(h.x,h.y);h=g.workspacePoint2windowPoint(this.extremities.boundingBox.bottomRight.x,
this.extremities.boundingBox.bottomRight.y);c.render.drawDot(h.x,h.y)}}}};this.arrangement=new function(){var b=new a.group;b.name="root";this.createElement=function(b){return new a[b]};this.clear=function(){b.clear()};this.get=function(){return b};this.set=function(a){b=a};this.prepend=function(a){b.prepend(a)};this.append=function(a){b.append(a)};this.remove=function(a){b.remove(a)};this.getElementUnderPoint=function(a,c,d,g){return b.getElementUnderPoint(a,c,void 0===d?!1:d,void 0===g?!1:g)};this.getElementsWithName=
function(a){return b.getElementsWithName(a)}};this.viewport=new function(){function a(){function a(a){var c=a.charAt(0).toUpperCase()+a.slice(1),e=f.getAttribute("workspace"+c);if(d[a]!=e||d["window"+c]!=window["inner"+c])d[a]=e,d["window"+c]=window["inner"+c],void 0==e?(f[a]=d.defaultSize[a]*window.devicePixelRatio,f.style[a]=d.defaultSize[a]+"px"):e.indexOf("%")==e.length-1?(c=f.parentElement["offset"+c],e=parseFloat(e.slice(0,e.length-1))/100,f[a]=c*e*window.devicePixelRatio,f.style[a]=c*e+"px"):
(f[a]=e*window.devicePixelRatio,f.style[a]=e+"px"),b=!0}var b=!1;a("height");a("width");b&&c()}function c(){k.points.tl=g.windowPoint2workspacePoint(0,0);k.points.tr=g.windowPoint2workspacePoint(f.width,0);k.points.bl=g.windowPoint2workspacePoint(0,f.height);k.points.br=g.windowPoint2workspacePoint(f.width,f.height);k.boundingBox=f.library.math.boundingBoxFromPoints([k.points.tl,k.points.tr,k.points.br,k.points.bl])}var d={defaultSize:{width:640,height:480},width:0,height:0,windowWidth:0,windowHeight:0},
k={position:{x:0,y:0},scale:window.devicePixelRatio,angle:0,points:{tl:{x:0,y:0},tr:{x:0,y:0},bl:{x:0,y:0},br:{x:0,y:0}},boundingBox:{topLeft:{x:0,y:0},bottomRight:{x:0,y:0}}},p=void 0,t=void 0,m=!1,q=!0;this.position=function(a,b){if(void 0==a||void 0==b)return{x:k.position.x,y:k.position.y};k.position.x=a;k.position.y=b;c()};this.scale=function(a){if(void 0==a)return k.scale;k.scale=0==a?window.devicePixelRatio:a;c()};this.angle=function(a){if(void 0==a)return k.angle;k.angle=a;c()};this.windowPoint2workspacePoint=
function(a,b){return g.windowPoint2workspacePoint(a,b)};this.refresh=function(){a();c();this.allowKeyboardInput(q)};this.getBoundingBox=function(){return k.boundingBox};this.mousePosition=function(a,b){if(void 0==a||void 0==b)return{x:p,y:t};p=a;t=b};this.stopMouseScroll=function(a){if(void 0==a)return m;m=a;a||(document.body.style.overflow="")};this.allowKeyboardInput=function(a){if(void 0==a)return q;(q=a)?f.setAttribute("tabIndex",1):f.removeAttribute("tabIndex")};this.cursor=function(a){if(void 0==
a)return document.body.style.cursor;document.body.style.cursor=a}};this.render=new function(){function a(a){void 0!==a&&a||(g.fillStyle="rgb(255,255,255)",g.fillRect(0,0,f.width,f.height));c.arrangement.get().render(g)}function d(b){k=requestAnimationFrame(d);try{a()}catch(t){c.render.active(!1),console.error("major animation error"),console.error(t)}c.stats.collect(b)}var g=f.getContext("2d",{alpha:!1}),k=void 0;this.drawDot=function(a,b,c,d){c=void 0===c?2:c;g.fillStyle=void 0===d?"rgba(150,150,255,1)":
d;g.beginPath();g.arc(a,b,c,0,2*Math.PI,!1);g.closePath();g.fill()};this.frame=function(b){a(void 0===b?!1:b)};this.active=function(a){if(void 0==a)return void 0!=k;a?void 0==k&&d():void 0!=k&&(cancelAnimationFrame(k),k=void 0)}};this.stats=new function(){var a=!1,c=0,d={compute:function(a){this.frameTimeArray.push(1E3/(a-c));30<=this.frameTimeArray.length&&this.frameTimeArray.shift();this.rate=f.library.math.averageArray(this.frameTimeArray);c=a},counter:0,frameTimeArray:[],rate:0},g={recursiveCount:function(a){void 0==
a&&(this.counts={total:0,canvas:0,circle:0,group:0,image:0,path:0,polygon:0,rectangle:0,text:0},a=f.core.arrangement.get());this.counts.total++;switch(a.type){case "canvas":this.counts.canvas++;break;case "circle":this.counts.circle++;break;case "group":this.counts.group++;break;case "image":this.counts.image++;break;case "path":this.counts.path++;break;case "polygon":this.counts.polygon++;break;case "rectangle":this.counts.rectangle++;break;case "text":this.counts.text++}if(void 0!=a.children)for(var b=
0;b<a.children.length;b++)this.recursiveCount(a.children[b])},recursivePrint:function(a,b){b=void 0===b?"":b;void 0==a&&(a=f.core.arrangement.get());console.log(b+a.name);if(void 0!=a.children)for(var c=0;c<a.children.length;c++)this.recursivePrint(a.children[c],b+"- ")},counts:{total:0,canvas:0,circle:0,group:0,image:0,path:0,polygon:0,rectangle:0,text:0}};this.collect=function(b){a&&d.compute(b)};this.active=function(b){if(void 0==b)return a;a=b};this.getReport=function(){g.recursiveCount();return{framesPerSecond:d.rate,
shapeCount:g.counts}}};this.callback=new function(){for(var a="onmousedown onmouseup onmousemove onmouseenter onmouseleave onwheel onclick ondblclick onkeydown onkeyup touchstart touchmove touchend touchenter touchleave touchcancel".split(" "),d={},h=0;h<a.length;d={$jscomp$loop$prop$getRelevantShape$8:d.$jscomp$loop$prop$getRelevantShape$8},h++){d.$jscomp$loop$prop$getRelevantShape$8=function(a,b,d){var e=c.arrangement.getElementUnderPoint(a,b);if(void 0!=e&&void 0==e[d])for(a=c.arrangement.getElementUnderPoint(a,
b,void 0,!0),b=0;b<a.length;b++)if(void 0!=a[b][d]){e=a[b];break}return e};this[a[h]]=function(a,b,c){};var k=0,p=0;f[a[h]]=function(a){return function(b){return function(d){if(c.callback[b]){var e=g.windowPoint2workspacePoint(d.x,d.y),f=a.$jscomp$loop$prop$getRelevantShape$8(e.x,e.y,b);c.callback[b](e.x,e.y,d,f)}}}}(d)(a[h]);f.onmouseover=function(a){return function(b){c.viewport.stopMouseScroll()&&(document.body.style.overflow="hidden");if(c.callback.onmouseover){var d=g.windowPoint2workspacePoint(b.x,
b.y),e=a.$jscomp$loop$prop$getRelevantShape$8(d.x,d.y,"onmouseover");c.callback.onmouseover(d.x,d.y,b,e)}}}(d);f.onmouseout=function(a){return function(b){c.viewport.stopMouseScroll()&&(document.body.style.overflow="");if(c.callback.onmouseout){var d=g.windowPoint2workspacePoint(b.x,b.y),e=a.$jscomp$loop$prop$getRelevantShape$8(d.x,d.y,"onmouseout");c.callback.onmouseout(d.x,d.y,b,e)}}}(d);f.onmousemove=function(a){return function(b){var d=g.windowPoint2workspacePoint(b.x,b.y);c.viewport.mousePosition(d.x,
d.y);if(c.callback.onmousemove){var e=a.$jscomp$loop$prop$getRelevantShape$8(k,p,"onmouseleave"),f=a.$jscomp$loop$prop$getRelevantShape$8(d.x,d.y,"onmouseenter"),m=a.$jscomp$loop$prop$getRelevantShape$8(d.x,d.y,"onmousemove");e!=f&&(c.callback.onmouseleave(d.x,d.y,b,e),c.callback.onmouseenter(d.x,d.y,b,f));c.callback.onmousemove(d.x,d.y,b,m);k=d.x;p=d.y}}}(d);f.onkeydown=function(a){return function(b){if(c.callback.onkeydown){var d=c.viewport.mousePosition(),e=a.$jscomp$loop$prop$getRelevantShape$8(d.x,
d.y,"onkeydown");c.callback.onkeydown(d.x,d.y,b,e)}}}(d);f.onkeyup=function(a){return function(b){if(c.callback.onkeyup){var d=c.viewport.mousePosition(),e=a.$jscomp$loop$prop$getRelevantShape$8(d.x,d.y,"onkeyup");c.callback.onkeyup(d.x,d.y,b,e)}}}(d)}};c.viewport.refresh();c.arrangement.clear()};this.arrangement=new function(){this.get=function(){return r.arrangement.get()};this.set=function(d){return r.arrangement.set(d)};this.createElement=function(d){return r.arrangement.createElement(d)};this.append=
function(d){return r.arrangement.append(d)};this.prepend=function(d){return r.arrangement.prepend(d)};this.remove=function(d){return r.arrangement.remove(d)};this.getElementUnderPoint=function(d,c){return r.arrangement.getElementUnderPoint(d,c)};this.getElementsWithName=function(d){return r.arrangement.getElementsWithName(d)};this.forceRefresh=function(d){return r.arrangement.forceRefresh(d)}};this.viewport=new function(){this.position=function(d,c){return r.viewport.position(d,c)};this.scale=function(d){return r.viewport.scale(d)};
this.angle=function(d){return r.viewport.angle(d)};this.windowPoint2workspacePoint=function(d,c){return r.viewport.windowPoint2workspacePoint(d,c)};this.refresh=function(){r.viewport.refresh()};this.mousePosition=function(){return r.viewport.mousePosition()};this.stopMouseScroll=function(d){return r.viewport.stopMouseScroll(d)};this.allowKeyboardInput=function(d){return r.viewport.allowKeyboardInput(d)};this.cursor=function(d){return r.viewport.cursor(d)}};this.render=new function(){this.frame=function(d){return r.render.frame(void 0===
d?!1:d)};this.active=function(d){return r.render.active(d)}};this.stats=new function(){this.active=function(d){return r.stats.active(d)};this.getReport=function(){return r.stats.getReport()}};this.callback=new function(){this.onmousedown=function(d,c,g,a){};r.callback.onmousedown=function(d){return function(c,g,a,b){d.onmousedown(c,g,a,b)}}(this);this.onmouseup=function(d,c,g,a){};r.callback.onmouseup=function(d){return function(c,g,a,b){d.onmouseup(c,g,a,b)}}(this);this.onmousemove=function(d,c,
g,a){};r.callback.onmousemove=function(d){return function(c,g,a,b){d.onmousemove(c,g,a,b)}}(this);this.onmouseenter=function(d,c,g,a){};r.callback.onmouseenter=function(d){return function(c,g,a,b){d.onmouseenter(c,g,a,b)}}(this);this.onmouseleave=function(d,c,g,a){};r.callback.onmouseleave=function(d){return function(c,g,a,b){d.onmouseleave(c,g,a,b)}}(this);this.onwheel=function(d,c,g,a){};r.callback.onwheel=function(d){return function(c,g,a,b){d.onwheel(c,g,a,b)}}(this);this.onclick=function(d,c,
g,a){};r.callback.onclick=function(d){return function(c,g,a,b){d.onclick(c,g,a,b)}}(this);this.ondblclick=function(d,c,g,a){};r.callback.ondblclick=function(d){return function(c,g,a,b){d.ondblclick(c,g,a,b)}}(this);this.onkeydown=function(d,c,g,a){};r.callback.onkeydown=function(d){return function(c,g,a,b){d.onkeydown(c,g,a,b)}}(this);this.onkeyup=function(d,c,g,a){};r.callback.onkeyup=function(d){return function(c,g,a,b){d.onkeyup(c,g,a,b)}}(this);this.touchstart=function(d,c,g){};r.callback.touchstart=
function(d){return function(c,g,a,b){d.touchstart(c,g,a)}}(this);this.touchmove=function(d,c,g){};r.callback.touchmove=function(d){return function(c,g,a,b){d.touchmove(c,g,a)}}(this);this.touchend=function(d,c,g){};r.callback.touchend=function(d){return function(c,g,a,b){d.touchend(c,g,a)}}(this);this.touchenter=function(d,c,g){};r.callback.touchenter=function(d){return function(c,g,a,b){d.touchenter(c,g,a)}}(this);this.touchleave=function(d,c,g){};r.callback.touchleave=function(d){return function(c,
g,a,b){d.touchleave(c,g,a)}}(this);this.touchcancel=function(d,c,g){};r.callback.touchcancel=function(d){return function(c,g,a,b){d.touchcancel(c,g,a)}}(this)}};f.system=new function(){};f.system.mouse=new function(){function r(d,c,g,a,b){if(void 0==b)return!1;do if(void 0!=b[d])return b[d](c,g,a),!0;while(void 0!=(b=b.parent));return!1}this.tmp={};this.functionList={};this.mouseInteractionHandler=function(d,c){f.system.mouse.tmp.onmousemove_old=f.onmousemove;f.system.mouse.tmp.onmouseleave_old=f.onmouseleave;
f.system.mouse.tmp.onmouseup_old=f.onmouseup;f.onmousemove=function(c){void 0!=d&&d(c)};f.onmouseup=function(d){void 0!=c&&c(d);f.onmousemove=f.system.mouse.tmp.onmousemove_old;f.onmouseleave=f.system.mouse.tmp.onmouseleave_old;f.onmouseup=f.system.mouse.tmp.onmouseup_old};f.onmouseleave=f.onmouseup};this.forceMouseUp=function(){f.onmouseup()};f.core.callback.onmousedown=function(d,c,g,a){r("onmousedown",d,c,g,a)||f.library.structure.functionListRunner(f.system.mouse.functionList.onmousedown,f.system.keyboard.pressedKeys)({event:g,
x:d,y:c})};f.core.callback.onmousemove=function(d,c,g,a){r("onmousemove",d,c,g,a)||f.library.structure.functionListRunner(f.system.mouse.functionList.onmousemove,f.system.keyboard.pressedKeys)({event:g,x:d,y:c})};f.core.callback.onmouseup=function(d,c,g,a){r("onmouseup",d,c,g,a)||f.library.structure.functionListRunner(f.system.mouse.functionList.onmouseup,f.system.keyboard.pressedKeys)({event:g,x:d,y:c})};f.core.callback.onmouseleave=function(d,c,g,a){r("onmouseleave",d,c,g,a)||f.library.structure.functionListRunner(f.system.mouse.functionList.onmouseleave,
f.system.keyboard.pressedKeys)({event:g,x:d,y:c})};f.core.callback.onmouseenter=function(d,c,g,a){r("onmouseenter",d,c,g,a)||f.library.structure.functionListRunner(f.system.mouse.functionList.onmouseenter,f.system.keyboard.pressedKeys)({event:g,x:d,y:c})};f.core.callback.onwheel=function(d,c,g,a){r("onwheel",d,c,g,a)||f.library.structure.functionListRunner(f.system.mouse.functionList.onwheel,f.system.keyboard.pressedKeys)({event:g,x:d,y:c})};f.core.callback.onclick=function(d,c,g,a){r("onclick",d,
c,g,a)||f.library.structure.functionListRunner(f.system.mouse.functionList.onclick,f.system.keyboard.pressedKeys)({event:g,x:d,y:c})};f.core.callback.ondblclick=function(d,c,g,a){r("ondblclick",d,c,g,a)||f.library.structure.functionListRunner(f.system.mouse.functionList.ondblclick,f.system.keyboard.pressedKeys)({event:g,x:d,y:c})};this.functionList.onmousedown=[];this.functionList.onmousemove=[];this.functionList.onmouseup=[];this.functionList.onmouseleave=[];this.functionList.onmouseenter=[];this.functionList.onwheel=
[];this.functionList.onclick=[];this.functionList.ondblclick=[]};f.system.keyboard=new function(){function r(c,d,a,b,e){if(void 0==e)return!1;do if(void 0!=e[c])return e[c](d,a,b),!0;while(void 0!=(e=e.parent));return!1}function d(d,g){var a=f.system.keyboard.pressedKeys;if("ControlLeft"==d.code||"ControlRight"==d.code)a.control=g;else if("AltLeft"==d.code||"AltRight"==d.code)a.alt=g;else if("MetaLeft"==d.code||"MetaRight"==d.code)a.meta=g;else if("ShiftLeft"==d.code||"ShiftRight"==d.code)a.shift=
g;-1!=window.navigator.platform.indexOf("Mac")&&(a.option=a.alt,a.command=a.meta)}f.core.callback.onkeydown=function(c,g,a,b){f.system.keyboard.pressedKeys[a.code]||(f.system.keyboard.pressedKeys[a.code]=!0,d(a,!0),r("onkeydown",c,g,a,b)||f.library.structure.functionListRunner(f.system.keyboard.functionList.onkeydown,f.system.keyboard.pressedKeys)({event:a,x:c,y:g}))};f.core.callback.onkeyup=function(c,g,a,b){f.system.keyboard.pressedKeys[a.code]&&(delete f.system.keyboard.pressedKeys[a.code],d(a,
!1),r("onkeyup",c,g,a,b)||f.library.structure.functionListRunner(f.system.keyboard.functionList.onkeyup,f.system.keyboard.pressedKeys)({event:a,x:c,y:g}))};this.releaseAll=function(){for(var d=0;d<this.pressedKeys.length;d++)this.releaseKey(this.pressedKeys[d])};this.releaseKey=function(d){f.onkeyup(new KeyboardEvent("keyup",{code:d}))};this.pressedKeys={control:!1,alt:!1,meta:!1};this.functionList={};this.functionList.onkeydown=[];this.functionList.onkeyup=[]};f.system.pane={};f.system.pane.background=
f.core.arrangement.createElement("group");f.system.pane.background.name="background";f.system.pane.background._static=!0;f.system.pane.background.ignored=!0;f.core.arrangement.append(f.system.pane.background);f.system.pane.middleground=f.core.arrangement.createElement("group");f.system.pane.middleground.name="middleground";f.core.arrangement.append(f.system.pane.middleground);f.system.pane.middleground.back=f.core.arrangement.createElement("group");f.system.pane.middleground.back.name="back";f.system.pane.middleground.append(f.system.pane.middleground.back);
f.system.pane.middleground.middle=f.core.arrangement.createElement("group");f.system.pane.middleground.middle.name="middle";f.system.pane.middleground.append(f.system.pane.middleground.middle);f.system.pane.middleground.front=f.core.arrangement.createElement("group");f.system.pane.middleground.front.name="front";f.system.pane.middleground.append(f.system.pane.middleground.front);f.system.pane.foreground=f.core.arrangement.createElement("group");f.system.pane.foreground.name="foreground";f.system.pane.foreground._static=
!0;f.core.arrangement.append(f.system.pane.foreground);f.system.pane.b=f.system.pane.background;f.system.pane.mb=f.system.pane.middleground.back;f.system.pane.mm=f.system.pane.middleground.middle;f.system.pane.mf=f.system.pane.middleground.front;f.system.pane.f=f.system.pane.foreground;f.system.pane.getMiddlegroundPane=function(r){do{if(r==f.system.pane.mb)return f.system.pane.mb;if(r==f.system.pane.mm)return f.system.pane.mm;if(r==f.system.pane.mf)return f.system.pane.mf}while(void 0!=(r=r.parent))};
f._interface=new function(){var r=this;this.circuit=new function(){this.alpha=new function(){this.audio2percentage=function(){return new function(){var d=null,c=null;var g=f.library.audio.context.createAnalyser();g.fftSize=128;d=new Uint8Array(g.fftSize);new Uint8Array(g.fftSize);this.__render=function(){g.getByteTimeDomainData(d);for(var a=[],b=0;b<d.length;b++)a.push(d[b]/128-1);var c=0;a.forEach(function(a){Math.abs(a)>c&&(c=Math.abs(a))});this.newValue(c)};this.audioIn=function(){return g};this.start=
function(){c=setInterval(function(a){a.__render()},1E3/30,this)};this.stop=function(){clearInterval(c)};this.newValue=function(a){}}};this.audioIn=function(d,c){c=void 0===c?!0:c;var g=1;var a=d.createGain();f.library.audio.changeAudioParam(d,a.gain,g);this.out=function(){return a};this.listDevices=function(a){navigator.mediaDevices.enumerateDevices().then(function(b){a(b.filter(function(a){return"audioinput"===a.kind}))})};this.selectDevice=function(b){navigator.mediaDevices.getUserMedia({audio:{deviceId:b}}).then(function(b){audioDevice=
b;f.library.audio.context.createMediaStreamSource(b).connect(a)},function(a){console.warn('could not find audio input device: "'+b+'"');console.warn("\terror:",a)})};this.gain=function(b){if(null==b)return g;g=b;f.library.audio.changeAudioParam(d,a.gain,b)};c&&this.selectDevice("default")};this.channelMultiplier=function(d,c){c=void 0===c?2:c;var g=[];var a=1;var b=d.createGain();f.library.audio.changeAudioParam(d,b.gain,a,.01,"instant",!0);for(var e=0;e<c;e++){var h={gain:.5,node:d.createGain()};
f.library.audio.changeAudioParam(d,h.node.gain,h.gain,.01,"instant",!0);g.push(h);b.connect(h.node)}this.in=function(){return b};this.out=function(a){return g[a].node};this.inGain=function(c){if(void 0==c)return a;a=c;f.library.audio.changeAudioParam(d,b.gain,a,.01,"instant",!0)};this.outGain=function(a,b){if(void 0==b)return g[a].gain;g[a].gain=b;f.library.audio.changeAudioParam(d,g[a].node.gain,g[a].gain,.01,"instant",!0)}};this.distortionUnit=function(d){function c(){g.inAggregator.node.disconnect();
g.distortionNode.node&&g.distortionNode.node.disconnect();g.distortionNode.node=d.createWaveShaper();g.distortionNode.curve=new Float32Array(f.library.math.curveGenerator.s(g.distortionNode.resolution,-1,1,g.distortionNode.distortionAmount));g.distortionNode.node.curve=g.distortionNode.curve;g.distortionNode.node.oversample=g.distortionNode.oversample;g.inAggregator.node.connect(g.distortionNode.node);g.distortionNode.node.connect(g.outAggregator.node)}var g={inAggregator:{},distortionNode:{},outAggregator:{}};
g.inAggregator.gain=0;g.inAggregator.node=d.createGain();f.library.audio.changeAudioParam(d,g.inAggregator.node.gain,g.inAggregator.gain,.01,"instant",!0);g.distortionNode.distortionAmount=0;g.distortionNode.oversample="none";g.distortionNode.resolution=100;g.outAggregator.gain=0;g.outAggregator.node=d.createGain();f.library.audio.changeAudioParam(d,g.outAggregator.node.gain,g.outAggregator.gain,.01,"instant",!0);this.in=function(){return g.inAggregator.node};this.out=function(){return g.outAggregator.node};
this.inGain=function(a){if(null==a)return g.inAggregator.gain;g.inAggregator.gain=a;f.library.audio.changeAudioParam(d,g.inAggregator.node.gain,a,.01,"instant",!0)};this.outGain=function(a){if(null==a)return g.outAggregator.gain;g.outAggregator.gain=a;f.library.audio.changeAudioParam(d,g.outAggregator.node.gain,a,.01,"instant",!0)};this.distortionAmount=function(a){if(null==a)return g.distortionNode.distortionAmount;g.distortionNode.distortionAmount=a;c()};this.oversample=function(a){if(null==a)return g.distortionNode.oversample;
g.distortionNode.oversample=a;c()};this.resolution=function(a){if(null==a)return g.distortionNode.resolution;g.distortionNode.resolution=2<=a?a:2;c()};c()};this.filterUnit=function(d){var c=d.createGain();f.library.audio.changeAudioParam(d,c.gain,1,.01,"instant",!0);var g=d.createBiquadFilter();g.type="lowpass";f.library.audio.changeAudioParam(d,g.frequency,110,.01,"instant",!0);f.library.audio.changeAudioParam(d,g.gain,1,.01,"instant",!0);f.library.audio.changeAudioParam(d,g.Q,.1,.01,"instant",!0);
var a=d.createGain();f.library.audio.changeAudioParam(d,a.gain,1,.01,"instant",!0);c.connect(g);g.connect(a);this.in=function(){return c};this.out=function(){return a};this.type=function(a){g.type=a};this.frequency=function(a){f.library.audio.changeAudioParam(d,g.frequency,a,.01,"instant",!0)};this.gain=function(a){f.library.audio.changeAudioParam(d,g.gain,a,.01,"instant",!0)};this.Q=function(a){f.library.audio.changeAudioParam(d,g.Q,a,.01,"instant",!0)};this.measureFrequencyResponse=function(a,d,
c){for(var b=[];a<d;a+=c)b.push(a);return this.measureFrequencyResponse_values(b)};this.measureFrequencyResponse_values=function(a){var b=new Float32Array(a),d=new Float32Array(b.length),c=new Float32Array(b.length);g.getFrequencyResponse(b,d,c);return[d,a]}};this.looper=function(d){var c=this,g=!1,a=1,b=!0,e=0,h=1,k={},p=null,t={};t=d.createChannelSplitter(2);var m=d.createGain();m.gain.setTargetAtTime(1,d.currentTime,0);t.connect(m,0);var q=d.createGain();q.gain.setTargetAtTime(1,d.currentTime,
0);t.connect(q,1);this.out_left=function(){return m};this.out_right=function(){return q};this.load=function(a,b,d){g=!1;f.library.audio.loadAudioFile(function(a){c.stop();k=a;g=!0;b(a)},a,void 0===d?"":d)};this.start=function(){g&&(p&&(p.onended=function(){},p.stop(0)),p=f.library.audio.loadBuffer(d,k.buffer,t),p.playbackRate.value=a,p.loop=b,p.loopStart=e*this.duration(),p.loopEnd=h*this.duration(),p.start(0,0),p.onended=function(){p=null})};this.stop=function(){g&&p&&(p.stop(0),p=void 0)};this.rate=
function(){a=value};this.duration=function(){return g?k.duration:-1};this.title=function(){return g?k.name:""};this.waveformSegment=function(a){a=void 0===a?{start:0,end:1}:a;return void 0!=a&&g?f.library.audio.waveformSegment(k.buffer,a):[]};this.loop=function(a){if(void 0==data)return data;b=void 0===a?!1:a};this.loopBounds=function(a){a=void 0===a?{start:0,end:1}:a;if(void 0==a)return a;e=void 0!=a.start?a.start:e;h=void 0!=a.end?a.end:h}};this.multibandFilter=function(d,c,g){function a(a){var b=
{frequency:110,Q:.1,node:d.createBiquadFilter()};b.node.type=a;f.library.audio.changeAudioParam(d,b.node.frequency,110,.01,"instant",!0);f.library.audio.changeAudioParam(d,b.node.Q,.1,.01,"instant",!0);return b}g=void 0===g?!1:g;var b=[],e=[],h=[],k=[];var p=d.createGain();f.library.audio.changeAudioParam(d,p.gain,1,.01,"instant",!0);if(g){2>c&&(c=2);h.push(a("lowpass"));for(g=1;g<c-1;g++)h.push(a("bandpass"));h.push(a("highpass"))}else for(g=0;g<c;g++)h.push(a("bandpass"));for(g=0;g<c;g++){var t=
{gain:1,node:d.createGain()};f.library.audio.changeAudioParam(d,t.node.gain,t.gain,.01,"instant",!0);k.push(t);b[g]={Q:.1,gain:1,frequency:110,fresh:!0}}var m=1;var q=d.createGain();f.library.audio.changeAudioParam(d,q.gain,m,.01,"instant",!0);for(g=0;g<c;g++)p.connect(h[g].node),h[g].node.connect(k[g].node),k[g].node.connect(q);this.in=function(){return p};this.out=function(){return q};this.masterGain=function(a){if(void 0==a)return m;m=a;f.library.audio.changeAudioParam(d,q.gain,m,.01,"instant",
!0)};this.gain=function(a,c){if(void 0==c)return k[a].gain;k[a].gain=c;f.library.audio.changeAudioParam(d,k[a].node.gain,k[a].gain,.01,"instant",!0);b[a].gain=c;b[a].fresh=!0};this.frequency=function(a,c){if(void 0==c)return h[a].frequency;h[a].frequency=c;f.library.audio.changeAudioParam(d,h[a].node.frequency,h[a].frequency,.01,"instant",!0);b[a].frequency=c;b[a].fresh=!0};this.Q=function(a,c){if(void 0==c)return h[a].Q;h[a].Q=c;f.library.audio.changeAudioParam(d,h[a].node.Q,h[a].Q,.01,"instant",
!0);b[a].Q=c;b[a].fresh=!0};this.measureFrequencyResponse=function(a,d){var g=this;if(void 0==a)return Array(c).fill(0).map(function(a,b){return g.measureFrequencyResponse(b,d)});if(!b[a].fresh)return[e[a].magResponse.map(function(a){return a*m}),e[a].requencyArray];var f=new Float32Array(d),q=new Float32Array(f.length),t=new Float32Array(f.length);h[a].node.getFrequencyResponse(f,q,t);e[a]={magResponse:q.map(function(b){return b*k[a].gain}),phaseResponse:t,frequencyArray:d};b[a].fresh=!1;return[q.map(function(b){return b*
k[a].gain*m}),d]}};this.oneShot_multi=function(d){var c=this,g=!1,a=1,b={},e=[],h={};h=d.createChannelSplitter(2);var k=d.createGain();k.gain.setTargetAtTime(1,d.currentTime,0);h.connect(k,0);var p=d.createGain();p.gain.setTargetAtTime(1,d.currentTime,0);h.connect(p,1);this.audioOut=function(a){switch(a){case "r":return p;case "l":return k;default:console.error('"part.circuit.alpha.oneShot_multi.audioOut" unknown channel "'+a+'"')}};this.out_left=function(){return this.audioOut("l")};this.out_right=
function(){return this.audioOut("r")};this.loadRaw=function(a){0!==Object.keys(a).length&&(b=a,g=!0)};this.load=function(a,b,d){g=!1;f.library.audio.loadAudioFile(function(a){c.loadRaw(a);void 0!=b&&b(a)},a,d)};this.unloadRaw=function(){return b};this.fire=function(c,k){c=void 0===c?0:c;if(g){var m=f.library.audio.loadBuffer(d,b.buffer,h,function(){e.splice(e.indexOf(this),1)});m.playbackRate.value=a;m.start(0,c*a,k*a);e.push(m)}};this.panic=function(){for(;0<e.length;)e.shift().stop(0)};this.rate=
function(b){if(void 0==b)return a;0==b&&(b=1E-6);a=b};this.duration=function(){return g?b.duration/a:-1};this.title=function(){return g?b.name:""};this.waveformSegment=function(a){a=void 0===a?{start:0,end:1}:a;return void 0!=a&&g?f.library.audio.waveformSegment(b.buffer,a):[]}};this.oneShot_single=function(d){var c=this,g=!1,a=1,b={},e=null,h={};h=d.createChannelSplitter(2);var k=d.createGain();k.gain.setTargetAtTime(1,d.currentTime,0);h.connect(k,0);var p=d.createGain();p.gain.setTargetAtTime(1,
d.currentTime,0);h.connect(p,1);this.out_left=function(){return k};this.out_right=function(){return p};this.load=function(a,d,e){g=!1;f.library.audio.loadAudioFile(function(a){c.stop();b=a;g=!0;d(a)},a,void 0===e?"":e)};this.fire=function(){g&&(e&&(e.onended=function(){},e.stop(0)),e=f.library.audio.loadBuffer(d,b.buffer,h),e.playbackRate.value=a,e.start(0,0),e.onended=function(){e=null})};this.stop=function(){g&&(e.stop(0),e=void 0)};this.rate=function(){a=value};this.duration=function(){return g?
b.duration:-1};this.title=function(){return g?b.name:""};this.waveformSegment=function(a){a=void 0===a?{start:0,end:1}:a;return void 0!=a&&g?f.library.audio.waveformSegment(b.buffer,a):[]}};this.player=function(d){function c(){clearInterval(a.loop.timeout);a.playhead.position=a.itself.currentTime();a.playhead.lastSightingTime=d.currentTime;if(a.loop.active&&a.playing){var b=a.loop.end-a.itself.currentTime();0>b&&(b=0);a.loop.timeout=setTimeout(function(){a.itself.jumpTo(a.loop.start,!1);c()},1E3*
b/a.rate)}}function g(b){a.fileLoaded&&(a.playing?(a.loop.active&&b>a.loop.end&&(b=a.loop.start),a.itself.stop(function(){a.playhead.position=b;a.playhead.lastSightingTime=d.currentTime;a.itself.start()})):(a.playhead.position=b,a.playhead.lastSightingTime=d.currentTime))}var a={itself:this,fileLoaded:!1,playing:!1,playhead:{position:0,lastSightingTime:0},loop:{active:!1,start:0,end:1,timeout:null},rate:1},b={},e=null,h={};h=d.createChannelSplitter(2);var k=d.createGain();k.gain.setTargetAtTime(1,
d.currentTime,0);h.connect(k,0);var p=d.createGain();p.gain.setTargetAtTime(1,d.currentTime,0);h.connect(p,1);this.out_left=function(){return k};this.out_right=function(){return p};this.unloadRaw=function(){return b};this.loadRaw=function(d,c){0!==Object.keys(d).length&&(a.itself.stop(),b=d,a.fileLoaded=!0,a.playhead.position=0,c(d))};this.load=function(d,c,e){a.fileLoaded=!1;f.library.audio.loadAudioFile(function(d){a.itself.stop();b=d;a.fileLoaded=!0;a.playhead.position=0;c(d)},d,void 0===e?"":
e)};this.start=function(){!a.playing&&a.fileLoaded&&(e=f.library.audio.loadBuffer(d,b.buffer,h,function(b){a.itself.stop()}),e.loop=a.loop.active,e.loopStart=a.loop.start,e.loopEnd=a.loop.end,e.playbackRate.value=a.rate,e.start(0,a.playhead.position),a.playhead.lastSightingTime=d.currentTime,a.playing=!0,c())};this.stop=function(b){a.playing&&(b&&(e.onended=function(){b()}),e.stop(0),e=void 0,c(),a.playing=!1)};this.jumpTo=function(a,b){a=void 0===a?0:a;void 0===b||b?(a=1<a?1:a,a=0>a?0:a,g(this.duration()*
a)):g(a);c()};this.loop=function(b,d){b=void 0===b?{active:!1,start:0,end:1}:b;d=void 0===d?!0:d;if(void 0==b)return a.loop;void 0!=b.active&&(a.loop.active=b.active,e&&(e.loop=b.active));if(void 0!=b.start||void 0!=b.end)d=d?this.duration():1,a.loop.start=void 0!=b.start?b.start*d:a.loop.start,a.loop.end=void 0!=b.end?b.end*d:a.loop.end,e&&(e.loopStart=a.loop.start,e.loopEnd=a.loop.end);c()};this.rate=function(b){b=void 0===b?1:b;a.rate=b;e&&(e.playbackRate.value=b);c()};this.isLoaded=function(){return a.fileLoaded};
this.duration=function(){return a.fileLoaded?b.duration:-1};this.title=function(){return a.fileLoaded?b.name:""};this.currentTime=function(){return a.fileLoaded?a.playing?a.playhead.position+a.rate*(d.currentTime-a.playhead.lastSightingTime):a.playhead.position:-1};this.progress=function(){return this.currentTime()/this.duration()};this.waveformSegment=function(d,c){d=void 0===d?{start:0,end:1}:d;return void 0!=d&&a.fileLoaded?f.library.audio.waveformSegment(b.buffer,d,c):[]}};this.recorder=function(d){function c(){switch(a.recordingNode.node.state){case "inactive":case "paused":return g.recordingLength;
case "recording":return d.currentTime-g.recordingStartTime}}var g={recordedChunks:[],recordingStartTime:-1,recordingLength:0},a={leftIn:{},rightIn:{},recordingNode:{},leftOut:{},rightOut:{}};a.leftIn.node=d.createAnalyser();a.rightIn.node=d.createAnalyser();a.recordingNode.audioDest=new MediaStreamAudioDestinationNode(d);a.recordingNode.node=new MediaRecorder(a.recordingNode.audioDest.stream,{mimeType:"audio/webm"});a.recordingNode.node.onstart=function(){};a.recordingNode.node.ondataavailable=function(a){g.recordedChunks.push(a.data)};
a.recordingNode.node.onpause=function(){};a.recordingNode.node.onresume=function(){};a.recordingNode.node.onerror=function(a){console.log(a)};a.recordingNode.node.onstop=function(){};a.leftIn.node.connect(a.recordingNode.audioDest);a.rightIn.node.connect(a.recordingNode.audioDest);a.leftOut.node=d.createAnalyser();a.leftIn.node.connect(a.leftOut.node);a.rightOut.node=d.createAnalyser();a.rightIn.node.connect(a.rightOut.node);this.clear=function(){this.stop();g.recordedChunks=[];g.recordingStartTime=
-1;g.recordingLength=0};this.start=function(){this.clear();a.recordingNode.node.start();g.recordingStartTime=d.currentTime};this.pause=function(){"inactive"!=this.state()&&(g.recordingLength=c(),a.recordingNode.node.pause())};this.resume=function(){a.recordingNode.node.resume();g.recordingStartTime=d.currentTime-g.recordingLength};this.stop=function(){"inactive"!=this.state()&&(g.recordingLength=c(),a.recordingNode.node.stop())};this.export=function(){return new Blob(g.recordedChunks,{type:"audio/ogg; codecs=opus"})};
this.save=function(a){a=void 0===a?"output":a;var b=document.createElement("a");b.href=URL.createObjectURL(this.export());b.download=a+".ogg";document.body.appendChild(b);b.click();document.body.removeChild(b)};this.state=function(){return a.recordingNode.node.state};this.recordingTime=function(){return c()};this.getTrack=function(){return this.export()};this.in_left=function(){return a.leftIn.node};this.in_right=function(){return a.rightIn.node};this.out_left=function(){return a.leftOut.node};this.out_right=
function(){return a.rightOut.node}};this.reverbUnit=function(d){function c(b,c,g){var e=new XMLHttpRequest;e.open("GET",b+c,!0);e.responseType="arraybuffer";e.onload=function(){a.reverbNode.node.disconnect();a.reverbNode.node=d.createConvolver();a.reverbGain.node.connect(a.reverbNode.node);a.reverbNode.node.connect(a.outAggregator.node);d.decodeAudioData(e.response,function(b){a.reverbNode.node.buffer=b},function(a){console.warn("Error with decoding audio data"+a.err)});g&&g()};e.send()}function g(a,
d){d=void 0===d?null:d;var b=new XMLHttpRequest;b.open("GET",a+"available2.list",!0);b.onload=function(){var a=b.response.split("\n");a[a.length-1]=a[a.length-1].split("");a[a.length-1].pop();a[a.length-1]=a[a.length-1].join("");a.splice(-1,1);null==d?console.log(a):d(a)};b.send()}var a={inAggregator:{},reverbGain:{},bypassGain:{},reverbNode:{},outAggregator:{}};a.inAggregator.gain=1;a.inAggregator.node=d.createGain();f.library.audio.changeAudioParam(d,a.inAggregator.node.gain,a.inAggregator.gain,
.01,"instant",!0);a.reverbGain.gain=.5;a.bypassGain.gain=.5;a.reverbGain.node=d.createGain();a.bypassGain.node=d.createGain();f.library.audio.changeAudioParam(d,a.reverbGain.node.gain,a.reverbGain.gain,.01,"instant",!0);f.library.audio.changeAudioParam(d,a.bypassGain.node.gain,a.bypassGain.gain,.01,"instant",!0);a.reverbNode.impulseResponseRepoURL="https://metasophiea.com/lib/audio/impulseResponse/";a.reverbNode.selectedReverbType="Musikvereinsaal.wav";a.reverbNode.node=d.createConvolver();a.outAggregator.gain=
1;a.outAggregator.node=d.createGain();f.library.audio.changeAudioParam(d,a.outAggregator.node.gain,a.outAggregator.gain,.01,"instant",!0);a.inAggregator.node.connect(a.reverbGain.node);a.inAggregator.node.connect(a.bypassGain.node);a.reverbGain.node.connect(a.reverbNode.node);a.bypassGain.node.connect(a.outAggregator.node);a.reverbNode.node.connect(a.outAggregator.node);this.in=function(){return a.inAggregator.node};this.out=function(){return a.outAggregator.node};this.getTypes=function(b){g(a.reverbNode.impulseResponseRepoURL,
b)};this.type=function(b,d){if(null==b)return a.reverbNode.selectedReverbType;a.reverbNode.selectedReverbType=b;c(a.reverbNode.impulseResponseRepoURL,a.reverbNode.selectedReverbType,d)};this.outGain=function(b){if(null==b)return a.outAggregator.gain;a.outAggregator.gain=b;f.library.audio.changeAudioParam(d,a.outAggregator.node.gain,b,.01,"instant",!0)};this.wetdry=function(b){if(null==b)return a.reverbGain.gain;a.reverbGain.gain=b;a.bypassGain.gain=1-b;f.library.audio.changeAudioParam(d,a.reverbGain.node.gain,
a.reverbGain.gain,.01,"instant",!0);f.library.audio.changeAudioParam(d,a.bypassGain.node.gain,a.bypassGain.gain,.01,"instant",!0)};c(a.reverbNode.impulseResponseRepoURL,a.reverbNode.selectedReverbType)};this.synthesizer=function(d,c,g,a,b,e,h,k,p,t,m,q,u,n,l,y){g=void 0===g?{sin:[0,1],cos:[0,0]}:g;a=void 0===a?1:a;b=void 0===b?0:b;e=void 0===e?0:e;h=void 0===h?.01:h;k=void 0===k?1:k;p=void 0===p?{time:.01,curve:"linear"}:p;t=void 0===t?{time:.05,curve:"linear"}:t;l=void 0===l?.01:l;y=void 0===y?1:
y;var v={},B={},x={},w={};v.waveType=void 0===c?"sine":c;v.periodicWave=g;v.attack=p;v.release=t;v.octave=void 0===m?0:m;v.detune=void 0===q?0:q;v.func=function(a,b,d,c,e,g,k,l,m,h){return new function(){this.generator=a.createOscillator();"custom"==c?this.generator.setPeriodicWave(a.createPeriodicWave(new Float32Array(e.cos),new Float32Array(e.sin))):this.generator.type=c;this.generator.frequency.setTargetAtTime(f.library.audio.num2freq(d+12*h),a.currentTime,0);this.generator.detune.setTargetAtTime(m,
a.currentTime,0);this.generator.start(0);this.gain=a.createGain();this.generator.connect(this.gain);this.gain.gain.setTargetAtTime(0,a.currentTime,0);f.library.audio.changeAudioParam(a,this.gain.gain,g,k.time,k.curve,!1);this.gain.connect(b);this.detune=function(b,d,c){f.library.audio.changeAudioParam(a,this.generator.detune,b,d,c)};this.changeVelocity=function(b){f.library.audio.changeAudioParam(a,this.gain.gain,b,k.time,k.curve)};this.stop=function(){f.library.audio.changeAudioParam(a,this.gain.gain,
0,l.time,l.curve,!1);setTimeout(function(a){a.gain.disconnect();a.generator.stop();a.generator.disconnect();a.gain=null;a.generator=null},1E3*l.time,this)}}};x.depth=void 0===u?0:u;x.period=void 0===n?0:n;x.phase=!0;x.wave="s";x.interval=null;x.start=function(){x.period<l||x.period>=y||(x.interval=setInterval(function(){var a=Object.keys(B);if(x.phase)for(var b=0;b<a.length;b++)B[a[b]].detune(x.depth,.9*x.period,x.wave);else for(b=0;b<a.length;b++)B[a[b]].detune(-x.depth,.9*x.period,x.wave);x.phase=
!x.phase},1E3*x.period))};x.stop=function(){clearInterval(x.interval)};var A=d.createGain();A.gain.setTargetAtTime(1,d.currentTime,0);w.depth=b;w.period=e;w.phase=!0;w.wave="s";w.interval=null;w.start=function(){w.period<h||w.period>=k?f.library.audio.changeAudioParam(d,w.node.gain,1,.01,w.wave):w.interval=setInterval(function(){w.phase?f.library.audio.changeAudioParam(d,w.node.gain,1,.9*w.period,w.wave):f.library.audio.changeAudioParam(d,w.node.gain,1-w.depth,.9*w.period,w.wave);w.phase=!w.phase},
1E3*w.period)};w.stop=function(){clearInterval(w.interval)};w.node=d.createGain();w.node.gain.setTargetAtTime(1,d.currentTime,0);A.connect(w.node);var G=d.createGain();G.gain.setTargetAtTime(a,d.currentTime,0);w.node.connect(G);this.out=function(){return G};this.perform=function(a){if(B[a.num]||0!=a.velocity)B[a.num]?0==a.velocity?(B[a.num].stop(),delete B[a.num]):B[a.num].changeVelocity(a.velocity):B[a.num]=v.func(d,A,a.num,v.waveType,v.periodicWave,a.velocity,v.attack,v.release,v.detune,v.octave)};
this.panic=function(){for(var a=Object.keys(B),b=0;b<a.length;b++)this.perform({num:a[b],velocity:0})};this.waveType=function(a){if(null==a)return v.waveType;v.waveType=a};this.periodicWave=function(a){if(null==a)return v.periodicWave;v.periodicWave=a};this.gain=function(a,b,c){return f.library.audio.changeAudioParam(d,G.gain,a,b,c)};this.attack=function(a,b){if(null==a&&null==b)return v.attack;v.attack.time=a?a:v.attack.time;v.attack.curve=b?b:v.attack.curve};this.release=function(a,b){if(null==
a&&null==b)return v.release;v.release.time=a?a:v.release.time;v.release.curve=b?b:v.release.curve};this.octave=function(a){if(null==a)return v.octave;v.octave=a};this.detune=function(a,b,d){if(null==a)return v.detune;var c=v.detune,e=a-c,g=Math.round(Math.abs(e)),f=g*b,k=[1];switch(d){case "linear":k=system.utility.math.curveGenerator.linear(f);break;case "exponential":k=system.utility.math.curveGenerator.exponential(f);break;case "s":k=system.utility.math.curveGenerator.s(f,8)}if(0!=k.length)var l=
setInterval(function(){v.detune=c+k.shift()*e;0==k.length&&clearInterval(l)},1E3/g);g=Object.keys(B);for(f=0;f<g.length;f++)B[g[f]].detune(a,b,d)};this.gainWobbleDepth=function(a){if(null==a)return w.depth;w.depth=a;w.stop();w.start()};this.gainWobblePeriod=function(a){if(null==a)return w.period;w.period=a;w.stop();w.start()};this.detuneWobbleDepth=function(a){if(null==a)return x.depth;x.depth=a;x.stop();x.start()};this.detuneWobblePeriod=function(a){if(null==a)return x.period;x.period=a;x.stop();
x.start()}}}};this.part=new function(){this.alpha=new function(){var d=this;this.basic=new function(){this.canvas=function(d,g,a,b,e,h,k,p,t){d=void 0===d?null:d;g=void 0===g?0:g;a=void 0===a?0:a;b=void 0===b?10:b;e=void 0===e?10:e;h=void 0===h?0:h;k=void 0===k?{x:0,y:0}:k;p=void 0===p?!1:p;t=void 0===t?1:t;var c=f.core.arrangement.createElement("canvas");c.name=d;c.x=g;c.y=a;c.parameter.width(b);c.parameter.height(e);c.resolution(t);c.angle=h;c.anchor=k;c.ignored=p;return c};this.circle=function(d,
g,a,b,e,h,k,p,t,m,q,u,n){d=void 0===d?null:d;g=void 0===g?0:g;a=void 0===a?0:a;b=void 0===b?2:b;e=void 0===e?!1:e;h=void 0===h?"rgba(255,100,255,1)":h;k=void 0===k?"rgba(0,0,0,0)":k;p=void 0===p?1:p;t=void 0===t?"round":t;m=void 0===m?2:m;q=void 0===q?"rgba(0,0,0,0)":q;u=void 0===u?20:u;n=void 0===n?{x:20,y:20}:n;var c=f.core.arrangement.createElement("circle");c.name=d;c.x=g;c.y=a;c.r=b;c.ignored=e;c.style.fill=h;c.style.stroke=k;c.style.lineWidth=p;c.style.lineJoin=t;c.style.miterLimit=m;c.style.shadowColour=
q;c.style.shadowBlur=u;c.style.shadowOffset=n;return c};this.group=function(d,g,a,b,e){d=void 0===d?null:d;g=void 0===g?0:g;a=void 0===a?0:a;b=void 0===b?0:b;e=void 0===e?!1:e;var c=f.core.arrangement.createElement("group");c.name=d;c.x=g;c.y=a;c.angle=b;c.ignored=e;return c};this.image=function(d,g,a,b,e,h,k,p,t){d=void 0===d?null:d;g=void 0===g?0:g;a=void 0===a?0:a;b=void 0===b?10:b;e=void 0===e?10:e;h=void 0===h?0:h;k=void 0===k?{x:0,y:0}:k;p=void 0===p?!1:p;t=void 0===t?"":t;var c=f.core.arrangement.createElement("image");
c.name=d;c.x=g;c.y=a;c.width=b;c.height=e;c.angle=h;c.anchor=k;c.ignored=p;c.url=t;return c};this.path=function(d,g,a,b,e,h,k,p,t,m,q){d=void 0===d?null:d;g=void 0===g?[]:g;a=void 0===a?!1:a;b=void 0===b?"rgba(0,0,0,1)":b;e=void 0===e?1:e;h=void 0===h?"butt":h;k=void 0===k?"miter":k;p=void 0===p?2:p;t=void 0===t?"rgba(0,0,0,0)":t;m=void 0===m?20:m;q=void 0===q?{x:20,y:20}:q;var c=f.core.arrangement.createElement("path");c.name=d;c.points=g;c.ignored=a;c.style.stroke=b;c.style.lineWidth=e;c.style.lineCap=
h;c.style.lineJoin=k;c.style.miterLimit=p;c.style.shadowColour=t;c.style.shadowBlur=m;c.style.shadowOffset=q;return c};this.polygon=function(d,g,a,b,e,h,k,p,t,m,q){d=void 0===d?null:d;g=void 0===g?[]:g;a=void 0===a?!1:a;b=void 0===b?"rgba(255,100,255,1)":b;e=void 0===e?"rgba(0,0,0,0)":e;h=void 0===h?1:h;k=void 0===k?"round":k;p=void 0===p?2:p;t=void 0===t?"rgba(0,0,0,0)":t;m=void 0===m?20:m;q=void 0===q?{x:20,y:20}:q;var c=f.core.arrangement.createElement("polygon");c.name=d;c.points=g;c.ignored=
a;c.style.fill=b;c.style.stroke=e;c.style.lineWidth=h;c.style.lineJoin=k;c.style.miterLimit=p;c.style.shadowColour=t;c.style.shadowBlur=m;c.style.shadowOffset=q;return c};this.advancedPolygon=function(d,g,a,b,e,h,k,p,t,m){d=void 0===d?null:d;g=void 0===g?[]:g;a=void 0===a?"rgba(255,100,255,1)":a;b=void 0===b?"rgba(0,0,0,1)":b;e=void 0===e?1:e;h=void 0===h?"round":h;k=void 0===k?2:k;p=void 0===p?"rgba(0,0,0,0)":p;t=void 0===t?20:t;m=void 0===m?{x:20,y:20}:m;var c=f.core.arrangement.createElement("advancedPolygon");
c.name=d;c.points=g;c.style.fill=a;c.style.stroke=b;c.style.lineWidth=e;c.style.lineJoin=h;c.style.miterLimit=k;c.style.shadowColour=p;c.style.shadowBlur=t;c.style.shadowOffset=m;return c};this.rectangle=function(d,g,a,b,e,h,k,p,t,m,q,u,n,l,y,v){d=void 0===d?null:d;g=void 0===g?0:g;a=void 0===a?0:a;b=void 0===b?10:b;e=void 0===e?10:e;h=void 0===h?0:h;k=void 0===k?{x:0,y:0}:k;p=void 0===p?!1:p;t=void 0===t?"rgba(255,100,255,1)":t;m=void 0===m?"rgba(0,0,0,0)":m;q=void 0===q?1:q;u=void 0===u?"round":
u;n=void 0===n?2:n;l=void 0===l?"rgba(0,0,0,0)":l;y=void 0===y?20:y;v=void 0===v?{x:20,y:20}:v;var c=f.core.arrangement.createElement("rectangle");c.name=d;c.x=g;c.y=a;c.width=b;c.height=e;c.angle=h;c.anchor=k;c.ignored=p;c.style.fill=t;c.style.stroke=m;c.style.lineWidth=q;c.style.lineJoin=u;c.style.miterLimit=n;c.style.shadowColour=l;c.style.shadowBlur=y;c.style.shadowOffset=v;return c};this.text=function(d,g,a,b,e,h,k,p,t,m,q,u,n,l,y,v,B,x,w){d=void 0===d?null:d;g=void 0===g?0:g;a=void 0===a?0:
a;b=void 0===b?"Hello":b;e=void 0===e?0:e;h=void 0===h?{x:0,y:0}:h;k=void 0===k?1:k;p=void 0===p?!1:p;t=void 0===t?"30pt Arial":t;m=void 0===m?"start":m;q=void 0===q?"alphabetic":q;u=void 0===u?"rgba(255,100,255,1)":u;n=void 0===n?"rgba(0,0,0,0)":n;l=void 0===l?1:l;y=void 0===y?"round":y;v=void 0===v?2:v;B=void 0===B?"rgba(0,0,0,0)":B;x=void 0===x?20:x;w=void 0===w?{x:20,y:20}:w;var c=f.core.arrangement.createElement("text");c.name=d;c.x=g;c.y=a;c.text=b;c.angle=e;c.anchor=h;c.size=k;c.ignored=p;
c.style.font=t;c.style.align=m;c.style.baseline=q;c.style.fill=u;c.style.stroke=n;c.style.lineWidth=l;c.style.lineJoin=y;c.style.miterLimit=v;c.style.shadowColour=B;c.style.shadowBlur=x;c.style.shadowOffset=w;return c}};this.display=new function(){this.audio_meter_level=function(c,g,a,b,e,f,k,p,t,m,q){e=void 0===e?20:e;f=void 0===f?60:f;k=void 0===k?[.125,.25,.375,.5,.625,.75,.875]:k;p=void 0===p?"rgb(10,10,10)":p;t=void 0===t?["rgba(250,250,250,1)","rgb(100,100,100)"]:t;m=void 0===m?"rgba(220,220,220,1)":
m;q=void 0===q?"1pt Courier New":q;c=d.builder("group",void 0===c?"audio_meter_level":c,{x:g,y:a,angle:void 0===b?0:b});var h=d.builder("meter_level","meter",{width:e,height:f,markings:k,style:{backing:p,levels:t,markingStyle_fill:m,markingStyle_font:q}});c.append(h);var n=r.circuit.alpha.audio2percentage();n.newValue=function(a){h.set(a)};c.audioIn=function(){return n.audioIn()};c.start=function(){n.start()};c.stop=function(){n.stop()};return c};this.glowbox_rect=function(c,g,a,b,e,f,k,p){b=void 0===
b?30:b;e=void 0===e?30:e;f=void 0===f?0:f;k=void 0===k?"rgba(244,234,141,1)":k;p=void 0===p?"rgba(80,80,80,1)":p;c=d.builder("group",void 0===c?"glowbox_rect":c,{x:g,y:a});var h=d.builder("rectangle","light",{width:b,height:e,angle:f,style:{fill:p}});c.append(h);c.on=function(){h.style.fill=k};c.off=function(){h.style.fill=p};return c};this.grapher=function(c,g,a,b,e,h,k,p,t,m,q,u,n){function l(){A.clear();for(var a=f.library.math.relativeDistance(b,v.left,v.right,B.mappedPosition),c=0;c<B.points.length;c++)if(B.points[c]<
v.top||B.points[c]>v.bottom){var g=e-f.library.math.relativeDistance(e,v.bottom,v.top,B.points[c]),k=d.builder("rectangle","horizontal_line_"+c,{x:0,y:g,width:b,height:m,style:{fill:t}});A.append(k);B.printText&&(k=d.builder("text","horizontal_text_"+c,{x:a+B.textPositionOffset.x,y:g+B.textPositionOffset.y,text:B.printingValues&&void 0!=B.printingValues[c]?B.printingValues[c]:B.points[c],style:{fill:q,font:u}}),A.append(k))}g=e-f.library.math.relativeDistance(e,v.bottom,v.top,x.mappedPosition);for(c=
0;c<x.points.length;c++)x.points[c]<v.left||x.points[c]>v.right||(a=f.library.math.relativeDistance(b,v.left,v.right,x.points[c]),k=d.builder("rectangle","vertical_line_"+c,{x:a,y:0,width:m,height:e,style:{fill:t}}),A.append(k),x.printText&&(k=d.builder("text","vertical_text_"+c,{x:a+x.textPositionOffset.x,y:g+x.textPositionOffset.y,text:x.printingValues&&void 0!=x.printingValues[c]?x.printingValues[c]:x.points[c],style:{fill:q,font:u}}),A.append(k)))}function y(a,g,l){l=void 0===l?0:l;G.clear();
w[l]=void 0==a&&void 0==g?void 0:{x:g,y:a};if(void 0!=w[l]&&void 0==w[l].y)console.warn("grapher error",c,"attempting to add line with no y component"),console.warn("x:",w[l].x),console.warn("y:",w[l].y);else for(a=0;a<w.length;a++)if(void 0!=w[a]){l=w[a];g=[];if(void 0!=l.y&&void 0==l.x)for(var m=0;m<l.y.length;m++)g.push({x:b/(l.y.length-1)*m,y:e-f.library.math.relativeDistance(e,v.bottom,v.top,l.y[m],!0)});else if(l.y.length==l.x.length)for(m=0;m<l.y.length;m++)g.push({x:f.library.math.relativeDistance(b,
v.left,v.right,l.x[m],!0),y:e-f.library.math.relativeDistance(e,v.bottom,v.top,l.y[m],!0)});else console.error("grapher::"+c,":layers are of differnt length:",l.y,l.x);G.append(d.builder("path","layer_"+a,{points:g,style:{stroke:k[a].stroke,lineWidth:k[a].lineWidth,lineJoin:k[a].lineJoin,lineCap:k[a].lineJoin}}))}}c=void 0===c?"grapher":c;b=void 0===b?120:b;e=void 0===e?60:e;k=void 0===k?[{stroke:"rgba(0,255,0,1)",lineWidth:.5,lineJoin:"round"},{stroke:"rgba(255,255,0,1)",lineWidth:.5,lineJoin:"round"},
{stroke:"rgba(0,255,255,1)",lineWidth:.5,lineJoin:"round"}]:k;t=void 0===t?"rgba(0,100,0,1)":t;m=void 0===m?.25:m;q=void 0===q?"rgba(0,150,0,1)":q;u=void 0===u?"1.5pt Helvetica":u;n=void 0===n?"rgba(50,50,50,1)":n;var v={bottom:-1,top:1,left:-1,right:1},B={points:[.75,.5,.25,0,-.25,-.5,-.75],printingValues:[],mappedPosition:0,textPositionOffset:{x:1,y:-.5},printText:!0},x={points:[.75,.5,.25,0,-.25,-.5,-.75],printingValues:[],mappedPosition:0,textPositionOffset:{x:1,y:-.5},printText:!0},w=[];g=d.builder("group",
c,{x:g,y:a,angle:void 0===h?0:h});n=d.builder("rectangle","backing",{width:b,height:e,style:{fill:n}});g.append(n);var A=d.builder("group","background");g.append(A);var G=d.builder("group","foreground");g.append(G);n=d.builder("rectangle","stencil",{width:b,height:e});g.stencil(n);g.clip(!0);g.viewbox=function(a){if(null==a)return v;void 0!=a.bottom&&(v.bottom=a.bottom);void 0!=a.top&&(v.top=a.top);void 0!=a.left&&(v.left=a.left);void 0!=a.right&&(v.right=a.right)};g.horizontalMarkings=function(a){if(null==
a)return B;void 0!=a.points&&(B.points=a.points);void 0!=a.printingValues&&(B.printingValues=a.printingValues);void 0!=a.textPositionOffset&&(B.textPositionOffset=a.textPositionOffset);void 0!=a.printText&&(B.printText=a.printText)};g.verticalMarkings=function(a){if(null==a)return x;void 0!=a.points&&(x.points=a.points);void 0!=a.printingValues&&(x.printingValues=a.printingValues);void 0!=a.textPositionOffset&&(x.textPositionOffset=a.textPositionOffset);void 0!=a.printText&&(x.printText=a.printText)};
g.drawBackground=function(){l()};g.drawForeground=function(a,b,c){y(a,b,void 0===c?0:c)};g.draw=function(a,b,c){c=void 0===c?0:c;l();y(a,b,c)};return g};this.grapher_audioScope=function(c,g,a,b,e,h,k,p,t,m,q,u,n,l){c=void 0===c?"grapher_audioScope":c;b=void 0===b?120:b;e=void 0===e?60:e;h=void 0===h?0:h;k=void 0===k?{stroke:"rgba(0,255,0,1)",lineWidth:.5,lineJoin:"round"}:k;p=void 0===p?{fill:"rgba(100,255,100,1)",size:.75,font:"Helvetica"}:p;t=void 0===t?"rgba(0,100,0,1)":t;m=void 0===m?.25:m;q=
void 0===q?"rgba(0,150,0,1)":q;u=void 0===u?.1:u;n=void 0===n?"Helvetica":n;l=void 0===l?"rgba(50,50,50,1)":l;var y=f.library.audio.context.createAnalyser(),v=null,B=10,x=null,w=256;y.fftSize=w;v=new Uint8Array(y.fftSize);new Uint8Array(y.fftSize);g=d.builder("group",c,{x:g,y:a,angle:h});var A=d.builder("grapher",c,{x:0,y:0,width:b,height:e,foregroundStyles:[k],foregroundTextStyles:[p],backgroundStyle_stroke:t,backgroundStyle_lineWidth:m,backgroundTextStyle_fill:q,backgroundTextStyle_size:u,backgroundTextStyle_font:n,
backingStyle:l});g.append(A);g.start=function(){null==x&&(x=setInterval(function(){var a=[];y.getByteTimeDomainData(v);for(var b=0;b<v.length;b++)a.push(v[b]/128-1);A.draw(a)},1E3/B))};g.stop=function(){clearInterval(x);x=null};g.getNode=function(){return y};g.resolution=function(a){a=void 0===a?null:a;if(null==a)return w;w=a;this.stop();this.start()};g.refreshRate=function(a){if(null==a)return B;B=a;this.stop();this.start()};A.viewbox({l:-1.1,h:1.1});A.horizontalMarkings({points:[1,.75,.5,.25,0,
-.25,-.5,-.75,-1],printText:!1});A.verticalMarkings({points:[-.25,-.5,-.75,0,.25,.5,.75],printText:!1});A.drawBackground();return g};this.grapher_audioScope__static=function(c,g,a,b,e,h,k,p,t,m,q,u,n,l){c=void 0===c?"grapher_audioScope__static":c;b=void 0===b?120:b;e=void 0===e?60:e;h=void 0===h?0:h;k=void 0===k?{stroke:"rgba(0,255,0,1)",lineWidth:.5,lineJoin:"round"}:k;p=void 0===p?{fill:"rgba(100,255,100,1)",size:.75,font:"Helvetica"}:p;t=void 0===t?"rgba(0,100,0,1)":t;m=void 0===m?.25:m;q=void 0===
q?"rgba(0,150,0,1)":q;u=void 0===u?.1:u;n=void 0===n?"Helvetica":n;l=void 0===l?"rgba(50,50,50,1)":l;var y=f.library.audio.context.createAnalyser(),v=null,B=10,x=null,w=256;y.fftSize=w;v=new Uint8Array(y.fftSize);new Uint8Array(y.fftSize);g=d.builder("group",c,{x:g,y:a,angle:h});var A=d.builder("grapher__static",c,{x:0,y:0,width:b,height:e,foregroundStyles:[k],foregroundTextStyles:[p],backgroundStyle_stroke:t,backgroundStyle_lineWidth:m,backgroundTextStyle_fill:q,backgroundTextStyle_size:u,backgroundTextStyle_font:n,
backingStyle:l});g.append(A);g.start=function(){null==x&&(x=setInterval(function(){var a=[];y.getByteTimeDomainData(v);for(var b=0;b<v.length;b++)a.push(v[b]/128-1);A.draw(a)},1E3/B))};g.stop=function(){clearInterval(x);x=null};g.getNode=function(){return y};g.resolution=function(a){a=void 0===a?null:a;if(null==a)return w;w=a;this.stop();this.start()};g.refreshRate=function(a){if(null==a)return B;B=a;this.stop();this.start()};A.viewbox({l:-1.1,h:1.1});A.horizontalMarkings({points:[1,.75,.5,.25,0,
-.25,-.5,-.75,-1],printText:!1});A.verticalMarkings({points:[-.25,-.5,-.75,0,.25,.5,.75],printText:!1});A.drawBackground();return g};this.grapher_periodicWave=function(c,g,a,b,e,f,k,p,t,m,q,u,n,l){c=void 0===c?"grapher_periodicWave":c;b=void 0===b?120:b;e=void 0===e?60:e;k=void 0===k?{stroke:"rgba(0,255,0,1)",lineWidth:.5,lineJoin:"round"}:k;p=void 0===p?{fill:"rgba(100,255,100,1)",size:.75,font:"Helvetica"}:p;t=void 0===t?"rgba(0,100,0,1)":t;m=void 0===m?.25:m;q=void 0===q?"rgba(0,150,0,1)":q;u=
void 0===u?.1:u;n=void 0===n?"Helvetica":n;l=void 0===l?"rgba(50,50,50,1)":l;var h={sin:[],cos:[]},v=100;g=d.builder("group",c,{x:g,y:a,angle:void 0===f?0:f});var B=d.builder("grapher",c,{x:0,y:0,width:b,height:e,foregroundStyles:[k],foregroundTextStyles:[p],backgroundStyle_stroke:t,backgroundStyle_lineWidth:m,backgroundTextStyle_fill:q,backgroundTextStyle_size:u,backgroundTextStyle_font:n,backingStyle:l});g.append(B);g.wave=function(a,b){a=void 0===a?null:a;b=void 0===b?null:b;if(null==a){for(;h.sin.length<
h.cos.length;)h.sin.push(0);for(;h.sin.length>h.cos.length;)h.cos.push(0);for(a=0;a<h.sin.length;a++)h.sin[a]||(h.sin[a]=0),h.cos[a]||(h.cos[a]=0);return h}null==b&&(h=a);switch(b){case "sin":h.sin=a;break;case "cos":h.cos=a}};g.waveElement=function(a,b,c){if(null==c)return h[a][b];h[a][b]=c};g.resolution=function(a){a=void 0===a?null:a;if(null==a)return v;v=a};g.updateBackground=function(){B.viewbox({bottom:-1.1,top:1.1,left:0});B.horizontalMarkings({points:[1,.75,.5,.25,0,-.25,-.5,-.75,-1],printText:!0});
B.verticalMarkings({points:[0,.25,.5,.75],printText:!0});B.drawBackground()};g.draw=function(){for(var a=[],b,c=0;c<=v;c++){for(var d=b=0;d<h.sin.length;d++)h.sin[d]||(h.sin[d]=0),b+=Math.sin(c/v*d*Math.PI*2)*h.sin[d];for(d=0;d<h.cos.length;d++)h.cos[d]||(h.cos[d]=0),b+=Math.cos(c/v*d*Math.PI*2)*h.cos[d];a.push(b)}B.draw(a)};g.reset=function(){this.wave({sin:[],cos:[]});this.resolution(100);this.updateBackground()};return g};this.grapher_periodicWave__static=function(c,g,a,b,e,f,k,p,t,m,q,u,n,l){c=
void 0===c?"grapher_periodicWave__static":c;b=void 0===b?120:b;e=void 0===e?60:e;k=void 0===k?{stroke:"rgba(0,255,0,1)",lineWidth:.5,lineJoin:"round"}:k;p=void 0===p?{fill:"rgba(100,255,100,1)",size:.75,font:"Helvetica"}:p;t=void 0===t?"rgba(0,100,0,1)":t;m=void 0===m?.25:m;q=void 0===q?"rgba(0,150,0,1)":q;u=void 0===u?.1:u;n=void 0===n?"Helvetica":n;l=void 0===l?"rgba(50,50,50,1)":l;var h={sin:[],cos:[]},v=100;g=d.builder("group",c,{x:g,y:a,angle:void 0===f?0:f});var B=d.builder("grapher__static",
c,{x:0,y:0,width:b,height:e,foregroundStyles:[k],foregroundTextStyles:[p],backgroundStyle_stroke:t,backgroundStyle_lineWidth:m,backgroundTextStyle_fill:q,backgroundTextStyle_size:u,backgroundTextStyle_font:n,backingStyle:l});g.append(B);g.wave=function(a,b){a=void 0===a?null:a;b=void 0===b?null:b;if(null==a){for(;h.sin.length<h.cos.length;)h.sin.push(0);for(;h.sin.length>h.cos.length;)h.cos.push(0);for(a=0;a<h.sin.length;a++)h.sin[a]||(h.sin[a]=0),h.cos[a]||(h.cos[a]=0);return h}null==b&&(h=a);switch(b){case "sin":h.sin=
a;break;case "cos":h.cos=a}};g.waveElement=function(a,b,c){if(null==c)return h[a][b];h[a][b]=c};g.resolution=function(a){a=void 0===a?null:a;if(null==a)return v;v=a};g.updateBackground=function(){B.viewbox({bottom:-1.1,top:1.1,left:0});B.horizontalMarkings({points:[1,.75,.5,.25,0,-.25,-.5,-.75,-1],printText:!0});B.verticalMarkings({points:[0,.25,.5,.75],printText:!0});B.drawBackground()};g.draw=function(){for(var a=[],b,c=0;c<=v;c++){for(var d=b=0;d<h.sin.length;d++)h.sin[d]||(h.sin[d]=0),b+=Math.sin(c/
v*d*Math.PI*2)*h.sin[d];for(d=0;d<h.cos.length;d++)h.cos[d]||(h.cos[d]=0),b+=Math.cos(c/v*d*Math.PI*2)*h.cos[d];a.push(b)}B.draw(a)};g.reset=function(){this.wave({sin:[],cos:[]});this.resolution(100);this.updateBackground()};return g};this.grapher__static=function(c,g,a,b,e,h,k,p,t,m,q,u,n,l){function y(){C._.fillStyle=l;C._.fillRect(0,0,C.$(b),C.$(e))}function v(){for(var a=f.library.math.relativeDistance(b,x.left,x.right,w.mappedPosition),c=0;c<w.points.length;c++)if(w.points[c]<x.top||w.points[c]>
x.bottom){var d=e-f.library.math.relativeDistance(e,x.bottom,x.top,w.points[c]);C._.fillStyle=m;C._.fillRect(0,C.$(d),C.$(b),C.$(q));w.printText&&(C._.fillStyle=u,C._.font=n,C._.fillText(w.printingValues&&void 0!=w.printingValues[c]?w.printingValues[c]:w.points[c],C.$(a+w.textPositionOffset.x),C.$(d+w.textPositionOffset.y)))}d=e-f.library.math.relativeDistance(e,x.bottom,x.top,A.mappedPosition);for(c=0;c<A.points.length;c++)A.points[c]<x.left||A.points[c]>x.right||(a=f.library.math.relativeDistance(b,
x.left,x.right,A.points[c]),C._.fillStyle=m,C._.fillRect(C.$(a),0,C.$(q),C.$(e)),A.printText&&(C._.fillStyle=u,C._.font=n,C._.fillText(A.printingValues&&void 0!=A.printingValues[c]?A.printingValues[c]:A.points[c],C.$(a+A.textPositionOffset.x),C.$(d+A.textPositionOffset.y))))}function B(a,d,g){g=void 0===g?0:g;r[g]=void 0==a&&void 0==d?void 0:{x:d,y:a};if(void 0!=r[g]&&void 0==r[g].y)console.warn("grapher__static error",c,"attempting to add line with no y component"),console.warn("x:",r[g].x),console.warn("y:",
r[g].y);else for(a=0;a<r.length;a++)if(void 0!=r[a]){g=r[a];C._.strokeStyle=p[a].stroke;C._.lineWidth=C.$(p[a].lineWidth);C._.lineJoin=p[a].lineJoin;C._.lineCap=p[a].lineJoin;C._.beginPath();if(void 0!=g.y&&void 0==g.x)for(C._.moveTo(0,C.$(e-f.library.math.relativeDistance(e,x.bottom,x.top,g.y[0],!0))),d=1;d<g.y.length;d++)C._.lineTo(C.$(b/(g.y.length-1)*d),C.$(e-f.library.math.relativeDistance(e,x.bottom,x.top,g.y[d],!0)));else if(g.y.length==g.x.length)for(d=0;d<g.y.length;d++)for(C._.moveTo(C.$(f.library.math.relativeDistance(b,
x.left,x.right,g.x[0],!0)),C.$(e-f.library.math.relativeDistance(e,x.bottom,x.top,g.y[0],!0))),d=1;d<g.y.length;d++)C._.lineTo(C.$(f.library.math.relativeDistance(b,x.left,x.right,g.x[d],!0)),C.$(e-f.library.math.relativeDistance(e,x.bottom,x.top,g.y[d],!0)));else console.error("grapher__static::"+c,":layers are of different length:",g.y,g.x);C._.stroke()}}c=void 0===c?"grapher__static":c;b=void 0===b?120:b;e=void 0===e?60:e;k=void 0===k?5:k;p=void 0===p?[{stroke:"rgba(0,255,0,1)",lineWidth:.5,lineJoin:"round"},
{stroke:"rgba(255,255,0,1)",lineWidth:.5,lineJoin:"round"},{stroke:"rgba(0,255,255,1)",lineWidth:.5,lineJoin:"round"}]:p;m=void 0===m?"rgba(0,100,0,1)":m;q=void 0===q?.25:q;u=void 0===u?"rgba(0,150,0,1)":u;n=void 0===n?"7.5pt Helvetica":n;l=void 0===l?"rgba(50,50,50,1)":l;var x={bottom:-1,top:1,left:-1,right:1},w={points:[.75,.5,.25,0,-.25,-.5,-.75],printingValues:[],mappedPosition:0,textPositionOffset:{x:1,y:-.5},printText:!0},A={points:[.75,.5,.25,0,-.25,-.5,-.75],printingValues:[],mappedPosition:0,
textPositionOffset:{x:1,y:-.5},printText:!0},r=[];g=d.builder("group",c,{x:g,y:a,angle:void 0===h?0:h});var C=d.builder("canvas","backing",{width:b,height:e,resolution:k});g.append(C);g.resolution=function(a){return C.resolution(a)};g.viewbox=function(a){if(null==a)return x;void 0!=a.bottom&&(x.bottom=a.bottom);void 0!=a.top&&(x.top=a.top);void 0!=a.left&&(x.left=a.left);void 0!=a.right&&(x.right=a.right)};g.horizontalMarkings=function(a){if(null==a)return w;void 0!=a.points&&(w.points=a.points);
void 0!=a.printingValues&&(w.printingValues=a.printingValues);void 0!=a.textPositionOffset&&(w.textPositionOffset=a.textPositionOffset);void 0!=a.printText&&(w.printText=a.printText)};g.verticalMarkings=function(a){if(null==a)return A;void 0!=a.points&&(A.points=a.points);void 0!=a.printingValues&&(A.printingValues=a.printingValues);void 0!=a.textPositionOffset&&(A.textPositionOffset=a.textPositionOffset);void 0!=a.printText&&(A.printText=a.printText)};g.drawBackground=function(){y();v()};g.drawForeground=
function(a,b,c){B(a,b,void 0===c?0:c)};g.draw=function(a,b,c){c=void 0===c?0:c;y();v();B(a,b,c)};return g};this.level=function(c,g,a,b,e,f,k,p){e=void 0===e?20:e;f=void 0===f?60:f;k=void 0===k?"rgb(10,10,10)":k;p=void 0===p?["rgb(250,250,250)","rgb(200,200,200)"]:p;var h=[];c=d.builder("group",void 0===c?"level":c,{x:g,y:a,angle:void 0===b?0:b});k=d.builder("rectangle","backing",{width:e,height:f,style:{fill:k}});c.append(k);k=d.builder("group","levels");c.append(k);var m=[];for(g=0;g<p.length;g++)h.push(0),
m.push(d.builder("rectangle","movingRect_"+g,{y:f,width:e,height:0,style:{fill:p[g]}})),k.prepend(m[g]);c.layer=function(a,b){b=void 0===b?0:b;if(void 0==b)return h;if(null==a)return h[b];a=1<a?1:a;a=0>a?0:a;h[b]=a;m[b].parameter.height(f*a);m[b].parameter.y(f-f*a)};return c};this.meter_level=function(c,g,a,b,e,f,k,p,t,m,q){function h(a){return d.builder("polygon","mark_"+a,{points:[{x:e,y:a-.1},{x:e-e/4,y:a-.1},{x:e-e/4,y:a+.1},{x:e,y:a+.1}],style:{fill:m}})}function n(a,b){return d.builder("text",
"text_"+b,{x:.5,y:a+.3,text:b,style:{fill:m,font:q}})}e=void 0===e?20:e;f=void 0===f?60:f;k=void 0===k?[.125,.25,.375,.5,.625,.75,.875]:k;p=void 0===p?"rgb(10,10,10)":p;t=void 0===t?["rgba(250,250,250,1)","fill:rgb(100,100,100)"]:t;m=void 0===m?"rgba(220,220,220,1)":m;q=void 0===q?"1pt Courier New":q;c=d.builder("group",void 0===c?"meter_level":c,{x:g,y:a,angle:void 0===b?0:b});var l=d.builder("level","level",{width:e,height:f,style:{backing:p,levels:t}});c.append(l);p=d.builder("group","markings");
c.append(p);for(t=0;t<k.length;t++)p.append(h(f*(1-k[t]))),p.append(n(f*(1-k[t]),k[t]));var y=0,v=0;setInterval(function(){l.layer(v,0);0<y&&(y-=.005);l.layer(y,1);v>y&&(y=v)},1E3/15);c.set=function(a){v=a};return c};this.rastorDisplay=function(c,g,a,b,e,f,k,p,t,m,q,u){function h(){for(var a=0;a<k;a++)for(var b=0;b<p;b++)l[a][b].style.fill="rgb("+255*y[a][b][0]+","+255*y[a][b][1]+","+255*y[a][b][2]+")"}e=void 0===e?60:e;f=void 0===f?60:f;k=void 0===k?8:k;p=void 0===p?8:p;t=void 0===t?.1:t;m=void 0===
m?.1:m;q=void 0===q?"rgba(50,50,50)":q;u=void 0===u?"rgba(0,0,0)":u;c=d.builder("group",void 0===c?"rastorDisplay":c,{x:g,y:a,angle:void 0===b?0:b});q=d.builder("rectangle","backing",{width:e,height:f,style:{fill:q}});c.append(q);b=d.builder("group","pixels");c.append(b);var l=[],y=[];e/=k;f/=p;for(g=0;g<k;g++){var v=[],B=[];for(a=0;a<p;a++)q=d.builder("rectangle",g+"_"+a,{x:g*e+t/2,y:a*f+m/2,width:e-t,height:f-m,style:{fill:u}}),v.push(q),B.push([0,0,0]),b.append(q);l.push(v);y.push(B)}c.get=function(a,
b){return y[a][b]};c.set=function(a,b,c){y[a][b]=c;h()};c.import=function(a){for(var b=0;b<k;b++)for(var c=0;c<p;c++)this.set(b,c,a[b][c]);h()};c.export=function(){return y};c.setAll=function(a){for(var b=0;b<k;b++)for(var c=0;c<p;c++)this.set(b,c,a)};c.test=function(){this.setAll([1,1,1]);this.set(1,1,[1,.5,.5]);this.set(2,2,[.5,1,.5]);this.set(3,3,[.5,.5,1]);this.set(4,4,[1,.5,1]);h()};return c};this.readout_sixteenSegmentDisplay=function(c,g,a,b,e,f,k,p,t,m){b=void 0===b?100:b;e=void 0===e?30:
e;f=void 0===f?5:f;p=void 0===p?"rgb(0,0,0)":p;t=void 0===t?"rgb(200,200,200)":t;m=void 0===m?"rgb(20,20,20)":m;var h="",u=null;c=d.builder("group",void 0===c?"readout_sixteenSegmentDisplay":c,{x:g,y:a,angle:void 0===k?0:k});var n=[];for(g=0;g<f;g++)a=d.builder("sixteenSegmentDisplay",""+g,{x:b/f*g,width:b/f,height:e,style:{background:p,glow:t,dim:m}}),c.append(a),n.push(a);c.text=function(a){if(null==a)return h;h=a};c.print=function(a){clearInterval(u);switch(a){case "smart":h.length>n.length?this.print("r2lSweep"):
this.print("regular");break;case "r2lSweep":var b=0;u=setInterval(function(){for(var a=n.length-1;0<=a;a--)n[a].enterCharacter(h[b-(n.length-1-a)]);b++;b>n.length+h.length-1&&(b=0)},150);break;default:for(a=0;a<n.length;a++)n[a].enterCharacter(h[a])}};return c};this.readout_sixteenSegmentDisplay__static=function(c,g,a,b,e,f,k,p,t,m,q){b=void 0===b?100:b;e=void 0===e?30:e;f=void 0===f?5:f;p=void 0===p?5:p;t=void 0===t?"rgb(0,0,0)":t;m=void 0===m?"rgb(200,200,200)":m;q=void 0===q?"rgb(20,20,20)":q;
var h="",n=null;c=d.builder("group",void 0===c?"readout_sixteenSegmentDisplay__static":c,{x:g,y:a,angle:void 0===k?0:k});var l=[];for(g=0;g<f;g++)a=d.builder("sixteenSegmentDisplay__static",""+g,{x:b/f*g,width:b/f,height:e,resolution:p,style:{background:t,glow:m,dim:q}}),c.append(a),l.push(a);c.text=function(a){if(null==a)return h;h=a};c.print=function(a){clearInterval(n);switch(a){case "smart":h.length>l.length?this.print("r2lSweep"):this.print("regular");break;case "r2lSweep":var b=0;n=setInterval(function(){for(var a=
l.length-1;0<=a;a--)l[a].enterCharacter(h[b-(l.length-1-a)]);b++;b>l.length+h.length-1&&(b=0)},150);break;default:for(a=0;a<l.length;a++)l[a].enterCharacter(h[a])}};return c};this.sevenSegmentDisplay=function(c,g,a,b,e,f,k,p,t){b=void 0===b?20:b;e=void 0===e?30:e;k=void 0===k?"rgb(0,0,0)":k;p=void 0===p?"rgb(200,200,200)":p;t=void 0===t?"rgb(20,20,20)":t;var m=b/8,h=b/8;f=[{x:1*h+m,y:1*h+m},{x:.5*h+m,y:.5*h+m},{x:1*h+m,y:0*h+m},{x:0*h+m,y:1*h+m}];var u=[{x:b-1*h-m,y:0*h+m},{x:b-.5*h-m,y:.5*h+m},{x:b-
1*h-m,y:1*h+m},{x:b-0*h-m,y:1*h+m}],n=[{x:1*h+m,y:.5*e-1*h+.5*m},{x:.5*h+m,y:.5*e-.5*h+.5*m},{x:1*h+m,y:.5*e-0*h+.5*m},{x:0*h+m,y:.5*e-1*h+.5*m},{x:0*h+m,y:.5*e-0*h+.5*m}],l=[{x:b-1*h-m,y:.5*e-0*h+.5*m},{x:b-.5*h-m,y:.5*e-.5*h+.5*m},{x:b-1*h-m,y:.5*e-1*h+.5*m},{x:b-0*h-m,y:.5*e-1*h+.5*m},{x:b-0*h-m,y:.5*e-0*h+.5*m}],y=[{x:1*h+m,y:e-1*h-m},{x:.5*h+m,y:e-.5*h-m},{x:1*h+m,y:e-0*h-m},{x:0*h+m,y:e-1*h-m}];m=[{x:b-1*h-m,y:e-0*h-m},{x:b-.5*h-m,y:e-.5*h-m},{x:b-1*h-m,y:e-1*h-m},{x:b-0*h-m,y:e-1*h-m}];c=d.builder("group",
void 0===c?"sevenSegmentDisplay":c,{x:g,y:a});b=d.builder("rectangle","backing",{width:b,height:e,style:{fill:k}});c.append(b);var v=[];b=[[f[0],u[2],u[1],u[0],f[2],f[1]],[f[1],f[3],n[3],n[1],n[0],f[0]],[u[1],u[3],l[3],l[1],l[2],u[2]],[n[0],l[2],l[1],l[0],n[2],n[1]],[n[1],n[4],y[3],y[1],y[0],n[2]],[l[1],l[4],m[3],m[1],m[2],l[0]],[y[0],m[2],m[1],m[0],y[2],y[1]]];for(e=0;e<b.length;e++)k={segment:d.builder("polygon","segment_"+e,{points:b[e],style:{fill:t}}),state:!1},v.push(k),c.append(k.segment);
c.set=function(a,b){v[a].state=b;v[a].segment.style.fill=b?p:t};c.get=function(a){return v[a].state};c.clear=function(){for(var a=0;a<v.length;a++)this.set(a,!1)};c.enterCharacter=function(a){switch(a){case 0:case "0":a=[1,1,1,0,1,1,1];break;case 1:case "1":a=[0,0,1,0,0,1,0];break;case 2:case "2":a=[1,0,1,1,1,0,1];break;case 3:case "3":a=[1,0,1,1,0,1,1];break;case 4:case "4":a=[0,1,1,1,0,1,0];break;case 5:case "5":a=[1,1,0,1,0,1,1];break;case 6:case "6":a=[1,1,0,1,1,1,1];break;case 7:case "7":a=[1,
0,1,0,0,1,0];break;case 8:case "8":a=[1,1,1,1,1,1,1];break;case 9:case "9":a=[1,1,1,1,0,1,1];break;default:a=[0,0,0,0,0,0,0]}for(var b=0;b<a.length;b++)this.set(b,1==a[b])};return c};this.sevenSegmentDisplay__static=function(c,g,a,b,e,f,k,p,t,m){function h(){C._.fillStyle=p;C._.fillRect(0,0,C.$(b),C.$(e))}function u(){for(var a=0;a<A.length;a++){C._.beginPath();C._.moveTo(C.$(A[a][0].x),C.$(A[a][0].y));for(var b=1;b<A[a].length;b++)C._.lineTo(C.$(A[a][b].x),C.$(A[a][b].y));C._.closePath();C._.fillStyle=
0==r[a]?m:t;C._.fill()}}b=void 0===b?20:b;e=void 0===e?30:e;k=void 0===k?5:k;p=void 0===p?"rgb(0,0,0)":p;t=void 0===t?"rgb(200,200,200)":t;m=void 0===m?"rgb(20,20,20)":m;var n=b/8,l=b/8,y=[{x:1*l+n,y:1*l+n},{x:.5*l+n,y:.5*l+n},{x:1*l+n,y:0*l+n},{x:0*l+n,y:1*l+n}],v=[{x:b-1*l-n,y:0*l+n},{x:b-.5*l-n,y:.5*l+n},{x:b-1*l-n,y:1*l+n},{x:b-0*l-n,y:1*l+n}],B=[{x:1*l+n,y:.5*e-1*l+.5*n},{x:.5*l+n,y:.5*e-.5*l+.5*n},{x:1*l+n,y:.5*e-0*l+.5*n},{x:0*l+n,y:.5*e-1*l+.5*n},{x:0*l+n,y:.5*e-0*l+.5*n}],x=[{x:b-1*l-n,y:.5*
e-0*l+.5*n},{x:b-.5*l-n,y:.5*e-.5*l+.5*n},{x:b-1*l-n,y:.5*e-1*l+.5*n},{x:b-0*l-n,y:.5*e-1*l+.5*n},{x:b-0*l-n,y:.5*e-0*l+.5*n}],w=[{x:1*l+n,y:e-1*l-n},{x:.5*l+n,y:e-.5*l-n},{x:1*l+n,y:e-0*l-n},{x:0*l+n,y:e-1*l-n}];n=[{x:b-1*l-n,y:e-0*l-n},{x:b-.5*l-n,y:e-.5*l-n},{x:b-1*l-n,y:e-1*l-n},{x:b-0*l-n,y:e-1*l-n}];var A=[[y[0],v[2],v[1],v[0],y[2],y[1]],[y[1],y[3],B[3],B[1],B[0],y[0]],[v[1],v[3],x[3],x[1],x[2],v[2]],[B[0],x[2],x[1],x[0],B[2],B[1]],[B[1],B[4],w[3],w[1],w[0],B[2]],[x[1],x[4],n[3],n[1],n[2],x[0]],
[w[0],n[2],n[1],n[0],w[2],w[1]]],r=[0,0,0,0,0,0,0];c=d.builder("group",void 0===c?"sevenSegmentDisplay__static":c,{x:g,y:a,angle:void 0===f?0:f});var C=d.builder("canvas","subcanvas",{width:b,height:e,resolution:k});c.append(C);c.set=function(a,b){r[a].state=b;u()};c.get=function(a){return r[a].state};c.clear=function(){for(var a=0;a<r.length;a++)this.set(a,!1)};c.enterCharacter=function(a){switch(a){case 0:case "0":r=[1,1,1,0,1,1,1];break;case 1:case "1":r=[0,0,1,0,0,1,0];break;case 2:case "2":r=
[1,0,1,1,1,0,1];break;case 3:case "3":r=[1,0,1,1,0,1,1];break;case 4:case "4":r=[0,1,1,1,0,1,0];break;case 5:case "5":r=[1,1,0,1,0,1,1];break;case 6:case "6":r=[1,1,0,1,1,1,1];break;case 7:case "7":r=[1,0,1,0,0,1,0];break;case 8:case "8":r=[1,1,1,1,1,1,1];break;case 9:case "9":r=[1,1,1,1,0,1,1];break;default:r=[0,0,0,0,0,0,0]}h();u()};h();u();return c};this.sixteenSegmentDisplay=function(c,g,a,b,e,f,k,p,t){b=void 0===b?20:b;e=void 0===e?30:e;k=void 0===k?"rgb(0,0,0)":k;p=void 0===p?"rgb(200,200,200)":
p;t=void 0===t?"rgb(20,20,20)":t;var h=b/8,q=b/8;f=[{x:.5*q+h,y:.5*q+h},{x:1*q+h,y:0*q+h},{x:0*q+h,y:1*q+h},{x:1*q+h,y:1*q+h},{x:1.75*q+h,y:1*q+h},{x:1*q+h,y:1.75*q+h}];var u=[{x:b/2,y:.5*q+h},{x:b/2-.5*q,y:1*q+h},{x:b/2+.5*q,y:1*q+h},{x:b/2-.5*q,y:0*q+h},{x:b/2+.5*q,y:0*q+h}],n=[{x:b-.5*q-h,y:.5*q+h},{x:b-1*q-h,y:0*q+h},{x:b-0*q-h,y:1*q+h},{x:b-1*q-h,y:1*q+h},{x:b-1*q-h,y:1.75*q+h},{x:b-1.75*q-h,y:1*q+h}],l=[{x:0*q+h,y:.5*e-.5*q},{x:1*q+h,y:.5*e-.5*q},{x:.5*q+h,y:.5*e-0*q},{x:0*q+h,y:.5*e+.5*q},
{x:1*q+h,y:.5*e+.5*q}],y=[{x:b/2,y:e/2},{x:b/2-.5*q,y:.5*q+e/2},{x:b/2-.25*q,y:1.25*q+e/2},{x:b/2-1*q,y:.5*q+e/2},{x:b/2+.5*q,y:.5*q+e/2},{x:b/2+.5*q,y:1.75*q+e/2},{x:b/2+1*q,y:.5*q+e/2},{x:b/2-.5*q,y:.5*-q+e/2},{x:b/2-.25*q,y:1.25*-q+e/2},{x:b/2-1*q,y:.25*-q+e/2},{x:b/2+.5*q,y:.5*-q+e/2},{x:b/2+.5*q,y:1.75*-q+e/2},{x:b/2+1*q,y:.25*-q+e/2}],v=[{x:b-1*q-h,y:.5*e-.5*q},{x:b-0*q-h,y:.5*e-.5*q},{x:b-.5*q-h,y:.5*e-0*q},{x:b-1*q-h,y:.5*e+.5*q},{x:b-0*q-h,y:.5*e+.5*q}],B=[{x:.5*q+h,y:e-.5*q-h},{x:0*q+h,
y:e-1*q-h},{x:1*q+h,y:e-0*q-h},{x:1*q+h,y:e-1*q-h},{x:1*q+h,y:e-1.75*q-h},{x:1.75*q+h,y:e-1*q-h}],x=[{x:b/2-.5*q,y:e-1*q-h},{x:b/2+.5*q,y:e-1*q-h},{x:b/2,y:e-.5*q-h},{x:b/2-.5*q,y:e-0*q-h},{x:b/2+.5*q,y:e-0*q-h}];h=[{x:b-.5*q-h,y:e-.5*q-h},{x:b-0*q-h,y:e-1*q-h},{x:b-1*q-h,y:e-0*q-h},{x:b-1*q-h,y:e-1*q-h},{x:b-1*q-h,y:e-1.75*q-h},{x:b-1.75*q-h,y:e-1*q-h}];c=d.builder("group",void 0===c?"sixteenSegmentDisplay":c,{x:g,y:a});b=d.builder("rectangle","backing",{width:b,height:e,style:{fill:k}});c.append(b);
var w=[];b=[[f[1],f[0],f[3],u[1],u[0],u[3]],[u[4],u[0],u[2],n[3],n[0],n[1]],[f[0],f[2],l[0],l[2],l[1],f[3]],[f[4],f[3],f[5],y[9],y[7],y[8]],[u[0],u[1],y[7],y[0],y[10],u[2]],[n[4],n[3],n[5],y[11],y[10],y[12]],[n[0],n[2],v[1],v[2],v[0],n[3]],[l[4],l[2],l[1],y[7],y[0],y[1]],[v[3],v[2],v[0],y[10],y[0],y[4]],[B[0],B[1],l[3],l[2],l[4],B[3]],[B[4],B[3],B[5],y[2],y[1],y[3]],[x[0],x[2],x[1],y[4],y[0],y[1]],[h[4],h[3],h[5],y[5],y[4],y[6]],[h[3],v[3],v[2],v[4],h[1],h[0]],[B[2],B[0],B[3],x[0],x[2],x[3]],[h[2],
h[0],h[3],x[1],x[2],x[4]]];for(e=0;e<b.length;e++)k={segment:d.builder("polygon","segment_"+e,{points:b[e],style:{fill:t}}),state:!1},w.push(k),c.append(k.segment);c.set=function(a,b){w[a].state=b;w[a].segment.style.fill=b?p:t};c.get=function(a){return w[a].state};c.clear=function(){for(var a=0;a<w.length;a++)this.set(a,!1)};c.enterCharacter=function(a){switch(a){case "!":a=[1,1,0,1,1,1,0,0,0,0,0,0,0,0,1,1];break;case "?":a=[1,1,0,0,0,0,1,0,1,0,0,0,0,0,1,1];break;case ".":a=[0,0,0,0,0,0,0,0,0,0,0,
0,0,0,1,0];break;case ",":a=[0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0];break;case "'":a=[0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0];break;case ":":a=[0,0,0,1,0,1,0,0,0,0,1,0,1,0,0,0];break;case '"':a=[0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0];break;case "_":a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1];break;case "-":a=[0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0];break;case "\\":a=[0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0];break;case "/":a=[0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];break;case "*":a=[0,0,0,1,1,1,0,1,1,0,1,1,1,0,0,0];break;case "#":a=[1,1,1,0,1,0,
1,1,1,1,0,1,0,1,1,1];break;case "<":a=[0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0];break;case ">":a=[0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0];break;case "(":a=[0,1,0,0,1,0,0,0,0,0,0,1,0,0,0,1];break;case ")":a=[1,0,0,0,1,0,0,0,0,0,0,1,0,0,1,0];break;case "[":a=[1,1,1,0,0,0,0,0,0,1,0,0,0,0,1,1];break;case "]":a=[1,1,0,0,0,0,1,0,0,0,0,0,0,1,1,1];break;case "{":a=[1,1,0,1,0,0,0,1,0,0,1,0,0,0,1,1];break;case "}":a=[1,1,0,0,0,1,0,0,1,0,0,0,1,0,1,1];break;case "0":a=[1,1,1,0,0,1,1,0,0,1,1,0,0,1,1,1];break;case "1":a=[1,0,
0,0,1,0,0,0,0,0,0,1,0,0,1,1];break;case "2":a=[1,1,0,0,0,0,1,0,1,0,1,0,0,0,1,1];break;case "3":a=[1,1,0,0,0,0,1,1,1,0,0,0,0,1,1,1];break;case "4":a=[0,0,1,0,0,0,1,1,1,0,0,0,0,1,0,0];break;case "5":a=[1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1];break;case "6":a=[1,1,1,0,0,0,0,1,1,1,0,0,0,1,1,1];break;case "7":a=[1,1,0,0,0,1,0,0,0,0,1,0,0,0,0,0];break;case "8":a=[1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1];break;case "9":a=[1,1,1,0,0,0,1,1,1,0,0,0,0,1,1,1];break;case "a":case "A":a=[1,1,1,0,0,0,1,1,1,1,0,0,0,1,0,0];break;
case "b":case "B":a=[1,1,0,0,1,0,1,0,1,0,0,1,0,1,1,1];break;case "c":case "C":a=[1,1,1,0,0,0,0,0,0,1,0,0,0,0,1,1];break;case "d":case "D":a=[1,1,0,0,1,0,1,0,0,0,0,1,0,1,1,1];break;case "e":case "E":a=[1,1,1,0,0,0,0,1,1,1,0,0,0,0,1,1];break;case "f":case "F":a=[1,1,1,0,0,0,0,1,1,1,0,0,0,0,0,0];break;case "g":case "G":a=[1,1,1,0,0,0,0,0,1,1,0,0,0,1,1,1];break;case "h":case "H":a=[0,0,1,0,0,0,1,1,1,1,0,0,0,1,0,0];break;case "i":case "I":a=[1,1,0,0,1,0,0,0,0,0,0,1,0,0,1,1];break;case "j":case "J":a=[1,
1,0,0,1,0,0,0,0,0,0,1,0,0,1,0];break;case "k":case "K":a=[0,0,1,0,0,1,0,1,0,1,0,0,1,0,0,0];break;case "l":case "L":a=[0,0,1,0,0,0,0,0,0,1,0,0,0,0,1,1];break;case "m":case "M":a=[0,0,1,1,0,1,1,0,0,1,0,0,0,1,0,0];break;case "n":case "N":a=[0,0,1,1,0,0,1,0,0,1,0,0,1,1,0,0];break;case "o":case "O":a=[1,1,1,0,0,0,1,0,0,1,0,0,0,1,1,1];break;case "p":case "P":a=[1,1,1,0,0,0,1,1,1,1,0,0,0,0,0,0];break;case "q":case "Q":a=[1,1,1,0,0,0,1,0,0,1,0,0,1,1,1,1];break;case "r":case "R":a=[1,1,1,0,0,0,1,1,1,1,0,0,
1,0,0,0];break;case "s":case "S":a=[1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1];break;case "t":case "T":a=[1,1,0,0,1,0,0,0,0,0,0,1,0,0,0,0];break;case "u":case "U":a=[0,0,1,0,0,0,1,0,0,1,0,0,0,1,1,1];break;case "v":case "V":a=[0,0,1,0,0,1,0,0,0,1,1,0,0,0,0,0];break;case "w":case "W":a=[0,0,1,0,0,0,1,0,0,1,1,0,1,1,0,0];break;case "x":case "X":a=[0,0,0,1,0,1,0,0,0,0,1,0,1,0,0,0];break;case "y":case "Y":a=[0,0,0,1,0,1,0,0,0,0,0,1,0,0,0,0];break;case "z":case "Z":a=[1,1,0,0,0,1,0,0,0,0,1,0,0,0,1,1];break;case "all":a=
[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];break;default:a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}for(var b=0;b<a.length;b++)this.set(b,1==a[b])};return c};this.sixteenSegmentDisplay__static=function(c,g,a,b,e,f,k,p,t,m){function h(){F._.fillStyle=p;F._.fillRect(0,0,F.$(b),F.$(e))}function u(){for(var a=0;a<N.length;a++){F._.beginPath();F._.moveTo(F.$(N[a][0].x),F.$(N[a][0].y));for(var b=1;b<N[a].length;b++)F._.lineTo(F.$(N[a][b].x),F.$(N[a][b].y));F._.closePath();F._.fillStyle=0==stamp[a]?m:t;F._.fill()}}b=void 0===
b?20:b;e=void 0===e?30:e;k=void 0===k?5:k;p=void 0===p?"rgb(0,0,0)":p;t=void 0===t?"rgb(200,200,200)":t;m=void 0===m?"rgb(20,20,20)":m;var n=b/8,l=b/8,y=[{x:.5*l+n,y:.5*l+n},{x:1*l+n,y:0*l+n},{x:0*l+n,y:1*l+n},{x:1*l+n,y:1*l+n},{x:1.75*l+n,y:1*l+n},{x:1*l+n,y:1.75*l+n}],v=[{x:b/2,y:.5*l+n},{x:b/2-.5*l,y:1*l+n},{x:b/2+.5*l,y:1*l+n},{x:b/2-.5*l,y:0*l+n},{x:b/2+.5*l,y:0*l+n}],B=[{x:b-.5*l-n,y:.5*l+n},{x:b-1*l-n,y:0*l+n},{x:b-0*l-n,y:1*l+n},{x:b-1*l-n,y:1*l+n},{x:b-1*l-n,y:1.75*l+n},{x:b-1.75*l-n,y:1*
l+n}],x=[{x:0*l+n,y:.5*e-.5*l},{x:1*l+n,y:.5*e-.5*l},{x:.5*l+n,y:.5*e-0*l},{x:0*l+n,y:.5*e+.5*l},{x:1*l+n,y:.5*e+.5*l}],w=[{x:b/2,y:e/2},{x:b/2-.5*l,y:.5*l+e/2},{x:b/2-.25*l,y:1.25*l+e/2},{x:b/2-1*l,y:.5*l+e/2},{x:b/2+.5*l,y:.5*l+e/2},{x:b/2+.5*l,y:1.75*l+e/2},{x:b/2+1*l,y:.5*l+e/2},{x:b/2-.5*l,y:.5*-l+e/2},{x:b/2-.25*l,y:1.25*-l+e/2},{x:b/2-1*l,y:.25*-l+e/2},{x:b/2+.5*l,y:.5*-l+e/2},{x:b/2+.5*l,y:1.75*-l+e/2},{x:b/2+1*l,y:.25*-l+e/2}],r=[{x:b-1*l-n,y:.5*e-.5*l},{x:b-0*l-n,y:.5*e-.5*l},{x:b-.5*l-
n,y:.5*e-0*l},{x:b-1*l-n,y:.5*e+.5*l},{x:b-0*l-n,y:.5*e+.5*l}],z=[{x:.5*l+n,y:e-.5*l-n},{x:0*l+n,y:e-1*l-n},{x:1*l+n,y:e-0*l-n},{x:1*l+n,y:e-1*l-n},{x:1*l+n,y:e-1.75*l-n},{x:1.75*l+n,y:e-1*l-n}],C=[{x:b/2-.5*l,y:e-1*l-n},{x:b/2+.5*l,y:e-1*l-n},{x:b/2,y:e-.5*l-n},{x:b/2-.5*l,y:e-0*l-n},{x:b/2+.5*l,y:e-0*l-n}];n=[{x:b-.5*l-n,y:e-.5*l-n},{x:b-0*l-n,y:e-1*l-n},{x:b-1*l-n,y:e-0*l-n},{x:b-1*l-n,y:e-1*l-n},{x:b-1*l-n,y:e-1.75*l-n},{x:b-1.75*l-n,y:e-1*l-n}];var N=[[y[1],y[0],y[3],v[1],v[0],v[3]],[v[4],v[0],
v[2],B[3],B[0],B[1]],[y[0],y[2],x[0],x[2],x[1],y[3]],[y[4],y[3],y[5],w[9],w[7],w[8]],[v[0],v[1],w[7],w[0],w[10],v[2]],[B[4],B[3],B[5],w[11],w[10],w[12]],[B[0],B[2],r[1],r[2],r[0],B[3]],[x[4],x[2],x[1],w[7],w[0],w[1]],[r[3],r[2],r[0],w[10],w[0],w[4]],[z[0],z[1],x[3],x[2],x[4],z[3]],[z[4],z[3],z[5],w[2],w[1],w[3]],[C[0],C[2],C[1],w[4],w[0],w[1]],[n[4],n[3],n[5],w[5],w[4],w[6]],[n[3],r[3],r[2],r[4],n[1],n[0]],[z[2],z[0],z[3],C[0],C[2],C[3]],[n[2],n[0],n[3],C[1],C[2],C[4]]];stamp=[0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0];c=d.builder("group",void 0===c?"sixteenSegmentDisplay__static":c,{x:g,y:a,angle:void 0===f?0:f});var F=d.builder("canvas","subcanvas",{width:b,height:e,resolution:k});c.append(F);c.set=function(a,b){stamp[a].state=b;u()};c.get=function(a){return segments[a].state};c.clear=function(){for(var a=0;a<segments.length;a++)this.set(a,!1)};c.enterCharacter=function(a){switch(a){case "!":stamp=[1,1,0,1,1,1,0,0,0,0,0,0,0,0,1,1];break;case "?":stamp=[1,1,0,0,0,0,1,0,1,0,0,0,0,0,1,1];break;case ".":stamp=
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0];break;case ",":stamp=[0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0];break;case "'":stamp=[0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0];break;case ":":stamp=[0,0,0,1,0,1,0,0,0,0,1,0,1,0,0,0];break;case '"':stamp=[0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0];break;case "_":stamp=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1];break;case "-":stamp=[0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0];break;case "\\":stamp=[0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0];break;case "/":stamp=[0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];break;case "*":stamp=[0,0,
0,1,1,1,0,1,1,0,1,1,1,0,0,0];break;case "#":stamp=[1,1,1,0,1,0,1,1,1,1,0,1,0,1,1,1];break;case "<":stamp=[0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0];break;case ">":stamp=[0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0];break;case "(":stamp=[0,1,0,0,1,0,0,0,0,0,0,1,0,0,0,1];break;case ")":stamp=[1,0,0,0,1,0,0,0,0,0,0,1,0,0,1,0];break;case "[":stamp=[1,1,1,0,0,0,0,0,0,1,0,0,0,0,1,1];break;case "]":stamp=[1,1,0,0,0,0,1,0,0,0,0,0,0,1,1,1];break;case "{":stamp=[1,1,0,1,0,0,0,1,0,0,1,0,0,0,1,1];break;case "}":stamp=[1,1,0,0,0,
1,0,0,1,0,0,0,1,0,1,1];break;case "0":case 0:stamp=[1,1,1,0,0,1,1,0,0,1,1,0,0,1,1,1];break;case "1":case 1:stamp=[1,0,0,0,1,0,0,0,0,0,0,1,0,0,1,1];break;case "2":case 2:stamp=[1,1,0,0,0,0,1,0,1,0,1,0,0,0,1,1];break;case "3":case 3:stamp=[1,1,0,0,0,0,1,1,1,0,0,0,0,1,1,1];break;case "4":case 4:stamp=[0,0,1,0,0,0,1,1,1,0,0,0,0,1,0,0];break;case "5":case 5:stamp=[1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1];break;case "6":case 6:stamp=[1,1,1,0,0,0,0,1,1,1,0,0,0,1,1,1];break;case "7":case 7:stamp=[1,1,0,0,0,1,0,0,
0,0,1,0,0,0,0,0];break;case "8":case 8:stamp=[1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1];break;case "9":case 9:stamp=[1,1,1,0,0,0,1,1,1,0,0,0,0,1,1,1];break;case "a":case "A":stamp=[1,1,1,0,0,0,1,1,1,1,0,0,0,1,0,0];break;case "b":case "B":stamp=[1,1,0,0,1,0,1,0,1,0,0,1,0,1,1,1];break;case "c":case "C":stamp=[1,1,1,0,0,0,0,0,0,1,0,0,0,0,1,1];break;case "d":case "D":stamp=[1,1,0,0,1,0,1,0,0,0,0,1,0,1,1,1];break;case "e":case "E":stamp=[1,1,1,0,0,0,0,1,1,1,0,0,0,0,1,1];break;case "f":case "F":stamp=[1,1,1,0,0,
0,0,1,1,1,0,0,0,0,0,0];break;case "g":case "G":stamp=[1,1,1,0,0,0,0,0,1,1,0,0,0,1,1,1];break;case "h":case "H":stamp=[0,0,1,0,0,0,1,1,1,1,0,0,0,1,0,0];break;case "i":case "I":stamp=[1,1,0,0,1,0,0,0,0,0,0,1,0,0,1,1];break;case "j":case "J":stamp=[1,1,0,0,1,0,0,0,0,0,0,1,0,0,1,0];break;case "k":case "K":stamp=[0,0,1,0,0,1,0,1,0,1,0,0,1,0,0,0];break;case "l":case "L":stamp=[0,0,1,0,0,0,0,0,0,1,0,0,0,0,1,1];break;case "m":case "M":stamp=[0,0,1,1,0,1,1,0,0,1,0,0,0,1,0,0];break;case "n":case "N":stamp=
[0,0,1,1,0,0,1,0,0,1,0,0,1,1,0,0];break;case "o":case "O":stamp=[1,1,1,0,0,0,1,0,0,1,0,0,0,1,1,1];break;case "p":case "P":stamp=[1,1,1,0,0,0,1,1,1,1,0,0,0,0,0,0];break;case "q":case "Q":stamp=[1,1,1,0,0,0,1,0,0,1,0,0,1,1,1,1];break;case "r":case "R":stamp=[1,1,1,0,0,0,1,1,1,1,0,0,1,0,0,0];break;case "s":case "S":stamp=[1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1];break;case "t":case "T":stamp=[1,1,0,0,1,0,0,0,0,0,0,1,0,0,0,0];break;case "u":case "U":stamp=[0,0,1,0,0,0,1,0,0,1,0,0,0,1,1,1];break;case "v":case "V":stamp=
[0,0,1,0,0,1,0,0,0,1,1,0,0,0,0,0];break;case "w":case "W":stamp=[0,0,1,0,0,0,1,0,0,1,1,0,1,1,0,0];break;case "x":case "X":stamp=[0,0,0,1,0,1,0,0,0,0,1,0,1,0,0,0];break;case "y":case "Y":stamp=[0,0,0,1,0,1,0,0,0,0,0,1,0,0,0,0];break;case "z":case "Z":stamp=[1,1,0,0,0,1,0,0,0,0,1,0,0,0,1,1];break;case "all":stamp=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];break;default:stamp=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}h();u()};h();u();return c}};this.control=new function(){this.button_rect=function(c,g,a,b,e,f,k,p,t,
m,q,u,n,l,y,v,B,x,w,r,z,C,N,F,T,L,Y,Z,fa,U,aa,ba,ca,H,ea,E,D,W,R,J,I,da,M,O,P,S,Q,V,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa,Ba,Ca,Da,Ea,Fa,Ga,Ha,Ia,Ja,Ka){function h(){if(u){var a=[{fill:F,stroke:T,lineWidth:L},{fill:Y,stroke:Z,lineWidth:fa},{fill:U,stroke:aa,lineWidth:ba},{fill:ca,stroke:H,lineWidth:ea},{fill:E,stroke:D,lineWidth:W},{fill:R,stroke:J,lineWidth:I},{fill:da,stroke:M,lineWidth:O},{fill:P,stroke:S,lineWidth:Q},{fill:V,stroke:ha,lineWidth:ia},{fill:ja,stroke:ka,lineWidth:la},
{fill:ma,stroke:na,lineWidth:oa},{fill:pa,stroke:qa,lineWidth:ra},{fill:sa,stroke:ta,lineWidth:ua},{fill:va,stroke:wa,lineWidth:xa},{fill:ya,stroke:za,lineWidth:Aa},{fill:Ba,stroke:Ca,lineWidth:Da}];!n&&A.state.hovering&&(A.state.hovering=!1);!l&&A.state.selected&&(A.state.selected=!1);var b=8*A.state.hovering+4*A.state.glowing+2*A.state.selected+1*(y&&A.state.pressed);G.style.fill=a[b].fill;G.style.stroke=a[b].stroke;G.style.lineWidth=a[b].lineWidth}else G.style.fill=z,G.style.stroke=C,G.style.lineWidth=
N}b=void 0===b?30:b;e=void 0===e?20:e;k=void 0===k?"":k;p=void 0===p?"":p;t=void 0===t?"":t;m=void 0===m?.5:m;q=void 0===q?.05:q;u=void 0===u?!0:u;n=void 0===n?!0:n;l=void 0===l?!1:l;y=void 0===y?!0:y;v=void 0===v?"5pt Arial":v;B=void 0===B?"alphabetic":B;x=void 0===x?"rgba(0,0,0,1)":x;w=void 0===w?"rgba(0,0,0,0)":w;r=void 0===r?1:r;z=void 0===z?"rgba(180,180,180,1)":z;C=void 0===C?"rgba(0,0,0,0)":C;N=void 0===N?0:N;F=void 0===F?"rgba(200,200,200,1)":F;T=void 0===T?"rgba(0,0,0,0)":T;L=void 0===L?
0:L;Y=void 0===Y?"rgba(230,230,230,1)":Y;Z=void 0===Z?"rgba(0,0,0,0)":Z;fa=void 0===fa?0:fa;U=void 0===U?"rgba(200,200,200,1)":U;aa=void 0===aa?"rgba(120,120,120,1)":aa;ba=void 0===ba?.75:ba;ca=void 0===ca?"rgba(230,230,230,1)":ca;H=void 0===H?"rgba(120,120,120,1)":H;ea=void 0===ea?.75:ea;E=void 0===E?"rgba(220,220,220,1)":E;D=void 0===D?"rgba(0,0,0,0)":D;W=void 0===W?0:W;R=void 0===R?"rgba(250,250,250,1)":R;J=void 0===J?"rgba(0,0,0,0)":J;I=void 0===I?0:I;da=void 0===da?"rgba(220,220,220,1)":da;M=
void 0===M?"rgba(120,120,120,1)":M;O=void 0===O?.75:O;P=void 0===P?"rgba(250,250,250,1)":P;S=void 0===S?"rgba(120,120,120,1)":S;Q=void 0===Q?.75:Q;V=void 0===V?"rgba(220,220,220,1)":V;ha=void 0===ha?"rgba(0,0,0,0)":ha;ia=void 0===ia?0:ia;ja=void 0===ja?"rgba(240,240,240,1)":ja;ka=void 0===ka?"rgba(0,0,0,0)":ka;la=void 0===la?0:la;ma=void 0===ma?"rgba(220,220,220,1)":ma;na=void 0===na?"rgba(120,120,120,1)":na;oa=void 0===oa?.75:oa;pa=void 0===pa?"rgba(240,240,240,1)":pa;qa=void 0===qa?"rgba(120,120,120,1)":
qa;ra=void 0===ra?.75:ra;sa=void 0===sa?"rgba(240,240,240,1)":sa;ta=void 0===ta?"rgba(0,0,0,0)":ta;ua=void 0===ua?0:ua;va=void 0===va?"rgba(250,250,250,1)":va;wa=void 0===wa?"rgba(0,0,0,0)":wa;xa=void 0===xa?0:xa;ya=void 0===ya?"rgba(240,240,240,1)":ya;za=void 0===za?"rgba(120,120,120,1)":za;Aa=void 0===Aa?.75:Aa;Ba=void 0===Ba?"rgba(250,250,250,1)":Ba;Ca=void 0===Ca?"rgba(120,120,120,1)":Ca;Da=void 0===Da?.75:Da;Ea=void 0===Ea?function(a){}:Ea;Fa=void 0===Fa?function(a){}:Fa;Ga=void 0===Ga?function(a){}:
Ga;Ha=void 0===Ha?function(a){}:Ha;Ia=void 0===Ia?function(a){}:Ia;Ja=void 0===Ja?function(a){}:Ja;Ka=void 0===Ka?function(a){}:Ka;var A=d.builder("group",void 0===c?"button_rect":c,{x:g,y:a,angle:void 0===f?0:f}),G=d.builder("rectangle","backing",{width:b,height:e,style:{fill:z,stroke:C,lineWidth:N}});A.append(G);k=d.builder("text","centre",{x:b/2,y:e*m,text:k,style:{font:v,testBaseline:B,fill:x,stroke:w,lineWidth:r,textAlign:"center",textBaseline:"middle"}});A.append(k);p=d.builder("text","left",
{x:b*q,y:e*m,text:p,style:{font:v,testBaseline:B,fill:x,stroke:w,lineWidth:r,textAlign:"left",textBaseline:"middle"}});A.append(p);t=d.builder("text","right",{x:b-b*q,y:e*m,text:t,style:{font:v,testBaseline:B,fill:x,stroke:w,lineWidth:r,textAlign:"right",textBaseline:"middle"}});A.append(t);var X=d.builder("rectangle","cover",{width:b,height:e,style:{fill:"rgba(0,0,0,0)"}});A.append(X);A.state={hovering:!1,glowing:!1,selected:!1,pressed:!1};h();A.press=function(a){if(u){if(y){if(this.state.pressed)return;
this.state.pressed=!0;if(this.onpress)this.onpress(this,a)}this.select(!this.select(),a);h()}};A.release=function(a){if(u&&y&&this.state.pressed&&(this.state.pressed=!1,h(),this.onrelease))this.onrelease(this,a)};A.active=function(a){if(void 0==a)return u;u=a;h()};A.glow=function(a){if(void 0==a)return this.state.glowing;this.state.glowing=a;h()};A.select=function(a,b,c){c=void 0===c?!0:c;if(u){if(void 0==a)return this.state.selected;if(l&&this.state.selected!=a&&(this.state.selected=a,h(),c))if(this.state.selected)this.onselect(this,
b);else this.ondeselect(this,b)}};A.forceMouseLeave=function(){A.state.hovering=!1;A.release("forced");h();if(A.onleave)A.onleave("forced")};X.onmouseenter=function(a,b,c){A.state.hovering=!0;h();if(A.onenter)A.onenter(c);if(1==c.buttons)X.onmousedown(c)};X.onmouseleave=function(a,b,c){A.state.hovering=!1;A.release(c);h();if(A.onleave)A.onleave(c)};X.onmouseup=function(a,b,c){A.release(c)};X.onmousedown=function(a,b,c){A.press(c)};X.ondblclick=function(a,b,c){if(u&&A.ondblpress)A.ondblpress(c)};A.onenter=
Ea;A.onleave=Fa;A.onpress=Ga;A.ondblpress=Ha;A.onrelease=Ia;A.onselect=Ja;A.ondeselect=Ka;return A};this.checkbox_rect=function(c,g,a,b,e,f,k,p,t,m,q){function h(){v.glowing?(l.style.fill=m,y.style.fill=v.checked?t:"rgba(0,0,0,0)"):(l.style.fill=p,y.style.fill=v.checked?k:"rgba(0,0,0,0)")}b=void 0===b?20:b;e=void 0===e?20:e;k=void 0===k?"rgba(150,150,150,1)":k;p=void 0===p?"rgba(200,200,200,1)":p;t=void 0===t?"rgba(220,220,220,1)":t;m=void 0===m?"rgba(220,220,220,1)":m;q=void 0===q?function(){}:q;
var n=d.builder("group",void 0===c?"checkbox_rect":c,{x:g,y:a,angle:void 0===f?0:f}),l=d.builder("rectangle","backing",{width:b,height:e,style:{fill:p}});n.append(l);var y=d.builder("rectangle","checkrect",{x:.1*b,y:.1*e,width:.8*b,height:.8*e,style:{fill:"rgba(0,0,0,0)"}});n.append(y);c=d.builder("rectangle","cover",{width:b,height:e,style:{fill:"rgba(0,0,0,0)"}});n.append(c);var v={checked:!1,glowing:!1};n.get=function(){return v.checked};n.set=function(a,b){b=void 0===b?!0:b;v.checked=a;h();if(b&&
this.onchange)this.onchange(a)};n.light=function(a){if(void 0==a)return a.glowing;a.glowing=a;h()};c.onclick=function(a){n.set(!n.get())};c.onmousedown=function(){};n.onchange=q;return n};this.dial_continuous=function(c,g,a,b,e,h,k,p,t,m,q,u,n,l){function y(a,b){a=1<a?1:a;a=0>a?0:a;if((void 0===b||b)&&void 0!=v.onchange)v.onchange(a);h=a;r.parameter.angle(p+t*h)}b=void 0===b?15:b;h=void 0===h?0:h;k=void 0===k?-1:k;p=void 0===p?3*Math.PI/4:p;t=void 0===t?1.5*Math.PI:t;m=void 0===m?"rgba(200,200,200,1)":
m;q=void 0===q?"rgba(50,50,50,1)":q;u=void 0===u?"rgba(250,100,100,1)":u;n=void 0===n?function(){}:n;l=void 0===l?function(){}:l;var v=d.builder("group",void 0===c?"dial_continuous":c,{x:g,y:a,angle:void 0===e?0:e});c=d.builder("circle","slot",{r:1.1*b,style:{fill:q}});v.append(c);m=d.builder("circle","handle",{r:b,style:{fill:m}});v.append(m);var r=d.builder("group","needleGroup",{ignored:!0});v.append(r);c=b/5;g=b;u=d.builder("rectangle","needle",{x:g/3,y:-c/2,height:c,width:g,style:{fill:u}});
r.append(u);var x=!1;v.set=function(a,b){x||y(a,b)};v.get=function(){return h};var w=4*b;m.ondblclick=function(){if(!(0>k||x)&&(y(k),void 0!=v.onrelease))v.onrelease(h)};m.onwheel=function(a,b,c){if(!x&&(a=c.deltaY/100,b=f.core.viewport.scale(),y(h-a/(10*b)),void 0!=v.onrelease))v.onrelease(h)};m.onmousedown=function(a,b,c){var d=h,e=c.y;x=!0;f.system.mouse.mouseInteractionHandler(function(a){a=a.y-e;var b=f.core.viewport.scale();y(d-a/(b*w)*window.devicePixelRatio,!0)},function(a){x=!1;if(void 0!=
v.onrelease)v.onrelease(h)})};v.onchange=n;v.onrelease=l;y(h);return v};this.dial_discrete=function(c,g,a,b,e,h,k,p,t,m,q,u,n,l,y){function v(a,b){a=a>p-1?p-1:a;a=0>a?0:a;if((void 0===b||b)&&void 0!=r.onchange)r.onchange(a);h=a=Math.round(a);x.set(h/(p-1))}c=void 0===c?"dial_discrete":c;b=void 0===b?15:b;h=void 0===h?0:h;k=void 0===k?0:k;p=void 0===p?5:p;t=void 0===t?3*Math.PI/4:t;m=void 0===m?1.5*Math.PI:m;q=void 0===q?"rgba(200,200,200,1)":q;u=void 0===u?"rgba(50,50,50,1)":u;n=void 0===n?"rgba(250,100,100,1)":
n;l=void 0===l?function(){}:l;y=void 0===y?function(){}:y;var r=d.builder("group",c,{x:g,y:a,angle:void 0===e?0:e}),x=d.builder("dial_continuous",c,{x:0,y:0,r:b,angle:0,startAngle:t,maxAngle:m,style:{handle:q,slot:u,needle:n}});x.getChildByName("handle").ondblclick=void 0;x.getChildByName("handle").onwheel=void 0;x.getChildByName("handle").onmousedown=void 0;r.append(x);var w=!1;r.set=function(a,b){w||v(a,b)};r.get=function(){return h};var A=0;x.getChildByName("handle").ondblclick=function(){if(!(0>
k||w)&&(v(k),void 0!=r.onrelease))r.onrelease(h)};x.getChildByName("handle").onwheel=function(a,b,c){if(!w&&(A+=c.deltaY/100,1<=Math.abs(A)&&(v(h-1*Math.sign(A)),A=0,void 0!=r.onrelease)))r.onrelease(h)};x.getChildByName("handle").onmousedown=function(a,b,c){var d=h,e=c.y;w=!0;f.system.mouse.mouseInteractionHandler(function(a){v(d-Math.round((a.y-e)/25));if(void 0!=r.onchange)r.onchange(h)},function(a){w=!1;if(void 0!=r.onrelease)r.onrelease(h)})};r.onchange=l;r.onrelease=y;v(h);return r};this.grapher_waveWorkspace=
function(c,g,a,b,e,f,k,p,t,m,q,u,n,l,y,v,r,x){b=void 0===b?120:b;e=void 0===e?60:e;k=void 0===k?!0:k;p=void 0===p?!0:p;t=void 0===t?[{stroke:"rgba(0,255,0,1)",lineWidth:.25,lineJoin:"round"},{stroke:"rgba(255,255,0,1)",lineWidth:.25,lineJoin:"round"}]:t;m=void 0===m?[{fill:"rgba(100,255,100,1)",size:.75,font:"Helvetica"},{fill:"rgba(255,255,100,1)",size:.75,font:"Helvetica"}]:m;q=void 0===q?"rgba(0,100,0,1)":q;u=void 0===u?.25:u;n=void 0===n?"rgba(0,150,0,1)":n;l=void 0===l?"10pt Helvetica":l;y=void 0===
y?"rgba(50,50,50,1)":y;v=void 0===v?function(a,b){}:v;r=void 0===r?function(a,b){}:r;x=void 0===x?function(a){}:x;var h=d.builder("group",void 0===c?"grapher_waveWorkspace":c,{x:g,y:a,angle:void 0===f?0:f});c=d.builder("grapher__static","graph",{width:b,height:e,style:{foregrounds:t,foregroundText:m,background_stroke:q,background_lineWidth:u,backgroundText_fill:n,backgroundText_font:l,backing:y}});c.resolution(10);h.append(c);b=d.builder("needleOverlay","overlay",{width:b,height:e,selectNeedle:k,
selectionArea:p,needleStyles:t.map(function(a){return a.stroke})});h.append(b);h.horizontalMarkings=c.horizontalMarkings;h.verticalMarkings=c.verticalMarkings;h.drawBackground=c.drawBackground;h.drawForeground=c.drawForeground;h.draw=c.draw;h.mark=b.mark;h.removeAllMarks=b.removeAllMarks;h.select=b.select;h.area=b.area;h.onchange=v;h.onrelease=r;h.selectionAreaToggle=x;b.onchange=function(a,b){if(h.onchange)h.onchange(a,b)};b.onrelease=function(a,b){if(h.onrelease)h.onrelease(a,b)};b.selectionAreaToggle=
function(a){h.selectionAreaToggle&&h.selectionAreaToggle(a)};c.viewbox({left:0});c.drawBackground();b.select(0);return h};this.list=function(c,g,a,b,e,f,k,p,t,m,q,r,n,l,y,v,B,x,w,A,z,C,N,F,H,L,Y,Z,fa,U,aa,ba,ca,X,ea,E,D,W,R,J,I,da,M,O,P,S,Q,V,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa,Ba,Ca,Da,Ea,Fa,Ga,Ha,Ia,Ja,Ka,Ma,Oa,Qa,Ra,Na,Pa,Sa){function h(){u=[];La.clear();G=[];for(var a=T=Ua=0,c=0;c<k.length;c++)if("space"==k[c]){var g=d.builder("rectangle",""+c,{x:0,y:a,width:b,height:e*
A,style:{fill:"rgba(255,0,0,0)"}});a+=e*(A+B);La.append(g)}else"break"==k[c]?(g=d.builder("rectangle",""+c,{x:b*(1-w)*.5,y:a,width:b*w,height:e*x,style:{fill:C}}),a+=e*(x+B),La.append(g)):(g=d.builder("button_rect",""+c,{x:b*(1-v)*.5,y:a,width:b*v,height:e*y,text_left:k[c].text_left,text_centre:k[c].text?k[c].text:k[c].text_centre,text_right:k[c].text_right,textVerticalOffset:p,textHorizontalOffsetMux:t,active:m,hoverable:r,selectable:n,pressable:l,style:{text_font:N,text_textBaseline:F,text_fill:H,
text_stroke:L,text_lineWidth:Y,background__off__fill:Z,background__off__stroke:fa,background__off__lineWidth:U,background__up__fill:aa,background__up__stroke:ba,background__up__lineWidth:ca,background__press__fill:X,background__press__stroke:ea,background__press__lineWidth:E,background__select__fill:D,background__select__stroke:W,background__select__lineWidth:R,background__select_press__fill:J,background__select_press__stroke:I,background__select_press__lineWidth:da,background__glow__fill:M,background__glow__stroke:O,
background__glow__lineWidth:P,background__glow_press__fill:S,background__glow_press__stroke:Q,background__glow_press__lineWidth:V,background__glow_select__fill:ha,background__glow_select__stroke:ia,background__glow_select__lineWidth:ja,background__glow_select_press__fill:ka,background__glow_select_press__stroke:la,background__glow_select_press__lineWidth:ma,background__hover__fill:na,background__hover__stroke:oa,background__hover__lineWidth:pa,background__hover_press__fill:qa,background__hover_press__stroke:ra,
background__hover_press__lineWidth:sa,background__hover_select__fill:ta,background__hover_select__stroke:ua,background__hover_select__lineWidth:va,background__hover_select_press__fill:wa,background__hover_select_press__stroke:xa,background__hover_select_press__lineWidth:ya,background__hover_glow__fill:za,background__hover_glow__stroke:Aa,background__hover_glow__lineWidth:Ba,background__hover_glow_press__fill:Ca,background__hover_glow_press__stroke:Da,background__hover_glow_press__lineWidth:Ea,background__hover_glow_select__fill:Fa,
background__hover_glow_select__stroke:Ga,background__hover_glow_select__lineWidth:Ha,background__hover_glow_select_press__fill:Ia,background__hover_glow_select_press__stroke:Ja,background__hover_glow_select_press__lineWidth:Ka}}),g.onenter=function(a){return function(){K.onenter(a)}}(c),g.onleave=function(a){return function(){K.onleave(a)}}(c),g.onpress=function(a){return function(){K.onpress(a)}}(c),g.ondblpress=function(a){return function(){K.ondblpress(a)}}(c),g.onrelease=function(a){return function(){k[a].function&&
k[a].function();K.onrelease(a)}}(c),g.onselect=function(a){return function(b,c){K.select(a,!0,c,!1)}}(c),g.ondeselect=function(a){return function(b,c){K.select(a,!1,c,!1)}}(c),a+=e*(y+B),La.append(g),u.push(g));return a-e*B}b=void 0===b?50:b;e=void 0===e?100:e;k=void 0===k?[]:k;p=void 0===p?.5:p;t=void 0===t?.05:t;m=void 0===m?!0:m;q=void 0===q?!0:q;r=void 0===r?!0:r;n=void 0===n?!0:n;l=void 0===l?!0:l;y=void 0===y?.1:y;v=void 0===v?.95:v;B=void 0===B?.01:B;x=void 0===x?.0025:x;w=void 0===w?.9:w;
A=void 0===A?.005:A;z=void 0===z?"rgba(230,230,230,1)":z;C=void 0===C?"rgba(195,195,195,1)":C;N=void 0===N?"5pt Arial":N;F=void 0===F?"alphabetic":F;H=void 0===H?"rgba(0,0,0,1)":H;L=void 0===L?"rgba(0,0,0,0)":L;Y=void 0===Y?1:Y;Z=void 0===Z?"rgba(180,180,180,1)":Z;fa=void 0===fa?"rgba(0,0,0,0)":fa;U=void 0===U?0:U;aa=void 0===aa?"rgba(200,200,200,1)":aa;ba=void 0===ba?"rgba(0,0,0,0)":ba;ca=void 0===ca?0:ca;X=void 0===X?"rgba(230,230,230,1)":X;ea=void 0===ea?"rgba(0,0,0,0)":ea;E=void 0===E?0:E;D=void 0===
D?"rgba(200,200,200,1)":D;W=void 0===W?"rgba(120,120,120,1)":W;R=void 0===R?2:R;J=void 0===J?"rgba(230,230,230,1)":J;I=void 0===I?"rgba(120,120,120,1)":I;da=void 0===da?2:da;M=void 0===M?"rgba(220,220,220,1)":M;O=void 0===O?"rgba(0,0,0,0)":O;P=void 0===P?0:P;S=void 0===S?"rgba(250,250,250,1)":S;Q=void 0===Q?"rgba(0,0,0,0)":Q;V=void 0===V?0:V;ha=void 0===ha?"rgba(220,220,220,1)":ha;ia=void 0===ia?"rgba(120,120,120,1)":ia;ja=void 0===ja?2:ja;ka=void 0===ka?"rgba(250,250,250,1)":ka;la=void 0===la?"rgba(120,120,120,1)":
la;ma=void 0===ma?2:ma;na=void 0===na?"rgba(220,220,220,1)":na;oa=void 0===oa?"rgba(0,0,0,0)":oa;pa=void 0===pa?0:pa;qa=void 0===qa?"rgba(240,240,240,1)":qa;ra=void 0===ra?"rgba(0,0,0,0)":ra;sa=void 0===sa?0:sa;ta=void 0===ta?"rgba(220,220,220,1)":ta;ua=void 0===ua?"rgba(120,120,120,1)":ua;va=void 0===va?2:va;wa=void 0===wa?"rgba(240,240,240,1)":wa;xa=void 0===xa?"rgba(120,120,120,1)":xa;ya=void 0===ya?2:ya;za=void 0===za?"rgba(240,240,240,1)":za;Aa=void 0===Aa?"rgba(0,0,0,0)":Aa;Ba=void 0===Ba?0:
Ba;Ca=void 0===Ca?"rgba(250,250,250,1)":Ca;Da=void 0===Da?"rgba(0,0,0,0)":Da;Ea=void 0===Ea?0:Ea;Fa=void 0===Fa?"rgba(240,240,240,1)":Fa;Ga=void 0===Ga?"rgba(120,120,120,1)":Ga;Ha=void 0===Ha?2:Ha;Ia=void 0===Ia?"rgba(250,250,250,1)":Ia;Ja=void 0===Ja?"rgba(120,120,120,1)":Ja;Ka=void 0===Ka?2:Ka;Ma=void 0===Ma?function(){}:Ma;Oa=void 0===Oa?function(){}:Oa;Qa=void 0===Qa?function(){}:Qa;Ra=void 0===Ra?function(){}:Ra;Na=void 0===Na?function(){}:Na;Pa=void 0===Pa?function(){}:Pa;Sa=void 0===Sa?function(){}:
Sa;var u=[],G=[],T=0,Ua=0,K=d.builder("group",void 0===c?"list":c,{x:g,y:a,angle:void 0===f?0:f});c=d.builder("rectangle","backing",{width:b,height:e,style:{fill:z}});K.append(c);var La=d.builder("group","itemCollection");K.append(La);var Ta=h();c=d.builder("rectangle","cover",{width:b,height:e,style:{fill:"rgba(0,0,0,0)"}});K.append(c);g=d.builder("rectangle","stencil",{width:b,height:e,style:{fill:"rgba(0,0,0,0)"}});K.stencil(g);K.clip(!0);c.onwheel=function(a,b,c){a=c.deltaY/100;K.position(K.position()+
a/10);for(a=0;a<u.length;a++)u[a].forceMouseLeave()};K.position=function(a,b){b=void 0===b?!0:b;if(void 0==a)return Ua;a=0>a?0:a;Ua=a=1<a?1:a;if(!(Ta<e)&&(La.parameter.y(-a*(Ta-e)),b&&this.onpositionchange))this.onpositionchange(a)};K.select=function(a,b,c,d){d=void 0===d?!0:d;if(n){if(q)if(void 0!=c&&c.shiftKey){b=Math.min(T,a);a=Math.max(T,a);for(c=0;c<u.length;c++)u[c].name==""+b&&(b=c),u[c].name==""+a&&(a=c);G=[];for(c=0;c<u.length;c++)(c>a||c<b)&&u[c].select()&&u[c].select(!1,void 0,!1);for(c=
b;c<=a;c++)u[c].select()||(u[c].select(!0,void 0,!1),G.push(c))}else d&&u[a].select(b),b&&!G.includes(a)?G.push(a):!b&&G.includes(a)&&G.splice(G.indexOf(a),1),T=a;else{if(b&&!G.includes(a)){for(;0<G.length;)La.children[G[0]].select(!1,void 0,!1),G.shift();G.push(a)}else!b&&G.includes(a)&&(G=[]);d&&La.children[a].select(!0,void 0,!1)}K.onselection(G)}};K.add=function(a){k.push(a);Ta=h()};K.remove=function(a){k.splice(a,1);Ta=h()};K.onenter=Ma;K.onleave=Oa;K.onpress=Qa;K.ondblpress=Ra;K.onrelease=Na;
K.onselection=Pa;K.onpositionchange=Sa;return K};this.needleOverlay=function(c,g,a,b,e,h,k,p,t,m,q,u,n){function l(a){return a.x*Math.cos(A.__calculationAngle)-a.y*Math.sin(A.__calculationAngle)}function y(a){var c=f.core.viewport.windowPoint2workspacePoint(a.x,a.y);a=c.x-z.extremities.points[0].x;c=c.y-z.extremities.points[0].y;return{x:(a*Math.cos(A.__calculationAngle)-c*Math.sin(A.__calculationAngle))/b,y:(c*Math.cos(A.__calculationAngle)-a*Math.sin(A.__calculationAngle))/e}}function v(a,c){var d=
"lead"==a?N:C;void 0==c||0>c||1<c?(d.remove(F[a]),delete w[a]):(d.contains(F[a])||d.append(F[a]),F[a].parameter.x(c*b-b*k*c),w[a]=c)}function r(a,b){b=void 0===b?!0:b;if(p){if(void 0==a)return w.lead;1<a||0>a?v("lead"):v("lead",a);if(b&&void 0!=A.onchange)A.onchange("lead",a)}}function x(a,c,d){d=void 0===d?!0:d;if(t){if(void 0==a||void 0==c)return{A:w.selection_A,B:w.selection_B};1<a||0>a||1<c||0>c?(v("selection_A"),v("selection_B")):(v("selection_A",a),v("selection_B",c));if(void 0==w.selection_A||
void 0==w.selection_B||w.selection_A==w.selection_B)C.remove(F.selection_area),A.selectionAreaToggle&&A.selectionAreaToggle(!1),delete w.selection_area;else{C.contains(F.selection_area)||(C.append(F.selection_area),A.selectionAreaToggle&&A.selectionAreaToggle(!0));if(w.selection_A<w.selection_B)var e=w.selection_A,g=w.selection_B;else e=w.selection_B,g=w.selection_A;e=e-k*e+k;g=g-k*g-e;0>g&&(g=0);F.selection_area.parameter.x(b*e);F.selection_area.parameter.width(b*g)}if(d&&void 0!=A.onchange)A.onchange("selection_A",
a);if(d&&void 0!=A.onchange)A.onchange("selection_B",c)}}b=void 0===b?120:b;e=void 0===e?60:e;h=void 0===h?0:h;k=void 0===k?1/512:k;p=void 0===p?!0:p;t=void 0===t?!0:t;m=void 0===m?["rgba(240, 240, 240, 1)","rgba(255, 231, 114, 1)"]:m;q=void 0===q?function(a,b){}:q;u=void 0===u?function(a,b){}:u;n=void 0===n?function(a){}:n;var w={},A=d.builder("group",void 0===c?"needleOverlay":c,{x:g,y:a,angle:h}),z=d.builder("rectangle","backing",{width:b,height:e,style:{fill:"rgba(0,0,0,0)"}});A.append(z);c=d.builder("group",
"controlObjectsGroup");A.append(c);var C=d.builder("group","back");c.append(C);var N=d.builder("group","front");c.append(N);c=b*k+.005*b;var F={};F.lead=d.builder("group","lead");F.lead.append(d.builder("rectangle","handle",{width:k*b,height:e,style:{fill:m[0]}}));F.lead.append(d.builder("rectangle","invisibleHandle",{x:(b*k-c)/2,width:c,height:e,style:{fill:"rgba(255,0,0,0)"}}));F.selection_A=d.builder("group","selection_A");F.selection_A.append(d.builder("rectangle","handle",{width:k*b,height:e,
style:{fill:m[1]}}));F.selection_A.append(d.builder("rectangle","invisibleHandle",{x:(b*k-c)/2,width:c,height:e,style:{fill:"rgba(255,0,0,0)"}}));F.selection_B=d.builder("group","selection_B");F.selection_B.append(d.builder("rectangle","handle",{width:k*b,height:e,style:{fill:m[1]}}));F.selection_B.append(d.builder("rectangle","invisibleHandle",{x:(b*k-c)/2,width:c,height:e,style:{fill:"rgba(255,0,0,0)"}}));F.selection_area=d.builder("rectangle","selection_area",{height:e,style:{fill:f.library.misc.blendColours(m[1],
"rgba(0,0,0,0)",.5)}});F.markGroup=d.builder("group","markGroup");C.append(F.markGroup);A.__calculationAngle=h;var H=!1,L=!1,Y=!1,Z=!1;z.onmousedown=function(a,b,c){if(f.system.keyboard.pressedKeys.shift){var d=y(c).x;f.system.mouse.mouseInteractionHandler(function(a){A.area(d,y(a).x)})}else A.select(y(c).x)};F.lead.getChildByName("invisibleHandle").onmouseenter=function(a,b,c){f.core.viewport.cursor("col-resize")};F.lead.getChildByName("invisibleHandle").onmouseleave=function(a,b,c){f.core.viewport.cursor("default")};
F.lead.getChildByName("invisibleHandle").onmousedown=function(a,c,d){H=!0;var e=w.lead,g=l(d),h=(b-b*k)/2;f.system.mouse.mouseInteractionHandler(function(a){a=g-l(a);var b=f.core.viewport.scale();a=e-a/(b*h);a=0>a?0:a;r(1<a?1:a)},function(a){a=g-l(a);var b=f.core.viewport.scale();a=e-a/(b*h);a=0>a?0:a;a=1<a?1:a;H=!1;r(a);if(void 0!=A.onrelease)A.onrelease("lead",a)})};F.selection_A.getChildByName("invisibleHandle").onmouseenter=function(a,b,c){f.core.viewport.cursor("col-resize")};F.selection_A.getChildByName("invisibleHandle").onmouseleave=
function(a,b,c){f.core.viewport.cursor("default")};F.selection_A.getChildByName("invisibleHandle").onmousedown=function(a,c,d){Y=!0;var e=w.selection_A,g=l(d),h=(b-b*k)/2;f.system.mouse.mouseInteractionHandler(function(a){a=g-l(a);var b=f.core.viewport.scale();a=e-a/(b*h);a=0>a?0:a;x(1<a?1:a,w.selection_B)},function(a){a=g-l(a);var b=f.core.viewport.scale();a=e-a/(b*h);a=0>a?0:a;a=1<a?1:a;Y=!1;x(a,w.selection_B);if(void 0!=A.onrelease)A.onrelease("selection_A",a)})};F.selection_B.getChildByName("invisibleHandle").onmouseenter=
function(a,b,c){f.core.viewport.cursor("col-resize")};F.selection_B.getChildByName("invisibleHandle").onmouseleave=function(a,b,c){f.core.viewport.cursor("default")};F.selection_B.getChildByName("invisibleHandle").onmousedown=function(a,c,d){Z=!0;var e=w.selection_B,g=l(d),h=(b-b*k)/2;f.system.mouse.mouseInteractionHandler(function(a){a=g-l(a);var b=f.core.viewport.scale();a=e-a/(b*h);a=0>a?0:a;x(w.selection_A,1<a?1:a)},function(a){a=g-l(a);var b=f.core.viewport.scale();a=e-a/(b*h);a=0>a?0:a;a=1<
a?1:a;Z=!1;x(w.selection_A,a);if(void 0!=A.onrelease)A.onrelease("selection_B",a)})};F.selection_area.onmouseenter=function(a,b,c){f.core.viewport.cursor("grab")};F.selection_area.onmouseleave=function(a,b,c){f.core.viewport.cursor("default")};F.selection_area.onmousedown=function(a,c,d){f.core.viewport.cursor("grabbing");L=!0;var e=w.selection_B-w.selection_A,g=w.selection_A,h=w.selection_B,m=l(d),p=(b-b*k)/2;f.system.mouse.mouseInteractionHandler(function(a){var b=m-l(a),c=f.core.viewport.scale();
a=g-b/(c*p);b=h-b/(c*p);1<a&&(a=1,b=1+e);1<b&&(b=1,a=1-e);0>a&&(a=0,b=e);0>b&&(b=0,a=-e);x(a,b)},function(a){f.core.viewport.cursor("grab");var b=m-l(a),c=f.core.viewport.scale();a=g-b/(c*p);b=h-b/(c*p);1<a&&(a=1,b=1+e);1<b&&(b=1,a=1-e);0>a&&(a=0,b=e);0>b&&(b=0,a=-e);L=!1;x(a,b);if(void 0!=A.onrelease)A.onrelease("selection_A",a);if(void 0!=A.onrelease)A.onrelease("selection_B",b)})};F.selection_A.ondblclick=function(a,b,c,d){x(-1,-1);f.core.viewport.cursor("default")};F.selection_B.ondblclick=F.selection_A.ondblclick;
F.selection_area.ondblclick=F.selection_A.ondblclick;A.mark=function(a){var c=F.markGroup.getChildByName(""+a);void 0==c?(F.markGroup.append(d.builder("rectangle",""+a,{x:a*b,width:k*b,height:e,style:{fill:m[0]}})),a=!0):(F.markGroup.remove(c),a=!1);return a};A.removeAllMarks=function(){F.markGroup.clear()};A.select=function(a,b){b=void 0===b?!0:b;if(void 0==a)return r();H||r(a,b)};A.area=function(a,b,c){c=void 0===c?!0:c;if(void 0==a&&void 0==b)return x();L||void 0!=a&&Y||void 0!=b&&Z||x(a,b,c)};
A.onchange=q;A.onrelease=u;A.selectionAreaToggle=n;return A};this.rangeslide=function(c,g,a,b,e,h,k,p,t,m,q,r,n,l,y,v,B){function u(a,b,c){c=void 0===c?!0:c;a=1<a?1:a;a=0>a?0:a;switch(b){default:console.error("unknown handle to adjust");break;case "start":1<=a/(1-k/(1-k))&&(a=1-k/(1-k));var d=a+(1-a)*k,g=t.end-t.end*k;d>=g&&(t.end=d/(1-k));break;case "end":1>=a/(k/(1-k))&&(a=k/(1-k)),d=t.start+(1-t.start)*k,g=a-a*k,d>=g&&(t.start=(g-k)/(1-k))}t[b]=a;L.start.parameter.y(t.start*e*(1-k));L.end.parameter.y(t.end*
e*(1-k));T.parameter.y(e*(k+t.start-k*(t.start+.1)));T.parameter.height(e*(t.end-t.start+k*(t.start-t.end-1+.2)));if(c&&C.onchange)C.onchange(t)}function w(a,b){var c=H.getOffset();return f.library.math.cartesianAngleAdjust(a-(H.x+c.x),b-(H.y+c.y),0-(H.angle+c.a)).y/F.height}b=void 0===b?10:b;e=void 0===e?95:e;k=void 0===k?.1:k;p=void 0===p?.75:p;t=void 0===t?{start:0,end:1}:t;m=void 0===m?{start:-1,end:-1}:m;q=void 0===q?"rgba(200,200,200,1)":q;r=void 0===r?"rgba(150,150,150,1)":r;n=void 0===n?"rgba(50,50,50,1)":
n;l=void 0===l?"rgba(255,0,0,0)":l;y=void 0===y?"rgba(200,0,200,0.5)":y;v=void 0===v?function(){}:v;B=void 0===B?function(){}:B;var A=!1,z=["start","end"],C=d.builder("group",void 0===c?"rangeslide":c,{x:g,y:a,angle:void 0===h?0:h}),H=d.builder("group","backingAndSlotGroup");C.append(H);c=d.builder("rectangle","backing",{width:b,height:e,style:{fill:r}});H.append(c);n=d.builder("rectangle","slot",{x:.45*b,y:k/2*e,width:.1*b,height:e*(1-k),style:{fill:n}});H.append(n);var F=d.builder("rectangle","backingAndSlotCover",
{width:b,height:e,style:{fill:"rgba(0,0,0,0)"}});H.append(F);var T=d.builder("rectangle","span",{x:(1-p)/2*b,y:e*k,width:b*p,height:e-2*e*k,style:{fill:y}});C.append(T);var L={};for(p=0;p<z.length;p++)L[z[p]]=d.builder("group","handle_"+p,{}),C.append(L[z[p]]),y=d.builder("rectangle","handle",{width:b,height:e*k,style:{fill:q}}),L[z[p]].append(y),y=e*k+.01*e,y=d.builder("rectangle","invisibleHandle",{y:(e*k-y)/2,width:b,height:y+k,style:{fill:l}}),L[z[p]].append(y);C.get=function(){return t};C.set=
function(a,b){A||(void 0!=a.start&&u(a.start,"start",b),void 0!=a.end&&u(a.end,"end",b))};H.onmousedown=function(a,b,c){};H.onclick=function(a,b,c){A||(a=w(a,b),a+=.5*k*(2*a-1),Math.abs(t.start-a)<Math.abs(t.end-a)?u(a,"start"):u(a,"end"))};C.ondblclick=function(){0>m.start||0>m.end||A||(u(m.start,"start"),u(m.end,"end"),C.onrelease(t))};C.onwheel=function(){if(!A){var a=event.deltaY/100,b=f.core.viewport.scale();a/=10*b;u(t.start-a,"start");u(t.end+a,"end")}};T.onmousedown=function(a,b,c){A=!0;var d=
t.start,e=w(a,b);f.system.mouse.mouseInteractionHandler(function(a){a=f.core.viewport.windowPoint2workspacePoint(a.x,a.y);a=w(a.x,a.y);a=d+(a-e);a=[a,a+(t.end-t.start)];0>=a[0]?(a[1]-=a[0],a[0]=0):1<=a[1]&&(a[0]-=a[1]-1,a[1]=1);u(a[0],"start");u(a[1],"end");C.onchange(t)},function(a){C.onrelease(t);A=!1})};for(p=0;p<z.length;p++)L[z[p]].children[1].onmousedown=function(a){return function(b,c,d){A=!0;var e=t[z[a]],g=w(b,c);f.system.mouse.mouseInteractionHandler(function(b){b=f.core.viewport.windowPoint2workspacePoint(b.x,
b.y);b=w(b.x,b.y);u(e+(b-g)/(1-k),z[a]);C.onchange(t)},function(a){C.onrelease(t);A=!1})}}(p);C.onchange=v;C.onrelease=B;u(0,"start");u(1,"end");return C};this.rastorgrid=function(c,g,a,b,e,f,k,p,t,m,q,r,n){b=void 0===b?80:b;e=void 0===e?80:e;k=void 0===k?5:k;p=void 0===p?5:p;t=void 0===t?"rgba(200,200,200,1)":t;m=void 0===m?"rgba(150,150,150,1)":m;q=void 0===q?"rgba(220,220,220,1)":q;r=void 0===r?"rgba(220,220,220,1)":r;n=void 0===n?function(){}:n;var h=d.builder("group",void 0===c?"rastorgrid":
c,{x:g,y:a,angle:void 0===f?0:f});for(a=0;a<p;a++)for(g=0;g<k;g++)c=d.builder("checkbox_rect",a+"_"+g,{x:b/k*g,y:e/p*a,width:b/k,height:e/p,style:{check:m,backing:t,checkGlow:r,backingGlow:q},onchange:function(){if(h.onchange)h.onchange(h.get())}}),h.append(c);h.box=function(a,b){return h.getChildByName(b+"_"+a)};h.get=function(){for(var a=[],b=0;b<p;b++){for(var c=[],d=0;d<k;d++)c.push(this.box(d,b).get());a.push(c)}return a};h.set=function(a,b){for(b=0;b<p;b++)for(var c=0;c<k;c++)h.box(c,b).set(a[b][c],
!1)};h.clear=function(){for(var a=0;a<p;a++)for(var b=0;b<k;b++)h.box(b,a).set(!1,!1)};h.light=function(a,b,c){h.box(a,b).light(c)};h.onchange=n;return h};this.sequencer=function(c,g,a,b,e,h,k,p,t,m,q,r,n,l,y,v,B,x,w,z,G,C,H,F,T,L){function u(a){var c=f.core.viewport.windowPoint2workspacePoint(a.x,a.y);a=c.x-da.extremities.points[0].x;c=c.y-da.extremities.points[0].y;return{x:(a*Math.cos(I.__calculationAngle)-c*Math.sin(I.__calculationAngle))/b,y:(c*Math.cos(I.__calculationAngle)-a*Math.sin(I.__calculationAngle))/
e}}function A(a){return{x:E.viewArea.topLeft.x+a.x*t,y:E.viewArea.topLeft.y+a.y*m}}function N(a){return{x:t*(a.x-E.viewposition.x)+E.viewposition.x,y:m*(a.y-E.viewposition.y)+E.viewposition.y}}function U(a){a.y=Math.floor(a.y*p);a.y>=p&&(a.y=p-1);a.x=D.snapping?Math.round(a.x*k/D.step)*D.step:a.x*k;0>a.x&&(a.x=0);return{line:a.y,position:a.x}}function aa(a,c,d){if(void 0==a&&void 0==c)return E.viewposition;if(void 0==a||isNaN(a))a=E.viewposition.x;if(void 0==c||isNaN(c))c=E.viewposition.y;a=0>a?0:
a;a=1<a?1:a;c=0>c?0:c;c=1<c?1:c;E.viewposition.x=a;E.viewposition.y=c;M.parameter.x(-E.viewposition.x*(E.totalSize.width-b));M.parameter.y(-E.viewposition.y*(E.totalSize.height-e));E.viewArea={topLeft:{x:a-t*a,y:c-m*c},bottomRight:{x:a+t*(1-a),y:c+m*(1-c)}}}function ba(a,c){if(void 0==a&&void 0==c)return{x:t,y:m};if(void 0!=a&&a!=t&&void 0!=c&&c!=m){a=.01>a?.01:a;c=.01>c?.01:c;t=1<a?1:a;m=1<c?1:c;E.totalSize.width=b/t;E.totalSize.height=e/m;S.parameter.width(E.totalSize.width);S.parameter.height(E.totalSize.width);
V.parameter.width(E.totalSize.width);V.parameter.height(E.totalSize.width);for(a=0;a<k;a++)P.children[a].parameter.x(b/(k*t)*a),P.children[a].parameter.width(b/(k*t)),P.children[a].parameter.height(E.totalSize.height);for(a=0;a<p;a++)O.children[a].parameter.y(e/(p*m)*a),O.children[a].parameter.height(e/(p*m)),O.children[a].parameter.width(E.totalSize.width);for(a=0;a<Q.children.length;a++)Q.children[a].unit(b/(k*t),e/(p*m));J.present&&(M.getElementsWithName("playhead")[0].getElementsWithName("main")[0].parameter.height(E.totalSize.height),
M.getElementsWithName("playhead")[0].getElementsWithName("invisibleHandle")[0].parameter.height(E.totalSize.height),M.getElementsWithName("playhead")[0].parameter.x(E.totalSize.width/k*J.position))}else if(void 0!=a&&a!=t){a=.01>a?.01:a;t=1<a?1:a;E.totalSize.width=b/t;S.parameter.width(E.totalSize.width);V.parameter.width(E.totalSize.width);for(a=0;a<k;a++)P.children[a].parameter.x(b/(k*t)*a),P.children[a].parameter.width(b/(k*t));for(a=0;a<p;a++)O.children[a].parameter.width(E.totalSize.width);for(a=
0;a<Q.children.length;a++)Q.children[a].unit(b/(k*t),void 0);J.present&&M.getElementsWithName("playhead")[0].parameter.x(E.totalSize.width/k*J.position)}else if(void 0!=c&&c!=m){c=.01>c?.01:c;m=1<c?1:c;E.totalSize.height=e/m;S.parameter.height(E.totalSize.width);V.parameter.height(E.totalSize.width);for(a=0;a<k;a++)P.children[a].parameter.height(E.totalSize.height);for(a=0;a<p;a++)O.children[a].parameter.y(e/(p*m)*a),O.children[a].parameter.height(e/(p*m));for(a=0;a<Q.children.length;a++)Q.children[a].unit(void 0,
e/(p*m));J.present&&(M.getElementsWithName("playhead")[0].getElementsWithName("main")[0].parameter.height(E.totalSize.height),M.getElementsWithName("playhead")[0].getElementsWithName("invisibleHandle")[0].parameter.height(E.totalSize.height))}}function ca(a,c,d,g){g=void 0===g?D.defaultStrength:g;a=D.signalRegistry.add({line:a,position:c,length:d,strength:g});c=D.signalRegistry.getSignal(a);var h=ea.sequencer.signalBlock(a,b/(k*t),e/(p*m),c.line,c.position,c.length,c.strength,!1,n,l,y,v);Q.append(h);
h.select=function(a){a=void 0===a?!1:a;-1!=D.selectedSignals.indexOf(this)?a||this.deselect():(this.selected(!0),D.selectedSignals.push(this),this.glow(!0))};h.deselect=function(){D.selectedSignals.splice(D.selectedSignals.indexOf(this),1);this.selected(!1);this.glow(!1)};h.delete=function(){this.deselect();D.signalRegistry.remove(parseInt(this.name));this.parent.remove(this)};h.ondblclick=function(a,b,c){if(f.system.keyboard.pressedKeys.control||f.system.keyboard.pressedKeys.command)for(a=0;a<D.selectedSignals.length;a++)D.selectedSignals[a].strength(D.defaultStrength),
D.signalRegistry.update(parseInt(D.selectedSignals[a].name),{strength:D.defaultStrength})};h.body.onmousedown=function(a,b,c){if(f.system.keyboard.pressedKeys.Space)S.onmousedown(a,b,c);else{if(!f.system.keyboard.pressedKeys.shift&&!h.selected())for(;0<D.selectedSignals.length;)D.selectedSignals[0].deselect();h.select(!0);var d=[];for(a=0;a<D.selectedSignals.length;a++)d.push({name:parseInt(D.selectedSignals[a].name),block:D.selectedSignals[a],starting:D.signalRegistry.getSignal(parseInt(D.selectedSignals[a].name))});
if(f.system.keyboard.pressedKeys.control||f.system.keyboard.pressedKeys.command){var g=d.map(function(a){return a.block.strength()}),k=c.offsetY;f.system.mouse.mouseInteractionHandler(function(a){f.system.keyboard.pressedKeys.ControlLeft||f.system.keyboard.pressedKeys.ControlRight||f.system.keyboard.pressedKeys.command||f.system.mouse.forceMouseUp();a=(k-a.offsetY)/(f.core.viewport.scale()*e*4);for(var b=0;b<d.length;b++)d[b].block.strength(g[b]+a),D.signalRegistry.update(d[b].name,{strength:g[b]+
a})})}else{var l=!1,m=U(A(u(c)));f.system.mouse.mouseInteractionHandler(function(a){if(!l&&(l=!0,f.system.keyboard.pressedKeys.alt))for(var b=0;b<D.selectedSignals.length;b++){var c=D.signalRegistry.getSignal(parseInt(D.selectedSignals[b].name));ca(c.line,c.position,c.length,c.strength)}b=U(A(u(a)));a=b.line-m.line;b=b.position-m.position;for(c=0;c<d.length;c++){D.signalRegistry.update(d[c].name,{line:d[c].starting.line+a,position:d[c].starting.position+b});var e=D.signalRegistry.getSignal(d[c].name);
d[c].block.line(e.line);d[c].block.position(e.position)}})}}};h.body.onmousemove=function(a,b,c){a=f.system.keyboard.pressedKeys;b="default";a.alt?b="copy":a.Space&&(b="grab");f.core.viewport.cursor(b)};h.body.onkeydown=function(a,b,c){f.system.keyboard.pressedKeys.alt&&f.core.viewport.cursor("copy")};h.body.onkeyup=function(a,b,c){f.system.keyboard.pressedKeys.alt||f.core.viewport.cursor("default")};h.leftHandle.onmousedown=function(a,b,c){if(f.system.keyboard.pressedKeys.Space)S.onmousedown(a,b,
c);else if(f.system.keyboard.pressedKeys.alt)h.body.onmousedown(a,b,c);else{if(!f.system.keyboard.pressedKeys.shift&&!h.selected())for(;0<D.selectedSignals.length;)D.selectedSignals[0].deselect();h.select(!0);var d=[];for(a=0;a<D.selectedSignals.length;a++)d.push({name:parseInt(D.selectedSignals[a].name),block:D.selectedSignals[a],starting:D.signalRegistry.getSignal(parseInt(D.selectedSignals[a].name))});var e=U(A(u(c)));f.system.mouse.mouseInteractionHandler(function(a){a=U(A(u(a)));a=e.position-
a.position;for(var b=0;b<d.length;b++)if(!(0>d[b].starting.position-a)){D.signalRegistry.update(d[b].name,{length:d[b].starting.length+a,position:d[b].starting.position-a});var c=D.signalRegistry.getSignal(d[b].name);d[b].block.position(c.position);d[b].block.length(c.length)}})}};h.leftHandle.onmousemove=function(a,b,c){a=f.system.keyboard.pressedKeys;b="col-resize";a.alt?b="copy":a.Space&&(b="grab");f.core.viewport.cursor(b)};h.leftHandle.onmouseleave=function(a,b,c){f.core.viewport.cursor("default")};
h.rightHandle.onmousedown=function(a,b,c,d){d=void 0===d?!1:d;if(f.system.keyboard.pressedKeys.Space)S.onmousedown(a,b,c);else if(!d&&f.system.keyboard.pressedKeys.alt)h.body.onmousedown(a,b,c);else{if(!f.system.keyboard.pressedKeys.shift&&!h.selected())for(;0<D.selectedSignals.length;)D.selectedSignals[0].deselect();h.select(!0);var e=[];for(a=0;a<D.selectedSignals.length;a++)e.push({name:parseInt(D.selectedSignals[a].name),block:D.selectedSignals[a],starting:D.signalRegistry.getSignal(parseInt(D.selectedSignals[a].name))});
var g=U(A(u(c)));f.system.mouse.mouseInteractionHandler(function(a){a=U(A(u(a))).position-g.position;for(var b=0;b<e.length;b++){D.signalRegistry.update(e[b].name,{length:e[b].starting.length+a});var c=D.signalRegistry.getSignal(e[b].name);e[b].block.position(c.position);e[b].block.length(c.length)}})}};h.rightHandle.onmousemove=function(a,b,c){a=f.system.keyboard.pressedKeys;b="col-resize";a.alt?b="copy":a.Space&&(b="grab");f.core.viewport.cursor(b)};h.rightHandle.onmouseleave=function(a,b,c){f.core.viewport.cursor("default")};
return{id:a,signalBlock:h}}function X(){var a=d.builder("group","playhead");M.append(a);a.main=d.builder("rectangle","main",{x:-J.width/2,width:J.width,height:E.totalSize.height,style:{fill:H}});a.append(a.main);a.invisibleHandle=d.builder("rectangle","invisibleHandle",{x:-J.width*J.invisibleHandleMux/2+J.width/2,width:J.width*J.invisibleHandleMux,height:E.totalSize.height,style:{fill:"rgba(255,0,0,0)"}});a.append(a.invisibleHandle);a.invisibleHandle.onmousedown=function(){J.held=!0;f.system.mouse.mouseInteractionHandler(function(a){I.playheadPosition(U(A(u(a))).position)},
function(){J.held=!1})};a.invisibleHandle.onmouseenter=function(a,b,c){f.core.viewport.cursor("col-resize")};a.invisibleHandle.onmousemove=function(a,b,c){f.core.viewport.cursor("col-resize")};a.invisibleHandle.onmouseleave=function(a,b,c){f.core.viewport.cursor("default")};J.present=!0;return a}c=void 0===c?"sequencer":c;b=void 0===b?300:b;e=void 0===e?100:e;h=void 0===h?0:h;k=void 0===k?64:k;p=void 0===p?16:p;t=void 0===t?1:t;m=void 0===m?1:m;q=void 0===q?"rgba(20,20,20,1)":q;r=void 0===r?"rgba(209, 189, 222, 0.5)":
r;n=void 0===n?[{fill:"rgba(138,138,138,0.6)",stroke:"rgba(175,175,175,0.95)",lineWidth:.5},{fill:"rgba(130,199,208,0.6)",stroke:"rgba(130,199,208,0.95)",lineWidth:.5},{fill:"rgba(129,209,173,0.6)",stroke:"rgba(129,209,173,0.95)",lineWidth:.5},{fill:"rgba(234,238,110,0.6)",stroke:"rgba(234,238,110,0.95)",lineWidth:.5},{fill:"rgba(249,178,103,0.6)",stroke:"rgba(249,178,103,0.95)",lineWidth:.5},{fill:"rgba(255, 69, 69,0.6)",stroke:"rgba(255, 69, 69,0.95)",lineWidth:.5}]:n;l=void 0===l?[{fill:"rgba(138,138,138,0.8)",
stroke:"rgba(175,175,175,1)",lineWidth:.5},{fill:"rgba(130,199,208,0.8)",stroke:"rgba(130,199,208,1)",lineWidth:.5},{fill:"rgba(129,209,173,0.8)",stroke:"rgba(129,209,173,1)",lineWidth:.5},{fill:"rgba(234,238,110,0.8)",stroke:"rgba(234,238,110,1)",lineWidth:.5},{fill:"rgba(249,178,103,0.8)",stroke:"rgba(249,178,103,1)",lineWidth:.5},{fill:"rgba(255, 69, 69,0.8)",stroke:"rgba(255, 69, 69,1)",lineWidth:.5}]:l;y=void 0===y?"rgba(200,0,0,0)":y;v=void 0===v?3:v;B=void 0===B?[0,1]:B;x=void 0===x?{fill:"rgba(120,120,120,0.8)",
stroke:"rgba(120,120,120,1)",lineWidth:.5}:x;w=void 0===w?[{fill:"rgba(120,120,120,0.5)",stroke:"rgba(120,120,120,1)",lineWidth:.5},{fill:"rgba(100,100,100,  0)",stroke:"rgba(120,120,120,1)",lineWidth:.5}]:w;z=void 0===z?[0]:z;G=void 0===G?{fill:"rgba(229, 221, 112,0.25)",stroke:"rgba(252,244,128,0.5)",lineWidth:.5}:G;C=void 0===C?[{fill:"rgba(30,30,30,0.5)",stroke:"rgba(120,120,120,1)",lineWidth:.5}]:C;H=void 0===H?"rgb(240, 240, 240)":H;F=void 0===F?function(a){}:F;T=void 0===T?function(a){}:T;
L=void 0===L?function(a){}:L;var ea=this,E={totalSize:{width:b/t,height:e/m},viewposition:{x:0,y:0},viewArea:{topLeft:{x:0,y:0},bottomRight:{x:t,y:m}}},D={step:1,snapping:!0,defaultStrength:.5,selectedSignals:[],activeSignals:[],signalRegistry:new f.library.structure.signalRegistry(k,p)},W=!1,R={start:0,end:k},J={present:!1,width:.75,invisibleHandleMux:4,position:-1,held:!1,automoveViewposition:!1},I=d.builder("group",c,{x:g,y:a,angle:h}),da=d.builder("rectangle","backing",{width:b,height:e,style:{fill:q}});
I.append(da);c=d.builder("rectangle","stencil",{width:b,height:e});I.stencil(c);I.clip(!0);var M=d.builder("group","workarea");I.append(M);c=d.builder("group","backgroundDrawArea");M.append(c);var O=d.builder("group","backgroundDrawArea_horizontal");c.append(O);var P=d.builder("group","backgroundDrawArea_vertical");c.append(P);var S=d.builder("rectangle","interactionPlane_back",{width:E.totalSize.width,height:E.totalSize.height,style:{fill:"rgba(0,0,0,0)"}});M.append(S);S.onwheel=function(a,b,c){};
var Q=d.builder("group","signalPane");M.append(Q);var V=d.builder("rectangle","interactionPlane_front",{width:E.totalSize.width,height:E.totalSize.height,style:{fill:"rgba(0,0,0,0)"}});M.append(V);V.onwheel=function(a,b,c){};I.__calculationAngle=h;I.viewposition=aa;I.viewarea=function(a,b){b=void 0===b?!0:b;if(void 0==a||void 0==a.topLeft&&void 0==a.bottomRight)return E.viewArea;void 0==a.topLeft?a.topLeft={x:E.viewArea.topLeft.x,y:E.viewArea.topLeft.y}:(void 0==a.topLeft.x&&(a.topLeft.x=E.viewArea.topLeft.x),
void 0==a.topLeft.y&&(a.topLeft.y=E.viewArea.topLeft.y));void 0==a.bottomRight?a.bottomRight={x:E.bottomRight.topLeft.x,y:E.bottomRight.topLeft.ys}:(void 0==a.bottomRight.x&&(a.bottomRight.x=E.viewArea.bottomRight.x),void 0==a.bottomRight.y&&(a.bottomRight.y=E.viewArea.bottomRight.y));var c=E.viewArea.bottomRight.x-E.viewArea.topLeft.x!=a.bottomRight.x-a.topLeft.x,d=a.bottomRight.y-a.topLeft.y!=E.viewArea.bottomRight.y-E.viewArea.topLeft.y;c&&d?ba(a.bottomRight.x-a.topLeft.x,a.bottomRight.y-a.topLeft.y):
c?ba(a.bottomRight.x-a.topLeft.x,void 0):d&&ba(void 0,a.bottomRight.y-a.topLeft.y);d=c=0;0!=1-(a.bottomRight.x-a.topLeft.x)&&(c=a.topLeft.x+(a.bottomRight.x-a.topLeft.x)/(1-(a.bottomRight.x-a.topLeft.x))*a.topLeft.x);0!=1-(a.bottomRight.y-a.topLeft.y)&&(d=a.topLeft.y+(a.bottomRight.y-a.topLeft.y)/(1-(a.bottomRight.y-a.topLeft.y))*a.topLeft.y);aa(c,d,b);E.viewArea=Object.assign(a,{})};I.step=function(a){if(void 0==a)return D.step;D.step=a};I.glowHorizontal=function(a,b,c){for(void 0==c&&(c=b+1);b<=
c;b++){var d=a?x:w[B[b%B.length]];O.children[b].style.fill=d.fill;O.children[b].style.stroke=d.stroke;O.children[b].style.lineWidth=d.lineWidth}};I.glowVertical=function(a,b,c){for(void 0==c&&(c=b+1);b<c;b++){var d=a?G:C[z[b%z.length]];P.children[b].style.fill=d.fill;P.children[b].style.stroke=d.stroke;P.children[b].style.lineWidth=d.lineWidth}};I.loopActive=function(a){if(void 0==a)return W;W=a;I.glowVertical(!1,0,k);W&&I.glowVertical(!0,0>R.start?0:R.start,R.end>k?k:R.end)};I.loopPeriod=function(a,
b){if(void 0==a||void 0==b)return R;a>b||0>a||0>b||(R={start:a,end:b},W&&(I.glowVertical(!1,0,k),I.glowVertical(!0,0>a?0:a,b>k?k:b)))};I.export=function(){return D.signalRegistry.export()};I.import=function(a){D.signalRegistry.import(a)};I.getAllSignals=function(){return D.signalRegistry.getAllSignals()};I.addSignal=function(a,b,c,d){ca(a,b,c,void 0===d?1:d)};I.addSignals=function(a){for(var b=0;b<a.length;b++)void 0!=a[b]&&null!=a[b]&&this.addSignal(a[b].line,a[b].position,a[b].length,a[b].strength)};
I.eventsBetween=function(a,b){return D.signalRegistry.eventsBetween(a,b)};I.automove=function(a){if(void 0==a)return J.automoveViewposition;J.automoveViewposition=a};I.playheadPosition=function(a,b){if(void 0==a)return J.position;J.position=a;if(void 0===b||b){a=[];for(b=0;b<D.activeSignals.length;b++){var c=D.signalRegistry.getSignal(D.activeSignals[b]);null!=c&&a.unshift({signalID:D.activeSignals[b],line:c.line,position:R.start,strength:0})}D.activeSignals=[];I.event&&0<a.length&&I.event(a)}a=M.getElementsWithName("playhead")[0];
0>J.position||J.position>k?void 0!=a&&a.parent.remove(a):(void 0==a&&(a=X()),a.parameter.x(E.totalSize.width/k*J.position),J.automoveViewposition&&(a=k-k*t,(J.position<Math.floor(E.viewposition.x*a)||J.position>Math.floor(E.viewposition.x*a)+k*t)&&I.viewposition((J.position>a?a:J.position)/a)))};I.progress=function(){if(!J.held){var a=I.eventsBetween(J.position,J.position+D.step);if(W&&J.position==R.start){for(var b=0;b<D.activeSignals.length;b++){var c=D.signalRegistry.getSignal(D.activeSignals[b]);
null!=c&&a.unshift({signalID:D.activeSignals[b],line:c.line,position:R.start,strength:0})}D.activeSignals=[]}for(b=0;b<a.length;b++)c=D.activeSignals.indexOf(a[b].signalID),-1!=c&&0==a[b].strength?D.activeSignals.splice(c):0<a[b].strength&&D.activeSignals.push(a[b].signalID);J.position=W&&J.position+D.step==R.end?R.start:J.position+D.step;I.playheadPosition(J.position,!1);I.event&&0<a.length&&I.event(a)}};S.onmousedown=function(a,c,g){a=f.system.keyboard.pressedKeys;if(!a.alt||!a.Space)if(a.shift){var h=
u(g),l=u(g),n=d.builder("rectangle","selectionArea",{x:h.x*b,y:h.y*e,width:0,height:0,style:{fill:r}});I.append(n);f.system.mouse.mouseInteractionHandler(function(a){l=u(a);l.x=0>l.x?0:l.x;l.y=0>l.y?0:l.y;l.x=1<l.x?1:l.x;l.y=1<l.y?1:l.y;a=l.x-h.x;var c=l.y-h.y,d=h.x,g=h.y,f=1,k=1;0>a&&(f=-1,d+=a);0>c&&(k=-1,g+=c);n.parameter.x(d*b);n.parameter.y(g*e);n.parameter.width(f*a*b);n.parameter.height(k*c*e)},function(a){n.parent.remove(n);var b=N(h),c=N(l);b.x*=E.totalSize.width;c.y*=E.totalSize.height;
c.x*=E.totalSize.width;b.y*=E.totalSize.height;a={topLeft:{x:0,y:0},bottomRight:{x:0,y:0}};b.x<c.x?(a.topLeft.x=b.x,a.bottomRight.x=c.x):(a.topLeft.x=c.x,a.bottomRight.x=b.x);b.y<c.y?(a.topLeft.y=b.y,a.bottomRight.y=c.y):(a.topLeft.y=c.y,a.bottomRight.y=b.y);for(;0<D.selectedSignals.length;)D.selectedSignals[0].deselect();for(b=0;b<Q.children.length;b++)c=D.signalRegistry.getSignal(parseInt(Q.children[b].name)),f.library.math.detectOverlap.boundingBoxes({topLeft:{x:E.totalSize.width/k*c.position,
y:E.totalSize.height/p*c.line},bottomRight:{x:E.totalSize.width/k*(c.position+c.length),y:E.totalSize.height/p*(c.line+1)}},a)&&Q.children[b].select(!0)})}else if(a.alt){for(;0<D.selectedSignals.length;)D.selectedSignals[0].deselect();a=U(A(u(g)));a=ca(a.line,a.position,0);a.signalBlock.select();a.signalBlock.rightHandle.onmousedown(void 0,void 0,g,!0)}else if(a.Space){f.core.viewport.cursor("grabbing");var q=u(g),v=E.viewposition.x,y=E.viewposition.y;f.system.mouse.mouseInteractionHandler(function(a){a=
u(a);aa(v-(q.x-a.x)*t/(t-1),y-(q.y-a.y)*m/(m-1))},function(a){f.library.math.detectOverlap.pointWithinBoundingBox(A(u(a)),E.viewArea)&&f.system.keyboard.pressedKeys.Space?f.core.viewport.cursor("grab"):f.core.viewport.cursor("default")})}else for(;0<D.selectedSignals.length;)D.selectedSignals[0].deselect()};S.onmousemove=function(a,b,c){a=f.system.keyboard.pressedKeys;a.alt?f.core.viewport.cursor("crosshair"):a.Space?f.core.viewport.cursor("grab"):f.core.viewport.cursor("default")};V.onkeydown=function(a,
b,c){c=f.system.keyboard.pressedKeys;if(c.Backspace||c.Delete)for(;0<D.selectedSignals.length;)D.selectedSignals[0].delete();c.Space&&f.core.viewport.cursor("grab");c.alt&&(void 0!=Q.getElementUnderPoint(a,b)?f.core.viewport.cursor("copy"):f.core.viewport.cursor("crosshair"))};V.onkeyup=function(a,b,c){f.core.viewport.cursor("default")};I.onpan=F;I.onchangeviewarea=T;I.event=L;(function(){O.clear();for(var a=0;a<p;a++){var c=w[B[a%B.length]];O.append(d.builder("rectangle","strip_horizontal_"+a,{x:0,
y:e/(p*m)*a,width:E.totalSize.width,height:e/(p*m),style:{fill:c.fill,stroke:c.stroke,lineWidth:c.lineWidth}}))}P.clear();for(a=0;a<k;a++)c=C[z[a%z.length]],P.append(d.builder("rectangle","strip_vertical_"+a,{x:b/(k*t)*a,y:0,width:b/(k*t),height:E.totalSize.height,style:{fill:c.fill,stroke:c.stroke,lineWidth:c.lineWidth}}))})();return I};this.sequencer.signalBlock=function(c,g,a,b,e,h,k,p,t,m,q,r){function n(){G.body.parameter.height(a);G.leftHandle.parameter.height(a);G.rightHandle.parameter.height(a)}
function l(){G.body.parameter.width(h*g);G.rightHandle.parameter.x(h*g-r/2)}function u(){G.parameter.y(b*a)}function v(a,b){var c=Object.assign({},a[0]);a[0].hasOwnProperty("fill")&&(c.fill=f.library.misc.multiBlendColours(a.map(function(a){return a.fill}),b));a[0].hasOwnProperty("stroke")&&(c.stroke=f.library.misc.multiBlendColours(a.map(function(a){return a.stroke}),b));return c}k=void 0===k?1:k;p=void 0===p?!1:p;t=void 0===t?[{fill:"rgba(138,138,138,0.6)",stroke:"rgba(175,175,175,0.8)",lineWidth:.5},
{fill:"rgba(130,199,208,0.6)",stroke:"rgba(130,199,208,0.8)",lineWidth:.5},{fill:"rgba(129,209,173,0.6)",stroke:"rgba(129,209,173,0.8)",lineWidth:.5},{fill:"rgba(234,238,110,0.6)",stroke:"rgba(234,238,110,0.8)",lineWidth:.5},{fill:"rgba(249,178,103,0.6)",stroke:"rgba(249,178,103,0.8)",lineWidth:.5},{fill:"rgba(255, 69, 69,0.6)",stroke:"rgba(255, 69, 69,0.8)",lineWidth:.5}]:t;m=void 0===m?[{fill:"rgba(138,138,138,0.8)",stroke:"rgba(175,175,175,1)",lineWidth:.5},{fill:"rgba(130,199,208,0.8)",stroke:"rgba(130,199,208,1)",
lineWidth:.5},{fill:"rgba(129,209,173,0.8)",stroke:"rgba(129,209,173,1)",lineWidth:.5},{fill:"rgba(234,238,110,0.8)",stroke:"rgba(234,238,110,1)",lineWidth:.5},{fill:"rgba(249,178,103,0.8)",stroke:"rgba(249,178,103,1)",lineWidth:.5},{fill:"rgba(255, 69, 69,0.8)",stroke:"rgba(255, 69, 69,1)",lineWidth:.5}]:m;q=void 0===q?"rgba(255,0,255,0)":q;r=void 0===r?5:r;var z=!1,x=r/4,w=v(t,k),A=v(m,k),G=d.builder("group",String(c),{x:e*g,y:b*a});G.body=d.builder("rectangle","body",{width:h*g,height:a,style:{fill:w.fill,
stroke:w.stroke,lineWidth:w.lineWidth}});G.leftHandle=d.builder("rectangle","leftHandle",{x:-r/2,width:r,height:a,style:{fill:q}});G.rightHandle=d.builder("rectangle","rightHandle",{x:h*g-r/2,width:r,height:a,style:{fill:q}});G.append(G.body);G.append(G.leftHandle);G.append(G.rightHandle);G.unit=function(b,c){if(void 0==b&&void 0==c)return{x:g,y:a};void 0==b?(a=c,n(),u()):(void 0==c?(g=b,l()):(g=b,a=c,l(),n(),u()),G.parameter.x(e*g))};G.line=function(a){if(void 0==a)return b;b=a;u()};G.position=function(a){if(void 0==
a)return e;e=a;G.parameter.x(e*g)};G.length=function(a){if(void 0==a)return h;h=a<x/g?x/g:a;l()};G.strength=function(a){if(void 0==a)return k;a=1<a?1:a;k=0>a?0:a;w=v(t,k);A=v(m,k);G.glow(p)};G.glow=function(a){if(void 0==a)return p;(p=a)?(G.body.style.fill=A.fill,G.body.style.stroke=A.stroke,G.body.style.lineWidth=A.lineWidth):(G.body.style.fill=w.fill,G.body.style.stroke=w.stroke,G.body.style.lineWidth=w.lineWidth)};G.selected=function(a){if(void 0==a)return z;z=a};return G};this.slide=function(c,
g,a,b,e,h,k,p,t,m,q,r,n,l,y){function v(a,b){a=1<a?1:a;a=0>a?0:a;if((void 0===b||b)&&void 0!=x.onchange)x.onchange(a);p=a;G.y=a*e*(1-k);C.y=a*e*(1-k);G.computeExtremities();C.computeExtremities()}function u(a){return a.y*Math.cos(x.__calculationAngle)-a.x*Math.sin(x.__calculationAngle)}b=void 0===b?10:b;e=void 0===e?95:e;h=void 0===h?0:h;k=void 0===k?.1:k;p=void 0===p?0:p;t=void 0===t?-1:t;m=void 0===m?"rgba(200,200,200,1)":m;q=void 0===q?"rgba(150,150,150,1)":q;r=void 0===r?"rgba(50,50,50,1)":r;
n=void 0===n?"rgba(255,0,0,0)":n;l=void 0===l?function(){}:l;y=void 0===y?function(){}:y;var x=d.builder("group",void 0===c?"slide":c,{x:g,y:a,angle:h}),w=d.builder("group","backingAndSlotGroup");x.append(w);c=d.builder("rectangle","backing",{width:b,height:e,style:{fill:q}});w.append(c);r=d.builder("rectangle","slot",{x:.45*b,y:k/2*e,width:.1*b,height:e*(1-k),style:{fill:r}});w.append(r);var z=d.builder("rectangle","backingAndSlotCover",{width:b,height:e,style:{fill:"rgba(0,0,0,0)"}});w.append(z);
var G=d.builder("rectangle","handle",{width:b,height:e*k,style:{fill:m}});x.append(G);m=e*k+.01*e;var C=d.builder("rectangle","invisibleHandle",{y:(e*k-m)/2,width:b,height:m+k,style:{fill:n}});x.append(C);x.__calculationAngle=h;var H=!1;x.set=function(a,b){H||v(a,b)};x.get=function(){return p};x.ondblclick=function(){if(!(0>t||H)&&(v(t),void 0!=x.onrelease))x.onrelease(p)};x.onwheel=function(){if(!H){var a=event.deltaY/100,b=f.core.viewport.scale();v(p+a/(10*b));if(void 0!=x.onrelease)x.onrelease(p)}};
w.onmousedown=function(a,b,c){};w.onclick=function(a,b,c){if(!H&&(c=w.getOffset(),a=f.library.math.cartesianAngleAdjust(a-(w.x+c.x),b-(w.y+c.y),0-(w.angle+c.a)).y/z.height,a+=.5*k*(2*a-1),v(a),void 0!=x.onrelease))x.onrelease(a)};C.onmousedown=function(a,b,c){H=!0;var d=p,g=u(c),h=e-e*k;f.system.mouse.mouseInteractionHandler(function(a){a=g-u(a);var b=f.core.viewport.scale();v(d-a/(b*h)*window.devicePixelRatio)},function(a){a=g-u(a);var b=f.core.viewport.scale();x.onrelease(d-a/(b*h)*window.devicePixelRatio);
H=!1})};v(p);x.onchange=l;x.onrelease=y;return x};this.slidePanel=function(c,g,a,b,e,f,k,p,t,m,q,r,n){b=void 0===b?80:b;e=void 0===e?95:e;f=void 0===f?0:f;p=void 0===p?8:p;t=void 0===t?0:t;m=void 0===m?.5:m;q=void 0===q?"rgba(200,200,200,1)":q;r=void 0===r?"rgba(150,150,150,1)":r;n=void 0===n?"rgba(50,50,50,1)":n;var h=d.builder("group",void 0===c?"slidePanel":c,{x:g,y:a,angle:f});for(c=0;c<p;c++)g=d.builder("slide","slide_"+c,{x:b/p*c,y:0,width:b/p,height:e,value:t,resetValue:m,style:{handle:q,backing:r,
slot:n},onchange:function(a){h.onchange(this.id,a)},onrelease:function(a){h.onrelease(this.id,a)}}),g.__calculationAngle=f,h.append(g);return h}};this.dynamic=new function(){this.cable=function(c,g,a,b,e,f,k){g=void 0===g?0:g;a=void 0===a?0:a;b=void 0===b?0:b;e=void 0===e?0:e;f=void 0===f?"rgb(255,0,0)":f;k=void 0===k?"rgb(255,100,100)":k;c=d.builder("group",void 0===c?"path":c);var h=d.builder("path","cable",{points:[{x:g,y:a},{x:b,y:e}],style:{stroke:f,lineWidth:5}});c.append(h);c.activate=function(){h.style.stroke=
k};c.deactivate=function(){h.style.stroke=f};c.draw=function(c,d,f,k){g=void 0!=c?c:g;a=void 0!=d?d:a;b=void 0!=f?f:b;e=void 0!=k?k:e;h.parameter.points([{x:g,y:a},{x:b,y:e}])};c._isCable=!0;return c};this.connectionNode=function(c,g,a,b,e,h,k,p,t,m,q,r,n,l){e=void 0===e?20:e;h=void 0===h?20:h;k=void 0===k?"none":k;p=void 0===p?"":p;t=void 0===t?"rgb(220, 220, 220)":t;m=void 0===m?"rgb(244, 244, 244)":m;q=void 0===q?"rgb(146, 146, 146)":q;r=void 0===r?"rgb(215, 215, 215)":r;n=void 0===n?function(a){}:
n;l=void 0===l?function(a){}:l;var y=d.builder("group",void 0===c?"connectionNode":c,{x:g,y:a,angle:void 0===b?0:b});y._connectionNode=!0;y._type=k;y._direction=p;var v=d.builder("rectangle","node",{width:e,height:h,style:{fill:t}});y.append(v);var u=void 0;y.connectTo=function(a){if(void 0!=a&&a!=this&&a._type==this._type&&(""!=this._direction&&""!=a._direction||this._direction==a._direction)&&(""==this._direction||a._direction!=this._direction)&&a!=u){this.disconnect();u=a;if(void 0!=n)this.onconnect(!0);
u._receiveConnection(this);this._addCable(this)}};y._receiveConnection=function(a){this.disconnect();u=a;if(void 0!=n)this.onconnect(!1)};y.disconnect=function(){if(void 0!=u){this._removeCable();if(void 0!=l)this.ondisconnect(!0);u._receiveDisconnection();u=null}};y._receiveDisconnection=function(){if(void 0!=l)this.ondisconnect(!1);u=null};y.getForeignNode=function(){return u};v.onmousedown=function(a,b,c){f.system.mouse.mouseInteractionHandler(void 0,function(a){a=f.core.viewport.windowPoint2workspacePoint(a.x,
a.y);a=f.core.arrangement.getElementUnderPoint(a.x,a.y);void 0!=a&&(a=a.parent,a._connectionNode&&y.connectTo(a))})};v.ondblclick=function(a,b,c){y.disconnect()};var x;y._addCable=function(){x=d.builder("cable","cable-"+this.getAddress(),{x1:0,y1:0,x2:100,y2:100,style:{dim:q,glow:r}});u._receiveCable(x);f.system.pane.getMiddlegroundPane(this).append(x);this.draw()};y._receiveCable=function(a){x=a};y._removeCable=function(){x.parent.remove(x);x=void 0;u._loseCable()};y._loseCable=function(){x=void 0};
y.getCablePoint=function(){var b=this.getOffset(),c=f.library.math.cartesianAngleAdjust(g+e/2,a+h/2,b.a);c.x+=b.x;c.y+=b.y;return c};y.draw=function(){if(void 0!=x){var a=this.getCablePoint(),b=u.getCablePoint();x.draw(a.x,a.y,b.x,b.y)}};y.activate=function(){v.style.fill=m;void 0!=x&&x.activate()};y.deactivate=function(){v.style.fill=t;void 0!=x&&x.deactivate()};y.onconnect=n;y.ondisconnect=l;return y};this.connectionNode_audio=function(c,g,a,b,e,f,k,p,t,m,q,r,n,l){k=void 0===k?!1:k;n=void 0===n?
function(){}:n;l=void 0===l?function(){}:l;var h=d.builder("connectionNode",void 0===c?"connectionNode_audio":c,{x:g,y:a,angle:void 0===b?0:b,width:void 0===e?20:e,height:void 0===f?20:f,type:"audio",direction:k?"out":"in",style:{dim:void 0===t?"rgba(255, 244, 220, 1)":t,glow:void 0===m?"rgba(255, 244, 244, 1)":m,cable_dim:void 0===q?"rgb(247, 146, 84)":q,cable_glow:void 0===r?"rgb(242, 168, 123)":r}});h._direction=k?"out":"in";h.audioNode=p.createAnalyser();h.out=function(){return h.audioNode};h.in=
function(){return h.audioNode};h.onconnect=function(a){"out"==h._direction&&h.audioNode.connect(h.getForeignNode().audioNode);n&&n(a)};h.ondisconnect=function(a){"out"==h._direction&&h.audioNode.disconnect(h.getForeignNode().audioNode);l&&l(a)};return h};this.connectionNode_data=function(c,g,a,b,e,f,k,p,t,m,q,r,n,l){function h(a){a.activate();setTimeout(function(){void 0!=a&&a.deactivate()},100);void 0!=a.getForeignNode()&&(a.getForeignNode().activate(),setTimeout(function(){void 0!=a&&void 0!=a.getForeignNode()&&
a.getForeignNode().deactivate()},100))}q=void 0===q?function(a,b){}:q;r=void 0===r?function(a){}:r;var v=d.builder("connectionNode",void 0===c?"connectionNode_data":c,{x:g,y:a,angle:void 0===b?0:b,width:void 0===e?20:e,height:void 0===f?20:f,type:"data",style:{dim:void 0===k?"rgba(220, 244, 255,1)":k,glow:void 0===p?"rgba(244, 244, 255, 1)":p,cable_dim:void 0===t?"rgb(84, 146, 247)":t,cable_glow:void 0===m?"rgb(123, 168, 242)":m},onconnect:void 0===n?function(){}:n,ondisconnect:void 0===l?function(){}:
l});v.send=function(a,b){h(v);if(void 0!=v.getForeignNode())v.getForeignNode().onreceivedata(a,b)};v.request=function(a){h(v);if(void 0!=v.getForeignNode())v.getForeignNode().ongivedata(a)};v.onreceivedata=q;v.ongivedata=r;return v};this.connectionNode_signal=function(c,g,a,b,e,f,k,p,t,m,q,r,n){q=void 0===q?function(a){}:q;r=void 0===r?function(a){}:r;n=void 0===n?function(a){}:n;var h=d.builder("connectionNode",void 0===c?"connectionNode_signal":c,{x:g,y:a,angle:void 0===b?0:b,width:void 0===e?20:
e,height:void 0===f?20:f,type:"signal",style:{dim:void 0===k?"rgb(255, 220, 244)":k,glow:void 0===p?"rgb(255, 244, 244)":p,cable_dim:void 0===t?"rgb(247, 84, 146)":t,cable_glow:void 0===m?"rgb(247, 195, 215)":m}}),u=!1;h._getLocalValue=function(){return u};h._update=function(){var a=h.read();a?h.activate():h.deactivate();q(a)};h.set=function(a){u=a;h._update();void 0!=h.getForeignNode()&&h.getForeignNode()._update()};h.read=function(){return u||(void 0!=h.getForeignNode()?h.getForeignNode()._getLocalValue():
!1)};h.onconnect=function(a){r&&r(a);h._update()};h.ondisconnect=function(a){n&&n(a);h._update()};return h};this.connectionNode_voltage=function(c,g,a,b,e,f,k,p,t,m,q,r,n){q=void 0===q?function(a){}:q;r=void 0===r?function(a){}:r;n=void 0===n?function(a){}:n;var h=d.builder("connectionNode",void 0===c?"connectionNode_voltage":c,{x:g,y:a,angle:void 0===b?0:b,width:void 0===e?20:e,height:void 0===f?20:f,type:"voltage",style:{dim:void 0===k?"rgb(222, 255, 220)":k,glow:void 0===p?"rgb(240, 252, 239)":
p,cable_dim:void 0===t?"rgb(84, 247, 111)":t,cable_glow:void 0===m?"rgb(159, 252, 174)":m}}),u=0;h._getLocalValue=function(){return u};h._update=function(a){0<a?h.activate():h.deactivate();q(a)};h.set=function(a){u=a;a=h.read();h._update(a);void 0!=h.getForeignNode()&&h.getForeignNode()._update(a)};h.read=function(){return u+(void 0!=h.getForeignNode()?h.getForeignNode()._getLocalValue():!1)};h.onconnect=function(a){r&&r(a);h._update(h.read())};h.ondisconnect=function(a){n&&n(a);h._update(u)};return h}};
this.builder=function(c,d,a){a||(a={});void 0==a.style&&(a.style={});switch(c){default:return console.warn("Unknown element: "+c),null;case "group":return this.basic.group(d,a.x,a.y,a.angle,a.ignored);case "rectangle":return this.basic.rectangle(d,a.x,a.y,a.width,a.height,a.angle,a.anchor,a.ignored,a.style.fill,a.style.stroke,a.style.lineWidth,a.style.lineJoin,a.style.miterLimit,a.style.shadowColour,a.style.shadowBlur,a.style.shadowOffset);case "image":return this.basic.image(d,a.x,a.y,a.width,a.height,
a.angle,a.anchor,a.ignored,a.url);case "canvas":return this.basic.canvas(d,a.x,a.y,a.width,a.height,a.angle,a.anchor,a.ignored,a.resolution);case "polygon":return this.basic.polygon(d,a.points,a.ignored,a.style.fill,a.style.stroke,a.style.lineWidth,a.style.lineJoin,a.style.miterLimit,a.style.shadowColour,a.style.shadowBlur,a.style.shadowOffset);case "text":return this.basic.text(d,a.x,a.y,a.text,a.angle,a.anchor,a.size,a.ignored,a.style.font,a.style.textAlign,a.style.textBaseline,a.style.fill,a.style.stroke,
a.style.lineWidth,a.style.lineJoin,a.style.miterLimit,a.style.shadowColour,a.style.shadowBlur,a.style.shadowOffset);case "circle":return this.basic.circle(d,a.x,a.y,a.r,a.ignored,a.style.fill,a.style.stroke,a.style.lineWidth,a.style.lineJoin,a.style.miterLimit,a.style.shadowColour,a.style.shadowBlur,a.style.shadowOffset);case "path":return this.basic.path(d,a.points,a.ignored,a.style.stroke,a.style.lineWidth,a.style.lineCap,a.style.lineJoin,a.style.miterLimit,a.style.shadowColour,a.style.shadowBlur,
a.style.shadowOffset);case "glowbox_rect":return this.display.glowbox_rect(d,a.x,a.y,a.width,a.height,a.angle,a.style.glow,a.style.dim);case "sevenSegmentDisplay":return this.display.sevenSegmentDisplay(d,a.x,a.y,a.width,a.height,a.angle,a.style.background,a.style.glow,a.style.dim);case "sevenSegmentDisplay__static":return this.display.sevenSegmentDisplay__static(d,a.x,a.y,a.width,a.height,a.angle,a.resolution,a.style.background,a.style.glow,a.style.dim);case "sixteenSegmentDisplay":return this.display.sixteenSegmentDisplay(d,
a.x,a.y,a.width,a.height,a.angle,a.style.background,a.style.glow,a.style.dim);case "sixteenSegmentDisplay__static":return this.display.sixteenSegmentDisplay__static(d,a.x,a.y,a.width,a.height,a.angle,a.resolution,a.style.background,a.style.glow,a.style.dim);case "readout_sixteenSegmentDisplay":return this.display.readout_sixteenSegmentDisplay(d,a.x,a.y,a.width,a.height,a.count,a.angle,a.style.background,a.style.glow,a.style.dim);case "readout_sixteenSegmentDisplay__static":return this.display.readout_sixteenSegmentDisplay__static(d,
a.x,a.y,a.width,a.height,a.count,a.angle,a.resolution,a.style.background,a.style.glow,a.style.dim);case "level":return this.display.level(d,a.x,a.y,a.angle,a.width,a.height,a.style.backing,a.style.levels);case "meter_level":return this.display.meter_level(d,a.x,a.y,a.angle,a.width,a.height,a.markings,a.style.backing,a.style.levels,a.style.markingStyle_fill,a.style.markingStyle_font);case "audio_meter_level":return this.display.audio_meter_level(d,a.x,a.y,a.angle,a.width,a.height,a.markings,a.style.backing,
a.style.levels,a.style.markingStyle_fill,a.style.markingStyle_font);case "rastorDisplay":return this.display.rastorDisplay(d,a.x,a.y,a.angle,a.width,a.height,a.xCount,a.yCount,a.xGappage,a.yGappage);case "grapher":return this.display.grapher(d,a.x,a.y,a.width,a.height,a.angle,a.style.foregrounds,a.style.foregroundText,a.style.background_stroke,a.style.background_lineWidth,a.style.backgroundText_fill,a.style.backgroundText_font,a.style.backing);case "grapher__static":return this.display.grapher__static(d,
a.x,a.y,a.width,a.height,a.angle,a.resolution,a.style.foregrounds,a.style.foregroundText,a.style.background_stroke,a.style.background_lineWidth,a.style.backgroundText_fill,a.style.backgroundText_font,a.style.backing);case "grapher_periodicWave":return this.display.grapher_periodicWave(d,a.x,a.y,a.width,a.height,a.angle,a.style.foregrounds,a.style.foregroundText,a.style.background_stroke,a.style.background_lineWidth,a.style.backgroundText_fill,a.style.backgroundText_size,a.style.backgroundText_font,
a.style.backing);case "grapher_periodicWave__static":return this.display.grapher_periodicWave__static(d,a.x,a.y,a.width,a.height,a.angle,a.style.foregrounds,a.style.foregroundText,a.style.background_stroke,a.style.background_lineWidth,a.style.backgroundText_fill,a.style.backgroundText_size,a.style.backgroundText_font,a.style.backing);case "grapher_audioScope":return this.display.grapher_audioScope(d,a.x,a.y,a.width,a.height,a.angle,a.style.foregrounds,a.style.foregroundText,a.style.background_stroke,
a.style.background_lineWidth,a.style.backgroundText_fill,a.style.backgroundText_size,a.style.backgroundText_font,a.style.backing);case "grapher_audioScope__static":return this.display.grapher_audioScope__static(d,a.x,a.y,a.width,a.height,a.angle,a.style.foregrounds,a.style.foregroundText,a.style.background_stroke,a.style.background_lineWidth,a.style.backgroundText_fill,a.style.backgroundText_size,a.style.backgroundText_font,a.style.backing);case "slide":return this.control.slide(d,a.x,a.y,a.width,
a.height,a.angle,a.handleHeight,a.value,a.resetValue,a.style.handle,a.style.backing,a.style.slot,a.style.invisibleHandle,a.onchange,a.onrelease);case "slidePanel":return this.control.slidePanel(d,a.x,a.y,a.width,a.height,a.angle,a.handleHeight,a.count,a.value,a.resetValue,a.style.handle,a.style.backing,a.style.slot,a.style.invisibleHandle,a.onchange,a.onrelease);case "rangeslide":return this.control.rangeslide(d,a.x,a.y,a.width,a.height,a.angle,a.handleHeight,a.spanWidth,a.values,a.resetValues,a.style.handle,
a.style.backing,a.style.slot,a.style.invisibleHandle,a.style.span,a.onchange,a.onrelease);case "dial_continuous":return this.control.dial_continuous(d,a.x,a.y,a.r,a.angle,a.value,a.resetValue,a.startAngle,a.maxAngle,a.style.handle,a.style.slot,a.style.needle,a.onchange,a.onrelease);case "dial_discrete":return this.control.dial_discrete(d,a.x,a.y,a.r,a.angle,a.value,a.resetValue,a.optionCount,a.startAngle,a.maxAngle,a.style.handle,a.style.slot,a.style.needle,a.onchange,a.onrelease);case "button_rect":return this.control.button_rect(d,
a.x,a.y,a.width,a.height,a.angle,a.text_centre,a.text_left,a.text_right,a.textVerticalOffsetMux,a.textHorizontalOffsetMux,a.active,a.hoverable,a.selectable,a.pressable,a.style.text_font,a.style.text_textBaseline,a.style.text_fill,a.style.text_stroke,a.style.text_lineWidth,a.style.background__off__fill,a.style.background__off__stroke,a.style.background__off__strokeWidth,a.style.background__up__fill,a.style.background__up__stroke,a.style.background__up__strokeWidth,a.style.background__press__fill,a.style.background__press__stroke,
a.style.background__press__strokeWidth,a.style.background__select__fill,a.style.background__select__stroke,a.style.background__select__strokeWidth,a.style.background__select_press__fill,a.style.background__select_press__stroke,a.style.background__select_press__strokeWidth,a.style.background__glow__fill,a.style.background__glow__stroke,a.style.background__glow__strokeWidth,a.style.background__glow_press__fill,a.style.background__glow_press__stroke,a.style.background__glow_press__strokeWidth,a.style.background__glow_select__fill,
a.style.background__glow_select__stroke,a.style.background__glow_select__strokeWidth,a.style.background__glow_select_press__fill,a.style.background__glow_select_press__stroke,a.style.background__glow_select_press__strokeWidth,a.style.background__hover__fill,a.style.background__hover__stroke,a.style.background__hover__strokeWidth,a.style.background__hover_press__fill,a.style.background__hover_press__stroke,a.style.background__hover_press__strokeWidth,a.style.background__hover_select__fill,a.style.background__hover_select__stroke,
a.style.background__hover_select__strokeWidth,a.style.background__hover_select_press__fill,a.style.background__hover_select_press__stroke,a.style.background__hover_select_press__strokeWidth,a.style.background__hover_glow__fill,a.style.background__hover_glow__stroke,a.style.background__hover_glow__strokeWidth,a.style.background__hover_glow_press__fill,a.style.background__hover_glow_press__stroke,a.style.background__hover_glow_press__strokeWidth,a.style.background__hover_glow_select__fill,a.style.background__hover_glow_select__stroke,
a.style.background__hover_glow_select__strokeWidth,a.style.background__hover_glow_select_press__fill,a.style.background__hover_glow_select_press__stroke,a.style.background__hover_glow_select_press__strokeWidth,a.onenter,a.onleave,a.onpress,a.ondblpress,a.onrelease,a.onselect,a.ondeselect);case "list":return this.control.list(d,a.x,a.y,a.width,a.height,a.angle,a.list,a.itemTextVerticalOffsetMux,a.itemTextHorizontalOffsetMux,a.active,a.multiSelect,a.hoverable,a.selectable,a.pressable,a.itemHeightMux,
a.itemWidthMux,a.itemSpacingMux,a.breakHeightMux,a.breakWidthMux,a.spacingHeightMux,a.style.backing,a.style.break,a.style.text_font,a.style.text_textBaseline,a.style.text_fill,a.style.text_stroke,a.style.text_lineWidth,a.style.item__off__fill,a.style.item__off__stroke,a.style.item__off__strokeWidth,a.style.item__up__fill,a.style.item__up__stroke,a.style.item__up__strokeWidth,a.style.item__press__fill,a.style.item__press__stroke,a.style.item__press__strokeWidth,a.style.item__select__fill,a.style.item__select__stroke,
a.style.item__select__strokeWidth,a.style.item__select_press__fill,a.style.item__select_press__stroke,a.style.item__select_press__strokeWidth,a.style.item__glow__fill,a.style.item__glow__stroke,a.style.item__glow__strokeWidth,a.style.item__glow_press__fill,a.style.item__glow_press__stroke,a.style.item__glow_press__strokeWidth,a.style.item__glow_select__fill,a.style.item__glow_select__stroke,a.style.item__glow_select__strokeWidth,a.style.item__glow_select_press__fill,a.style.item__glow_select_press__stroke,
a.style.item__glow_select_press__strokeWidth,a.style.item__hover__fill,a.style.item__hover__stroke,a.style.item__hover__strokeWidth,a.style.item__hover_press__fill,a.style.item__hover_press__stroke,a.style.item__hover_press__strokeWidth,a.style.item__hover_select__fill,a.style.item__hover_select__stroke,a.style.item__hover_select__strokeWidth,a.style.item__hover_select_press__fill,a.style.item__hover_select_press__stroke,a.style.item__hover_select_press__strokeWidth,a.style.item__hover_glow__fill,
a.style.item__hover_glow__stroke,a.style.item__hover_glow__strokeWidth,a.style.item__hover_glow_press__fill,a.style.item__hover_glow_press__stroke,a.style.item__hover_glow_press__strokeWidth,a.style.item__hover_glow_select__fill,a.style.item__hover_glow_select__stroke,a.style.item__hover_glow_select__strokeWidth,a.style.item__hover_glow_select_press__fill,a.style.item__hover_glow_select_press__stroke,a.style.item__hover_glow_select_press__strokeWidth,a.onenter,a.onleave,a.onpress,a.ondblpress,a.onrelease,
a.onselection,a.onpositionchange);case "checkbox_rect":return this.control.checkbox_rect(d,a.x,a.y,a.width,a.height,a.angle,a.style.check,a.style.backing,a.style.checkGlow,a.style.backingGlow,a.onchange);case "rastorgrid":return this.control.rastorgrid(d,a.x,a.y,a.width,a.height,a.angle,a.xCount,a.yCount,a.style.backing,a.style.check,a.style.backingGlow,a.style.checkGlow,a.onchange);case "needleOverlay":return this.control.needleOverlay(d,a.x,a.y,a.width,a.height,a.angle,a.needleWidth,a.selectNeedle,
a.selectionArea,a.style.needles,a.onchange,a.onrelease,a.selectionAreaToggle);case "grapher_waveWorkspace":return this.control.grapher_waveWorkspace(d,a.x,a.y,a.width,a.height,a.angle,a.selectNeedle,a.selectionArea,a.style.foregrounds,a.style.foregroundText,a.style.background_stroke,a.style.background_lineWidth,a.style.backgroundText_fill,a.style.backgroundText_font,a.style.backing,a.onchange,a.onrelease,a.selectionAreaToggle);case "sequencer":return this.control.sequencer(d,a.x,a.y,a.width,a.height,
a.angle,a.xCount,a.yCount,a.zoomLevel_x,a.zoomLevel_y,a.backingStyle,a.selectionAreaStyle,a.blockStyle_body,a.blockStyle_bodyGlow,a.blockStyle_handle,a.blockStyle_handleWidth,a.horizontalStripStyle_pattern,a.horizontalStripStyle_glow,a.horizontalStripStyle_styles,a.verticalStripStyle_pattern,a.verticalStripStyle_glow,a.verticalStripStyle_styles,a.playheadStyle,a.onpan,a.onchangeviewarea,a.event);case "cable":return this.dynamic.cable(d,a.x1,a.y1,a.x2,a.y2,a.style.dim,a.style.glow);case "connectionNode":return this.dynamic.connectionNode(d,
a.x,a.y,a.angle,a.width,a.height,a.type,a.direction,a.style.dim,a.style.glow,a.style.cable_dim,a.style.cable_glow,a.onconnect,a.ondisconnect);case "connectionNode_signal":return this.dynamic.connectionNode_signal(d,a.x,a.y,a.angle,a.width,a.height,a.style.dim,a.style.glow,a.style.cable_dim,a.style.cable_glow,a.onchange,a.onconnect,a.ondisconnect);case "connectionNode_voltage":return this.dynamic.connectionNode_voltage(d,a.x,a.y,a.angle,a.width,a.height,a.style.dim,a.style.glow,a.style.cable_dim,a.style.cable_glow,
a.onchange,a.onconnect,a.ondisconnect);case "connectionNode_data":return this.dynamic.connectionNode_data(d,a.x,a.y,a.angle,a.width,a.height,a.style.dim,a.style.glow,a.style.cable_dim,a.style.cable_glow,a.onreceive,a.ongive,a.onconnect,a.ondisconnect);case "connectionNode_audio":return this.dynamic.connectionNode_audio(d,a.x,a.y,a.angle,a.width,a.height,a.isAudioOutput,f.library.audio.context,a.style.dim,a.style.glow,a.style.cable_dim,a.style.cable_glow,a.onconnect,a.ondisconnect)}}}};this.unit=new function(){this.test=
new function(){var d=this;this.testUnit=function(c,g,a){c=d.builder(this.testUnit,{name:"testUnit",category:"misc",collection:"alpha",x:c,y:g,a:a,space:[{x:-5,y:-5},{x:65,y:-5},{x:65,y:5},{x:290,y:5},{x:290,y:40},{x:615,y:40},{x:615,y:130},{x:715,y:130},{x:715,y:220},{x:255,y:220},{x:255,y:335},{x:440,y:335},{x:440,y:445},{x:-5,y:455}],elements:[{type:"rectangle",name:"testRectangle",data:{x:5,y:5,width:30,height:30,style:{fill:"rgba(255,0,0,1)"}}},{type:"circle",name:"testCircle",data:{x:20,y:55,
r:15}},{type:"image",name:"testImage",data:{x:40,y:40,width:30,height:30,url:"https://t2.genius.com/unsafe/300x300/https%3A%2F%2Fimages.genius.com%2F72ee0b753f056baa410c17a6ad9fea70.588x588x1.jpg"}},{type:"polygon",name:"testPolygon",data:{points:[{x:55,y:5},{x:70,y:35},{x:40,y:35}],style:{fill:"rgba(0,255,0,1)"}}},{type:"text",name:"testText",data:{x:7.5,y:95,text:"Hello",style:{font:"20pt Arial",fill:"rgba(150,150,255,1)"}}},{type:"path",name:"testPath",data:{points:[{x:0,y:0},{x:0,y:90},{x:2.5,
y:90},{x:2.5,y:72.5},{x:75,y:72.5}]}},{type:"glowbox_rect",name:"test_glowbox_rect",data:{x:90,y:0}},{type:"sevenSegmentDisplay",name:"test_sevenSegmentDisplay",data:{x:125,y:0}},{type:"sixteenSegmentDisplay",name:"test_sixteenSegmentDisplay",data:{x:150,y:0}},{type:"readout_sixteenSegmentDisplay",name:"test_readout_sixteenSegmentDisplay",data:{x:175,y:0}},{type:"level",name:"test_level1",data:{x:90,y:35}},{type:"meter_level",name:"test_meterLevel1",data:{x:115,y:35}},{type:"audio_meter_level",name:"test_audioMeterLevel1",
data:{x:140,y:35}},{type:"rastorDisplay",name:"test_rastorDisplay1",data:{x:165,y:35}},{type:"grapher",name:"test_grapher1",data:{x:230,y:35}},{type:"grapher_periodicWave",name:"test_grapher_periodicWave1",data:{x:355,y:35}},{type:"grapher_audioScope",name:"test_grapher_audioScope1",data:{x:480,y:35}},{type:"slide",name:"test_slide1",data:{x:0,y:110}},{type:"slidePanel",name:"test_slidePanel1",data:{x:15,y:110}},{type:"slide",name:"test_slide2",data:{x:0,y:220,angle:-Math.PI/2}},{type:"slidePanel",
name:"test_slidePanel2",data:{x:0,y:305,angle:-Math.PI/2}},{type:"rangeslide",name:"test_rangeslide1",data:{x:100,y:110}},{type:"rangeslide",name:"test_rangeslide2",data:{x:100,y:220,angle:-Math.PI/2}},{type:"dial_continuous",name:"test_dial_continuous1",data:{x:130,y:125}},{type:"dial_discrete",name:"test_dial_discrete1",data:{x:170,y:125}},{type:"button_rect",name:"test_button_rect1",data:{x:115,y:145}},{type:"list",name:"test_list1",data:{x:185,y:225,list:["space",{text_left:"item1",text_centre:"",
text_right:"",function:function(){console.log("item1 function")}},{text_left:"item2",text_centre:"",text_right:"",function:function(){console.log("item2 function")}},{text_left:"item3",text_centre:"",text_right:"",function:function(){console.log("item3 function")}},{text_left:"item4",text_centre:"",text_right:"",function:function(){console.log("item4 function")}},{text_left:"item5",text_centre:"",text_right:"",function:function(){console.log("item5 function")}},"break",{text_left:"item6",text_centre:"",
text_right:"",function:function(){console.log("item6 function")}},{text_left:"item7",text_centre:"",text_right:"",function:function(){console.log("item7 function")}},{text_left:"item8",text_centre:"",text_right:"",function:function(){console.log("item8 function")}},{text_left:"item9",text_centre:"",text_right:"",function:function(){console.log("item9 function")}},{text_left:"item10",text_centre:"",text_right:"",function:function(){console.log("item10 function")}},"break",{text_left:"item11",text_centre:"",
text_right:"",function:function(){console.log("item11 function")}},{text_left:"item12",text_centre:"",text_right:"",function:function(){console.log("item12 function")}},{text_left:"item13",text_centre:"",text_right:"",function:function(){console.log("item13 function")}},{text_left:"item14",text_centre:"",text_right:"",function:function(){console.log("item14 function")}},{text_left:"item15",text_centre:"",text_right:"",function:function(){console.log("item15 function")}},"space"]}},{type:"checkbox_rect",
name:"test_checkbox_rect1",data:{x:150,y:145}},{type:"rastorgrid",name:"test_rastorgrid1",data:{x:100,y:225}},{type:"needleOverlay",name:"test_needleOverlay1",data:{x:0,y:310}},{type:"grapher_waveWorkspace",name:"test_grapher_waveWorkspace1",data:{x:0,y:375}},{type:"sequencer",name:"test_sequencer1",data:{x:125,y:330}},{type:"connectionNode",name:"test_connectionNode1",data:{x:255,y:135}},{type:"connectionNode",name:"test_connectionNode2",data:{x:230,y:185}},{type:"connectionNode",name:"test_connectionNode3",
data:{x:280,y:185}},{type:"connectionNode_signal",name:"test_connectionNode_signal1",data:{x:355,y:135}},{type:"connectionNode_signal",name:"test_connectionNode_signal2",data:{x:330,y:185}},{type:"connectionNode_signal",name:"test_connectionNode_signal3",data:{x:380,y:185}},{type:"connectionNode_voltage",name:"test_connectionNode_voltage1",data:{x:455,y:135}},{type:"connectionNode_voltage",name:"test_connectionNode_voltage2",data:{x:430,y:185}},{type:"connectionNode_voltage",name:"test_connectionNode_voltage3",
data:{x:480,y:185}},{type:"connectionNode_data",name:"test_connectionNode_data1",data:{x:555,y:135}},{type:"connectionNode_data",name:"test_connectionNode_data2",data:{x:530,y:185}},{type:"connectionNode_data",name:"test_connectionNode_data3",data:{x:580,y:185}},{type:"connectionNode_audio",name:"test_connectionNode_audio1",data:{x:655,y:135,isAudioOutput:!0}},{type:"connectionNode_audio",name:"test_connectionNode_audio2",data:{x:630,y:185}},{type:"connectionNode_audio",name:"test_connectionNode_audio3",
data:{x:680,y:185}}]});c.elements.readout_sixteenSegmentDisplay.test_readout_sixteenSegmentDisplay.text("hello");c.elements.readout_sixteenSegmentDisplay.test_readout_sixteenSegmentDisplay.print();c.elements.grapher.test_grapher1.draw([0,-2,1,-1,2],[0,.25,.5,.75,1]);c.elements.grapher.test_grapher1.draw([0,.25,1],void 0,1);c.elements.grapher_periodicWave.test_grapher_periodicWave1.updateBackground();c.elements.grapher_periodicWave.test_grapher_periodicWave1.wave({sin:[0,1,0,1/3,0,.2,0,1/7,0,1/9,0,
1/11,0,1/13,0,1/15],cos:[0,0]});c.elements.grapher_periodicWave.test_grapher_periodicWave1.draw();c.elements.needleOverlay.test_needleOverlay1.select(.25);c.elements.needleOverlay.test_needleOverlay1.area(.5,.75);c.elements.grapher_waveWorkspace.test_grapher_waveWorkspace1.select(.25);c.elements.grapher_waveWorkspace.test_grapher_waveWorkspace1.area(.5,.75);c.elements.sequencer.test_sequencer1.addSignal(0,0,10,0);c.elements.sequencer.test_sequencer1.addSignal(1,1,10,.1);c.elements.sequencer.test_sequencer1.addSignal(2,
2,10,.2);c.elements.sequencer.test_sequencer1.addSignal(3,3,10,.3);c.elements.sequencer.test_sequencer1.addSignal(4,4,10,.4);c.elements.sequencer.test_sequencer1.addSignal(5,5,10,.5);c.elements.sequencer.test_sequencer1.addSignal(6,6,10,.6);c.elements.sequencer.test_sequencer1.addSignal(7,7,10,.7);c.elements.sequencer.test_sequencer1.addSignal(8,8,10,.8);c.elements.sequencer.test_sequencer1.addSignal(9,9,10,.9);c.elements.sequencer.test_sequencer1.addSignal(10,10,10,1);return c};this.testUnit.devUnit=
!0;this.testUnit.metadata={name:"Test Unit",helpURL:"https://metasophiea.com/curve/help/units/test/testUnit/"};this.builder=function(c,d){function a(){b.space={points:Object.assign([],d.space).map(function(a){return{x:d.x+a.x,y:d.y+a.y}})};b.space.box=f.library.math.boundingBoxFromPoints(b.space.points)}if(c){var b=f._interface.part.alpha.builder("group",d.name,{x:d.x,y:d.y,angle:d.a});b.model=d.name;b.category=d.category;b.collection=d.collection;b.creatorMethod=c;b.elements={};for(c=0;c<d.elements.length;c++)if(void 0!=
b.getChildByName(d.elements[c].name))console.warn('error: part with the name "'+d.elements[c].name+'" already exists. Part:',d.elements[c],"will not be added");else{var e=f._interface.part.alpha.builder(d.elements[c].type,d.elements[c].name,d.elements[c].data);b.append(e);void 0==b.elements[d.elements[c].type]&&(b.elements[d.elements[c].type]={});b.elements[d.elements[c].type][d.elements[c].name]=e}b.io={};[{key:"_",name:"connectionNode"},{key:"signal",name:"connectionNode_signal"},{key:"voltage",
name:"connectionNode_voltage"},{key:"data",name:"connectionNode_data"},{key:"audio",name:"connectionNode_audio"}].forEach(function(a){if(b.elements[a.name])for(var c=Object.keys(b.elements[a.name]),d=0;d<c.length;d++){var e=b.elements[a.name][c[d]];void 0==b.io[a.key]&&(b.io[a.key]={});b.io[a.key][e.name]=e}});b.disconnectEverything=function(){for(var a=Object.keys(b.io),c=0;c<a.length;c++)for(var d=Object.keys(b.io[a[c]]),e=0;e<d.length;e++)b.io[a[c]][d[e]].disconnect()};a();for(c="spaceShape";void 0!=
b.getChildByName(c);)c+=Math.floor(10*Math.random());e=f._interface.part.alpha.builder("polygon",c,{points:d.space,style:{fill:"rgba(0,0,0,0)"}});b.prepend(e);d.spaceOutline&&b.append(f._interface.part.alpha.builder("polygon",c+"Outline",{points:d.space,style:{fill:"rgba(0,0,0,0)",stroke:"rgba(0,0,0,1)"}}));b._parameter={};b._parameter.x=b.parameter.x;b._parameter.y=b.parameter.y;b._parameter.angle=b.parameter.angle;b.parameter.x=function(c){if(void 0!=b._parameter.x(c))return b.x;d.x=c;a()};b.parameter.y=
function(c){if(void 0!=b._parameter.y(c))return b.y;d.y=c;a()};b.parameter.angle=function(c){if(void 0!=b._parameter.angle(c))return b.angle;d.angle=c;a()};return b}console.error("workspace unit\u00a0builder:: creatorMethod missing")}}}};f.system.mouse.functionList.onmousedown.push({requiredKeys:[],function:function(r){f.control.gui.closeAllDropdowns()}});f.system.mouse.functionList.onmousedown.push({requiredKeys:[["shift"]],function:function(r){if(f.control.switch.mouseGroupSelect)return f.system.mouse.tmp.selectionRectangle=
f._interface.part.alpha.builder("rectangle","selectionRectangle",{x:r.x,y:r.y,width:0,height:0,style:{fill:"rgba(224, 184, 252, 0.25)"}}),f.system.pane.mf.append(f.system.mouse.tmp.selectionRectangle),f.system.mouse.tmp.start={x:r.x,y:r.y},f.system.mouse.mouseInteractionHandler(function(d){var c=f.system.mouse.tmp.start;d=f.core.viewport.windowPoint2workspacePoint(d.x,d.y);f.system.mouse.tmp.selectionRectangle.parameter.width(d.x-c.x);f.system.mouse.tmp.selectionRectangle.parameter.height(d.y-c.y)},
function(d){f.system.pane.mf.remove(f.system.mouse.tmp.selectionRectangle);var c=f.system.mouse.tmp.start;d=f.core.viewport.windowPoint2workspacePoint(d.x,d.y);f.control.selection.selectUnits(f.control.scene.getUnitsWithinPoly([{x:c.x,y:c.y},{x:d.x,y:c.y},{x:d.x,y:d.y},{x:c.x,y:d.y}]))}),!0}});f.system.mouse.functionList.onmousedown.push({requiredKeys:[],function:function(r){if(f.control.switch.mouseGripPanningEnabled)return f.control.selection.deselectEverything(),f.system.mouse.tmp.oldPosition=
f.core.viewport.position(),f.system.mouse.tmp.clickPosition={x:r.event.x,y:r.event.y},f.system.mouse.mouseInteractionHandler(function(d){f.core.viewport.position(f.system.mouse.tmp.oldPosition.x-(f.system.mouse.tmp.clickPosition.x-d.x)/f.core.viewport.scale()*window.devicePixelRatio,f.system.mouse.tmp.oldPosition.y-(f.system.mouse.tmp.clickPosition.y-d.y)/f.core.viewport.scale()*window.devicePixelRatio)},function(d){}),!0}});f.system.mouse.functionList.onwheel.push({requiredKeys:[],function:function(r){if(f.control.switch.mouseWheelZoomEnabled){var d=
r.x,c=r.y,g=f.core.viewport.scale();g-=r.event.deltaY/100*g;20<g&&(g=20);.1>g&&(g=.1);f.core.viewport.scale(g);r=f.core.viewport.windowPoint2workspacePoint(r.event.x,r.event.y);d=f.library.math.cartesianAngleAdjust(r.x-d,r.y-c,f.core.viewport.angle());c=f.core.viewport.position();f.core.viewport.position(c.x+d.x,c.y+d.y);return!0}}});f.system.keyboard.functionList.onkeydown.push({requiredKeys:[["control","F2"],["command","F2"]],function:function(r){f.control.scene.load(void 0,void 0,!0);return!0}});
f.system.keyboard.functionList.onkeydown.push({requiredKeys:[["control","F3"],["command","F3"]],function:function(r){f.control.scene.save();return!0}});f.system.keyboard.functionList.onkeydown.push({requiredKeys:[["control","KeyX"],["command","KeyX"]],function:function(r){f.control.selection.cut();return!0}});f.system.keyboard.functionList.onkeydown.push({requiredKeys:[["control","KeyC"],["command","KeyC"]],function:function(r){f.system.keyboard.releaseKey("KeyC");f.control.selection.copy();return!0}});
f.system.keyboard.functionList.onkeydown.push({requiredKeys:[["control","KeyV"],["command","KeyV"]],function:function(r){f.system.keyboard.releaseKey("KeyV");f.control.selection.paste();return!0}});f.system.keyboard.functionList.onkeydown.push({requiredKeys:[["control","KeyB"],["command","KeyB"]],function:function(r){f.control.selection.duplicate();return!0}});f.system.keyboard.functionList.onkeydown.push({requiredKeys:[["Delete"],["Backspace"]],function:function(r){f.control.selection.delete();return!0}});
f.control=new function(){var r=this;this.switch={devMode:null!=(new URL(window.location.href)).searchParams.get("dev"),mouseWheelZoomEnabled:!0,mouseGripPanningEnabled:!0,mouseGroupSelect:!0,enableSceneSave:!0,enableSceneLoad:!0,enableMenubar:!0,enableWindowScrollbarAutomaticRemoval:!0,enableUnitSelection:!0,enableSceneModification:!0};this.gui=new function(){var d=f.system.pane.f,c=void 0,g=window.devicePixelRatio;this.refresh=function(){void 0!=c&&c.refresh()};this.showMenubar=function(){f.control.switch.enableMenubar?
void 0==c&&(c=r.gui.elements.menubar(0,0,g),d.append(c)):this.hideMenubar()};this.hideMenubar=function(){void 0!=c&&(d.remove(c),c=void 0)};this.closeAllDropdowns=function(){void 0!=c&&c.closeAllDropdowns()};this.elements=new function(){this.menubar=function(a,b,c){f.control.viewport.width();var d=20*c,e=void 0,g=void 0;a={text_fill:"rgba(0,0,0,1)",text_font:11.25*c+"pt Helvetica",background__up__fill:"rgba(240,240,240,1)",background__press__fill:"rgba(240,240,240,1)",background__select_press__fill:"rgba(229,167,255,1)",
background__press__stroke:"rgba(0,0,0,0)",background__select__fill:"rgba(229,167,255,1)",background__select__stroke:"rgba(0,0,0,0)",background__select_press__stroke:"rgba(0,0,0,0)"};var r={text_font:11.25*c+"pt Helvetica",item__up__fill:"rgba(240,240,240,1)",item__hover__fill:"rgba(229,167,255,1)"},m=f._interface.part.alpha.builder("group","menubar",{}),q=f._interface.part.alpha.builder("rectangle","rectangle",{x:0,y:0,width:d,height:d,style:{fill:"rgba(240,240,240,1)"}});m.append(q);for(var u=b=
0;u<this.menubar.dropdowns.length;u++){var n=f._interface.part.alpha.builder("button_rect","dropdownButton_"+u,{x:b*c,y:0,width:this.menubar.dropdowns[u].width,height:d,hoverable:!1,selectable:!0,text_centre:this.menubar.dropdowns[u].text,style:a});m.append(n);n.onpress=function(a){return function(){e=m.getChildByName("dropdownButton_"+a).select()?void 0:a}}(u);n.onenter=function(a){return function(b){void 0!=e&&e!=a&&(m.getChildByName("dropdownButton_"+e).select(!1),e=a,0==b.buttons&&m.getChildByName("dropdownButton_"+
e).select(!0))}}(u);n.onselect=function(a,b,h){return function(){for(var k=0,l=0;l<h.menubar.dropdowns[a].itemList.length;l++)switch(h.menubar.dropdowns[a].itemList[l]){case "break":k+=h.menubar.dropdowns[a].breakHeight*c;break;case "space":k+=h.menubar.dropdowns[a].spaceHeight*c;break;default:k+=h.menubar.dropdowns[a].listItemHeight*c}k>f.control.viewport.height()*c&&(k=f.control.viewport.height()*c);g=f._interface.part.alpha.builder("list","dropdown",{x:b,y:d*c,style:r,width:h.menubar.dropdowns[a].listWidth*
c,height:k*c,multiSelect:!1,selectable:!1,itemWidthMux:1*c,itemHeightMux:h.menubar.dropdowns[a].listItemHeight/k*c,breakHeightMux:h.menubar.dropdowns[a].breakHeight/k*c,spaceHeightMux:h.menubar.dropdowns[a].spaceHeight/k*c,itemSpacingMux:0,list:h.menubar.dropdowns[a].itemList});g.onrelease=function(){m.getChildByName("dropdownButton_"+a).select(!1);e=void 0};m.append(g)}}(u,b,this);n.ondeselect=function(){m.remove(g)};this.menubar.dropdowns[u].x=b;b+=this.menubar.dropdowns[u].width}m.closeAllDropdowns=
function(){if(void 0!=g)g.onrelease()};m.refresh=function(){q.parameter.width(f.control.viewport.width())};m.refresh();return m}}};this.viewport=new function(){this.width=function(){return f.width};this.height=function(){return f.height};this.scale=function(d){return f.core.viewport.scale(d)};this.position=function(d,c){return f.core.viewport.position(d,c)};this.refresh=function(){f.core.viewport.refresh();r.gui.refresh()};this.stopMouseScroll=function(d){return f.control.switch.enableWindowScrollbarAutomaticRemoval?
f.core.viewport.stopMouseScroll(d):(f.core.viewport.stopMouseScroll(!1),!1)};this.activeRender=function(d){return f.core.render.active(d)}};this.scene=new function(){var d=f.system.pane.mm,c=0;this.new=function(d){if(void 0===d||!d||confirm("This will clear the current scene! Are you sure?"))r.selection.selectEverything(),r.selection.delete(),c=0,r.viewport.position(0,0),r.viewport.scale(0)};this.documentUnits=function(c){for(var a=[],b=0;b<c.length;b++){var d=c[b],g={};g.position={x:d.parameter.x(),
y:d.parameter.y(),angle:d.parameter.angle()};g.details={collection:d.collection,category:d.category,model:d.model};g.data=d.exportData?d.exportData():null;g.connections=[];for(var f in d.io)for(var p in d.io[f]){var r=d.io[f][p].getForeignNode();if(void 0!=r){var m={};m.typeAndNameOfSourcePort={type:f,name:p};m.indexOfDestinationUnit=c.indexOf(r.parent);m.typeAndNameOfDestinationPort={type:f,name:r.name};g.connections.push(m)}}a.push(g)}return a};this.printUnits=function(c){for(var a=[],b=0;b<c.length;b++){var d=
c[b],g=r.scene.addUnit(d.position.x,d.position.y,d.position.angle,d.details.model,d.details.category,d.details.collection);a.push(g);g.importData&&g.importData(d.data);r.selection.selectUnit(g);for(var f=0;f<d.connections.length;f++){var p=d.connections[f],t=r.selection.selectedUnits[p.indexOfDestinationUnit];void 0!=t&&g.io[p.typeAndNameOfSourcePort.type][p.typeAndNameOfSourcePort.name].connectTo(t.io[p.typeAndNameOfDestinationPort.type][p.typeAndNameOfDestinationPort.name])}}return a};this.export=
function(){return this.documentUnits(Array.from(d.children).filter(function(c){return!c._isCable}))};this.import=function(c){this.printUnits(c)};this.save=function(c,a){c=void 0===c?"project":c;a=void 0===a?!0:a;if(f.control.switch.enableSceneSave){var b={filename:c,viewportLocation:{xy:f.control.viewport.position(),scale:f.control.viewport.scale()}};f.library.audio.destination.masterGain(0);b.units=this.export();b=f.library.misc.serialize(b,a);b={compressed:a,data:b};b=f.library.misc.serialize(b,
!1);f.library.misc.printFile(c,b);f.library.audio.destination.masterGain(1)}};this.load=function(c,a,b){function d(a,b){f.library.audio.destination.masterGain(0);try{a=f.library.misc.unserialize(a,!1)}catch(t){console.error("Major error unserializing first layer of file");console.error(t);return}var c=a.compressed;try{a=f.library.misc.unserialize(a.data,c)}catch(t){console.error("Major error unserializing second layer of file");console.error(t);return}r.scene.new();r.scene.import(a.units);r.viewport.position(a.viewportLocation.xy.x,
a.viewportLocation.xy.y);r.viewport.scale(a.viewportLocation.scale);f.library.audio.destination.masterGain(1);r.selection.deselectEverything();b&&b(metadata)}!f.control.switch.enableSceneLoad||void 0!==b&&b&&!confirm("This will clear the current scene! Are you sure?")||(void 0==c?f.library.misc.openFile(function(b){d(b,a)}):(b=new XMLHttpRequest,b.open("GET",c,!0),b.responseType="text",b.onload=function(){d(this.response,a)},b.send()))};this.generateUnitName=function(){return c++};this.addUnit=function(c,
a,b,e,h,k){k=void 0===k?"alpha":k;if(f.control.switch.enableSceneModification){var g=this.generateUnitName();c=void 0==h?f._interface.unit[k][e](c,a,b):f._interface.unit[k][h][e](c,a,b);c.name=""+g;c=f.control.grapple.declare(c);this.rectifyUnitPosition(c);d.append(c);return c}};this.removeUnit=function(c){f.control.switch.enableSceneModification&&d.remove(c)};this.getUnitByName=function(c){return d.getChildByName(c)};this.getUnitsByType=function(c){return d.children.filter(function(a){return a.unitType==
c})};this.getUnitUnderPoint=function(c,a){for(var b=0;b<d.children.length;b++)if(f.library.math.detectOverlap.boundingBoxes({bottomRight:{x:c,y:a},topLeft:{x:c,y:a}},d.children[b].space.box)&&f.library.math.detectOverlap.pointWithinPoly({x:c,y:a},d.children[b].space.points))return d.children[b]};this.getUnitsWithinPoly=function(c){var a=f.library.math.boundingBoxFromPoints(c);return d.children.filter(function(b){return!b._isCable&&f.library.math.detectOverlap.boundingBoxes(a,b.space.box)&&f.library.math.detectOverlap.overlappingPolygons(c,
b.space.points)})};this.rectifyUnitPosition=function(c){return!1}};this.selection=new function(){this.selectedUnits=[];this.lastSelectedUnits=null;this.clipboard=[];this.selectUnit=function(d,c){c=void 0===c?!0:c;if(f.control.switch.enableUnitSelection&&-1==this.selectedUnits.indexOf(d)){c&&(c=f.system.pane.getMiddlegroundPane(d),c.remove(d),c.append(d));c=f._interface.part.alpha.builder("polygon","selectionGlow-"+d.getAddress(),{points:d.space.points.map(function(c){return{x:c.x-d.x,y:c.y-d.y}}),
style:{fill:"rgba(244, 226, 66, 0.25)",stroke:"rgba(244, 226, 66, 1)"}});d.append(c);if(d.onselect)object.onselect();this.selectedUnits.push(d);this.lastSelectedUnits=d}};this.selectUnits=function(d){for(var c=0;c<d.length;c++)this.selectUnit(d[c])};this.deselectUnit=function(d){d.remove(d.getChildByName("selectionGlow-"+d.getAddress()));this.selectedUnits.splice(this.selectedUnits.indexOf(d),1);if(d.ondeselect)d.ondeselect()};this.selectEverything=function(){this.deselectEverything();for(var d=0;d<
f.system.pane.mm.children.length;d++)f.system.pane.mm.children[d]._isCable||this.selectUnit(f.system.pane.mm.children[d],!1)};this.deselectEverything=function(){for(;0<this.selectedUnits.length;)this.deselectUnit(this.selectedUnits[0])};this.cut=function(){f.control.switch.enableSceneModification&&(this.copy(),this.delete())};this.copy=function(){f.control.switch.enableSceneModification&&(this.clipboard=f.control.scene.documentUnits(this.selectedUnits))};this.paste=function(d){if(f.control.switch.enableSceneModification&&
0!=this.clipboard.length){this.deselectEverything();if("duplicate"!=d){var c=[];this.clipboard.forEach(function(a){return c.push(a.position)});var g=f.library.math.boundingBoxFromPoints(c).topLeft;void 0==d&&(d=f.core.viewport.mousePosition(),void 0==d.x||void 0==d.y)&&(d=f.core.viewport.windowPoint2workspacePoint(0,0));this.clipboard.forEach(function(a){a.position.x+=d.x-g.x;a.position.y+=d.y-g.y})}f.control.scene.printUnits(this.clipboard)}};this.duplicate=function(){f.control.switch.enableSceneModification&&
(this.copy(),this.paste("duplicate"),this.clipboard=[])};this.delete=function(){if(f.control.switch.enableSceneModification){for(;0<this.selectedUnits.length;){var d=this.selectedUnits[0];if(d.ondelete)d.ondelete();d.disconnectEverything();f.system.pane.getMiddlegroundPane(d).remove(d);this.selectedUnits.shift()}this.lastSelectedUnits=null}}}};f.control.grapple={tmpdata:{},tmpunit:void 0,functionList:{onmousedown:[],onmouseup:[]},declare:function(r){function d(c){return function(d,a,b){0==b.button&&
(f.control.grapple.tmpunit=this,f.library.structure.functionListRunner(c,f.system.keyboard.pressedKeys)({event:b,x:d,y:a}))}}r.onmousedown=d(this.functionList.onmousedown);r.onmouseup=d(this.functionList.onmouseup);return r}};f.control.grapple.functionList.onmousedown.push({requiredKeys:[],function:function(r){var d=f.control;d.selection.selectedUnits.includes(d.grapple.tmpunit)||(r.event.shiftKey||d.selection.deselectEverything(),d.selection.selectUnit(d.grapple.tmpunit))}});f.control.grapple.functionList.onmousedown.push({requiredKeys:[["shift",
"alt"]],function:function(r){var d=f.control;d.grapple.tmpdata.oldClickPosition={x:r.x,y:r.y};d.grapple.tmpdata.oldUnitsPositions=[];d.grapple.tmpdata.oldUnitsSelectionArea=[];for(r=0;r<d.selection.selectedUnits.length;r++)d.grapple.tmpdata.oldUnitsPositions.push({x:d.selection.selectedUnits[r].x,y:d.selection.selectedUnits[r].y,angle:d.selection.selectedUnits[r].angle}),d.grapple.tmpdata.oldUnitsSelectionArea.push(Object.assign({},d.selection.selectedUnits[r].selectionArea));f.system.mouse.mouseInteractionHandler(function(c){for(var g=
0;g<d.selection.selectedUnits.length;g++){var a=d.selection.selectedUnits[g],b=d.grapple.tmpdata.oldClickPosition,e=f.core.viewport.windowPoint2workspacePoint(c.x,c.y);a.parameter.angle(d.grapple.tmpdata.oldUnitsPositions[g].angle+(e.y-b.y)/100);f.control.scene.rectifyUnitPosition(a);if(a.onrotate)a.onrotate();if(a.io)for(b=Object.keys(a.io),e=0;e<b.length;e++)for(var h=a.io[b[e]],k=Object.keys(h),p=0;p<k.length;p++)h[k[p]].draw()}},function(c){});return!0}});f.control.grapple.functionList.onmousedown.push({requiredKeys:[["alt"]],
function:function(r){f.control.selection.duplicate()}});f.control.grapple.functionList.onmousedown.push({requiredKeys:[],function:function(r){var d=f.control;d.grapple.tmpdata.oldClickPosition={x:r.x,y:r.y};d.grapple.tmpdata.oldUnitsPositions=[];d.grapple.tmpdata.oldUnitsSelectionArea=[];for(r=0;r<d.selection.selectedUnits.length;r++)d.grapple.tmpdata.oldUnitsPositions.push({x:d.selection.selectedUnits[r].x,y:d.selection.selectedUnits[r].y}),d.grapple.tmpdata.oldUnitsSelectionArea.push(Object.assign({},
d.selection.selectedUnits[r].selectionArea));f.system.mouse.mouseInteractionHandler(function(c){for(var g=0;g<d.selection.selectedUnits.length;g++){var a=d.selection.selectedUnits[g],b=d.grapple.tmpdata.oldClickPosition,e=f.core.viewport.windowPoint2workspacePoint(c.x,c.y),h=d.grapple.tmpdata.oldUnitsPositions[g],k=h.y+(e.y-b.y);a.parameter.x(h.x+(e.x-b.x));a.parameter.y(k);f.control.scene.rectifyUnitPosition(a);if(a.onmove)a.onmove();if(a.io)for(b=Object.keys(a.io),e=0;e<b.length;e++){h=a.io[b[e]];
k=Object.keys(h);for(var p=0;p<k.length;p++)h[k[p]].draw()}}},function(c){})}});f.control.grapple.functionList.onmouseup.push({requiredKeys:[],function:function(r){var d=f.control;d.selection.selectedUnits.includes(d.grapple.tmpunit)&&(r.event.shiftKey&&d.selection.lastSelectedUnits!=d.grapple.tmpunit&&d.selection.deselectUnit(d.grapple.tmpunit),d.selection.lastSelectedUnits=null);return!0}});window.onresize=f.control.viewport.refresh}})();
