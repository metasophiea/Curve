var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var c=0;return function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var c="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return c?c.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var c,b=[];!(c=a.next()).done;)b.push(c.value);return b};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.findInternal=function(a,c,b){a instanceof String&&(a=String(a));for(var f=a.length,e=0;e<f;e++){var d=a[e];if(c.call(b,d,e,a))return{i:e,v:d}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,c,b,f){if(c){b=$jscomp.global;a=a.split(".");for(f=0;f<a.length-1;f++){var e=a[f];e in b||(b[e]={});b=b[e]}a=a[a.length-1];f=b[a];c=c(f);c!=f&&null!=c&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:c})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(a,c){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:c})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function a(b){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(b||"")+"_"+c++,b)}var c=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,c){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var b=0,f={next:function(){if(b<a.length){var e=b++;return{value:c(e,a[e]),done:!1}}f.next=function(){return{done:!0,value:void 0}};return f.next()}};f[Symbol.iterator]=function(){return f};return f};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.polyfill("Array.prototype.findIndex",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).i}},"es6","es3");$jscomp.owns=function(a,c){return Object.prototype.hasOwnProperty.call(a,c)};$jscomp.assign="function"==typeof Object.assign?Object.assign:function(a,c){for(var b=1;b<arguments.length;b++){var f=arguments[b];if(f)for(var e in f)$jscomp.owns(f,e)&&(a[e]=f[e])}return a};$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");
$jscomp.polyfill("Object.is",function(a){return a?a:function(a,b){return a===b?0!==a||1/a===1/b:a!==a&&b!==b}},"es6","es3");$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,b){var c=this;c instanceof String&&(c=String(c));var e=c.length;b=b||0;for(0>b&&(b=Math.max(b+e,0));b<e;b++){var d=c[b];if(d===a||Object.is(d,a))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,c,b){if(null==a)throw new TypeError("The 'this' value for String.prototype."+b+" must not be null or undefined");if(c instanceof RegExp)throw new TypeError("First argument to String.prototype."+b+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,b){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,b||0)}},"es6","es3");$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function c(){this.batch_=null}function b(a){return a instanceof e?a:new e(function(b,c){b(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;c.prototype.asyncExecute=function(a){if(null==this.batch_){this.batch_=[];var b=this;this.asyncExecuteFunction(function(){b.executeBatch_()})}this.batch_.push(a)};var f=$jscomp.global.setTimeout;c.prototype.asyncExecuteFunction=function(a){f(a,0)};c.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];a[b]=null;try{c()}catch(t){this.asyncThrow_(t)}}}this.batch_=null};c.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var e=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(w){b.reject(w)}};e.prototype.createResolveAndReject_=function(){function a(a){return function(e){c||(c=!0,a.call(b,e))}}var b=this,c=!1;
return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};e.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof e)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};e.prototype.resolveToNonPromiseObj_=function(a){var b=void 0;try{b=a.then}catch(w){this.reject_(w);return}"function"==typeof b?
this.settleSameAsThenable_(b,a):this.fulfill_(a)};e.prototype.reject_=function(a){this.settle_(2,a)};e.prototype.fulfill_=function(a){this.settle_(1,a)};e.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=0;a<this.onSettledCallbacks_.length;++a)d.asyncExecute(this.onSettledCallbacks_[a]);
this.onSettledCallbacks_=null}};var d=new c;e.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};e.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(t){c.reject(t)}};e.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{d(a(b))}catch(q){h(q)}}:b}var d,h,f=new e(function(a,b){d=a;h=b});this.callWhenSettled_(c(a,d),c(b,h));return f};
e.prototype.catch=function(a){return this.then(void 0,a)};e.prototype.callWhenSettled_=function(a,b){function c(){switch(e.state_){case 1:a(e.result_);break;case 2:b(e.result_);break;default:throw Error("Unexpected state: "+e.state_);}}var e=this;null==this.onSettledCallbacks_?d.asyncExecute(c):this.onSettledCallbacks_.push(c)};e.resolve=b;e.reject=function(a){return new e(function(b,c){c(a)})};e.race=function(a){return new e(function(c,e){for(var d=$jscomp.makeIterator(a),f=d.next();!f.done;f=d.next())b(f.value).callWhenSettled_(c,
e)})};e.all=function(a){var c=$jscomp.makeIterator(a),d=c.next();return d.done?b([]):new e(function(a,e){function f(b){return function(c){g[b]=c;h--;0==h&&a(g)}}var g=[],h=0;do g.push(void 0),h++,b(d.value).callWhenSettled_(f(g.length-1),e),d=c.next();while(!d.done)})};return e},"es6","es3");
var communicationModuleMaker=function(a,c){var b=this;this.log=function(){};this.function={};this.delayedFunction={};var f=0,e={};a.onmessage=function(c){var d=c.data;d.outgoing?d.cargo.function in b.function?(void 0==d.cargo.arguments&&(d.cargo.arguments=[]),null==d.id?b.function[d.cargo.function].apply(b.function,$jscomp.arrayFromIterable(d.cargo.arguments)):a.postMessage({id:d.id,outgoing:!1,cargo:b.function[d.cargo.function].apply(b.function,$jscomp.arrayFromIterable(d.cargo.arguments))})):d.cargo.function in
b.delayedFunction&&(void 0==d.cargo.arguments&&(d.cargo.arguments=[]),null==d.id?b.delayedFunction[d.cargo.function].apply(b.delayedFunction,$jscomp.arrayFromIterable(d.cargo.arguments)):b.delayedFunction[d.cargo.function].apply(b.delayedFunction,$jscomp.arrayFromIterable([function(b){a.postMessage({id:d.id,outgoing:!1,cargo:b})}].concat(d.cargo.arguments)))):(e[d.id](d.cargo),delete e[d.id])};this.run=function(b,c,v,w){c=void 0===c?[]:c;var d=null;void 0!=v&&(d=f++,e[d]=v);a.postMessage({id:d,outgoing:!0,
cargo:{function:b,arguments:c}},w)}},communicationModule=new communicationModuleMaker(this,"core_engine"),library={math:{averageArray:function(a){for(var c=a[0],b=1;b<a.length;b++)c+=a[b];return c/a.length},cartesianAngleAdjust:function(a,c,b){return 0==b?{x:a,y:c}:{x:a*Math.cos(b)-c*Math.sin(b),y:c*Math.cos(b)+a*Math.sin(b)}},boundingBoxFromPoints:function(a){if(0==a.length)return{topLeft:{x:0,y:0},bottomRight:{x:0,y:0}};for(var c=a[0].x,b=a[0].x,f=a[0].y,e=a[0].y,d=1;d<a.length;d++)a[d].x<c?c=a[d].x:
a[d].x>b&&(b=a[d].x),a[d].y<f?f=a[d].y:a[d].y>e&&(e=a[d].y);return{topLeft:{x:c,y:f},bottomRight:{x:b,y:e}}},detectOverlap:new function(){var a=this;this.boundingBoxes=function(a,b){return a.bottomRight.y>=b.topLeft.y&&a.bottomRight.x>=b.topLeft.x&&a.topLeft.y<=b.bottomRight.y&&a.topLeft.x<=b.bottomRight.x};this.pointWithinBoundingBox=function(a,b){return!(a.x<b.topLeft.x||a.y<b.topLeft.y||a.x>b.bottomRight.x||a.y>b.bottomRight.y)};this.pointWithinPoly=function(a,b){for(var c=!1,e=0,d=b.length-1;e<
b.length;d=e++){if(a.x==b[e].x&&a.y==b[e].y)return!0;if(b[d].y>=a.y&&b[e].y<=a.y||b[e].y>=a.y&&b[d].y<=a.y)if(b[e].x<a.x&&b[d].x<a.x)c=!c;else{var h=0;b[d].y>b[e].y&&b[d].x>b[e].x?h=(a.x-b[e].x)/(b[d].x-b[e].x)-(a.y-b[e].y)/(b[d].y-b[e].y)+1:b[d].y<=b[e].y&&b[d].x<=b[e].x?h=(a.x-b[d].x)/(b[e].x-b[d].x)-(a.y-b[d].y)/(b[e].y-b[d].y)+1:b[d].y>b[e].y&&b[d].x<b[e].x?h=(a.x-b[d].x)/(b[e].x-b[d].x)+(a.y-b[e].y)/(b[d].y-b[e].y):b[d].y<=b[e].y&&b[d].x>=b[e].x&&(h=(a.x-b[e].x)/(b[d].x-b[e].x)+(a.y-b[d].y)/
(b[e].y-b[d].y));if(1==h)return!0;1<h&&(c=!c)}}return c};this.lineSegments=function(a,b){var c=(b[1].y-b[0].y)*(a[1].x-a[0].x)-(b[1].x-b[0].x)*(a[1].y-a[0].y);if(0==c)return null;var e=((b[1].x-b[0].x)*(a[0].y-b[0].y)-(b[1].y-b[0].y)*(a[0].x-b[0].x))/c;b=((a[1].x-a[0].x)*(a[0].y-b[0].y)-(a[1].y-a[0].y)*(a[0].x-b[0].x))/c;return{x:a[0].x+e*(a[1].x-a[0].x),y:a[0].y+e*(a[1].y-a[0].y),inSeg1:0<=e&&1>=e,inSeg2:0<=b&&1>=b}};this.overlappingPolygons=function(c,b){for(var f=0;f<c.length;f++)if(a.pointWithinPoly(c[f],
b))return!0;for(f=0;f<b.length;f++)if(a.pointWithinPoly(b[f],c))return!0;f=Array.apply(null,{length:c.length}).map(Number.call,Number).concat([0]);for(var e=Array.apply(null,{length:b.length}).map(Number.call,Number).concat([0]),d=0;d<f.length-1;d++)for(var h=0;h<e.length-1;h++){var v=a.lineSegments([c[f[d]],c[f[d+1]]],[b[e[h]],b[e[h+1]]]);if(null!=v&&v.inSeg1&&v.inSeg2)return!0}return!1};this.overlappingPolygonWithPolygons=function(c,b){for(var f=0;f<b.length;f++)if(a.boundingBoxes(c.boundingBox,
b[f].boundingBox)&&a.overlappingPolygons(c.points,b[f].points))return!0;return!1};this.overlappingLineWithPolygons=function(a,b){var c={topLeft:{x:0,y:0},bottomRight:{x:0,y:0}};a.x1>a.x2?(c.topLeft.x=a.x2,c.bottomRight.x=a.x1):(c.topLeft.x=a.x1,c.bottomRight.x=a.x2);a.y1>a.y2?(c.topLeft.y=a.y2,c.bottomRight.y=a.y1):(c.topLeft.y=a.y1,c.bottomRight.y=a.y2);var e=[];b.forEach(function(b,f){if(library.math.detectOverlap.boundingBoxes(c,b.boundingBox)){a:{for(var d=b.points.length-1,h=0;h<b.points.length;d=
h++)if(d=library.math.detectOverlap.lineSegments([{x:a.x1,y:a.y1},{x:a.x2,y:a.y2}],[{x:b.points[d].x,y:b.points[d].y},{x:b.points[h].x,y:b.points[h].y}]),null!=d&&d.inSeg1&&d.inSeg2){b=!0;break a}b=!1}b&&e.push(f)}});return e}},getDifferenceOfArrays:function(a,c){function b(a,b){a.forEach(function(a){a=b.indexOf(a);-1!=a&&b.splice(a,1)});return b}return{a:b(c,a.slice()),b:b(a,c.slice())}}},glsl:{geometry:"\n            #define PI 3.141592653589793\n\n            vec2 cartesian2polar(vec2 xy){\n                float dis = pow(pow(xy.x,2.0)+pow(xy.y,2.0),0.5);\n                float ang = 0.0;\n\n                if(xy.x == 0.0){\n                    if(xy.y == 0.0){ang = 0.0;}\n                    else if(xy.y > 0.0){ang = 0.5*PI;}\n                    else{ang = 1.5*PI;}\n                }\n                else if(xy.y == 0.0){\n                    if(xy.x >= 0.0){ang = 0.0;}else{ang = PI;}\n                }\n                else if(xy.x >= 0.0){ ang = atan(xy.y/xy.x); }\n                else{ /*if(xy.x < 0.0)*/ ang = atan(xy.y/xy.x) + PI; }\n\n                return vec2(ang,dis);\n            }\n            vec2 polar2cartesian(vec2 ad){\n                return vec2( ad[1]*cos(ad[0]), ad[1]*sin(ad[0]) );\n            }\n            vec2 cartesianAngleAdjust(vec2 xy, float angle){\n                if(angle == 0.0 || mod(angle,PI*2.0) == 0.0){ return xy; }\n                return vec2( xy.x*cos(angle) - xy.y*sin(angle), xy.y*cos(angle) + xy.x*sin(angle) ); \n            }\n        "}},
dev={library:{active:!1,fontStyle:"color:rgb(87, 161, 80); font-style:italic;"},element:{active:!1,fontStyle:"color:rgb(161, 145, 80); font-style:italic;"},elementLibrary:{active:!1,fontStyle:"color:rgb(129, 80, 161); font-style:italic;"},arrangement:{active:!1,fontStyle:"color:rgb(80, 161, 141); font-style:italic;"},render:{active:!1,fontStyle:"color:rgb(161, 84, 80); font-style:italic;"},viewport:{active:!1,fontStyle:"color:rgb(80, 134, 161); font-style:italic;"},stats:{active:!1,fontStyle:"color:rgb(87, 80, 161); font-style:italic;"},
callback:{active:!1,fontStyle:"color:rgb(122, 163, 82); font-style:italic;"},log:{library:function(a,c){dev.library.active&&console.log("%ccore_engine.library."+a+(new (Function.prototype.bind.apply(Array,[null].concat($jscomp.arrayFromIterable(arguments))))).slice(1).join(" "),dev.library.fontStyle)},element:function(a){dev.element.active&&console.log("%ccore_engine.element"+(new (Function.prototype.bind.apply(Array,[null].concat($jscomp.arrayFromIterable(arguments))))).join(" "),dev.element.fontStyle)},
elementLibrary:function(a,c,b){dev.elementLibrary.active&&console.log("%ccore_engine.elementLibrary."+a+"["+c+"]"+(new (Function.prototype.bind.apply(Array,[null].concat($jscomp.arrayFromIterable(arguments))))).slice(2).join(" "),dev.elementLibrary.fontStyle)},arrangement:function(a){dev.arrangement.active&&console.log("%ccore_engine.arrangement"+(new (Function.prototype.bind.apply(Array,[null].concat($jscomp.arrayFromIterable(arguments))))).join(" "),dev.arrangement.fontStyle)},render:function(a){dev.render.active&&
console.log("%ccore_engine.render"+(new (Function.prototype.bind.apply(Array,[null].concat($jscomp.arrayFromIterable(arguments))))).join(" "),dev.render.fontStyle)},viewport:function(a){dev.viewport.active&&console.log("%ccore_engine.viewport"+(new (Function.prototype.bind.apply(Array,[null].concat($jscomp.arrayFromIterable(arguments))))).join(" "),dev.viewport.fontStyle)},stats:function(a){dev.stats.active&&console.log("%ccore_engine.stats"+(new (Function.prototype.bind.apply(Array,[null].concat($jscomp.arrayFromIterable(arguments))))).join(" "),
dev.stats.fontStyle)},callback:function(a){dev.callback.active&&console.log("%ccore_engine.callback"+(new (Function.prototype.bind.apply(Array,[null].concat($jscomp.arrayFromIterable(arguments))))).join(" "),dev.callback.fontStyle)}}},report={info:function(){console.log.apply(console,$jscomp.arrayFromIterable(["core_engine.report.info:"].concat.apply(["core_engine.report.info:"],$jscomp.arrayFromIterable(new (Function.prototype.bind.apply(Array,[null].concat($jscomp.arrayFromIterable(arguments))))))))},
warning:function(){console.warn.apply(console,$jscomp.arrayFromIterable(["core_engine.report.warning:"].concat.apply(["core_engine.report.warning:"],$jscomp.arrayFromIterable(new (Function.prototype.bind.apply(Array,[null].concat($jscomp.arrayFromIterable(arguments))))))))},error:function(){console.error.apply(console,$jscomp.arrayFromIterable(["core_engine.report.error:"].concat.apply(["core_engine.report.error:"],$jscomp.arrayFromIterable(new (Function.prototype.bind.apply(Array,[null].concat($jscomp.arrayFromIterable(arguments))))))))}},
element=new function(){function a(){var a=f.findIndex(function(a){return void 0==a});return-1!=a?a:f.length}function c(a){return a.getId()}var b=new function(){this.rectangle=function(a,b){function c(a,b){a=void 0===a?!0:a;void 0==b&&(b=d.parent&&!z?d.parent.getOffset():{x:0,y:0,scale:1,angle:0});var c=library.math.cartesianAngleAdjust(A,g,b.angle),e=c.x*b.scale+b.x;c=c.y*b.scale+b.y;var u=b.scale*p;b=-(b.angle+x);d.extremities.points=[];for(var C=0;C<B.length;C+=2){var f=u*q*(B[C]-n.x),h=u*r*(B[C+
1]-n.y);d.extremities.points.push({x:f*Math.cos(b)+h*Math.sin(b)+e,y:h*Math.cos(b)-f*Math.sin(b)+c})}d.extremities.boundingBox=library.math.boundingBoxFromPoints(d.extremities.points);a&&d.parent&&d.parent.updateExtremities()}function e(){d.extremities.points.forEach(function(a){return render.drawDot(a.x,a.y)});render.drawDot(d.extremities.boundingBox.topLeft.x,d.extremities.boundingBox.topLeft.y,3,{r:0,g:1,b:1,a:.5});render.drawDot(d.extremities.boundingBox.bottomRight.x,d.extremities.boundingBox.bottomRight.y,
3,{r:0,g:1,b:1,a:.5})}var d=this;this.getType=function(){return"rectangle"};this.getId=function(){return b};this.name=a;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{bottomRight:{x:0,y:0},topLeft:{x:0,y:0}}};var f=!1;this.ignored=function(a){if(void 0==a)return f;f=a;c()};var m={r:1,g:0,b:0,a:1};this.colour=function(a){if(void 0==a)return m;m=a;c()};var A=0,g=0,x=0,n={x:0,y:0},q=10,r=10,p=1,z=!1;this.x=function(a){if(void 0==a)return A;A=a;c()};this.y=function(a){if(void 0==
a)return g;g=a;c()};this.angle=function(a){if(void 0==a)return x;x=a;c()};this.anchor=function(a){if(void 0==a)return n;n=a;c()};this.width=function(a){if(void 0==a)return q;q=a;c()};this.height=function(a){if(void 0==a)return r;r=a;c()};this.scale=function(a){if(void 0==a)return p;p=a;c()};this._static=function(a){if(void 0==a)return z;z=a;c()};this.unifiedAttribute=function(a){if(void 0==a)return{x:A,y:g,angle:x,anchor:n,width:q,height:r,scale:p,ignored:f,colour:m,_static:z};"ignored"in a&&(f=a.ignored);
"colour"in a&&(m=a.colour);"x"in a&&(A=a.x);"y"in a&&(g=a.y);"angle"in a&&(x=a.angle);"anchor"in a&&(n=a.anchor);"width"in a&&(q=a.width);"height"in a&&(r=a.height);"scale"in a&&(p=a.scale);"_static"in a&&(p=a._static);c()};this.getAddress=function(){return(void 0!=d.parent?d.parent.getAddress():"")+"/"+d.name};var B=[0,0,1,0,1,1,0,1],k=void 0,y=void 0,l,u;this.computeExtremities=c;this.render=function(a,b){b=void 0===b?{x:0,y:0,scale:1,angle:0}:b;var c=library.math.cartesianAngleAdjust(A,g,b.angle),
f=c.x*b.scale+b.x;c=c.y*b.scale+b.y;var h=b.scale*p;b=-(b.angle+x);void 0==u&&(u=render.produceProgram(d.getType(),"#version 300 es\n                        //constants\n                            in vec2 point;\n            \n                        //variables\n                            struct location{\n                                vec2 xy;\n                                float scale;\n                                float angle;\n                            };\n                            uniform location adjust;\n            \n                            uniform vec2 resolution;\n                            uniform vec2 dimensions;\n                            uniform vec2 anchor;\n            \n                        void main(){\n                            //using the 'adjust' values; perform anchored rotation, and leave shape with it's anchor over the chosen point\n                                vec2 P = dimensions * adjust.scale * (point - anchor);\n                                P = vec2( P.x*cos(adjust.angle) + P.y*sin(adjust.angle), P.y*cos(adjust.angle) - P.x*sin(adjust.angle) ) + adjust.xy;\n            \n                            //convert from unit space to clipspace\n                                gl_Position = vec4( (((P / resolution) * 2.0) - 1.0) * vec2(1, -1), 0, 1 );\n                        }\n                    ",
"#version 300 es\n                        precision mediump float;\n                        out vec4 outputColor;\n                        uniform vec4 colour;\n                                                                                    \n                        void main(){\n                            outputColor = colour;\n                        }\n                    "));a.useProgram(u);void 0==k?(y=a.getAttribLocation(u,"point"),k=a.createBuffer(),a.enableVertexAttribArray(y),a.bindBuffer(a.ARRAY_BUFFER,
k),a.vertexAttribPointer(y,2,a.FLOAT,!1,0,0),a.bufferData(a.ARRAY_BUFFER,new Float32Array(B),a.STATIC_DRAW)):(a.bindBuffer(a.ARRAY_BUFFER,k),a.vertexAttribPointer(y,2,a.FLOAT,!1,0,0));void 0==l&&(l={"adjust.xy":a.getUniformLocation(u,"adjust.xy"),"adjust.scale":a.getUniformLocation(u,"adjust.scale"),"adjust.angle":a.getUniformLocation(u,"adjust.angle"),resolution:a.getUniformLocation(u,"resolution"),dimensions:a.getUniformLocation(u,"dimensions"),anchor:a.getUniformLocation(u,"anchor"),colour:a.getUniformLocation(u,
"colour")});a.uniform2f(l["adjust.xy"],f,c);a.uniform1f(l["adjust.scale"],h);a.uniform1f(l["adjust.angle"],b);a.uniform2f(l.resolution,a.canvas.width,a.canvas.height);a.uniform2f(l.dimensions,q,r);a.uniform2f(l.anchor,n.x,n.y);a.uniform4f(l.colour,m.r,m.g,m.b,m.a);a.drawArrays(a.TRIANGLE_FAN,0,4);d.dotFrame&&e()};this._dump=function(){report.info(d.getAddress(),"._dump()");report.info(d.getAddress(),"._dump -> id: "+b);report.info(d.getAddress(),"._dump -> parent: "+JSON.stringify(d.parent));report.info(d.getAddress(),
"._dump -> dotFrame: "+d.dotFrame);report.info(d.getAddress(),"._dump -> extremities: "+JSON.stringify(d.extremities));report.info(d.getAddress(),"._dump -> ignored: "+f);report.info(d.getAddress(),"._dump -> colour: "+JSON.stringify(m));report.info(d.getAddress(),"._dump -> x: "+A);report.info(d.getAddress(),"._dump -> y: "+g);report.info(d.getAddress(),"._dump -> angle: "+x);report.info(d.getAddress(),"._dump -> anchor: "+JSON.stringify(n));report.info(d.getAddress(),"._dump -> width: "+q);report.info(d.getAddress(),
"._dump -> height: "+r);report.info(d.getAddress(),"._dump -> scale: "+p);report.info(d.getAddress(),"._dump -> _static: "+z)};this._interface=new function(){this.ignored=d.ignored;this.colour=d.colour;this.x=d.x;this.y=d.y;this.angle=this.angle=d.angle;this.anchor=d.anchor;this.width=d.width;this.scale=d.scale;this._static=d._static;this.unifiedAttribute=d.unifiedAttribute;this.getAddress=d.getAddress;this._dump=d._dump}};this.group=function(a,b){function c(a){return void 0==a?!1:0==a.name.length?
(console.warn('group error: element with no name being inserted into group "'+g.getAddress()+'", therefore; the element will not be added'),!1):void 0!=y[a.name]?(console.warn('group error: element with name "'+a.name+'" already exists in group "'+g.getAddress()+'", therefore; the element will not be added'),!1):!0}function d(){var a=0,b=0,c=0,d=0;k.forEach(function(e){e=library.math.boundingBoxFromPoints(e.extremities.points);e.bottomRight.x>b?b=e.bottomRight.x:e.topLeft.x<a&&(a=e.topLeft.x);e.bottomRight.y>
c?c=e.bottomRight.y:e.topLeft.y<d&&(d=e.topLeft.y)});g.extremities.points=[{x:a,y:c},{x:b,y:c},{x:b,y:d},{x:a,y:d}]}function e(a){a=void 0===a?!0:a;g.extremities.points=[];l.active&&void 0!=l.stencil?g.extremities.points=l.stencil.extremities.points.slice():d();g.extremities.boundingBox=library.math.boundingBoxFromPoints(g.extremities.points);a&&g.parent&&g.parent.updateExtremities()}function f(a,b){a=void 0===a?!0:a;void 0==b&&(b=g.parent&&!g._static()?g.parent.getOffset():{x:0,y:0,scale:1,angle:0});
var c=library.math.cartesianAngleAdjust(n,q,b.angle),d={x:c.x*b.scale+b.x,y:c.y*b.scale+b.y,scale:b.scale*p,angle:b.angle+r};k.forEach(function(a){return a.computeExtremities(!1,d)});void 0!=l.stencil&&l.stencil.computeExtremities(!1,d);e(a,b)}function m(a){var b=g.parent&&!g._static()?g.parent.getOffset():{x:0,y:0,scale:1,angle:0},c=library.math.cartesianAngleAdjust(n,q,b.angle);a.computeExtremities(!1,{x:c.x*b.scale+b.x,y:c.y*b.scale+b.y,scale:b.scale*p,angle:b.angle+r});g.extremities.boundingBox=
library.math.boundingBoxFromPoints(g.extremities.points.concat(a.extremities.points));g.extremities.points=[{x:g.extremities.boundingBox.topLeft.x,y:g.extremities.boundingBox.topLeft.y},{x:g.extremities.boundingBox.bottomRight.x,y:g.extremities.boundingBox.topLeft.y},{x:g.extremities.boundingBox.bottomRight.x,y:g.extremities.boundingBox.bottomRight.y},{x:g.extremities.boundingBox.topLeft.x,y:g.extremities.boundingBox.bottomRight.y}];g.parent&&g.parent.updateExtremities()}function A(a){var b={topLeft:{x:g.extremities.boundingBox.topLeft.x-
a.extremities.boundingBox.topLeft.x,y:g.extremities.boundingBox.topLeft.y-a.extremities.boundingBox.topLeft.y},bottomRight:{x:a.extremities.boundingBox.bottomRight.x-g.extremities.boundingBox.bottomRight.x,y:a.extremities.boundingBox.bottomRight.y-g.extremities.boundingBox.bottomRight.y}};0!=b.topLeft.x&&0!=b.topLeft.y&&0!=b.bottomRight.x&&0!=b.bottomRight.y||["topLeft","bottomRight"].forEach(function(a){["x","y"].forEach(function(c){if(0==b[a][c]){for(var d=!1,e=void 0,u=void 0,f=0;f<k.length;f++){var h=
Math.abs(k[f].extremities.boundingBox[a][c]-g.extremities.boundingBox[a][c]);if(void 0==e||e>h)if(e=h,u=k[f].extremities.boundingBox[a][c],0==e){d=!0;break}}d||(g.extremities.boundingBox[a][c]=u)}})})}var g=this;this.getType=function(){return"group"};this.getId=function(){return b};this.name=a;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{bottomRight:{x:0,y:0},topLeft:{x:0,y:0}}};var x=!1;this.ignored=function(a){if(void 0==a)return x;x=a;f()};var n=0,q=0,r=0,p=1,z=
!1,B=!1;this.x=function(a){if(void 0==a)return n;n=a;f()};this.y=function(a){if(void 0==a)return q;q=a;f()};this.angle=function(a){if(void 0==a)return r;r=a;f()};this.scale=function(a){if(void 0==a)return p;p=a;f()};this.heedCamera=function(a){if(void 0==a)return z;z=a;f()};this._static=function(a){if(void 0==a)return B;B=a;f()};this.unifiedAttribute=function(a){if(void 0==a)return{x:n,y:q,angle:r,scale:p,ignored:x,heedCamera:z,_static:B};"ignored"in a&&(x=a.ignored);"x"in a&&(n=a.x);"y"in a&&(q=
a.y);"angle"in a&&(r=a.angle);"scale"in a&&(p=a.scale);"heedCamera"in a&&(p=a.heedCamera);"_static"in a&&(p=a._static);f()};this.getAddress=function(){return(void 0!=g.parent?g.parent.getAddress():"")+"/"+g.name};var k=[],y={};this.children=function(){return k};this.getChildByName=function(a){return y[a]};this.getChildIndexByName=function(a){return k.indexOf(k.find(function(b){return b.name==a}))};this.contains=function(a){return k.find(function(b){return b==a})};this.append=function(a){if(c(a)&&
(k.push(a),a.parent=this,m(a),y[a.name]=a,void 0!=a.onadd))a.onadd(!1)};this.prepend=function(a){if(c(a)&&(k.unshift(a),a.parent=this,m(a),y[a.name]=a,void 0!=a.onadd))a.onadd(!0)};this.remove=function(a){if(void 0!=a){if(void 0!=a.onremove)a.onremove();k.splice(k.indexOf(a),1);A(a);a.parent=void 0;delete y[a.name]}};this.clear=function(){k=[];y={}};this.getElementsUnderPoint=function(a,b){for(var c=[],d=k.length-1;0<=d;d--)k[d].ignored()||library.math.detectOverlap.pointWithinBoundingBox({x:a,y:b},
k[d].extremities.boundingBox)&&("group"==k[d].getType()?c=c.concat(k[d].getElementsUnderPoint(a,b)):library.math.detectOverlap.pointWithinPoly({x:a,y:b},k[d].extremities.points)&&(c=c.concat(k[d])));return c};this.getElementsUnderArea=function(a){for(var b=[],c=k.length-1;0<=c;c--)k[c].ignored()||library.math.detectOverlap.boundingBoxes(library.math.boundingBoxFromPoints(a),item.extremities.boundingBox)&&("group"==k[c].getType()?b=b.concat(item.getElementUnderArea(a)):library.math.detectOverlap.overlappingPolygons(a,
item.extremities.points)&&(b=b.concat(k[c])));return b};this.getTree=function(){var a={name:this.name,type:"group",children:[]};k.forEach(function(b){"group"==b.getType()?a.children.push(b.getTree()):a.children.push({type:b.getType(),name:b.name})});return a};var l={stencil:void 0,active:!1};this.stencil=function(a){if(void 0==a)return l.stencil;l.stencil=a;l.stencil.parent=this;l.active&&f()};this.clipActive=function(a){if(void 0==a)return l.active;l.active=a;f()};this.getOffset=function(){if(this.parent){var a=
this.parent.getOffset(),b=library.math.cartesianAngleAdjust(n,q,a.angle);return{x:b.x*a.scale+a.x,y:b.y*a.scale+a.y,scale:a.scale*p,angle:a.angle+r}}return{x:n,y:q,scale:p,angle:r}};this.computeExtremities=f;this.updateExtremities=e;this.render=function(a,b){var c=library.math.cartesianAngleAdjust(n,q,b.angle),d={x:c.x*b.scale+b.x,y:c.y*b.scale+b.y,scale:b.scale*p,angle:b.angle+r};l.active&&void 0!=l.stencil&&(a.enable(a.STENCIL_TEST),a.colorMask(!1,!1,!1,!1),a.stencilFunc(a.ALWAYS,1,255),a.stencilOp(a.KEEP,
a.KEEP,a.REPLACE),a.stencilMask(255),l.stencil.render(a,d),a.colorMask(!0,!0,!0,!0),a.stencilFunc(a.EQUAL,1,255));k.forEach(function(b){library.math.detectOverlap.boundingBoxes(l.active?g.extremities.boundingBox:viewport.getBoundingBox(),b.extremities.boundingBox)&&b.render(a,d)});l.active&&(a.disable(a.STENCIL_TEST),a.clear(a.STENCIL_BUFFER_BIT));g.dotFrame&&(render.drawDot(g.extremities.boundingBox.topLeft.x,g.extremities.boundingBox.topLeft.y,3,{r:0,g:0,b:0,a:.75}),render.drawDot(g.extremities.boundingBox.bottomRight.x,
g.extremities.boundingBox.bottomRight.y,3,{r:0,g:0,b:0,a:.75}))};this._dump=function(){report.info(g.getAddress(),"._dump()");report.info(g.getAddress(),"._dump -> id: "+b);report.info(g.getAddress(),"._dump -> parent: "+JSON.stringify(g.parent));report.info(g.getAddress(),"._dump -> dotFrame: "+g.dotFrame);report.info(g.getAddress(),"._dump -> extremities: "+JSON.stringify(g.extremities));report.info(g.getAddress(),"._dump -> ignored: "+x);report.info(g.getAddress(),"._dump -> x: "+n);report.info(g.getAddress(),
"._dump -> y: "+q);report.info(g.getAddress(),"._dump -> angle: "+r);report.info(g.getAddress(),"._dump -> scale: "+p);report.info(g.getAddress(),"._dump -> heedCamera: "+z);report.info(g.getAddress(),"._dump -> _static: "+B);report.info(g.getAddress(),"._dump -> children: "+JSON.stringify(k));report.info(g.getAddress(),"._dump -> childRegistry: "+JSON.stringify(y));report.info(g.getAddress(),"._dump -> clipping: "+JSON.stringify(l))};this._interface=new function(){this.ignored=g.ignored;this.x=g.x;
this.y=g.y;this.angle=g.angle;this.scale=g.scale;this.heedCamera=g.heedCamera;this._static=g._static;this.unifiedAttribute=g.unifiedAttribute;this.getAddress=g.getAddress;this.children=function(){return g.children().map(function(a){return element.getIdFromElement(a)})};this.getChildByName=function(a){return element.getIdFromElement(g.getChildByName(a))};this.getChildIndexByName=g.getChildIndexByName;this.contains=function(a){return g.contains(element.getElementFromId(a))};this.append=function(a){return g.append(element.getElementFromId(a))};
this.prepend=function(a){return g.prepend(element.getElementFromId(a))};this.remove=function(a){return g.remove(element.getElementFromId(a))};this.clear=g.clear;this.getElementsUnderPoint=function(a,b){return element.getIdFromElement(g.getElementsUnderPoint(a,b))};this.getElementsUnderArea=function(a){return element.getIdFromElement(g.getElementsUnderArea(a))};this.getTree=g.getTree;this.stencil=g.stencil;this.clipActive=g.clipActive;this._dump=g._dump}}};this.getAvailableElements=function(){return Object.keys(b)};
var f=[];this.getElementFromId=function(a){return f[a]};this.getIdFromElement=c;this.getCreatedElements=function(){return f};this.create_skipDatabase=function(a,c){return new b[a](c,-1)};this.create=function(c,d){if(void 0==c)report.error("elememt.createElement: type argument not provided - element will not be produced");else if(void 0==d)report.error("elememt.createElement: name argument not provided - element will not be produced");else if(void 0==b[c])report.error('elememt.createElement: type "'+
c+'" does not exist - element will not be produced');else{var e=a();f[e]=new b[c](d,e);return f[e]}};this.delete=function(a){f[c(a)]=void 0};this.deleteAllCreated=function(){for(var a=0;a<f.length;a++)this.delete(f[a])};this.getTypeById=function(a){return a.getType()};this._dump=function(){report.info("element._dump()");Object.keys(b).forEach(function(a){report.info("element._dump -> elementLibrary: "+a)});f.forEach(function(a){report.info("element._dump -> createdElements: "+JSON.stringify(a))})}},
arrangement=new function(){var a=element.create_skipDatabase("group","root");this.new=function(){a=core.shape.create("group")};this.get=function(){return a};this.set=function(c){a=c};this.prepend=function(c){a.prepend(c)};this.append=function(c){a.append(c)};this.remove=function(c){a.remove(c)};this.clear=function(){a.clear()};this.getElementByAddress=function(c){c=c.split("/");c.shift();c.shift();var b=a;c.forEach(function(a){b=b.getChildByName(a)});return b};this.getElementsUnderPoint=function(c,
b){return a.getElementsUnderPoint(c,b)};this.getElementsUnderArea=function(c){return a.getElementsUnderArea(c)};this.printTree=function(c){function b(a,e){e=void 0===e?"":e;a.children.forEach(function(a){"spaced"==c?(console.log(e+"- "+a.name),"group"==a.type&&b(a,e+"- ")):"tabular"==c?(console.log(e+"- \t"+a.name),"group"==a.type&&b(a,e+"-\t")):"address"==c&&(console.log(e+"/"+a.name),"group"==a.type&&b(a,e+"/"+a.name))})}c=void 0===c?"spaced":c;b(a.getTree(),"/root")};this._dump=function(){a._dump()}},
render=new function(){function a(a){(void 0===a?0:a)||h.clear(h.COLOR_BUFFER_BIT|h.STENCIL_BUFFER_BIT);arrangement.get().render(h,{x:0,y:0,scale:1,angle:0});a=d.transferToImageBitmap();communicationModule.run("printToScreen",[a],void 0,[a])}function c(b){v=requestAnimationFrame(c);if(m.active){var d=Date.now(),e=d-m.previousRenderTime;if(e<m.interval)return;m.previousRenderTime=d-e%m.interval}try{a()}catch(n){render.active(!1),console.error("major animation error"),console.error(n)}stats.collect(b)}
var b=this,f=!0;this.isBusy=function(){return f};var e={defaultCanvasSize:{width:800,height:600},currentCanvasSize:{width:800,height:600},selectedCanvasSize:{width:800,height:600},devicePixelRatio:1},d=new OffscreenCanvas(e.defaultCanvasSize.width,e.defaultCanvasSize.height),h=d.getContext("webgl2",{alpha:!1,preserveDrawingBuffer:!0,stencil:!0}),v=void 0,w={r:1,g:1,b:1,a:1};h.enable(h.BLEND);h.blendFunc(h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA);var t={};this.produceProgram=function(a,b,c){function d(a,b){function c(a,
b){var c=h.createShader(a);h.shaderSource(c,b);h.compileShader(c);if(h.getShaderParameter(c,h.COMPILE_STATUS))return c;console.error("major error in core's \""+a+'" shader creation');console.error(h.getShaderInfoLog(c));h.deleteShader(c)}var d=h.createProgram();h.attachShader(d,c(h.VERTEX_SHADER,a));h.attachShader(d,c(h.FRAGMENT_SHADER,b));h.linkProgram(d);if(h.getProgramParameter(d,h.LINK_STATUS))return d;console.error("major error in core's program creation");console.error(h.getProgramInfoLog(d));
h.deleteProgram(d)}a in t||(t[a]=d(b,c),h.useProgram(t[a]));return t[a]};this.clearColour=function(a){if(void 0==a)return w;w=a;h.clearColor(w.r,w.g,w.b,1)};this.adjustCanvasSize=function(a,c){function g(a,c){c*=e.devicePixelRatio;void 0!=c?e.currentCanvasSize[a]!=c&&(e.currentCanvasSize[a]=c,d[a]=e.currentCanvasSize[a]):e.currentCanvasSize[a]!=e.defaultCanvasSize[a]&&(e.currentCanvasSize[a]=e.defaultCanvasSize[a],d[a]=e.currentCanvasSize[a]);b.refreshCoordinates();t[a]=!1;f=t.width||t.height}function h(a){var b=
a[0].toUpperCase()+a.slice(1);_interface.getCanvasAttributes([b],[!0]).then(function(c){function d(a,b){report.error("Canvas element "+a+" is of an unparseable format: "+b);g(a,e.defaultCanvasSize[a])}e.selectedCanvasSize[a]=c[0];var f=e.selectedCanvasSize[a];f.indexOf("%")==f.length-1?_interface.getCanvasParentAttributes(["offset"+b]).then(function(b){b=b[0];var c=parseFloat(f.slice(0,-1))/100;isNaN(c)?d(a,f):g(a,b*c)}):-1!=f.indexOf("px")?(c=parseFloat(f.slice(0,-2)),isNaN(c)?d(a,f):g(a,c)):(c=
parseFloat(f),isNaN(c)?d(a,f):g(a,c))})}var t={width:!1,height:!1};f=!0;_interface["window.devicePixelRatio"]().then(function(b){e.devicePixelRatio=b;t={width:!0,height:!0};void 0!=a?g("width",a*e.devicePixelRatio):h("width");void 0!=c?g("height",c*e.devicePixelRatio):h("height")})};this.refreshCoordinates=function(){var a=h.canvas.width,b=h.canvas.height,c;if(1==e.devicePixelRatio){var d=c=0;var f=a;var t=b}else c=0,d=-b,f=2*a,t=2*b;h.viewport(c,d,f,t);_interface.setCanvasAttributes([{name:"width",
value:a/e.devicePixelRatio},{name:"height",value:b/e.devicePixelRatio}])};this.refresh=function(a){this.clearColour(w);this.frameRateLimit(this.frameRateLimit());this.adjustCanvasSize();var b=setInterval(function(){render.isBusy()||(clearInterval(b),a&&a())},1)};var m={active:!1,previousRenderTime:Date.now(),limit:30,interval:0};this.activeLimitToFrameRate=function(a){if(void 0==a)return m.active;m.active=a};this.frameRateLimit=function(a){if(void 0==a)return m.limit;m.limit=a;m.interval=1E3/m.limit};
this.frame=function(b){a(void 0===b?!1:b)};this.active=function(a){if(void 0==a)return void 0!=v;a?void 0==v&&c():void 0!=v&&(cancelAnimationFrame(v),v=void 0)};this.getCanvasDimensions=function(){return{width:e.currentCanvasSize.width/e.devicePixelRatio,height:e.currentCanvasSize.height/e.devicePixelRatio}};this.drawDot=function(a,b,c,d){};this._dump=function(){report.info("render._dump()");report.info("render._dump -> pageData: "+JSON.stringify(e));report.info("render._dump -> storedPrograms: "+
JSON.stringify(t));report.info("render._dump -> frameRateControl: "+JSON.stringify(m));report.info("render._dump -> clearColour: "+JSON.stringify(w))}},viewport=new function(){function a(){var a=render.getCanvasDimensions();f.points.tl={x:0,y:0};f.points.tr={x:a.width,y:0};f.points.bl={x:0,y:a.height};f.points.br={x:a.width,y:a.height};f.boundingBox=library.math.boundingBoxFromPoints([f.points.tl,f.points.tr,f.points.br,f.points.bl])}var c=this,b={position:{x:0,y:0},scale:1,angle:0},f={points:{tl:{x:0,
y:0},tr:{x:0,y:0},bl:{x:0,y:0},br:{x:0,y:0}},boundingBox:{topLeft:{x:0,y:0},bottomRight:{x:0,y:0}}},e={x:void 0,y:void 0,stopScrollActive:!1,clickVisibility:!1};this.adapter=new function(){this.windowPoint2workspacePoint=function(a,b){var c=viewport.position(),d=viewport.scale(),e=viewport.angle();a={x:a,y:b};a.x=(a.x-c.x)/d;a.y=(a.y-c.y)/d;return a=library.math.cartesianAngleAdjust(a.x,a.y,-e)}};this.position=function(d,e){if(void 0==d||void 0==e)return{x:b.position.x,y:b.position.y};b.position.x=
d;b.position.y=e;arrangement.get().children().forEach(function(a){a.heedCamera&&a.unifiedAttribute({x:b.position.x,y:b.position.y})});a();c.onCameraAdjust(Object.assign({},b))};this.scale=function(d){if(void 0==d)return b.scale;b.scale=0>=d?1:d;arrangement.get().children().forEach(function(a){a.heedCamera&&a.scale(b.scale)});a();c.onCameraAdjust(Object.assign({},b))};this.angle=function(d){if(void 0==d)return b.angle;b.angle=d;arrangement.get().children().forEach(function(a){a.heedCamera&&a.angle(b.angle)});
a();c.onCameraAdjust(Object.assign({},b))};this.getElementUnderCanvasPoint=function(a,b){a=this.adapter.windowPoint2canvasPoint(a,b);return arrangement.getElementUnderPoint(a.x,a.y)};this.getElementsUnderCanvasArea=function(a){var b=this;return arrangement.getElementsUnderArea(a.map(function(a){return b.adapter.windowPoint2canvasPoint(a.x,a.y)}))};this.calculateViewportExtremities=a;this.refresh=function(){a()};this.getBoundingBox=function(){return f.boundingBox};this.mousePosition=function(a,b){if(void 0==
a||void 0==b)return{x:e.x,y:e.y};e.x=a;e.y=b};this.stopMouseScroll=function(a){if(void 0==a)return e.stopScrollActive;e.stopScrollActive=a;if(!a)_interface["document.body.style.overflow"]("")};this.clickVisibility=function(a){if(void 0==a)return e.clickVisibility;e.clickVisibility=a};this.getHeight=function(){return f.points.br.y-f.points.tl.y};this.getWidth=function(){return f.points.br.x-f.points.tl.x};this._dump=function(){report.info("viewport._dump()");report.info("viewport._dump -> state: "+
JSON.stringify(b));report.info("viewport._dump -> viewbox: "+JSON.stringify(f));report.info("viewport._dump -> mouseData: "+JSON.stringify(e))};this.onCameraAdjust=function(a){}},stats=new function(){var a=!1,c=0,b={compute:function(a){this.frameTimeArray.push(1E3/(a-c));30<=this.frameTimeArray.length&&this.frameTimeArray.shift();this.rate=library.math.averageArray(this.frameTimeArray);c=a},counter:0,frameTimeArray:[],rate:0};this.collect=function(c){a&&b.compute(c)};this.active=function(b){if(void 0==
b)return a;a=b};this.getReport=function(){return{framesPerSecond:b.rate}}},callback=new function(){function a(a,b,c){return{point:0<c?viewport.adapter.windowPoint2workspacePoint(a.X,a.Y):void 0,elements:3<c?arrangement.getElementsUnderPoint(a.X,a.Y):void 0}}var c=this,b=this,f="onmousedown onmouseup onmousemove onmouseenter onmouseleave onwheel onclick ondblclick onmouseenterelement onmouseleaveelement onkeydown onkeyup".split(" ");this.listCallbackTypes=function(){return f};var e={};f.forEach(function(a){return e[a]=
!0});this.getElementCallbackState=function(a){return e[a]};this.activateElementCallback=function(a){e[a]=!0};this.disactivateElementCallback=function(a){e[a]=!1};this.activateAllElementCallbacks=function(){var a=this;f.forEach(function(b){return a.activateElementCallback(b)})};this.disactivateAllElementCallbacks=function(){var a=this;f.forEach(function(b){return a.disactivateElementCallback(b)})};this.activateAllElementCallbacks();this.attachCallback=function(a,b){a[b]=function(){}};this.removeCallback=
function(a,b){a[b]=void 0;delete a[b]};this.functions={};this.coupling={};for(var d=0;d<f.length;d++)this.coupling[f[d]]=function(c){return function(d){var e=a(d,c,b.functions[c].length);b.functions[c](e.point.x,e.point.y,d,e.elements)}}(f[d]);this.coupling.onmouseenter=function(a){if(viewport.stopMouseScroll())_interface["document.body.style.overflow"]("hidden")};this.coupling.onmouseleave=function(a){if(viewport.stopMouseScroll())_interface["document.body.style.overflow"]("")};var h=[];this.coupling.onmousemove=
function(a){viewport.mousePosition(a.X,a.Y);var c=arrangement.getElementsUnderPoint(a.X,a.Y),d=viewport.adapter.windowPoint2workspacePoint(a.X,a.Y),f=library.math.getDifferenceOfArrays(h,c);if(e.onmouseenter){if(0<f.b.length)b.functions.onmouseenterelement(d.x,d.y,a,f.b);if(0<f.a.length)b.functions.onmouseleaveelement(d.x,d.y,a,f.a)}f.b.forEach(function(a){h.push(a)});f.a.forEach(function(a){h.splice(h.indexOf(a),1)});if(b.functions.onmousemove)b.functions.onmousemove(d.x,d.y,a,c)};this.coupling.onwheel=
function(c){if(b.functions.onwheel){var d=a(c,"onwheel",b.functions.onwheel.length);b.functions.onwheel(d.point.x,d.point.y,c,d.elements)}};["onkeydown","onkeyup"].forEach(function(d){c.coupling[d]=function(c){return function(d){var e=viewport.mousePosition();d.X=e.x;d.Y=e.y;e=viewport.adapter.windowPoint2workspacePoint(d.X,d.Y);if(b.functions[c]){var f=a(d,c,b.functions[c].length);b.functions[c](e.x,e.y,d,f.elements)}}}(d)});var v=[];this.coupling.onmousedown=function(a){viewport.clickVisibility()&&
render.drawDot(a.offsetX,a.offsetY);var c=arrangement.getElementsUnderPoint(a.X,a.Y),d=viewport.adapter.windowPoint2workspacePoint(a.X,a.Y);v=c;if(b.functions.onmousedown)b.functions.onmousedown(d.x,d.y,a,c)};this.coupling.onmouseup=function(c){if(b.functions.onmouseup){var d=a(c,"onmouseup",b.functions.onmouseup.length);b.functions.onmouseup(d.point.x,d.point.y,c,d.elements)}};var w=[];this.coupling.onclick=function(c){if(b.functions.onclick){var d=a(c,"onclick",b.functions.onclick.length);d.elements=
d.elements.filter(function(a){return v.includes(a)});w=d.elements;b.functions.onclick(d.point.x,d.point.y,c,d.elements)}};this.coupling.ondblclick=function(c){if(b.functions.ondblclick){var d=a(c,"ondblclick",b.functions.ondblclick.length);d.elements=d.elements.filter(function(a){return w.includes(a)});b.functions.ondblclick(d.point.x,d.point.y,c,d.elements)}}};communicationModule.function.getAllFunctions=function(){return Object.keys(communicationModule.function)};
var _interface=new function(){this["document.body.style.overflow"]=function(a){return new Promise(function(c,b){communicationModule.run("document.body.style.overflow",[a],c)})};this["window.devicePixelRatio"]=function(a){return new Promise(function(c,b){communicationModule.run("window.devicePixelRatio",[a],c)})};this.setCanvasAttributes=function(a){a=void 0===a?[]:a;communicationModule.run("setCanvasAttributes",[a])};this.getCanvasAttributes=function(a,c){c=void 0===c?[]:c;return new Promise(function(b,
f){communicationModule.run("getCanvasAttributes",[a,c],b)})};this.getCanvasParentAttributes=function(a,c){c=void 0===c?[]:c;return new Promise(function(b,f){communicationModule.run("getCanvasParentAttributes",[a,c],b)})};this.sendReadySignal=function(){communicationModule.run("ready")}};communicationModule.delayedFunction.refresh=function(a){render.refresh(function(){viewport.refresh();a()})};communicationModule.function["element.getAvailableElements"]=function(){return element.getAvailableElements()};
communicationModule.function["element.getCreatedElements"]=function(){return element.getCreatedElements().map(function(a){return element.getIdFromElement(a)})};communicationModule.function["element.create"]=function(a,c){return element.getIdFromElement(element.create(a,c))};communicationModule.function["element.delete"]=function(a){element.delete(element.getElementFromId(a))};communicationModule.function["element.deleteAllCreated"]=function(){element.deleteAllCreated()};
communicationModule.function["element.getTypeById"]=function(a){return element.getTypeById(element.getElementFromId(a))};communicationModule.function["element.executeMethod"]=function(a,c,b){b=void 0===b?[]:b;return element.getElementFromId(a)._interface[c].apply(element.getElementFromId(a)._interface,$jscomp.arrayFromIterable(b))};communicationModule.function["element.boatload_executeMethod"]=function(a){a.forEach(function(a){communicationModule.function["element.executeMethod"](a.id,a.method,a.argumentList)})};
communicationModule.function["element._dump"]=function(){element._dump()};communicationModule.function["arrangement.new"]=function(){arrangement.new()};communicationModule.function["arrangement.prepend"]=function(a){arrangement.prepend(element.getElementFromId(a))};communicationModule.function["arrangement.append"]=function(a){arrangement.append(element.getElementFromId(a))};communicationModule.function["arrangement.remove"]=function(a){arrangement.remove(element.getElementFromId(a))};
communicationModule.function["arrangement.clear"]=function(){arrangement.clear()};communicationModule.function["arrangement.getElementByAddress"]=function(a){return element.getIdFromElement(arrangement.getElementByAddress(a))};communicationModule.function["arrangement.getElementsUnderPoint"]=function(a,c){return arrangement.getElementsUnderPoint(a,c).map(function(a){return element.getIdFromElement(a)})};communicationModule.function["arrangement.getElementsUnderArea"]=function(a){return arrangement.getElementsUnderArea(a).map(function(a){return element.getIdFromElement(a)})};
communicationModule.function["arrangement.printTree"]=function(a){arrangement.printTree(a)};communicationModule.function["arrangement._dump"]=function(){arrangement._dump()};communicationModule.function["render.clearColour"]=function(a){return render.clearColour(a)};communicationModule.function["render.adjustCanvasSize"]=function(a,c){render.adjustCanvasSize(a,c)};communicationModule.function["render.refreshCoordinates"]=function(){render.refreshCoordinates()};
communicationModule.delayedFunction["render.refresh"]=function(a){render.refresh(a)};communicationModule.function["render.activeLimitToFrameRate"]=function(a){return render.activeLimitToFrameRate(a)};communicationModule.function["render.frameRateLimit"]=function(a){return render.frameRateLimit(a)};communicationModule.function["render.frame"]=function(){render.frame()};communicationModule.function["render.active"]=function(a){return render.active(a)};
communicationModule.function["render.getCanvasDimensions"]=function(){return render.getCanvasDimensions()};communicationModule.function["render.drawDot"]=function(a,c,b,f){render.drawDot(a,c,b,f)};communicationModule.function["render._dump"]=function(){render._dump()};communicationModule.function["viewport.position"]=function(a,c){return viewport.position(a,c)};communicationModule.function["viewport.scale"]=function(a){return viewport.scale(a)};communicationModule.function["viewport.angle"]=function(a){return viewport.angle(a)};
communicationModule.function["viewport.getElementUnderCanvasPoint"]=function(a,c){return viewport.getElementUnderCanvasPoint(a,c)};communicationModule.function["viewport.getElementsUnderCanvasArea"]=function(a){return viewport.getElementsUnderCanvasArea(a)};communicationModule.function["viewport.calculateViewportExtremities"]=function(){viewport.calculateViewportExtremities()};communicationModule.function["viewport.refresh"]=function(){viewport.refresh()};
communicationModule.function["viewport.getBoundingBox"]=function(){return viewport.getBoundingBox()};communicationModule.function["viewport.mousePosition"]=function(a,c){return viewport.mousePosition(a,c)};communicationModule.function["viewport.stopMouseScroll"]=function(a){return viewport.stopMouseScroll(a)};communicationModule.function["viewport.clickVisibility"]=function(a){return viewport.clickVisibility(a)};communicationModule.function["viewport.getHeight"]=function(){return viewport.getHeight()};
communicationModule.function["viewport.getWidth"]=function(){return viewport.getWidth()};communicationModule.function["viewport._dump"]=function(){viewport._dump()};viewport.onCameraAdjust=function(a){communicationModule.run("viewport.onCameraAdjust",[a])};communicationModule.function["stats.active"]=function(a){return stats.active(a)};communicationModule.function["stats.getReport"]=function(){return stats.getReport()};communicationModule.function["callback.listCallbackTypes"]=function(){return callback.listCallbackTypes()};
communicationModule.function["callback.getShapeCallbackState"]=function(a){return callback.getShapeCallbackState(a)};communicationModule.function["callback.activateShapeCallback"]=function(a){callback.activateShapeCallback(a)};communicationModule.function["callback.disactivateShapeCallback"]=function(a){callback.disactivateShapeCallback(a)};communicationModule.function["callback.activateAllShapeCallbacks"]=function(){callback.activateAllShapeCallbacks()};
communicationModule.function["callback.disactivateAllShapeCallbacks"]=function(){callback.disactivateAllShapeCallbacks()};communicationModule.function["callback.attachCallback"]=function(a,c){callback.attachCallback(element.getElementFromId(a),c)};communicationModule.function["callback.removeCallback"]=function(a,c){callback.removeCallback(element.getElementFromId(a),c)};
callback.listCallbackTypes().forEach(function(a){communicationModule.function["callback.coupling."+a]=function(c){callback.coupling[a](c)};callback.functions[a]=function(c,b,f,e){communicationModule.run("callback."+a,[c,b,f,e.map(function(a){return element.getIdFromElement(a)})])}});render.refresh(function(){viewport.refresh();_interface.sendReadySignal()});
