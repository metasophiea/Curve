var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,f){a!=Array.prototype&&a!=Object.prototype&&(a[b]=f.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}();$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var f=0,d={next:function(){if(f<a.length){var g=f++;return{value:b(g,a[g]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill=function(a,b,f,d){if(b){f=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var g=a[d];g in f||(f[g]={});f=f[g]}a=a[a.length-1];d=f[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(f,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.polyfill("Array.from",function(a){return a?a:function(a,f,d){f=null!=f?f:function(c){return c};var b=[],c="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];if("function"==typeof c){a=c.call(a);for(var e=0;!(c=a.next()).done;)b.push(f.call(d,c.value,e++))}else for(c=a.length,e=0;e<c;e++)b.push(f.call(d,a[e],e));return b}},"es6","es3");
$jscomp.checkEs6ConformanceViaProxy=function(){try{var a={},b=Object.create(new $jscomp.global.Proxy(a,{get:function(f,d,g){return f==a&&"q"==d&&g==b}}));return!0===b.q}catch(f){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.polyfill("WeakMap",function(a){function b(){if(!a||!Object.seal)return!1;try{var c=Object.seal({}),e=Object.seal({}),d=new a([[c,2],[e,3]]);if(2!=d.get(c)||3!=d.get(e))return!1;d.delete(c);d.set(e,4);return!d.has(c)&&4==d.get(e)}catch(u){return!1}}function f(){}function d(e){if(!$jscomp.owns(e,c)){var a=new f;$jscomp.defineProperty(e,c,{value:a})}}function g(c){var e=Object[c];e&&(Object[c]=function(c){if(c instanceof f)return c;d(c);return e(c)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&
$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var c="$jscomp_hidden_"+Math.random();g("freeze");g("preventExtensions");g("seal");var e=0,k=function(c){this.id_=(e+=Math.random()+1).toString();if(c){c=$jscomp.makeIterator(c);for(var a;!(a=c.next()).done;)a=a.value,this.set(a[0],a[1])}};k.prototype.set=function(e,a){d(e);if(!$jscomp.owns(e,c))throw Error("WeakMap key fail: "+e);e[c][this.id_]=a;return this};k.prototype.get=function(e){return $jscomp.owns(e,c)?e[c][this.id_]:void 0};k.prototype.has=
function(e){return $jscomp.owns(e,c)&&$jscomp.owns(e[c],this.id_)};k.prototype.delete=function(e){return $jscomp.owns(e,c)&&$jscomp.owns(e[c],this.id_)?delete e[c][this.id_]:!1};return k},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_MAP||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var c=Object.seal({x:4}),e=new a($jscomp.makeIterator([[c,"s"]]));if("s"!=e.get(c)||1!=e.size||e.get({x:4})||e.set({x:4},"t")!=e||2!=e.size)return!1;var d=e.entries(),b=d.next();if(b.done||b.value[0]!=c||"s"!=b.value[1])return!1;b=d.next();return b.done||4!=b.value[0].x||"t"!=b.value[1]||!d.next().done?!1:!0}catch(n){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;$jscomp.initSymbolIterator();var f=new WeakMap,d=function(c){this.data_={};this.head_=e();this.size=0;if(c){c=$jscomp.makeIterator(c);for(var a;!(a=c.next()).done;)a=a.value,this.set(a[0],a[1])}};d.prototype.set=function(c,e){c=0===c?0:c;var a=g(this,c);a.list||(a.list=this.data_[a.id]=[]);a.entry?a.entry.value=e:(a.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:c,
value:e},a.list.push(a.entry),this.head_.previous.next=a.entry,this.head_.previous=a.entry,this.size++);return this};d.prototype.delete=function(c){c=g(this,c);return c.entry&&c.list?(c.list.splice(c.index,1),c.list.length||delete this.data_[c.id],c.entry.previous.next=c.entry.next,c.entry.next.previous=c.entry.previous,c.entry.head=null,this.size--,!0):!1};d.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=e();this.size=0};d.prototype.has=function(c){return!!g(this,c).entry};
d.prototype.get=function(c){return(c=g(this,c).entry)&&c.value};d.prototype.entries=function(){return c(this,function(c){return[c.key,c.value]})};d.prototype.keys=function(){return c(this,function(c){return c.key})};d.prototype.values=function(){return c(this,function(c){return c.value})};d.prototype.forEach=function(c,e){for(var a=this.entries(),d;!(d=a.next()).done;)d=d.value,c.call(e,d[1],d[0],this)};d.prototype[Symbol.iterator]=d.prototype.entries;var g=function(c,e){var a=e&&typeof e;"object"==
a||"function"==a?f.has(e)?a=f.get(e):(a=""+ ++k,f.set(e,a)):a="p_"+e;var d=c.data_[a];if(d&&$jscomp.owns(c.data_,a))for(c=0;c<d.length;c++){var b=d[c];if(e!==e&&b.key!==b.key||e===b.key)return{id:a,list:d,index:c,entry:b}}return{id:a,list:d,index:-1,entry:void 0}},c=function(c,e){var a=c.head_;return $jscomp.iteratorPrototype(function(){if(a){for(;a.head!=c.head_;)a=a.previous;for(;a.next!=a.head;)return a=a.next,{done:!1,value:e(a)};a=null}return{done:!0,value:void 0}})},e=function(){var c={};return c.previous=
c.next=c.head=c},k=0;return d},"es6","es3");
$jscomp.polyfill("Set",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_SET||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var d=Object.seal({x:4}),b=new a($jscomp.makeIterator([d]));if(!b.has(d)||1!=b.size||b.add(d)!=b||1!=b.size||b.add({x:4})!=b||2!=b.size)return!1;var c=b.entries(),e=c.next();if(e.done||e.value[0]!=d||e.value[1]!=d)return!1;e=c.next();return e.done||e.value[0]==d||4!=e.value[0].x||e.value[1]!=e.value[0]?!1:c.next().done}catch(k){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;$jscomp.initSymbolIterator();var f=function(a){this.map_=new Map;if(a){a=$jscomp.makeIterator(a);for(var d;!(d=a.next()).done;)this.add(d.value)}this.size=this.map_.size};f.prototype.add=function(a){a=0===a?0:a;this.map_.set(a,a);this.size=this.map_.size;return this};f.prototype.delete=function(a){a=this.map_.delete(a);this.size=this.map_.size;return a};f.prototype.clear=function(){this.map_.clear();
this.size=0};f.prototype.has=function(a){return this.map_.has(a)};f.prototype.entries=function(){return this.map_.entries()};f.prototype.values=function(){return this.map_.values()};f.prototype.keys=f.prototype.values;f.prototype[Symbol.iterator]=f.prototype.values;f.prototype.forEach=function(a,b){var c=this;this.map_.forEach(function(e){return a.call(b,e,e,c)})};return f},"es6","es3");
$jscomp.polyfill("Object.entries",function(a){return a?a:function(a){var b=[],d;for(d in a)$jscomp.owns(a,d)&&b.push([d,a[d]]);return b}},"es8","es3");$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,f,d){var b=this.length||0;0>f&&(f=Math.max(0,b+f));if(null==d||d>b)d=b;d=Number(d);0>d&&(d=Math.max(0,b+d));for(f=Number(f||0);f<d;f++)this[f]=a;return this}},"es6","es3");
$jscomp.assign="function"==typeof Object.assign?Object.assign:function(a,b){for(var f=1;f<arguments.length;f++){var d=arguments[f];if(d)for(var g in d)$jscomp.owns(d,g)&&(a[g]=d[g])}return a};$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");
for(var __canvasElements=document.getElementsByTagName("canvas"),__canvasElements_count=0;__canvasElements_count<__canvasElements.length;__canvasElements_count++)if(__canvasElements[__canvasElements_count].hasAttribute("workspace")){var workspace=__canvasElements[__canvasElements_count];workspace.library=new function(){};workspace.library.math=new function(){this.averageArray=function(a){return a.reduce(function(a,f){return a+f},0)/a.length};this.distanceBetweenTwoPoints=function(a,b){return Math.pow(Math.pow(a.x-
b.x,2)+Math.pow(a.y-b.y,2),.5)};this.seconds2time=function(a){var b={h:0,m:0,s:0};b.h=Math.floor(a/3600);a-=3600*b.h;b.m=Math.floor(a/60);a-=60*b.m;b.s=a;return b};this.largestValueFound=function(a){return a.reduce(function(a,f){return Math.abs(a)>Math.abs(f)?a:f})};this.smallestValueFound=function(a){return a.reduce(function(a,f){return Math.abs(a)<Math.abs(f)?a:f})};this.cartesian2polar=function(a,b){return{dis:Math.pow(Math.pow(a,2)+Math.pow(b,2),.5),ang:0===a?0===b?0:0<b?.5*Math.PI:1.5*Math.PI:
0===b?0<=a?0:Math.PI:0<=a?Math.atan(b/a):Math.atan(b/a)+Math.PI}};this.polar2cartesian=function(a,b){return{x:b*Math.cos(a),y:b*Math.sin(a)}};this.cartesianAngleAdjust=function(a,b,f){a=this.cartesian2polar(a,b);a.ang+=f;return this.polar2cartesian(a.ang,a.dis)};this.boundingBoxFromPoints=function(a){if(0==a.length)return{topLeft:{x:0,y:0},bottomRight:{x:0,y:0}};for(var b=a[0].x,f=a[0].x,d=a[0].y,g=a[0].y,c=1;c<a.length;c++)a[c].x<b?b=a[c].x:a[c].x>f&&(f=a[c].x),a[c].y<d?d=a[c].y:a[c].y>g&&(g=a[c].y);
return{topLeft:{x:b,y:d},bottomRight:{x:f,y:g}}};this.pointsOfRect=function(a,b,f,d,g,c){g=void 0===g?0:g;c=void 0===c?{x:0,y:0}:c;var e=c.x*f,k=c.y*d,h=this.cartesian2polar(e,k);h=this.polar2cartesian(h.ang-g,h.dis);c={x:a-h.x,y:b-h.y};h=this.cartesian2polar(e-f,k);h=this.polar2cartesian(h.ang-g,h.dis);var l={x:a-h.x,y:b-h.y};h=this.cartesian2polar(e-f,k-d);h=this.polar2cartesian(h.ang-g,h.dis);f={x:a-h.x,y:b-h.y};h=this.cartesian2polar(e,k-d);h=this.polar2cartesian(h.ang-g,h.dis);return[c,l,f,{x:a-
h.x,y:b-h.y}]};this.pointsOfCircle=function(a,b,f,d){d=void 0===d?3:d;for(var g=[],c=0;c<d;c++)g.push({x:a+f*Math.sin(c/d*Math.PI*2),y:b+f*Math.cos(c/d*Math.PI*2)});return g};this.pointsOfText=function(a,b,f,d,g,c,e,k){var h=document.createElement("canvas").getContext("2d");h.font=c;h.textAlign=e;h.textBaseline=k;a=h.measureText(a).width/g;c=-c.split("pt")[0].split(" ").pop();isNaN(c)&&(c=-7.5);c/=g;g=[{x:b,y:f},{x:b+a,y:f},{x:b+a,y:f-c},{x:b,y:f-c}];a={start:0,end:0,center:a/2,left:a,right:a};c=
{alphabetic:c,top:0,hanging:0,middle:c/2,ideographic:0,bottom:c};for(h=0;h<g.length;h++)g[h]={x:g[h].x-a[e],y:g[h].y+c[k]};for(h=0;h<g.length;h++)g[h]=this.cartesianAngleAdjust(g[h].x-b,g[h].y-f,d),g[h].x+=b,g[h].y+=f;return g};this.relativeDistance=function(a,b,f,d,g){b=(d-b)/(f-b);if(void 0===g||!g){if(1<b)return a;if(0>b)return 0}return b*a};this.lineCorrecter=function(a,b,f){if(!(0>a.x1||0>a.x2||a.x1>f||a.x2>f||0>a.y1&&0>a.y2||a.y1>b&&a.y2>b))return f=(a.y2-a.y1)/(a.x2-a.x1),0>a.y1?(a.x1=(0-a.y1+
f*a.x1)/f,a.y1=0):0>a.y2&&(a.x2=(0-a.y2+f*a.x2)/f,a.y2=0),a.y1>b?(a.x1=(b-a.y1+f*a.x1)/f,a.y1=b):a.y2>b&&(a.x2=(b-a.y2+f*a.x2)/f,a.y2=b),a};this.normalizeStretchArray=function(a){var b=a.reduce(function(a,c,e,b){return c>b[a]?e:a},0),f=Math.abs(a[b]);a=a.map(function(a){return a/f});if(0==a[0]&&1==a[a.length-1])return a;var d=0!=a[0]?a[0]:a[a.length-1];return a=a.map(function(a){return(a-d)/(1-d)})};this.curvePoint=new function(){this.linear=function(a,b,f){b=void 0===b?0:b;return(void 0===a?.5:a)*
((void 0===f?1:f)-b)+b};this.sin=function(a,b,f){b=void 0===b?0:b;return Math.sin(Math.PI/2*(void 0===a?.5:a))*((void 0===f?1:f)-b)+b};this.cos=function(a,b,f){b=void 0===b?0:b;return(1-Math.cos(Math.PI/2*(void 0===a?.5:a)))*((void 0===f?1:f)-b)+b};this.s=function(a,b,f,d){b=void 0===b?0:b;f=void 0===f?1:f;d=void 0===d?8:d;return workspace.library.math.normalizeStretchArray([1/(1+Math.exp(-.5*-d)),1/(1+Math.exp(-d*((void 0===a?.5:a)-.5))),1/(1+Math.exp(.5*-d))])[1]*(f-b)+b};this.exponential=function(a,
b,f,d){b=void 0===b?0:b;f=void 0===f?1:f;d=void 0===d?2:d;return workspace.library.math.normalizeStretchArray([(Math.exp(0*d)-1)/(Math.E-1),(Math.exp(d*(void 0===a?.5:a))-1)/(Math.E-1),(Math.exp(1*d)-1)/(Math.E-1)])[1]*(f-b)+b}};this.curveGenerator=new function(){this.linear=function(a,b,f){b=void 0===b?0:b;f=void 0===f?1:f;a=Math.abs(void 0===a?2:a)-1;for(var d=[0],g=1;g<a;g++)d.push(g/a);d.push(1);a=f-b;for(g=0;g<d.length;g++)d[g]=d[g]*a+b;return d};this.sin=function(a,b,f){b=void 0===b?0:b;f=void 0===
f?1:f;a=Math.abs(void 0===a?2:a)-1;for(var d=[0],g=1;g<a;g++)d.push(Math.sin(Math.PI/2*(g/a)));d.push(1);a=f-b;for(g=0;g<d.length;g++)d[g]=d[g]*a+b;return d};this.cos=function(a,b,f){b=void 0===b?0:b;f=void 0===f?1:f;a=Math.abs(void 0===a?2:a)-1;for(var d=[0],g=1;g<a;g++)d.push(1-Math.cos(Math.PI/2*(g/a)));d.push(1);a=f-b;for(g=0;g<d.length;g++)d[g]=d[g]*a+b;return d};this.s=function(a,b,f,d){a=void 0===a?2:a;b=void 0===b?0:b;f=void 0===f?1:f;d=void 0===d?8:d;0==d&&(d=1E-6);for(var g=[],c=0;c<a;c++)g.push(1/
(1+Math.exp(-d*(c/a-.5))));a=workspace.library.math.normalizeStretchArray(g);f-=b;for(c=0;c<a.length;c++)a[c]=a[c]*f+b;return a};this.exponential=function(a,b,f,d){b=void 0===b?0:b;f=void 0===f?1:f;d=void 0===d?2:d;a=(void 0===a?2:a)-1;for(var g=[],c=0;c<=a;c++)g.push((Math.exp(c/a*d)-1)/(Math.E-1));g=system.utility.math.normalizeStretchArray(g);a=f-b;for(c=0;c<g.length;c++)g[c]=g[c]*a+b;return g}};this.detectOverlap=new function(){this.boundingBoxes=function(a,b){return!(a.bottomRight.y<b.topLeft.y||
a.topLeft.y>b.bottomRight.y||a.bottomRight.x<b.topLeft.x||a.topLeft.x>b.bottomRight.x)};this.pointWithinBoundingBox=function(a,b){return!(a.x<b.topLeft.x||a.y<b.topLeft.y||a.x>b.bottomRight.x||a.y>b.bottomRight.y)};this.pointWithinPoly=function(a,b){for(var f=!1,d=0,g=b.length-1;d<b.length;g=d++)b[d].y>a.y!=b[g].y>a.y&&a.x<(b[g].x-b[d].x)*(a.y-b[d].y)/(b[g].y-b[d].y)+b[d].x&&(f=!f);return f};this.lineSegments=function(a,b){var f=(b[1].y-b[0].y)*(a[1].x-a[0].x)-(b[1].x-b[0].x)*(a[1].y-a[0].y);if(0==
f)return null;var d=((b[1].x-b[0].x)*(a[0].y-b[0].y)-(b[1].y-b[0].y)*(a[0].x-b[0].x))/f;b=((a[1].x-a[0].x)*(a[0].y-b[0].y)-(a[1].y-a[0].y)*(a[0].x-b[0].x))/f;return{x:a[0].x+d*(a[1].x-a[0].x),y:a[0].y+d*(a[1].y-a[0].y),inSeg1:0<=d&&1>=d,inSeg2:0<=b&&1>=b}};this.overlappingPolygons=function(a,b){for(var f=0;f<a.length;f++)if(this.pointWithinPoly(a[f],b))return!0;for(f=0;f<b.length;f++)if(this.pointWithinPoly(b[f],a))return!0;var d=Array.apply(null,{length:a.length}).map(Number.call,Number).concat([0]),
g=Array.apply(null,{length:b.length}).map(Number.call,Number).concat([0]);for(f=0;f<d.length-1;f++)for(var c=0;c<g.length-1;c++){var e=this.lineSegments([a[d[f]],a[d[f+1]]],[b[g[c]],b[g[c+1]]]);if(null!=e&&e.inSeg1&&e.inSeg2)return!0}return!1}}};workspace.library.structure=new function(){this.functionListRunner=function(a){return function(b,f){for(var d=0;d<a.length;d++){for(var g=!0,c=0;c<a[d].requiredKeys.length;c++){g=!0;for(var e=0;e<a[d].requiredKeys[c].length&&(g=g&&workspace.system.keyboard.pressedKeys[a[d].requiredKeys[c][e]],
g);e++);if(g)break}if(g&&a[d].function(b,f))break}}};this.signalRegistry=function(a,b,f){a=void 0===a?-1:a;b=void 0===b?-1:b;f=void 0===f?-1:f;var d=[],g=[],c=[],e=[],k={},h=[];this.__dump=function(){console.log("---- signalRegistry dump ----");console.log("\tsignals");for(var a=0;a<d.length;a++)console.log("\t\t",a," "+JSON.stringify(d[a]));console.log("\tselectedSignals");for(a=0;a<tselectedSignals.length;a++)console.log("\t\t",a," "+JSON.stringify(tselectedSignals[a]));console.log("\tevents");
for(a=0;a<c.length;a++)console.log("\t\t",a," "+JSON.stringify(c[a]));console.log("\tevents_byID");for(a=0;a<e.length;a++)console.log("\t\t",a," "+JSON.stringify(e[a]));console.log("\tevents_byPosition");var b=Object.keys(k);for(a=0;a<b.length;a++)console.log("\t\t",b[a]," "+JSON.stringify(k[b[a]]));console.log("\tpositions");for(a=0;a<h.length;a++)console.log("\t\t",a," "+JSON.stringify(h[a]))};this.export=function(){return JSON.parse(JSON.stringify({signals:d,selectedSignals:g,events:c,events_byID:e,
events_byPosition:k,positions:h}))};this.import=function(a){d=JSON.parse(JSON.stringify(a.signals));g=JSON.parse(JSON.stringify(a.selectedSignals));c=JSON.parse(JSON.stringify(a.events));e=JSON.parse(JSON.stringify(a.events_byID));k=JSON.parse(JSON.stringify(a.events_byPosition));h=JSON.parse(JSON.stringify(a.positions))};this.getAllSignals=function(){return JSON.parse(JSON.stringify(d))};this.getAllEvents=function(){return JSON.parse(JSON.stringify(c))};this.getSignal=function(c){if(void 0!=d[c])return JSON.parse(JSON.stringify(d[c]))};
this.eventsBetween=function(e,a){for(var b=void 0==a?Array.from(new Set(h.filter(function(c){return c==e}))):Array.from(new Set(h.filter(function(c){return c>=e&&c<a}))),d=[],f=0;f<b.length;f++){b[f]=k[String(b[f])];for(var l=0;l<b[f].length;l++)d.push(c[b[f][l]])}return d.sort(function(c,e){return c.position<e.position?-1:c.position>e.position?1:0})};this.add=function(l,g){if(void 0!=l&&"line"in l&&"position"in l&&"length"in l){"strength"in l||(l.strength=1);0>l.line&&(l.line=0);0>l.length&&(l.length=
0);0>l.position&&(l.position=0);0>l.strength&&(l.strength=0);-1<b&&l.line>b-1&&(l.line=b-1);-1<f&&l.length>f&&(l.length=f);-1<a&&l.position>a&&(l.position=a-l.length);-1<a&&l.position+l.length>a&&(l.length=a-l.position);-1<a&&l.position+l.length>a&&(l.position=a-l.length);1<l.strength&&(l.strength=1);var w=0;if(void 0==g)for(;void 0!=d[w];)w++;else w=g;d[w]=JSON.parse(JSON.stringify(l));l=[{signalID:w,line:l.line,position:l.position,strength:l.strength},{signalID:w,line:l.line,position:l.position+
l.length,strength:0}];for(g=0;void 0!=c[g];)g++;c[g]=l[0];e[w]=[g];void 0==k[l[0].position]?k[l[0].position]=[g]:k[l[0].position].push(g);for(h.push(l[0].position);void 0!=c[g];)g++;c[g]=l[1];e[w]=e[w].concat(g);void 0==k[l[1].position]?k[l[1].position]=[g]:k[l[1].position].push(g);h.push(l[1].position);return w}};this.remove=function(a){if(void 0!=d[a]){delete d[a];for(var b=0;b<e[a].length;b++){var f=e[a][b];k[c[f].position].splice(k[c[f].position].indexOf(f),1);h.splice(h.indexOf(c[f].position),
1);0==k[c[f].position].length&&delete k[c[f].position];delete c[f]}delete e[a]}};this.update=function(c,e){void 0!=e&&("line"in e||(e.line=d[c].line),-1<a&&("position"in e&&"length"in e?e.length+e.position>a&&(e.length=a-e.position):("position"in e?d[c].length+e.position>=a&&(e.position=a-d[c].length):e.position=d[c].position,"length"in e?e.length+e.position>a&&(e.length=a-e.position):e.length=d[c].length)),"strength"in e||(e.strength=d[c].strength),this.remove(c),this.add(e,c))};this.reset=function(){d=
[];g=[];c=[];e=[];k={};h=[]}}};workspace.library.audio=new function(){this.context=new (window.AudioContext||window.webkitAudioContext);this.changeAudioParam=function(a,c,e,b,d,f){f=void 0===f?!0:f;if(null==e)return c.value;f&&c.cancelScheduledValues(a.currentTime);try{switch(d){case "linear":c.linearRampToValueAtTime(e,a.currentTime+b);break;case "exponential":console.warn("2018-4-18 - changeAudioParam:exponential doesn't work on chrome");0==e&&(e=1E-4);c.exponentialRampToValueAtTime(e,a.currentTime+
b);break;case "s":for(var k=e-c.value,h=workspace.library.math.curveGenerator.s(10),l=0;l<h.length;l++)h[l]=c.value+h[l]*k;c.setValueCurveAtTime(new Float32Array(h),a.currentTime,b);break;default:c.setTargetAtTime(e,a.currentTime,.001)}}catch(q){console.log("could not change param (possibly due to an overlap, or bad target value)"),console.log("audioParam:",c,"target:",e,"time:",b,"curve:",d,"cancelScheduledValues:",f),console.log(q)}};this.loadAudioFile=function(a,c,e){e=void 0===e?"":e;switch(void 0===
c?"file":c){case "url":c=new XMLHttpRequest;c.open("GET",e,!0);c.responseType="arraybuffer";c.onload=function(){workspace.library.audio.context.decodeAudioData(this.response,function(c){a({buffer:c,name:e.split("/").pop(),duration:c.duration})},function(c){console.warn("Error with decoding audio data"+c.err)})};c.send();break;default:var b=document.createElement("input");b.type="file";b.onchange=function(){var c=this.files[0],e=new FileReader;e.readAsArrayBuffer(c);e.onload=function(e){workspace.library.audio.context.decodeAudioData(e.target.result,
function(e){a({buffer:e,name:c.name,duration:e.duration})});b.remove()}};document.body.appendChild(b);b.click()}};this.waveformSegment=function(a,c,e){c=void 0===c?{start:0,end:1}:c;e=void 0===e?1E4:e;var b=a.getChannelData(0);c.start=c.start?c.start:0;c.end=c.end?c.end:1;var d=a.length*c.start;a=a.length*c.end;e=(a-d)/e;for(c=[];d<a;d+=Math.round(e))c.push(workspace.library.math.largestValueFound(b.slice(d,d+Math.round(e))));return c};this.loadBuffer=function(a,c,e,b){a=a.createBufferSource();a.buffer=
c;a.connect(e);a.onended=b;return a};this.destination=this.context.createGain();this.destination.connect(this.context.destination);this.destination._gain=1;this.destination.masterGain=function(a){if(void 0==a)return this.destination._gain;this._gain=a;workspace.library.audio.changeAudioParam(workspace.library.audio.context,this.gain,this._gain,.01,"instant",!0)};this.names_frequencies_split={0:{C:16.35,"C#":17.32,D:18.35,"D#":19.45,E:20.6,F:21.83,"F#":23.12,G:24.5,"G#":25.96,A:27.5,"A#":29.14,B:30.87},
1:{C:32.7,"C#":34.65,D:36.71,"D#":38.89,E:41.2,F:43.65,"F#":46.25,G:49,"G#":51.91,A:55,"A#":58.27,B:61.74},2:{C:65.41,"C#":69.3,D:73.42,"D#":77.78,E:82.41,F:87.31,"F#":92.5,G:98,"G#":103.8,A:110,"A#":116.5,B:123.5},3:{C:130.8,"C#":138.6,D:146.8,"D#":155.6,E:164.8,F:174.6,"F#":185,G:196,"G#":207.7,A:220,"A#":233.1,B:246.9},4:{C:261.6,"C#":277.2,D:293.7,"D#":311.1,E:329.6,F:349.2,"F#":370,G:392,"G#":415.3,A:440,"A#":466.2,B:493.9},5:{C:523.3,"C#":554.4,D:587.3,"D#":622.3,E:659.3,F:698.5,"F#":740,G:784,
"G#":830.6,A:880,"A#":932.3,B:987.8},6:{C:1047,"C#":1109,D:1175,"D#":1245,E:1319,F:1397,"F#":1480,G:1568,"G#":1661,A:1760,"A#":1865,B:1976},7:{C:2093,"C#":2217,D:2349,"D#":2489,E:2637,F:2794,"F#":2960,G:3136,"G#":3322,A:3520,"A#":3729,B:3951},8:{C:4186,"C#":4435,D:4699,"D#":4978,E:5274,F:5588,"F#":5920,G:6272,"G#":6645,A:7040,"A#":7459,B:7902}};this.names_frequencies={};for(var a=Object.entries(this.names_frequencies_split),b=0;b<a.length;b++)for(var f=Object.entries(this.names_frequencies_split[b]),
d=0;d<f.length;d++)this.names_frequencies[a[b][0]+f[d][0]]=f[d][1];this.frequencies_names={};a=Object.entries(this.names_frequencies);for(b=0;b<a.length;b++)this.frequencies_names[a[b][1]]=a[b][0];a="0C 0C# 0D 0D# 0E 0F 0F# 0G 0G# 0A 0A# 0B 1C 1C# 1D 1D# 1E 1F 1F# 1G 1G# 1A 1A# 1B 2C 2C# 2D 2D# 2E 2F 2F# 2G 2G# 2A 2A# 2B 3C 3C# 3D 3D# 3E 3F 3F# 3G 3G# 3A 3A# 3B 4C 4C# 4D 4D# 4E 4F 4F# 4G 4G# 4A 4A# 4B 5C 5C# 5D 5D# 5E 5F 5F# 5G 5G# 5A 5A# 5B 6C 6C# 6D 6D# 6E 6F 6F# 6G 6G# 6A 6A# 6B 7C 7C# 7D 7D# 7E 7F 7F# 7G 7G# 7A 7A# 7B 8C 8C# 8D 8D# 8E 8F 8F# 8G 8G# 8A 8A# 8B".split(" ");
this.midinumbers_names={};for(b=0;b<a.length;b++)this.midinumbers_names[b+24]=a[b];this.names_midinumbers={};a=Object.entries(this.midinumbers_names);for(b=0;b<a.length;b++)this.names_midinumbers[a[b][1]]=parseInt(a[b][0]);this.num2name=function(a){return this.midinumbers_names[a]};this.num2freq=function(a){return this.names_frequencies[this.midinumbers_names[a]]};this.name2num=function(a){return this.names_midinumbers[a]};this.name2freq=function(a){return this.names_frequencies[a]};this.freq2num=
function(a){return this.names_midinumbers[this.frequencies_names[a]]};this.freq2name=function(a){return this.frequencies_names[a]}};workspace.library.misc=new function(){this.blendColours=function(a,b,f){function d(c){c=c.split(",");c[0]=c[0].replace("rgba(","");c[3]=c[3].replace(")","");return c.map(function(c){return parseFloat(c)})}a=d(a);b=d(b);for(var g=[],c=0;c<a.length;c++)g[c]=(1-f)*a[c]+f*b[c];return"rgba("+g[0]+","+g[1]+","+g[2]+","+g[3]+")"};this.multiBlendColours=function(a,b){if(0==b)return a[0];
if(1==b)return a[a.length-1];b*=a.length-1;return workspace.library.misc.blendColours(a[~~b],a[~~b+1],b%1)};this.padString=function(a,b,f){f=void 0===f?" ":f;if(1>f.length)return a;for(a=""+a;a.length<b;)a=f+a;return a};this.compressString=function(a){return workspace.library.thirdparty.lzString.compress(a)};this.decompressString=function(a){return workspace.library.thirdparty.lzString.decompress(a)};this.serialize=function(a,b){b=void 0===b?!0:b;a=JSON.stringify(a,function(a,b){switch({}.toString.call(b).match(/\s([a-zA-Z]+)/)[1].toLowerCase()){case "function":return{__uniqueType:"function",
__value:b.toString(),__name:b.name};case "arraybuffer":return{__uniqueType:"arraybuffer",__value:btoa(String.fromCharCode(new Uint8Array(b)))};case "audiobuffer":a=[];for(var d=0;d<b.numberOfChannels;d++)a.push(Array.from(b.getChannelData(d)));return{__uniqueType:"audiobuffer",__channelData:a,__sampleRate:b.sampleRate,__numberOfChannels:b.numberOfChannels,__length:b.length};default:return b}});b&&(a=workspace.library.misc.compressString(a));return a};this.unserialize=function(a,b){if(void 0!==a)return(void 0===
b||b)&&(a=workspace.library.misc.decompressString(a)),JSON.parse(a,function(a,b){if("object"==typeof b&&null!=b&&"__uniqueType"in b)switch(b.__uniqueType){case "function":a=b.__value.substring(0,b.__value.indexOf("{"));a=a.substring(a.indexOf("(")+1,a.lastIndexOf(")"));b=b.__value.substring(b.__value.indexOf("{")+1,b.__value.lastIndexOf("}"));b=Function(a,b);break;case "arraybuffer":b=atob(b.__value);for(a=0;a<b.length;a++)b[a]=b[a].charCodeAt(0);b=new ArrayBuffer(b);break;case "audiobuffer":var d=
workspace.library.audio.context.createBuffer(b.__numberOfChannels,b.__length,b.__sampleRate);for(a=0;a<d.numberOfChannels;a++){workingBuffer=d.getChannelData(a);for(var c=0;c<d.length;c++)workingBuffer[c]=b.__channelData[a][c]}b=d;break;default:b=b.__value}return b})};this.openFile=function(a,b){b=void 0===b?"readAsBinaryString":b;var f=document.createElement("input");f.type="file";f.onchange=function(){var d=new FileReader;switch(b){case "readAsArrayBuffer":d.readAsArrayBuffer(this.files[0]);break;
default:d.readAsBinaryString(this.files[0])}d.onloadend=function(){a&&a(d.result)}};f.click()};this.printFile=function(a,b){var f=document.createElement("a");f.href=URL.createObjectURL(new Blob([b]));f.download=a;f.click()}};workspace.library.thirdparty=new function(){this.lzString=function(){var a=String.fromCharCode,b={},f={compress:function(a){return null==a?"":f._compress(a,6,function(a){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$".charAt(a)})},decompress:function(a){if(null==
a)return"";if(""==a)return null;a=a.replace(/ /g,"+");return f._decompress(a.length,32,function(d){d=a.charAt(d);if(!b["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$"]){b["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$"]={};for(var c=0;65>c;c++)b["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$"]["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$".charAt(c)]=c}return b["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$"][d]})},
_compress:function(a,b,c){if(null==a)return"";var e,d={},f={},l="",g=2,u=3,n=2,q=[],m=0,p=0,t;for(t=0;t<a.length;t+=1){var v=a.charAt(t);Object.prototype.hasOwnProperty.call(d,v)||(d[v]=u++,f[v]=!0);var x=l+v;if(Object.prototype.hasOwnProperty.call(d,x))l=x;else{if(Object.prototype.hasOwnProperty.call(f,l)){if(256>l.charCodeAt(0)){for(e=0;e<n;e++)m<<=1,p==b-1?(p=0,q.push(c(m)),m=0):p++;var r=l.charCodeAt(0);for(e=0;8>e;e++)m=m<<1|r&1,p==b-1?(p=0,q.push(c(m)),m=0):p++,r>>=1}else{r=1;for(e=0;e<n;e++)m=
m<<1|r,p==b-1?(p=0,q.push(c(m)),m=0):p++,r=0;r=l.charCodeAt(0);for(e=0;16>e;e++)m=m<<1|r&1,p==b-1?(p=0,q.push(c(m)),m=0):p++,r>>=1}g--;0==g&&(g=Math.pow(2,n),n++);delete f[l]}else for(r=d[l],e=0;e<n;e++)m=m<<1|r&1,p==b-1?(p=0,q.push(c(m)),m=0):p++,r>>=1;g--;0==g&&(g=Math.pow(2,n),n++);d[x]=u++;l=String(v)}}if(""!==l){if(Object.prototype.hasOwnProperty.call(f,l)){if(256>l.charCodeAt(0)){for(e=0;e<n;e++)m<<=1,p==b-1?(p=0,q.push(c(m)),m=0):p++;r=l.charCodeAt(0);for(e=0;8>e;e++)m=m<<1|r&1,p==b-1?(p=0,
q.push(c(m)),m=0):p++,r>>=1}else{r=1;for(e=0;e<n;e++)m=m<<1|r,p==b-1?(p=0,q.push(c(m)),m=0):p++,r=0;r=l.charCodeAt(0);for(e=0;16>e;e++)m=m<<1|r&1,p==b-1?(p=0,q.push(c(m)),m=0):p++,r>>=1}g--;0==g&&(g=Math.pow(2,n),n++);delete f[l]}else for(r=d[l],e=0;e<n;e++)m=m<<1|r&1,p==b-1?(p=0,q.push(c(m)),m=0):p++,r>>=1;g--;0==g&&n++}r=2;for(e=0;e<n;e++)m=m<<1|r&1,p==b-1?(p=0,q.push(c(m)),m=0):p++,r>>=1;for(;;)if(m<<=1,p==b-1){q.push(c(m));break}else p++;return q.join("")},_decompress:function(b,f,c){var e=[],
d=4,h=4,l=3,g=[],u,n,q=c(0),m=f,p=1;for(u=0;3>u;u+=1)e[u]=u;var t=0;var v=Math.pow(2,2);for(n=1;n!=v;){var x=q&m;m>>=1;0==m&&(m=f,q=c(p++));t|=(0<x?1:0)*n;n<<=1}switch(t){case 0:t=0;v=Math.pow(2,8);for(n=1;n!=v;)x=q&m,m>>=1,0==m&&(m=f,q=c(p++)),t|=(0<x?1:0)*n,n<<=1;var r=a(t);break;case 1:t=0;v=Math.pow(2,16);for(n=1;n!=v;)x=q&m,m>>=1,0==m&&(m=f,q=c(p++)),t|=(0<x?1:0)*n,n<<=1;r=a(t);break;case 2:return""}u=e[3]=r;for(g.push(r);;){if(p>b)return"";t=0;v=Math.pow(2,l);for(n=1;n!=v;)x=q&m,m>>=1,0==m&&
(m=f,q=c(p++)),t|=(0<x?1:0)*n,n<<=1;switch(r=t){case 0:t=0;v=Math.pow(2,8);for(n=1;n!=v;)x=q&m,m>>=1,0==m&&(m=f,q=c(p++)),t|=(0<x?1:0)*n,n<<=1;e[h++]=a(t);r=h-1;d--;break;case 1:t=0;v=Math.pow(2,16);for(n=1;n!=v;)x=q&m,m>>=1,0==m&&(m=f,q=c(p++)),t|=(0<x?1:0)*n,n<<=1;e[h++]=a(t);r=h-1;d--;break;case 2:return g.join("")}0==d&&(d=Math.pow(2,l),l++);if(e[r])r=e[r];else if(r===h)r=u+u.charAt(0);else return null;g.push(r);e[h++]=u+r.charAt(0);d--;u=r;0==d&&(d=Math.pow(2,l),l++)}}};return f}()};workspace.core=
new function(){var a=new function(){function a(a){for(var c=[];void 0!=(a=a.parent);)c.unshift({x:a.x,y:a.y,a:a.angle});a={x:void 0!=c[0]?c[0].x:0,y:void 0!=c[0]?c[0].y:0,a:void 0!=c[0]?c[0].a:0};for(var b=1;b<c.length;b++){var d=workspace.library.math.cartesianAngleAdjust(c[b].x,c[b].y,c[b-1].a);a.a+=c[b].a;a.x+=d.x;a.y+=d.y}return a}var f=this,d=new function(){this.length=function(a){return a*f.viewport.scale()};this.windowPoint2workspacePoint=function(a,e){var c=f.viewport.position(),b=f.viewport.scale()/
window.devicePixelRatio,d=f.viewport.angle();a=a/b-c.x;e=e/b-c.y;return workspace.library.math.cartesianAngleAdjust(a,e,-d)};this.workspacePoint2windowPoint=function(a,e){var c=f.viewport.position(),b=f.viewport.scale(),d=f.viewport.angle();a=workspace.library.math.cartesianAngleAdjust(a,e,d);return{x:(a.x+c.x)*b,y:(a.y+c.y)*b}}},g=new function(){this.polygon=function(){this.type="polygon";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};
this.points=[];this.style={fill:"rgba(100,255,255,1)",stroke:"rgba(0,0,0,0)",lineWidth:1,lineJoin:"round",miterLimit:2,shadowColour:"rgba(0,0,0,0)",shadowBlur:20,shadowOffset:{x:20,y:20}};this.parameter={};this.parameter.points=function(a){return function(c){if(void 0==c)return a.points;a.points=c;a.computeExtremities()}}(this);this.getAddress=function(){var a="",e=this;do a=e.name+"/"+a;while(void 0!=(e=e.parent));return"/"+a};this.computeExtremities=function(c){for(var e=this._static,b=this;void 0!=
(b=b.parent)&&!e;)e=e||b._static;this._static=e;c=void 0==c?a(this):c;this.extremities={points:[],boundingBox:{}};this.extremities.points=this.points.map(function(a){a=workspace.library.math.cartesianAngleAdjust(a.x,a.y,c.a);a.x+=c.x;a.y+=c.y;return a});this.extremities.boundingBox=workspace.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(a,e){if(void 0==this.extremities.boundingBox){console.warn("the shape",
this,"has no bounding box");var c=!1}else c=workspace.library.math.detectOverlap.pointWithinBoundingBox({x:a,y:e},this.extremities.boundingBox);return c?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),a=!1):a=workspace.library.math.detectOverlap.pointWithinPoly({x:a,y:e},this.extremities.points),a):!1};this.render=function(a,e,b,h){e=void 0===e?{x:0,y:0,a:0}:e;b=void 0===b?!1:b;h=void 0===h?!1:h;var c=this._static?!0:workspace.library.math.detectOverlap.boundingBoxes(f.viewport.getBoundingBox(),
this.extremities.boundingBox);if(c){c=this.points.map(function(a){a=workspace.library.math.cartesianAngleAdjust(a.x,a.y,e.a);return{x:a.x+e.x,y:a.y+e.y}});var k=this.style.lineWidth,g=this.style.shadowBlur,n=this.style.shadowOffset.x,q=this.style.shadowOffset.y;b||(c=c.map(function(a){return d.workspacePoint2windowPoint(a.x,a.y)}),k=d.length(k),g=d.length(g),n=d.length(n),q=d.length(q));if(h){h=new Path2D;h.moveTo(c[0].x,c[0].y);for(b=1;b<c.length;b++)h.lineTo(c[b].x,c[b].y);a.clip(h)}else{a.fillStyle=
this.style.fill;a.strokeStyle=this.style.stroke;a.lineWidth=k;a.lineJoin=this.style.lineJoin;a.miterLimit=this.style.miterLimit;a.shadowColor=this.style.shadowColour;a.shadowBlur=g;a.shadowOffsetX=n;a.shadowOffsetY=q;a.beginPath();a.moveTo(c[0].x,c[0].y);for(b=1;b<c.length;b++)a.lineTo(c[b].x,c[b].y);a.closePath();a.fill();a.stroke();if(this.dotFrame){for(b=0;b<this.extremities.points.length;b++)a=d.workspacePoint2windowPoint(this.extremities.points[b].x,this.extremities.points[b].y),f.render.drawDot(a.x,
a.y,4,"rgba(50,50,50,1)");a=d.workspacePoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);f.render.drawDot(a.x,a.y);a=d.workspacePoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);f.render.drawDot(a.x,a.y)}}}}};this.circle=function(){this.type="circle";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.y=this.x=0;this.r=2;this.style=
{fill:"rgba(255,100,255,1)",stroke:"rgba(0,0,0,0)",lineWidth:1,shadowColour:"rgba(0,0,0,0)",shadowBlur:2,shadowOffset:{x:1,y:1}};this.parameter={};this.parameter.x=function(a){return function(c){if(void 0==c)return a.x;a.x=c;a.computeExtremities()}}(this);this.parameter.y=function(a){return function(c){if(void 0==c)return a.y;a.y=c;a.computeExtremities()}}(this);this.parameter.r=function(a){return function(c){if(void 0==c)return a.r;a.r=c;a.computeExtremities()}}(this);this.getAddress=function(){var a=
"",e=this;do a=e.name+"/"+a;while(void 0!=(e=e.parent));return"/"+a};this.computeExtremities=function(c){for(var e=this._static,b=this;void 0!=(b=b.parent)&&!e;)e=e||b._static;this._static=e;c=void 0==c?a(this):c;this.extremities={points:[],boundingBox:{},origin:{}};point=workspace.library.math.cartesianAngleAdjust(this.x,this.y,c.a);this.extremities.origin={x:this.x+c.x,y:this.y+c.y};this.extremities.points=workspace.library.math.pointsOfCircle(this.x,this.y,this.r,10);this.extremities.points=this.extremities.points.map(function(a){a=
workspace.library.math.cartesianAngleAdjust(a.x,a.y,c.a);a.x+=c.x;a.y+=c.y;return a});this.extremities.boundingBox=workspace.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(a,e){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var c=!1}else c=workspace.library.math.detectOverlap.pointWithinBoundingBox({x:a,y:e},this.extremities.boundingBox);return c?workspace.library.math.distanceBetweenTwoPoints({x:a,
y:e},{x:this.x+this.extremities.origin.x,y:this.y+this.extremities.origin.y})<=this.r:!1};this.render=function(a,e,b,h){e=void 0===e?{x:0,y:0,a:0}:e;b=void 0===b?!1:b;h=void 0===h?!1:h;var c=this._static?!0:workspace.library.math.detectOverlap.boundingBoxes(f.viewport.getBoundingBox(),this.extremities.boundingBox);if(c){c=workspace.library.math.cartesianAngleAdjust(this.x,this.y,e.a);e.x+=c.x-this.x;e.y+=c.y-this.y;e={x:this.x+e.x,y:this.y+e.y};c=this.r;var k=this.style.lineWidth,g=this.style.shadowBlur,
n=this.style.shadowOffset.x,q=this.style.shadowOffset.y;b||(e=d.workspacePoint2windowPoint(e.x,e.y),c=d.length(c),k=d.length(k),g=d.length(g),n=d.length(n),q=d.length(q));if(h)b=new Path2D,b.arc(e.x,e.y,c,0,2*Math.PI,!1),a.clip(b);else if(a.fillStyle=this.style.fill,a.strokeStyle=this.style.stroke,a.lineWidth=k,a.shadowColor=this.style.shadowColour,a.shadowBlur=g,a.shadowOffsetX=n,a.shadowOffsetY=q,a.beginPath(),a.arc(e.x,e.y,c,0,2*Math.PI,!1),a.closePath(),a.fill(),a.stroke(),this.dotFrame){for(a=
0;a<this.extremities.points.length;a++)b=d.workspacePoint2windowPoint(this.extremities.points[a].x,this.extremities.points[a].y),f.render.drawDot(b.x,b.y,4,"rgba(50,50,50,1)");b=d.workspacePoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);f.render.drawDot(b.x,b.y);b=d.workspacePoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);f.render.drawDot(b.x,b.y);b=d.workspacePoint2windowPoint(this.extremities.origin.x,
this.extremities.origin.y);f.render.drawDot(b.x,b.y)}}}};this.canvas=function(){this.type="canvas";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.angle=this.y=this.x=0;this.anchor={x:0,y:0};this.height=this.width=10;var c=document.createElement("canvas"),e=1;var b=c.getContext("2d",{alpha:!1});c.setAttribute("width",this.width*e);c.setAttribute("height",this.height*e);this.parameter={};this.parameter.x=function(a){return function(c){if(void 0==
c)return a.x;a.x=c;a.computeExtremities()}}(this);this.parameter.y=function(a){return function(c){if(void 0==c)return a.y;a.y=c;a.computeExtremities()}}(this);this.parameter.angle=function(a){return function(c){if(void 0==c)return a.angle;a.angle=c;a.computeExtremities()}}(this);this.parameter.anchor=function(a){return function(c){if(void 0==c)return a.anchor;a.anchor=c;a.computeExtremities()}}(this);this.parameter.width=function(a){return function(b){if(void 0==b)return a.width;a.width=b;a.computeExtremities();
c.setAttribute("width",a.width*e)}}(this);this.parameter.height=function(a){return function(b){if(void 0==b)return a.height;a.height=b;a.computeExtremities();c.setAttribute("height",a.height*e)}}(this);this.resolution=function(a){if(void 0==a)return e;e=a;c.setAttribute("width",this.width*e);c.setAttribute("height",this.height*e)};this._=b;this.$=function(a){return a*e};this.getAddress=function(){var a="",c=this;do a=c.name+"/"+a;while(void 0!=(c=c.parent));return"/"+a};this.computeExtremities=function(c){for(var e=
this._static,b=this;void 0!=(b=b.parent)&&!e;)e=e||b._static;this._static=e;c=void 0==c?a(this):c;this.extremities={points:[],boundingBox:{}};this.extremities.points=workspace.library.math.pointsOfRect(this.x,this.y,this.width,this.height,-this.angle,this.anchor);this.extremities.points=this.extremities.points.map(function(a){a=workspace.library.math.cartesianAngleAdjust(a.x,a.y,c.a);a.x+=c.x;a.y+=c.y;return a});this.extremities.boundingBox=workspace.library.math.boundingBoxFromPoints(this.extremities.points);
void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(a,c){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var e=!1}else e=workspace.library.math.detectOverlap.pointWithinBoundingBox({x:a,y:c},this.extremities.boundingBox);return e?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),a=!1):a=workspace.library.math.detectOverlap.pointWithinPoly({x:a,y:c},this.extremities.points),a):!1};this.render=
function(a,e,b){e=void 0===e?{x:0,y:0,a:0}:e;b=void 0===b?!1:b;var k=this._static?!0:workspace.library.math.detectOverlap.boundingBoxes(f.viewport.getBoundingBox(),this.extremities.boundingBox);if(k){k=workspace.library.math.cartesianAngleAdjust(this.x,this.y,e.a);e.x+=k.x-this.x;e.y+=k.y-this.y;k={x:this.x+e.x,y:this.y+e.y};e=this.angle+e.a;var l=this.width,h=this.height;b||(k=d.workspacePoint2windowPoint(k.x-this.anchor.x*l,k.y-this.anchor.y*h),l=d.length(l),h=d.length(h));k=workspace.library.math.cartesianAngleAdjust(k.x,
k.y,-e);a.save();a.rotate(e);a.drawImage(c,k.x,k.y,l,h);a.restore();if(this.dotFrame){for(a=0;a<this.extremities.points.length;a++)b=d.workspacePoint2windowPoint(this.extremities.points[a].x,this.extremities.points[a].y),f.render.drawDot(b.x,b.y,4,"rgba(50,50,50,1)");b=d.workspacePoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);f.render.drawDot(b.x,b.y);b=d.workspacePoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);
f.render.drawDot(b.x,b.y)}}}};this.image=function(){this.type="image";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.angle=this.y=this.x=0;this.anchor={x:0,y:0};this.height=this.width=10;this.url="";var c={};this.style={shadowColour:"rgba(0,0,0,0)",shadowBlur:2,shadowOffset:{x:1,y:1}};this.parameter={};this.parameter.x=function(a){return function(c){if(void 0==c)return a.x;a.x=c;a.computeExtremities()}}(this);this.parameter.y=
function(a){return function(c){if(void 0==c)return a.y;a.y=c;a.computeExtremities()}}(this);this.parameter.angle=function(a){return function(c){if(void 0==c)return a.angle;a.angle=c;a.computeExtremities()}}(this);this.parameter.anchor=function(a){return function(c){if(void 0==c)return a.anchor;a.anchor=c;a.computeExtremities()}}(this);this.parameter.width=function(a){return function(c){if(void 0==c)return a.width;a.width=c;a.computeExtremities()}}(this);this.parameter.height=function(a){return function(c){if(void 0==
c)return a.height;a.height=c;a.computeExtremities()}}(this);this.getAddress=function(){var a="",c=this;do a=c.name+"/"+a;while(void 0!=(c=c.parent));return"/"+a};this.computeExtremities=function(c){for(var e=this._static,b=this;void 0!=(b=b.parent)&&!e;)e=e||b._static;this._static=e;c=void 0==c?a(this):c;this.extremities={points:[],boundingBox:{}};this.extremities.points=workspace.library.math.pointsOfRect(this.x,this.y,this.width,this.height,-this.angle,this.anchor);this.extremities.points=this.extremities.points.map(function(a){a=
workspace.library.math.cartesianAngleAdjust(a.x,a.y,c.a);a.x+=c.x;a.y+=c.y;return a});this.extremities.boundingBox=workspace.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(a,c){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var e=!1}else e=workspace.library.math.detectOverlap.pointWithinBoundingBox({x:a,y:c},this.extremities.boundingBox);return e?(void 0==
this.extremities.points?(console.warn("the shape",this,"has no points"),a=!1):a=workspace.library.math.detectOverlap.pointWithinPoly({x:a,y:c},this.extremities.points),a):!1};this.render=function(a,b,h){b=void 0===b?{x:0,y:0,a:0}:b;h=void 0===h?!1:h;var e=this._static?!0:workspace.library.math.detectOverlap.boundingBoxes(f.viewport.getBoundingBox(),this.extremities.boundingBox);if(e){e=workspace.library.math.cartesianAngleAdjust(this.x,this.y,b.a);b.x+=e.x-this.x;b.y+=e.y-this.y;e={x:this.x+b.x,y:this.y+
b.y};b=this.angle+b.a;var k=this.width,g=this.height;h||(e=d.workspacePoint2windowPoint(e.x-this.anchor.x*k,e.y-this.anchor.y*g),k=d.length(k),g=d.length(g));e=workspace.library.math.cartesianAngleAdjust(e.x,e.y,-b);c.hasOwnProperty(this.url)||(c[this.url]=new Image,c[this.url].src=this.url);a.save();a.rotate(b);a.drawImage(c[this.url],e.x,e.y,k,g);a.restore();if(this.dotFrame){for(a=0;a<this.extremities.points.length;a++)h=d.workspacePoint2windowPoint(this.extremities.points[a].x,this.extremities.points[a].y),
f.render.drawDot(h.x,h.y,4,"rgba(50,50,50,1)");h=d.workspacePoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);f.render.drawDot(h.x,h.y);h=d.workspacePoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);f.render.drawDot(h.x,h.y)}}}};this.path=function(){this.type="path";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.points=
[];this.style={stroke:"rgba(0,0,0,0)",lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:2,shadowColour:"rgba(0,0,0,0)",shadowBlur:20,shadowOffset:{x:20,y:20}};this.parameter={};this.parameter.points=function(a){return function(c){if(void 0==c)return a.points;a.points=c;a.computeExtremities()}}(this);this.getAddress=function(){var a="",b=this;do a=b.name+"/"+a;while(void 0!=(b=b.parent));return"/"+a};this.computeExtremities=function(c){for(var b=this._static,d=this;void 0!=(d=d.parent)&&!b;)b=
b||d._static;this._static=b;c=void 0==c?a(this):c;this.extremities={points:[],boundingBox:{}};this.extremities.points=this.points.map(function(a){a=workspace.library.math.cartesianAngleAdjust(a.x,a.y,c.a);a.x+=c.x;a.y+=c.y;return a});this.extremities.boundingBox=workspace.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(a,b){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");
var c=!1}else c=workspace.library.math.detectOverlap.pointWithinBoundingBox({x:a,y:b},this.extremities.boundingBox);return c?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),a=!1):a=workspace.library.math.detectOverlap.pointWithinPoly({x:a,y:b},this.extremities.points),a):!1};this.render=function(a,b,k){b=void 0===b?{x:0,y:0,a:0}:b;k=void 0===k?!1:k;var c=this._static?!0:workspace.library.math.detectOverlap.boundingBoxes(f.viewport.getBoundingBox(),this.extremities.boundingBox);
if(c){c=this.points.map(function(a){a=workspace.library.math.cartesianAngleAdjust(a.x,a.y,b.a);return{x:a.x+b.x,y:a.y+b.y}});var e=this.style.lineWidth,g=this.style.shadowBlur,u=this.style.shadowOffset.x,n=this.style.shadowOffset.y;k||(c=c.map(function(a){return d.workspacePoint2windowPoint(a.x,a.y)}),e=d.length(e),g=d.length(g),u=d.length(u),n=d.length(n));a.fillStyle=this.style.fill;a.strokeStyle=this.style.stroke;a.lineWidth=e;a.lineCap=this.style.lineCap;a.lineJoin=this.style.lineJoin;a.miterLimit=
this.style.miterLimit;a.shadowColor=this.style.shadowColour;a.shadowBlur=g;a.shadowOffsetX=u;a.shadowOffsetY=n;a.beginPath();a.moveTo(c[0].x,c[0].y);for(k=1;k<c.length;k++)a.lineTo(c[k].x,c[k].y);a.stroke();if(this.dotFrame){for(k=0;k<this.extremities.points.length;k++)a=d.workspacePoint2windowPoint(this.extremities.points[k].x,this.extremities.points[k].y),f.render.drawDot(a.x,a.y,4,"rgba(50,50,50,1)");a=d.workspacePoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);
f.render.drawDot(a.x,a.y);a=d.workspacePoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);f.render.drawDot(a.x,a.y)}}}};this.rectangle=function(){this.type="rectangle";this.name="";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.angle=this.y=this.x=0;this.anchor={x:0,y:0};this.height=this.width=10;this.style={fill:"rgba(255,100,255,1)",stroke:"rgba(0,0,0,0)",lineWidth:1,shadowColour:"rgba(0,0,0,0)",
shadowBlur:2,shadowOffset:{x:1,y:1}};this.parameter={};this.parameter.x=function(a){return function(c){if(void 0==c)return a.x;a.x=c;a.computeExtremities()}}(this);this.parameter.y=function(a){return function(c){if(void 0==c)return a.y;a.y=c;a.computeExtremities()}}(this);this.parameter.angle=function(a){return function(c){if(void 0==c)return a.angle;a.angle=c;a.computeExtremities()}}(this);this.parameter.anchor=function(a){return function(c){if(void 0==c)return a.anchor;a.anchor=c;a.computeExtremities()}}(this);
this.parameter.width=function(a){return function(c){if(void 0==c)return a.width;a.width=c;a.computeExtremities()}}(this);this.parameter.height=function(a){return function(c){if(void 0==c)return a.height;a.height=c;a.computeExtremities()}}(this);this.getAddress=function(){var a="",b=this;do a=b.name+"/"+a;while(void 0!=(b=b.parent));return"/"+a};this.getOffset=function(){return a(this)};this.computeExtremities=function(c,b){b=this._static;for(var e=this;void 0!=(e=e.parent)&&!b;)b=b||e._static;this._static=
b;c=void 0==c?a(this):c;this.extremities={points:[],boundingBox:{}};this.extremities.points=workspace.library.math.pointsOfRect(this.x,this.y,this.width,this.height,-this.angle,this.anchor);this.extremities.points=this.extremities.points.map(function(a){a=workspace.library.math.cartesianAngleAdjust(a.x,a.y,c.a);a.x+=c.x;a.y+=c.y;return a});this.extremities.boundingBox=workspace.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=
function(a,b){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var c=!1}else c=workspace.library.math.detectOverlap.pointWithinBoundingBox({x:a,y:b},this.extremities.boundingBox);return c?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),a=!1):a=workspace.library.math.detectOverlap.pointWithinPoly({x:a,y:b},this.extremities.points),a):!1};this.render=function(a,b,k,g){b=void 0===b?{x:0,y:0,a:0}:b;k=void 0===k?!1:k;g=void 0===
g?!1:g;var c=this._static?!0:workspace.library.math.detectOverlap.boundingBoxes(f.viewport.getBoundingBox(),this.extremities.boundingBox);if(c){c=workspace.library.math.cartesianAngleAdjust(this.x,this.y,b.a);b.x+=c.x-this.x;b.y+=c.y-this.y;c={x:this.x+b.x,y:this.y+b.y};b=this.angle+b.a;var e=this.width,h=this.height,n=this.style.lineWidth,q=this.style.shadowBlur,m=this.style.shadowOffset.x,p=this.style.shadowOffset.y;k||(c=d.workspacePoint2windowPoint(c.x-this.anchor.x*e,c.y-this.anchor.y*h),e=d.length(e),
h=d.length(h),n=d.length(n),q=d.length(q),m=d.length(m),p=d.length(p));c=workspace.library.math.cartesianAngleAdjust(c.x,c.y,-b);if(g)a.rotate(b),k=new Path2D,k.rect(c.x,c.y,e,h),a.clip(k),a.rotate(-b);else if(a.fillStyle=this.style.fill,a.strokeStyle=this.style.stroke,a.lineWidth=n,a.shadowColor=this.style.shadowColour,a.shadowBlur=q,a.shadowOffsetX=m,a.shadowOffsetY=p,a.save(),a.rotate(b),a.fillRect(c.x,c.y,e,h),a.strokeRect(c.x,c.y,e,h),a.restore(),this.dotFrame){for(a=0;a<this.extremities.points.length;a++)k=
d.workspacePoint2windowPoint(this.extremities.points[a].x,this.extremities.points[a].y),f.render.drawDot(k.x,k.y,4,"rgba(50,50,50,1)");k=d.workspacePoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);f.render.drawDot(k.x,k.y);k=d.workspacePoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);f.render.drawDot(k.x,k.y)}}}};this.group=function(){function c(a,c){if(void 0==c)return a.getAddress()+" >> no element provided";
if(void 0==c.name||""==c.name)return a.getAddress()+" >> element has no name";for(var b=0;b<a.children.length;b++)if(a.children[b].name==c.name)return'element with the name "'+c.name+'" already exists in the '+(void 0==parent?"design root":'group "'+a.name+'"')}this.type="group";this.name="";this.clipActive=this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.angle=this.y=this.x=0;this.children=[];this.clippingStencil;this.parameter={};
this.parameter.x=function(a){return function(c){if(void 0==c)return a.x;a.x=c;a.computeExtremities(void 0,!0)}}(this);this.parameter.y=function(a){return function(c){if(void 0==c)return a.y;a.y=c;a.computeExtremities(void 0,!0)}}(this);this.parameter.angle=function(a){return function(c){if(void 0==c)return a.angle;a.angle=c;a.computeExtremities(void 0,!0)}}(this);this.getAddress=function(){var a="",c=this;do a=c.name+"/"+a;while(void 0!=(c=c.parent));return"/"+a};this.clip=function(a){if(void 0==
a)return this.clipActive;this.clipActive=void 0==this.clippingStencil?!1:a;this.computeExtremities()};this.stencil=function(a){if(void 0==a)return this.clippingStencil;this.clippingStencil=a;this.computeExtremities()};this.prepend=function(a){var b=c(this,a);void 0!=b?console.error("element invalid:",b):(this.children.unshift(a),a.parent=this,a.computeExtremities(void 0,!0))};this.append=function(a){var b=c(this,a);void 0!=b?console.error("element invalid:",b):(this.children.push(a),a.parent=this,
a.computeExtremities(void 0,!0))};this.remove=function(a){void 0!=a&&(a=this.children.indexOf(a),0>a||(this.children.splice(a,1),this.computeExtremities()))};this.clear=function(){this.children=[];this.computeExtremities()};this.contains=function(a){for(var c=0;c<this.children.length;c++)if(this.children[c]==a)return!0;return!1};this.getChildByName=function(a){for(var c=0;c<this.children.length;c++)if(this.children[c].name==a)return this.children[c]};this.getElementsWithName=function(a){for(var c=
[],b=0;b<this.children.length;b++)if(this.children[b].name==a&&c.push(this.children[b]),"group"==this.children[b].type)for(var e=this.children[b].getElementsWithName(a),d=0;d<e.length;d++)c.push(e[d]);return c};this.getOffset=function(){return a(this)};this.computeExtremities=function(c,b){b=void 0===b?!1:b;for(var e=void 0==c,d=this._static,f=this;void 0!=(f=f.parent)&&!d;)d=d||f._static;this._static=d;c=void 0==c?a(this):c;if(b)for(b={x:c.x,y:c.y,a:c.a+this.angle},d=workspace.library.math.cartesianAngleAdjust(this.x,
this.y,c.a),b.x+=d.x,b.y+=d.y,d=0;d<this.children.length;d++)this.children[d].computeExtremities(b,!0);this.extremities={points:[],boundingBox:{}};if(this.clipActive)b={x:c.x,y:c.y,a:c.a+this.angle},d=workspace.library.math.cartesianAngleAdjust(this.x,this.y,c.a),b.x+=d.x,b.y+=d.y,this.clippingStencil.computeExtremities(b),this.extremities.points=this.clippingStencil.extremities.points;else{c=[];for(d=0;d<this.children.length;d++)c.push(this.children[d].extremities.boundingBox.topLeft),c.push(this.children[d].extremities.boundingBox.bottomRight);
c=workspace.library.math.boundingBoxFromPoints(c);this.extremities.points=[{x:c.topLeft.x,y:c.topLeft.y},{x:c.bottomRight.x,y:c.topLeft.y},{x:c.bottomRight.x,y:c.bottomRight.y},{x:c.topLeft.x,y:c.bottomRight.y}]}this.extremities.boundingBox=workspace.library.math.boundingBoxFromPoints(this.extremities.points);void 0!=this.parent&&e&&this.parent.computeExtremities()};this.isPointWithin=function(a,c){if(this.clipActive)return this.clippingStencil.isPointWithin(a,c);if(void 0==this.extremities.boundingBox){console.warn("the shape",
this,"has no bounding box");var b=!1}else b=workspace.library.math.detectOverlap.pointWithinBoundingBox({x:a,y:c},this.extremities.boundingBox);return b?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),a=!1):a=workspace.library.math.detectOverlap.pointWithinPoly({x:a,y:c},this.extremities.points),a):!1};this.getElementUnderPoint=function(a,c,b,f){b=void 0===b?!1:b;f=void 0===f?!1:f;for(var e=[],g=this.children.length-1;0<=g;g--){var h=this.children[g]._static||b?d.workspacePoint2windowPoint(a,
c):{x:a,y:c};if(!this.children[g].ignored&&this.children[g].isPointWithin(h.x,h.y))if("group"==this.children[g].type){if(h=this.children[g].getElementUnderPoint(a,c,this.children[g]._static||b,f),void 0!=h)if(f)e=e.concat(h);else return h}else if(f)e.push(this.children[g]);else return this.children[g]}if(f)return e};this.render=function(a,c,b,g){c=void 0===c?{x:0,y:0,a:0}:c;b=void 0===b?!1:b;g=void 0===g?!1:g;a:if(this._static)var e=!0;else{for(e=0;e<this.children.length;e++)if(this.children[e]._static){e=
!0;break a}e=workspace.library.math.detectOverlap.boundingBoxes(f.viewport.getBoundingBox(),this.extremities.boundingBox)}if(e){e=workspace.library.math.cartesianAngleAdjust(this.x,this.y,c.a);c={a:c.a+this.angle,x:c.x+e.x,y:c.y+e.y};if(this.clipActive||g)a.save(),this.clippingStencil.render(a,Object.assign({},c),b||this.clippingStencil._static,g||this.clipActive);for(g=0;g<this.children.length;g++)e=this.children[g],e.render(a,Object.assign({},c),b||e._static);this.clipActive&&a.restore();if(this.dotFrame){for(g=
0;g<this.extremities.points.length;g++)a=d.workspacePoint2windowPoint(this.extremities.points[g].x,this.extremities.points[g].y),f.render.drawDot(a.x,a.y,4,"rgba(50,50,50,1)");a=d.workspacePoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);f.render.drawDot(a.x,a.y);a=d.workspacePoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);f.render.drawDot(a.x,a.y)}}}};this.text=function(){this.type="text";this.name=
"";this._static=this.ignored=!1;this.parent=void 0;this.dotFrame=!1;this.extremities={points:[],boundingBox:{}};this.y=this.x=0;this.text="curve";this.angle=0;this.size=1;this.style={font:"30pt Arial",align:"start",baseline:"alphabetic",fill:"rgba(255,100,100,1)",stroke:"rgba(0,0,0,0)",lineWidth:1,shadowColour:"rgba(0,0,0,0)",shadowBlur:2,shadowOffset:{x:20,y:20}};this.parameter={};this.parameter.x=function(a){return function(c){if(void 0==c)return a.x;a.x=c;a.computeExtremities()}}(this);this.parameter.y=
function(a){return function(c){if(void 0==c)return a.y;a.y=c;a.computeExtremities()}}(this);this.parameter.angle=function(a){return function(c){if(void 0==c)return a.angle;a.angle=c;a.computeExtremities()}}(this);this.parameter.size=function(a){return function(c){if(void 0==c)return a.size;a.size=c;a.computeExtremities()}}(this);this.getAddress=function(){var a="",b=this;do a=b.name+"/"+a;while(void 0!=(b=b.parent));return"/"+a};this.computeExtremities=function(c){for(var b=this._static,d=this;void 0!=
(d=d.parent)&&!b;)b=b||d._static;this._static=b;c=void 0==c?a(this):c;this.extremities={points:[],boundingBox:{}};this.extremities.points=workspace.library.math.pointsOfText(this.text,this.x,this.y,this.angle,1/this.size,this.style.font,this.style.align,this.style.baseline);this.extremities.points=this.extremities.points.map(function(a){a=workspace.library.math.cartesianAngleAdjust(a.x,a.y,c.a);a.x+=c.x;a.y+=c.y;return a});this.extremities.boundingBox=workspace.library.math.boundingBoxFromPoints(this.extremities.points);
void 0!=this.parent&&this.parent.computeExtremities()};this.isPointWithin=function(a,b){if(void 0==this.extremities.boundingBox){console.warn("the shape",this,"has no bounding box");var c=!1}else c=workspace.library.math.detectOverlap.pointWithinBoundingBox({x:a,y:b},this.extremities.boundingBox);return c?(void 0==this.extremities.points?(console.warn("the shape",this,"has no points"),a=!1):a=workspace.library.math.detectOverlap.pointWithinPoly({x:a,y:b},this.extremities.points),a):!1};this.render=
function(a,b,g,h){b=void 0===b?{x:0,y:0,a:0}:b;g=void 0===g?!1:g;h=void 0===h?!1:h;var c=workspace.library.math.cartesianAngleAdjust(this.x,this.y,b.a);b.x+=c.x-this.x;b.y+=c.y-this.y;c={x:this.x+b.x,y:this.y+b.y};var e=this.size;b=this.angle+b.a;var k=this.style.lineWidth,n=this.style.shadowBlur,q=this.style.shadowOffset.x,m=this.style.shadowOffset.y;g||(c=d.workspacePoint2windowPoint(c.x,c.y),e=d.length(e),n=d.length(n),q=d.length(q),m=d.length(m));c=workspace.library.math.cartesianAngleAdjust(c.x,
c.y,-b);if(h)console.warn("no clipping available for text shape");else if(a.font=this.style.font,a.textAlign=this.style.align,a.textBaseline=this.style.baseline,a.fillStyle=this.style.fill,a.strokeStyle=this.style.stroke,a.lineWidth=k,a.shadowColor=this.style.shadowColour,a.shadowBlur=n,a.shadowOffsetX=q,a.shadowOffsetY=m,a.save(),a.rotate(b),a.scale(e,e),a.fillText(this.text,c.x/e,c.y/e),a.shadowColor="rgba(0,0,0,0)",a.strokeText(this.text,c.x/e,c.y/e),a.restore(),this.dotFrame){for(a=0;a<this.extremities.points.length;a++)g=
d.workspacePoint2windowPoint(this.extremities.points[a].x,this.extremities.points[a].y),f.render.drawDot(g.x,g.y,4,"rgba(50,50,50,1)");g=d.workspacePoint2windowPoint(this.extremities.boundingBox.topLeft.x,this.extremities.boundingBox.topLeft.y);f.render.drawDot(g.x,g.y);g=d.workspacePoint2windowPoint(this.extremities.boundingBox.bottomRight.x,this.extremities.boundingBox.bottomRight.y);f.render.drawDot(g.x,g.y)}}}};this.arrangement=new function(){var a=new g.group;a.name="root";this.createElement=
function(a){return new g[a]};this.clear=function(){a.clear()};this.get=function(){return a};this.set=function(b){a=b};this.prepend=function(b){a.prepend(b)};this.append=function(b){a.append(b)};this.remove=function(b){a.remove(b)};this.getElementUnderPoint=function(b,c,d,f){return a.getElementUnderPoint(b,c,void 0===d?!1:d,void 0===f?!1:f)};this.getElementsWithName=function(b){return a.getElementsWithName(b)}};this.viewport=new function(){function a(){function a(a){var b=a.charAt(0).toUpperCase()+
a.slice(1),d=workspace.getAttribute("workspace"+b);if(f[a]!=d||f["window"+b]!=window["inner"+b])f[a]=d,f["window"+b]=window["inner"+b],void 0==d?(workspace[a]=f.defaultSize[a]*window.devicePixelRatio,workspace.style[a]=f.defaultSize[a]+"px"):d.indexOf("%")==d.length-1?(b=workspace.parentElement["offset"+b],d=parseFloat(d.slice(0,d.length-1))/100,workspace[a]=b*d*window.devicePixelRatio,workspace.style[a]=b*d+"px"):(workspace[a]=d*window.devicePixelRatio,workspace.style[a]=d),c=!0}var c=!1;a("width");
a("height");c&&b()}function b(){g.points.tl=d.windowPoint2workspacePoint(0,0);g.points.tr=d.windowPoint2workspacePoint(workspace.width,0);g.points.bl=d.windowPoint2workspacePoint(0,workspace.height);g.points.br=d.windowPoint2workspacePoint(workspace.width,workspace.height);g.boundingBox=workspace.library.math.boundingBoxFromPoints([g.points.tl,g.points.tr,g.points.br,g.points.bl])}var f={defaultSize:{width:640,height:480},width:0,height:0,windowWidth:0,windowHeight:0},g={position:{x:0,y:0},scale:window.devicePixelRatio,
angle:0,points:{tl:{x:0,y:0},tr:{x:0,y:0},bl:{x:0,y:0},br:{x:0,y:0}},boundingBox:{topLeft:{x:0,y:0},bottomRight:{x:0,y:0}}},l=void 0,w=void 0,u=!1,n=!0;this.position=function(a,c){if(void 0==a||void 0==c)return{x:g.position.x,y:g.position.y};g.position.x=a;g.position.y=c;b()};this.scale=function(a){if(void 0==a)return g.scale;g.scale=0==a?window.devicePixelRatio:a;b()};this.angle=function(a){if(void 0==a)return g.angle;g.angle=a;b()};this.windowPoint2workspacePoint=function(a,b){return d.windowPoint2workspacePoint(a,
b)};this.refresh=function(){a();b();this.allowKeyboardInput(n)};this.getBoundingBox=function(){return g.boundingBox};this.mousePosition=function(a,b){if(void 0==a||void 0==b)return{x:l,y:w};l=a;w=b};this.stopMouseScroll=function(a){if(void 0==a)return u;u=a;a||(document.body.style.overflow="")};this.allowKeyboardInput=function(a){if(void 0==a)return n;(n=a)?workspace.setAttribute("tabIndex",1):workspace.removeAttribute("tabIndex")};this.cursor=function(a){if(void 0==a)return document.body.style.cursor;
document.body.style.cursor=a}};this.render=new function(){function a(a){void 0!==a&&a||(d.fillStyle="rgb(255,255,255)",d.fillRect(0,0,workspace.width,workspace.height));f.arrangement.get().render(d)}function b(c){g=requestAnimationFrame(b);try{a()}catch(w){f.render.active(!1),console.error("major animation error"),console.error(w)}f.stats.collect(c)}var d=workspace.getContext("2d",{alpha:!1}),g=void 0;this.drawDot=function(a,b,c,e){c=void 0===c?2:c;d.fillStyle=void 0===e?"rgba(150,150,255,1)":e;d.beginPath();
d.arc(a,b,c,0,2*Math.PI,!1);d.closePath();d.fill()};this.frame=function(b){a(void 0===b?!1:b)};this.active=function(a){if(void 0==a)return void 0!=g;a?void 0==g&&b():void 0!=g&&(cancelAnimationFrame(g),g=void 0)}};this.stats=new function(){var a=!1,b=0,d={compute:function(a){this.frameTimeArray.push(1E3/(a-b));30<=this.frameTimeArray.length&&this.frameTimeArray.shift();this.rate=workspace.library.math.averageArray(this.frameTimeArray);b=a},counter:0,frameTimeArray:[],rate:0},f={recursiveCount:function(a){void 0==
a&&(this.counts={total:0,canvas:0,circle:0,group:0,image:0,path:0,polygon:0,rectangle:0,text:0},a=workspace.core.arrangement.get());this.counts.total++;switch(a.type){case "canvas":this.counts.canvas++;break;case "circle":this.counts.circle++;break;case "group":this.counts.group++;break;case "image":this.counts.image++;break;case "path":this.counts.path++;break;case "polygon":this.counts.polygon++;break;case "rectangle":this.counts.rectangle++;break;case "text":this.counts.text++}if(void 0!=a.children)for(var b=
0;b<a.children.length;b++)this.recursiveCount(a.children[b])},recursivePrint:function(a,b){b=void 0===b?"":b;void 0==a&&(a=workspace.core.arrangement.get());console.log(b+a.name);if(void 0!=a.children)for(var c=0;c<a.children.length;c++)this.recursivePrint(a.children[c],b+"- ")},counts:{total:0,canvas:0,circle:0,group:0,image:0,path:0,polygon:0,rectangle:0,text:0}};this.collect=function(b){a&&d.compute(b)};this.active=function(b){if(void 0==b)return a;a=b};this.getReport=function(){f.recursiveCount();
return{framesPerSecond:d.rate,shapeCount:f.counts}}};this.callback=new function(){for(var a="onmousedown onmouseup onmousemove onmouseenter onmouseleave onwheel onclick ondblclick onkeydown onkeyup touchstart touchmove touchend touchenter touchleave touchcancel".split(" "),b={},g=0;g<a.length;b={$jscomp$loop$prop$getRelevantShape$7:b.$jscomp$loop$prop$getRelevantShape$7},g++){b.$jscomp$loop$prop$getRelevantShape$7=function(a,b,c){var d=f.arrangement.getElementUnderPoint(a,b);if(void 0!=d&&void 0==
d[c])for(a=f.arrangement.getElementUnderPoint(a,b,void 0,!0),b=0;b<a.length;b++)if(void 0!=a[b][c]){d=a[b];break}return d};this[a[g]]=function(a,b,c){};var h=0,l=0;workspace[a[g]]=function(a){return function(b){return function(c){if(f.callback[b]){var e=d.windowPoint2workspacePoint(c.x,c.y),g=a.$jscomp$loop$prop$getRelevantShape$7(e.x,e.y,b);f.callback[b](e.x,e.y,c,g)}}}}(b)(a[g]);workspace.onmouseover=function(a){return function(b){f.viewport.stopMouseScroll()&&(document.body.style.overflow="hidden");
if(f.callback.onmouseover){var c=d.windowPoint2workspacePoint(b.x,b.y),e=a.$jscomp$loop$prop$getRelevantShape$7(c.x,c.y,"onmouseover");f.callback.onmouseover(c.x,c.y,b,e)}}}(b);workspace.onmouseout=function(a){return function(b){f.viewport.stopMouseScroll()&&(document.body.style.overflow="");if(f.callback.onmouseout){var c=d.windowPoint2workspacePoint(b.x,b.y),e=a.$jscomp$loop$prop$getRelevantShape$7(c.x,c.y,"onmouseout");f.callback.onmouseout(c.x,c.y,b,e)}}}(b);workspace.onmousemove=function(a){return function(b){var c=
d.windowPoint2workspacePoint(b.x,b.y);f.viewport.mousePosition(c.x,c.y);if(f.callback.onmousemove){var e=a.$jscomp$loop$prop$getRelevantShape$7(h,l,"onmouseleave"),g=a.$jscomp$loop$prop$getRelevantShape$7(c.x,c.y,"onmouseenter"),k=a.$jscomp$loop$prop$getRelevantShape$7(c.x,c.y,"onmousemove");e!=g&&(f.callback.onmouseleave(c.x,c.y,b,e),f.callback.onmouseenter(c.x,c.y,b,g));f.callback.onmousemove(c.x,c.y,b,k);h=c.x;l=c.y}}}(b);workspace.onkeydown=function(a){return function(b){if(f.callback.onkeydown){var c=
f.viewport.mousePosition(),d=a.$jscomp$loop$prop$getRelevantShape$7(c.x,c.y,"onkeydown");f.callback.onkeydown(c.x,c.y,b,d)}}}(b);workspace.onkeyup=function(a){return function(b){if(f.callback.onkeyup){var c=f.viewport.mousePosition(),d=a.$jscomp$loop$prop$getRelevantShape$7(c.x,c.y,"onkeyup");f.callback.onkeyup(c.x,c.y,b,d)}}}(b)}};f.viewport.refresh();f.arrangement.clear()};this.arrangement=new function(){this.get=function(){return a.arrangement.get()};this.set=function(b){return a.arrangement.set(b)};
this.createElement=function(b){return a.arrangement.createElement(b)};this.append=function(b){return a.arrangement.append(b)};this.prepend=function(b){return a.arrangement.prepend(b)};this.remove=function(b){return a.arrangement.remove(b)};this.getElementUnderPoint=function(b,f){return a.arrangement.getElementUnderPoint(b,f)};this.getElementsWithName=function(b){return a.arrangement.getElementsWithName(b)};this.forceRefresh=function(b){return a.arrangement.forceRefresh(b)}};this.viewport=new function(){this.position=
function(b,f){return a.viewport.position(b,f)};this.scale=function(b){return a.viewport.scale(b)};this.angle=function(b){return a.viewport.angle(b)};this.windowPoint2workspacePoint=function(b,f){return a.viewport.windowPoint2workspacePoint(b,f)};this.refresh=function(){a.viewport.refresh()};this.mousePosition=function(){return a.viewport.mousePosition()};this.stopMouseScroll=function(b){return a.viewport.stopMouseScroll(b)};this.allowKeyboardInput=function(b){return a.viewport.allowKeyboardInput(b)};
this.cursor=function(b){return a.viewport.cursor(b)}};this.render=new function(){this.frame=function(b){return a.render.frame(void 0===b?!1:b)};this.active=function(b){return a.render.active(b)}};this.stats=new function(){this.active=function(b){return a.stats.active(b)};this.getReport=function(){return a.stats.getReport()}};this.callback=new function(){this.onmousedown=function(a,f,d,g){};a.callback.onmousedown=function(a){return function(b,d,g,c){a.onmousedown(b,d,g,c)}}(this);this.onmouseup=function(a,
f,d,g){};a.callback.onmouseup=function(a){return function(b,d,g,c){a.onmouseup(b,d,g,c)}}(this);this.onmousemove=function(a,f,d,g){};a.callback.onmousemove=function(a){return function(b,d,g,c){a.onmousemove(b,d,g,c)}}(this);this.onmouseenter=function(a,f,d,g){};a.callback.onmouseenter=function(a){return function(b,d,g,c){a.onmouseenter(b,d,g,c)}}(this);this.onmouseleave=function(a,f,d,g){};a.callback.onmouseleave=function(a){return function(b,d,g,c){a.onmouseleave(b,d,g,c)}}(this);this.onwheel=function(a,
f,d,g){};a.callback.onwheel=function(a){return function(b,d,g,c){a.onwheel(b,d,g,c)}}(this);this.onclick=function(a,f,d,g){};a.callback.onclick=function(a){return function(b,d,g,c){a.onclick(b,d,g,c)}}(this);this.ondblclick=function(a,f,d,g){};a.callback.ondblclick=function(a){return function(b,d,g,c){a.ondblclick(b,d,g,c)}}(this);this.onkeydown=function(a,f,d,g){};a.callback.onkeydown=function(a){return function(b,d,g,c){a.onkeydown(b,d,g,c)}}(this);this.onkeyup=function(a,f,d,g){};a.callback.onkeyup=
function(a){return function(b,d,g,c){a.onkeyup(b,d,g,c)}}(this);this.touchstart=function(a,f,d){};a.callback.touchstart=function(a){return function(b,d,g,c){a.touchstart(b,d,g)}}(this);this.touchmove=function(a,f,d){};a.callback.touchmove=function(a){return function(b,d,g,c){a.touchmove(b,d,g)}}(this);this.touchend=function(a,f,d){};a.callback.touchend=function(a){return function(b,d,g,c){a.touchend(b,d,g)}}(this);this.touchenter=function(a,f,d){};a.callback.touchenter=function(a){return function(b,
d,g,c){a.touchenter(b,d,g)}}(this);this.touchleave=function(a,f,d){};a.callback.touchleave=function(a){return function(b,d,g,c){a.touchleave(b,d,g)}}(this);this.touchcancel=function(a,f,d){};a.callback.touchcancel=function(a){return function(b,d,g,c){a.touchcancel(b,d,g)}}(this)}}};
